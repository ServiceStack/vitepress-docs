import{_ as n,c as s,o as a,a as t}from"./app.14440598.js";const y='{"title":"Validation and Error Handling","description":"","frontmatter":{"slug":"validation","title":"Validation and Error Handling"},"headers":[{"level":3,"title":"Typed, Structured Exceptions end-to-end","slug":"typed-structured-exceptions-end-to-end"},{"level":3,"title":"JavaScript support included","slug":"javascript-support-included"},{"level":2,"title":"How it works","slug":"how-it-works"},{"level":2,"title":"Throw a C# Exception","slug":"throw-a-c-exception"},{"level":3,"title":"Enabling StackTraces","slug":"enabling-stacktraces"},{"level":2,"title":"Customized Error Messages","slug":"customized-error-messages"},{"level":2,"title":"Validation Feature","slug":"validation-feature"},{"level":3,"title":"FluentValidation for request dtos","slug":"fluentvalidation-for-request-dtos"},{"level":3,"title":"Async Validators","slug":"async-validators"},{"level":3,"title":"Register Validators","slug":"register-validators"},{"level":3,"title":"Custom Validation","slug":"custom-validation"},{"level":2,"title":"Use FluentValidation Everywhere","slug":"use-fluentvalidation-everywhere"},{"level":2,"title":"Populating the Response DTO Manually","slug":"populating-the-response-dto-manually"},{"level":2,"title":"World Validation","slug":"world-validation"}],"relativePath":"validation.md","lastUpdated":1634495308454}',e={},o=t(`__VP_STATIC_START__<p>As validation and error handling is an essential part of developing services, ServiceStack provides a rich array of error handling options that work intuitively out-of-the-box.</p><p>Optimized for developer happiness ServiceStack allows you to idiomatically throw C# exceptions directly in your services and trivially consume them on the client with minimal effort, intuitively and conventionally - allowing the opportunity to inject generic error handling routines to handle errors for all your web services.</p><p>As a bonus the most appropriate HTTP Status code is returned based upon the C# Exception type.</p><h3 id="typed-structured-exceptions-end-to-end" tabindex="-1">Typed, Structured Exceptions end-to-end <a class="header-anchor" href="#typed-structured-exceptions-end-to-end" aria-hidden="true">#</a></h3><p>The error handling support works end-to-end where all errors get auto-serialized into your Response DTO and re-hydrated into a C# Exception on ServiceStack&#39;s generic Service Clients. This allows you to idiomatically treat errors like normal C# Exceptions - providing easy access to rich, structured error messages in your clients.</p><h3 id="javascript-support-included" tabindex="-1">JavaScript support included <a class="header-anchor" href="#javascript-support-included" aria-hidden="true">#</a></h3><p>To make it trivial to consume errors in JavaScript, you can use the lightweight and embedded dep-free <a href="/servicestack-client-umd.html#binding-html-forms">@servicestack/client form binding</a> library or the <a href="/ss-utils-js.html#bootstrap-forms">ss-utils.js</a> jQuery library to trivially bind your response errors to your <strong>HTML form fields</strong> with a <strong>single line of code</strong>.</p><h2 id="how-it-works" tabindex="-1">How it works <a class="header-anchor" href="#how-it-works" aria-hidden="true">#</a></h2><p>All Error handling and validation options described below are treated in the same way - serialized into the <code>ResponseStatus</code> property of your Response DTO making it possible for your clients applications to generically treat all Web Service Errors in the same way.</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>HelloResponse<span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//Follows naming convention and is in the same namespace as &#39;Hello&#39;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloResponse</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ResponseStatus</span> ResponseStatus <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">//Exception gets serialized here</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If now an exception occurs in the service implementation, the exception is serialized.</p><p><strong>Example JSON output:</strong></p><div class="language-json"><pre><code><span class="token punctuation">{</span>
    <span class="token property">&quot;ResponseStatus&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token property">&quot;ErrorCode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NotSupportedException&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;Message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;...&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>It&#39;s up to the client how to handle this service error.</p><h2 id="throw-a-c-exception" tabindex="-1">Throw a C# Exception <a class="header-anchor" href="#throw-a-c-exception" aria-hidden="true">#</a></h2><p>The easiest way to generate an Error in ServiceStack is to simply throw a C# Exception:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Post</span><span class="token punctuation">(</span><span class="token class-name">User</span> request<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>By Default C# Exceptions:</p><ul><li>Inheriting from ArgumentException are returned as a HTTP StatusCode of <strong>400 BadRequest</strong></li><li>NotImplementedException is returned as a <strong>405 MethodNotAllowed</strong></li><li>Other normal C# Exceptions are returned as <strong>500 InternalServerError</strong></li></ul><p>All Exceptions gets injected into the ResponseStatus property of your Response DTO that is serialized into your ServiceClient&#39;s preferred Content-Type making error handling transparent regardless of your preferred format - i.e. the same C# Error handling code can be used for all ServiceClients.</p><div class="language-csharp"><pre><code><span class="token keyword">try</span> 
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>BaseUri<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Send</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserResponse<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">WebServiceException</span> webEx<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token comment">/*
      webEx.StatusCode  = 400
      webEx.ErrorCode   = ArgumentNullException
      webEx.Message     = Value cannot be null. Parameter name: Name
      webEx.StackTrace  = (your Server Exception StackTrace - if DebugMode is enabled)
      webEx.ResponseDto = (your populated Response DTO)
      webEx.ResponseStatus   = (your populated Response Status DTO)
      webEx.GetFieldErrors() = (individual errors for each field if any)
    */</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="enabling-stacktraces" tabindex="-1">Enabling StackTraces <a class="header-anchor" href="#enabling-stacktraces" aria-hidden="true">#</a></h3><p>By default display StackTraces in your Response DTOs are disabled, but they&#39;re a good to have for development, which you can enable with:</p><div class="language-cs"><pre><code><span class="token function">SetConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">HostConfig</span> <span class="token punctuation">{</span> DebugMode <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="customized-error-messages" tabindex="-1">Customized Error Messages <a class="header-anchor" href="#customized-error-messages" aria-hidden="true">#</a></h2><p>If you want even finer grained control of your HTTP errors you can either <strong>throw</strong> or <strong>return</strong> a <strong>HttpError</strong> letting you customize the <strong>Http Headers</strong> and <strong>Status Code</strong> and HTTP Response <strong>body</strong> to get exactly what you want on the wire:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token class-name">User</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">throw</span> HttpError<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;User </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">request<span class="token punctuation">.</span>Name</span><span class="token punctuation">}</span></span><span class="token string"> does not exist&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>the above is a short-hand for <code>new HttpError(HttpStatusCode.NotFound, $&quot;User {request.Name} does not exist&quot;)</code> which returns a <strong>404</strong> NotFound StatusCode on the wire.</p><h2 id="validation-feature" tabindex="-1">Validation Feature <a class="header-anchor" href="#validation-feature" aria-hidden="true">#</a></h2><p>For more complex validation and to be able to return multiple validation errors ServiceStack includes the excellent <a href="https://github.com/JeremySkinner/FluentValidation" target="_blank" rel="noopener noreferrer">Fluent Validation</a> library by <a href="http://twitter.com/JeremySkinner" target="_blank" rel="noopener noreferrer">@JeremySkinner</a> - a very clean and DSL-like way to validate request DTOs. Even contextual validation for each HTTP method (GET, POST, ...) is supported.</p><p>ServiceStack&#39;s Fluent Validation feature is encapsulated in the <code>ValidationFeature</code> plugin which can be registered in your AppHost with:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ValidationFeature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="fluentvalidation-for-request-dtos" tabindex="-1">FluentValidation for request dtos <a class="header-anchor" href="#fluentvalidation-for-request-dtos" aria-hidden="true">#</a></h3><p>The example below uses this request dto for validation:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Company <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Count <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Address <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The validation rules for this request dto are made with <a href="https://github.com/JeremySkinner/FluentValidation/wiki" target="_blank" rel="noopener noreferrer">FluentValidation</a>. ServiceStack makes heavy use of <a href="https://github.com/JeremySkinner/FluentValidation/wiki/b.-Creating-a-Validator#rulesets" target="_blank" rel="noopener noreferrer">rule sets</a> to provide different validation rules for each HTTP method (GET, POST, PUT...).</p><div class="info custom-block"><p class="custom-block-title">Tip</p><p>First read the <a href="https://github.com/JeremySkinner/FluentValidation/wiki" target="_blank" rel="noopener noreferrer">documentation about FluentValidation</a> before you continue reading</p></div><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IAddressValidator</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ValidAddress</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> address<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddressValidator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IAddressValidator</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ValidAddress</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> address<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
	<span class="token keyword">return</span> address <span class="token operator">!=</span> <span class="token keyword">null</span>
	    <span class="token operator">&amp;&amp;</span> address<span class="token punctuation">.</span>Length <span class="token operator">&gt;=</span> <span class="token number">20</span>
	    <span class="token operator">&amp;&amp;</span> address<span class="token punctuation">.</span>Length <span class="token operator">&lt;=</span> <span class="token number">250</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserValidator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AbstractValidator<span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IAddressValidator</span> AddressValidator <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token function">UserValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//Validation rules for all requests</span>
        <span class="token function">RuleFor</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">RuleFor</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span>Age<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GreaterThan</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">RuleFor</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Address<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Must</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> AddressValidator<span class="token punctuation">.</span><span class="token function">ValidAddress</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//Validation rules for GET request</span>
        <span class="token function">RuleSet</span><span class="token punctuation">(</span>ApplyTo<span class="token punctuation">.</span>Get<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">RuleFor</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span>Count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GreaterThan</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//Validation rules for POST and PUT request</span>
        <span class="token function">RuleSet</span><span class="token punctuation">(</span>ApplyTo<span class="token punctuation">.</span>Post <span class="token operator">|</span> ApplyTo<span class="token punctuation">.</span>Put<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">RuleFor</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span>Company<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>ServiceStack adds another extension method named <code>RuleSet</code> which can handle <code>ApplyTo</code> enum flags. This method doesn&#39;t exist in the core FluentValidation framework</p></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>If a validator for a request dto is created, all rules which aren&#39;t in any rule set are executed <strong>+ the rules in the matching rule set</strong>. Normally FluentValidation only executes the matching rule set and <strong>ignores</strong> all other rules (whether they&#39;re in a rule set or not) and the rules which don&#39;t belong to any rule set are normally only executed, if no rule set-name was given to the validate method of the validator.</p></div><p>Like services registered in the IoC container, validators are also auto-wired, so if there&#39;s a public property which can be resolved by the IoC container, the IoC container will inject it. In this case, the IoC container will resolve the property <code>AddressValidator</code>, if an object of the type <code>IAddressValidator</code> was registered.</p><div class="info custom-block"><p class="custom-block-title">Tip</p><p>You can access the current <code>IRequest</code> in your Custom Validator from <code>base.Request</code></p></div><h3 id="async-validators" tabindex="-1">Async Validators <a class="header-anchor" href="#async-validators" aria-hidden="true">#</a></h3><p>Async validators can be registered using the <code>MustAsync</code> validator where you could simulate the following built-in <strong>Not Empty</strong> validation:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRequestValidator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AbstractValidator<span class="token punctuation">&lt;</span>MyRequest<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">MyRequestValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">RuleFor</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>And replace it with an Async version that uses the <a href="/service-gateway.html">Service Gateway</a> to call a custom Async <code>GetStringLength</code> Service that returns the same <code>ErrorCode</code> and Error Message as the <strong>Not Empty</strong> validator:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRequestValidator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AbstractValidator<span class="token punctuation">&lt;</span>MyRequest<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">MyRequestValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">RuleFor</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">MustAsync</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> token<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
            <span class="token punctuation">(</span><span class="token keyword">await</span> Gateway<span class="token punctuation">.</span><span class="token function">SendAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">GetStringLength</span> <span class="token punctuation">{</span> Value <span class="token operator">=</span> s <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Result <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">WithMessage</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;Name&#39; should not be empty.&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">WithErrorCode</span><span class="token punctuation">(</span><span class="token string">&quot;NotEmpty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="register-validators" tabindex="-1">Register Validators <a class="header-anchor" href="#register-validators" aria-hidden="true">#</a></h3><p>The <code>ValidationFeature</code> plugin automatically scans and auto-wires all validators in the <code>AppHost.ServiceAssemblies</code> that&#39;s injected in the <code>AppHost</code> constructor.</p><p>This default behavior can be <strong>disabled</strong> with:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ValidationFeature</span> <span class="token punctuation">{</span>
    ScanAppHostAssemblies <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Otherwise if the validators are in other assembles they can be registered using <code>RegisterValidators()</code>, e.g:</p><div class="language-csharp"><pre><code><span class="token comment">//This method scans the assembly for validators</span>
container<span class="token punctuation">.</span><span class="token function">RegisterValidators</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">UserValidator</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Optionally each validator can be registered individually:</p><div class="language-csharp"><pre><code><span class="token comment">//Add the IAdressValidator which will be injected into the UserValidator</span>
container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Register</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IAddressValidator<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AddressValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Now the service etc can be created and the validation rules are checked every time a request comes in.</p><p>If you try now for example to send this request:</p><div class="language-"><pre><code>POST localhost:50386/validated
{
    &quot;Name&quot;: &quot;Max&quot;
} 
</code></pre></div><p>You&#39;ll get this JSON response:</p><div class="language-json"><pre><code><span class="token punctuation">{</span>
    <span class="token property">&quot;ErrorCode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GreaterThan&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&#39;Age&#39; must be greater than &#39;0&#39;.&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Errors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;ErrorCode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GreaterThan&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;FieldName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Age&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&#39;Age&#39; must be greater than &#39;0&#39;.&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;ErrorCode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NotEmpty&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;FieldName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Company&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&#39;Company&#39; should not be empty.&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As you can see, the <code>ErrorCode</code> and the <code>FieldName</code> provide an easy way to handle the validation error at the client side. If you want, you can also configure a custom <code>ErrorCode</code> for a validation rule:</p><div class="language-csharp"><pre><code><span class="token function">RuleFor</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WithErrorCode</span><span class="token punctuation">(</span><span class="token string">&quot;ShouldNotBeEmpty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>If the rule fails, the JSON response will look like that:</p><div class="language-json"><pre><code><span class="token punctuation">{</span>
    <span class="token property">&quot;ErrorCode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ShouldNotBeEmpty&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;FieldName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&#39;Name&#39; should not be empty.&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="custom-validation" tabindex="-1">Custom Validation <a class="header-anchor" href="#custom-validation" aria-hidden="true">#</a></h3><p>ServiceStack&#39;s internal implementation of <a href="https://github.com/JeremySkinner/FluentValidation" target="_blank" rel="noopener noreferrer">FluentValidation</a> uses the latest 7.2 version which lets you take advantage of new features like implementing <a href="https://github.com/JeremySkinner/FluentValidation/wiki/e.-Custom-Validators#using-a-custom-validator" target="_blank" rel="noopener noreferrer">Custom Validators</a>, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomValidationValidator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AbstractValidator<span class="token punctuation">&lt;</span>CustomValidation<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">CustomValidationValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">RuleFor</span><span class="token punctuation">(</span>request <span class="token operator">=&gt;</span> request<span class="token punctuation">.</span>Code<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">RuleFor</span><span class="token punctuation">(</span>request <span class="token operator">=&gt;</span> request<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Custom</span><span class="token punctuation">(</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>Code<span class="token punctuation">?.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span><span class="token string">&quot;X-&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token class-name"><span class="token keyword">var</span></span> propName <span class="token operator">=</span> context<span class="token punctuation">.</span>ParentContext<span class="token punctuation">.</span>PropertyChain<span class="token punctuation">.</span><span class="token function">BuildPropertyName</span><span class="token punctuation">(</span><span class="token string">&quot;Code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    context<span class="token punctuation">.</span><span class="token function">AddFailure</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ValidationFailure</span><span class="token punctuation">(</span>propName<span class="token punctuation">,</span> <span class="token named-parameter punctuation">error</span><span class="token punctuation">:</span><span class="token string">&quot;Incorrect prefix&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        ErrorCode <span class="token operator">=</span> <span class="token string">&quot;NotFound&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="use-fluentvalidation-everywhere" tabindex="-1">Use FluentValidation Everywhere <a class="header-anchor" href="#use-fluentvalidation-everywhere" aria-hidden="true">#</a></h2><p>Of course FluentValidation can be used for any other classes (not only request DTOs), too:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Text <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Length <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now the validator:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestClassValidator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AbstractValidator<span class="token punctuation">&lt;</span>TestClass<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">TestClassValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">RuleFor</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">RuleFor</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GreaterThan</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>If FluentValidation isn&#39;t used for request DTOs, it behaves the same as documented in the <a href="https://github.com/JeremySkinner/FluentValidation/wiki" target="_blank" rel="noopener noreferrer">Fluent Validation documentation</a></p></div><p>Inside some service code you can validate an instance of this class:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SomeService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//You should have registered your validator in the IoC container to inject the validator into this property</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IValidator<span class="token punctuation">&lt;</span>TestClass<span class="token punctuation">&gt;</span></span> Validator <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token class-name">Validated</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">TestClass</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TestClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ValidationResult</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Validator<span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">.</span>IsValid<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//The result will be serialized into a ValidationErrorException and throw this one</span>
            <span class="token comment">//The errors will be serialized in a clean, human-readable way (as the above JSON example)</span>
            <span class="token keyword">throw</span> result<span class="token punctuation">.</span><span class="token function">ToException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="populating-the-response-dto-manually" tabindex="-1">Populating the Response DTO Manually <a class="header-anchor" href="#populating-the-response-dto-manually" aria-hidden="true">#</a></h2><p>All the error handling methods illustrated above are just sugar coating for serializing exceptions into your Response DTOs <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/ServiceInterface.ServiceModel/ResponseStatus.cs" target="_blank" rel="noopener noreferrer">ResponseStatus</a> property. You don&#39;t have use any of this as you can simply populate the ResponseStatus property yourself, coupled with the HttpResult class you have complete control of your HTTP Response - this gives you the necessary freedom so you are able to define your own Error handling API and helpers if you have an existing validation library that you would like to use instead.</p><h1 id="examples" tabindex="-1">Examples <a class="header-anchor" href="#examples" aria-hidden="true">#</a></h1><h2 id="world-validation" tabindex="-1"><a href="/world-validation.html">World Validation</a> <a class="header-anchor" href="#world-validation" aria-hidden="true">#</a></h2><p>See the annotated <a href="/world-validation.html">World Validation Docs</a> for a detailed example of Fluent Validation that walks through and showcases the implementation of how the most popular <strong>Server HTML rendered</strong> approaches and <strong>Client UI rendered</strong> technologies which are able all to use the same single suite of Fluent Validators and ServiceStack Services.</p>__VP_STATIC_END__`,80),p=[o];function c(l,u,i,r,k,d){return a(),s("div",null,p)}var g=n(e,[["render",c]]);export{y as __pageData,g as default};
