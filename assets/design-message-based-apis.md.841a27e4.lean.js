import{_ as n,c as s,o as a,a as t}from"./app.14440598.js";const y='{"title":"Design Message-based APIs","description":"","frontmatter":{"title":"Design Message-based APIs","slug":"design-message-based-apis"},"headers":[{"level":2,"title":"WCF vs ServiceStack API Design","slug":"wcf-vs-servicestack-api-design"},{"level":2,"title":"WebApi vs ServiceStack API Design","slug":"webapi-vs-servicestack-api-design"},{"level":3,"title":"ServiceStack Message-Based API Design","slug":"servicestack-message-based-api-design"},{"level":2,"title":"Group by Call Semantics and Response Types","slug":"group-by-call-semantics-and-response-types"},{"level":3,"title":"Separate One and Many Services","slug":"separate-one-and-many-services"},{"level":3,"title":"Distinguish Service Operations vs Types","slug":"distinguish-service-operations-vs-types"},{"level":3,"title":"Returning naked collections","slug":"returning-naked-collections"},{"level":3,"title":"Returning coarse-grained Response DTOs","slug":"returning-coarse-grained-response-dtos"},{"level":3,"title":"Using AutoQuery","slug":"using-autoquery"},{"level":3,"title":"Keep a consistent Nomenclature","slug":"keep-a-consistent-nomenclature"},{"level":3,"title":"Self-describing Service Contracts","slug":"self-describing-service-contracts"},{"level":2,"title":"Service implementation","slug":"service-implementation"},{"level":2,"title":"Error Handling and Validation","slug":"error-handling-and-validation"}],"relativePath":"design-message-based-apis.md","lastUpdated":1634495307618}',e={},p=t(`__VP_STATIC_START__<p>To give you a flavor of the differences you should think about when designing message-based services in ServiceStack we&#39;ll look at some examples to contrast WCF/WebApi vs ServiceStack&#39;s approach:</p><h2 id="wcf-vs-servicestack-api-design" tabindex="-1">WCF vs ServiceStack API Design <a class="header-anchor" href="#wcf-vs-servicestack-api-design" aria-hidden="true">#</a></h2><p>WCF encourages you to think of web services as normal C# method calls, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IWcfCustomerService</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name">Customer</span> <span class="token function">GetCustomerById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Customer<span class="token punctuation">&gt;</span></span> <span class="token function">GetCustomerByIds</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token return-type class-name">Customer</span> <span class="token function">GetCustomerByUserName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Customer<span class="token punctuation">&gt;</span></span> <span class="token function">GetCustomerByUserNames</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> userNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token return-type class-name">Customer</span> <span class="token function">GetCustomerByEmail</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Customer<span class="token punctuation">&gt;</span></span> <span class="token function">GetCustomerByEmails</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> emails<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This is what the same Service contract would look like in ServiceStack:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Customers</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>List<span class="token punctuation">&lt;</span>Customer<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span> 
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Ids <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> UserNames <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Emails <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The important concept to keep in mind is that the entire query (aka Request) is captured in the Request Message (i.e. Request DTO) and not in the server method signatures. The obvious immediate benefit of adopting a message-based design is that any combination of the above RPC calls can be fulfilled in 1 remote message, by a single service implementation which improves cacheability and simplifies maintenance and testing with the reduced API surface area.</p><h2 id="webapi-vs-servicestack-api-design" tabindex="-1">WebApi vs ServiceStack API Design <a class="header-anchor" href="#webapi-vs-servicestack-api-design" aria-hidden="true">#</a></h2><p>Likewise WebApi promotes a similar C#-like RPC Api that WCF does:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductsController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ApiController</span></span> 
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span> <span class="token function">GetAllProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> products<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">Product</span> <span class="token function">GetProductById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> product <span class="token operator">=</span> products<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>Id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>product <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpResponseException</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>NotFound<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> product<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">Product</span> <span class="token function">GetProductByName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> categoryName<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> product <span class="token operator">=</span> products<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>Name <span class="token operator">==</span> categoryName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>product <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpResponseException</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>NotFound<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> product<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span> <span class="token function">GetProductsByCategory</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> category<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> products<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>Category<span class="token punctuation">,</span> category<span class="token punctuation">,</span>
                StringComparison<span class="token punctuation">.</span>OrdinalIgnoreCase<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span> <span class="token function">GetProductsByPriceGreaterThan</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">decimal</span></span> price<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> products<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>Price <span class="token operator">&gt;</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="servicestack-message-based-api-design" tabindex="-1">ServiceStack Message-Based API Design <a class="header-anchor" href="#servicestack-message-based-api-design" aria-hidden="true">#</a></h3><p>Whilst ServiceStack encourages you to retain a Message-based Design:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SearchProducts</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>List<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span> 
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Category <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span><span class="token punctuation">?</span></span> PriceGreaterThan <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GetProduct</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span></span> 
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductsService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span> 
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token class-name">SearchProducts</span> request<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> ret <span class="token operator">=</span> products<span class="token punctuation">.</span><span class="token function">AsQueryable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>Category <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            ret <span class="token operator">=</span> ret<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Category <span class="token operator">==</span> request<span class="token punctuation">.</span>Category<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>PriceGreaterThan<span class="token punctuation">.</span>HasValue<span class="token punctuation">)</span>
            ret <span class="token operator">=</span> ret<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Price <span class="token operator">&gt;</span> request<span class="token punctuation">.</span>PriceGreaterThan<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>            
        <span class="token keyword">return</span> ret<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">Product</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token class-name">GetProduct</span> request<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> product <span class="token operator">=</span> <span class="token return-type class-name">request<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>HasValue
            <span class="token punctuation">?</span></span> products<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Id <span class="token operator">==</span> request<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>Value<span class="token punctuation">)</span>
            <span class="token punctuation">:</span> products<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Name <span class="token operator">==</span> request<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>product <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpError</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>NotFound<span class="token punctuation">,</span> <span class="token string">&quot;Product does not exist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> product<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Again capturing the essence of the Request in the Request DTO. The message-based design is also able to condense <strong>5 separate RPC</strong> WebAPI Services into <strong>2 message-based</strong> ServiceStack Services.</p><h2 id="group-by-call-semantics-and-response-types" tabindex="-1">Group by Call Semantics and Response Types <a class="header-anchor" href="#group-by-call-semantics-and-response-types" aria-hidden="true">#</a></h2><p>It&#39;s grouped into 2 different services in this example based on <strong>Call Semantics</strong> and <strong>Response Types</strong>:</p><p>Every property in each Request DTO has the same semantics that is for <code>SearchProducts</code> each property acts like a Filter (e.g. an AND) whilst in <code>GetProduct</code> it acts like a combinator (e.g. an OR). The Services also return <code>List&lt;Product&gt;</code> and <code>Product</code> return types which will require different handling in the call-sites of Typed APIs.</p><p>In WCF / WebAPI (and other RPC services frameworks) whenever you have a client-specific requirement you would add a new Server signature on the controller that matches that request. In ServiceStack&#39;s message-based approach however you&#39;re instead encouraged to think about where this feature intuitively fits and whether you&#39;re able to enhance existing services. You should also be thinking about how you can support the client-specific requirement in a <strong>generic way</strong> so that the same service could benefit other future potential use-cases.</p><h3 id="separate-one-and-many-services" tabindex="-1">Separate One and Many Services <a class="header-anchor" href="#separate-one-and-many-services" aria-hidden="true">#</a></h3><p>We can use the above context as a guide to design new Services. If we needed to design a Bookings System that needed an API to return <strong>All Bookings</strong> and a <strong>Single Booking</strong> we&#39;d use a separate Services as they&#39;d have different Response Types, e.g. <code>GetBooking</code> returns 1 booking whilst <code>GetBookings</code> returns many.</p><h3 id="distinguish-service-operations-vs-types" tabindex="-1">Distinguish Service Operations vs Types <a class="header-anchor" href="#distinguish-service-operations-vs-types" aria-hidden="true">#</a></h3><p>There should be a clean split between your Operations (aka Request DTOs) which is unique per service and is used to capture the Services&#39; request, and the DTO types they return. Request DTOs are usually actions so they&#39;re verbs, whilst DTO types are entities/data-containers so they&#39;re nouns.</p><h3 id="returning-naked-collections" tabindex="-1">Returning naked collections <a class="header-anchor" href="#returning-naked-collections" aria-hidden="true">#</a></h3><p>ServiceStack can return naked collections that <a href="/error-handling.html#error-response-types">don&#39;t require a ResponseStatus</a> property since if it doesn&#39;t exist the generic <code>ErrorResponse</code> DTO will be thrown and serialized on the client instead which frees you from having your Responses contain <code>ResponseStatus</code> property.</p><h3 id="returning-coarse-grained-response-dtos" tabindex="-1">Returning coarse-grained Response DTOs <a class="header-anchor" href="#returning-coarse-grained-response-dtos" aria-hidden="true">#</a></h3><p>However since they offer better versionability that can later be extended to return more results without breaking existing clients we prefer specifying explicit Response DTOs for each Service, although this is entirely optional. So our preferred message-based would look similar to:</p><div class="language-csharp"><pre><code><span class="token comment">// Operations</span>
<span class="token punctuation">[</span><span class="token function">Route</span><span class="token punctuation">(</span><span class="token string">&quot;/bookings/{Id}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GetBooking</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>GetBookingResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GetBookingResponse</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Booking</span> Result <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ResponseStatus</span> ResponseStatus <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// inject structured errors</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/bookings/search&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeachBookings</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>SeachBookingsResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>      
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> BookedAfter <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeachBookingsResponse</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>BookingLimit<span class="token punctuation">&gt;</span></span> Results <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ResponseStatus</span> ResponseStatus <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// inject structured errors </span>
<span class="token punctuation">}</span>

<span class="token comment">// Types</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Booking</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> ShiftId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> StartDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> EndDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Limit <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When they&#39;re not ambiguous we&#39;ll typiclly leave out specifying the <strong>Verb</strong> in <code>[Route]</code> definitions for <strong>GET</strong> Requests as its unnecessary.</p><h3 id="using-autoquery" tabindex="-1">Using AutoQuery <a class="header-anchor" href="#using-autoquery" aria-hidden="true">#</a></h3><p>Where possible we&#39;ll also use <a href="/autoquery-rdbms.html">AutoQuery for Search Services</a> which require dramatically less effort whilst offering a lot more functionality out-of-the-box. E.g. The Search Bookings Service with AutoQuery could adopt the same Customer Route and properties:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/bookings/search&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeachBookings</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">QueryDb<span class="token punctuation">&lt;</span>Booking<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>      
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> BookedAfter <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>But no implementation is needed as AutoQuery automatically creates the optimal implementation. AutoQuery also supports <a href="/autoquery-rdbms.html#implicit-conventions">Implicit Conventions</a> where you&#39;re able to filter by any of <code>Booking</code> table columns without any additional code or effort.</p><h3 id="keep-a-consistent-nomenclature" tabindex="-1">Keep a consistent Nomenclature <a class="header-anchor" href="#keep-a-consistent-nomenclature" aria-hidden="true">#</a></h3><p>You should reserve the word <strong>Get</strong> on services which query on unique or Primary Keys fields, i.e. when a supplied value matches a field (e.g. Id) it only <strong>Gets</strong> 1 result. For &quot;Search Services&quot; that acts like a filter and returns multiple matching results which falls within a desired range we recommend using prefixing Services with the <strong>Search</strong> or <strong>Find</strong> verbs to signal the behavior of the Service.</p><h3 id="self-describing-service-contracts" tabindex="-1">Self-describing Service Contracts <a class="header-anchor" href="#self-describing-service-contracts" aria-hidden="true">#</a></h3><p>Also try to be descriptive with each of your field names, these properties are part of your <strong>public API</strong> and should be self-describing as to what it does. E.g. By just looking at the Service Contract (e.g. Request DTO) we&#39;d have no idea what a plain <strong>Date</strong> property means, as it could mean either <strong>BookedAfter</strong>, <strong>BookedBefore</strong> or <strong>BookedOn</strong> if it only returned bookings made on that Day.</p><p>The benefit of this is now the call-sites of your <a href="/csharp-client.html">Typed .NET clients</a> become easier to read:</p><div class="language-csharp"><pre><code><span class="token class-name">Product</span> product <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">GetProduct</span> <span class="token punctuation">{</span> Id <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SearchBookings</span> <span class="token punctuation">{</span> BookedAfter <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Today <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="service-implementation" tabindex="-1">Service implementation <a class="header-anchor" href="#service-implementation" aria-hidden="true">#</a></h2><p><a href="/filter-attributes.html">Filter Attributes</a> can be applied on either the <strong>class</strong> or <strong>method</strong> level, so when you need to secure all Operations within a given Service you can just annotate the top-level Service class with the <code>[Authenticate]</code>, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Authenticate</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookingsService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span> 
<span class="token punctuation">{</span> 
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token class-name">GetBooking</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token class-name">SearchBookings</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="error-handling-and-validation" tabindex="-1">Error Handling and Validation <a class="header-anchor" href="#error-handling-and-validation" aria-hidden="true">#</a></h2><p>For info on how to add validation you either have the option to just <a href="/error-handling.html#throwing-c-exceptions">throw C# exceptions</a> and apply your own customizations to them. You also have the option to use the built-in <a href="/validation.html">Fluent Validation</a> but you don&#39;t need to inject them into your service as they can all be registered with a single line in your AppHost, e.g:</p><div class="language-csharp"><pre><code>container<span class="token punctuation">.</span><span class="token function">RegisterValidators</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">CreateBookingValidator</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Validators are no-touch and invasive free meaning you can add them using a layered approach and maintain them without modifying the service implementation or DTO classes. Since they require an extra class We&#39;d only use them on operations with side-effects e.g. <strong>POST</strong> or <strong>PUT</strong>, as <strong>GET</strong> requests tend to have minimal validation so throwing C# Exceptions typically requires less boilerplate. Here&#39;s an example of a validator you could have when creating a Booking:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateBookingValidator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AbstractValidator<span class="token punctuation">&lt;</span>CreateBooking<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">CreateBookingValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">RuleFor</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span>StartDate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">RuleFor</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span>ShiftId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GreaterThan</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">RuleFor</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span>Limit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GreaterThan</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Depending on the use-case instead of having separate <code>CreateBooking</code> and <code>UpdateBooking</code> DTOs you could re-use the same <code>StoreBooking</code> Request DTO to handle both operations.</p>__VP_STATIC_END__`,47),o=[p];function c(u,l,i,r,k,d){return a(),s("div",null,o)}var h=n(e,[["render",c]]);export{y as __pageData,h as default};
