import{_ as n,c as s,o as a,a as e}from"./app.14440598.js";const g='{"title":"HTTP Caching","description":"","frontmatter":{"slug":"http-caching","title":"HTTP Caching"},"headers":[{"level":2,"title":"CacheResponse Attribute","slug":"cacheresponse-attribute"},{"level":2,"title":"Cache-Aware Clients","slug":"cache-aware-clients"},{"level":3,"title":"Server Caching","slug":"server-caching"},{"level":3,"title":"HTTP Client Caching","slug":"http-client-caching"},{"level":3,"title":"Short-circuiting HTTP Cache Validation","slug":"short-circuiting-http-cache-validation"},{"level":2,"title":"Http Caching of Static Files","slug":"http-caching-of-static-files"}],"relativePath":"http-caching.md","lastUpdated":1634495307618}',t={},o=e(`__VP_STATIC_START__<p>ServiceStack&#39;s HTTP Caching support transparently improves the behavior of existing <code>ToOptimized</code> Cached Responses, provides a typed API to opt-in to <strong>HTTP Client</strong> features, introduces a simpler declarative API for enabling both <strong>Server and Client Caching</strong> of Services and also includes Cache-aware clients that are able to improve the performance and robustness of all existing .NET Service Clients - functionality that&#39;s especially valuable to bandwidth-constrained Xamarin.iOS / Xamarin.Android clients offering improved performance and greater resilience.</p><p>The new caching functionality is encapsulated in the new <code>HttpCacheFeature</code> plugin that&#39;s pre-registered by default and can be removed to disable the new HTTP Caching behavior with:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">RemoveAll</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x <span class="token keyword">is</span> <span class="token class-name">HttpCacheFeature</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Caching options in ServiceStack include using the existing <code>ToOptimizedResult*</code> API&#39;s to create <strong>Server Caches</strong> within your Services as well as returning a customized <code>HttpResult</code> to take advantage of <strong>HTTP Caching</strong> Client features.</p><h2 id="cacheresponse-attribute" tabindex="-1"><a href="/cacheresponse-attribute.html">CacheResponse Attribute</a> <a class="header-anchor" href="#cacheresponse-attribute" aria-hidden="true">#</a></h2><p>The new declarative <code>[CacheResponse]</code> <a href="/filter-attributes.html">Request Filter attribute</a> provides the best of both worlds supporting both Server and HTTP Client features which is both non-invasive and simple to enhance, as a result we expect it to be the most popular option for adding caching to your Services in future.</p><h2 id="cache-aware-clients" tabindex="-1"><a href="/cache-aware-clients.html">Cache-Aware Clients</a> <a class="header-anchor" href="#cache-aware-clients" aria-hidden="true">#</a></h2><p>The <strong>Server Caching</strong> and <strong>HTTP Caching</strong> features in ServiceStack will automatically benefit Websites as browsers have excellent support for HTTP Caching. But .NET Desktop Apps or Xamarin.iOS and Xamarin.Android mobile clients wont see any of these benefits since none of the existing Service Clients have support for <strong>HTTP Caching</strong>. To complete the story we&#39;ve also developed cache-aware Service Clients that can be used to enhance all existing .NET Service Clients which manages its own local cache as instructed by the HTTP Caching directives.</p><h3 id="server-caching" tabindex="-1">Server Caching <a class="header-anchor" href="#server-caching" aria-hidden="true">#</a></h3><p>To explain the new HTTP Caching features we&#39;ll revisit the ServiceStack&#39;s previous caching support which enables what we refer to as <strong>Server Caching</strong> where the response of a Service is cached in the registered <a href="/caching.html">Caching Provider</a> by calling the <code>ToOptimizedResult*</code> API&#39;s which lets you programmatically construct the Cache Key and/or how long the cache should be persisted for, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrdersService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">GetCustomers</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//Good candidates: request.ToGetUrl() or base.Request.RawUrl</span>
        <span class="token class-name"><span class="token keyword">var</span></span> cacheKey <span class="token operator">=</span> <span class="token string">&quot;unique_key_for_this_request&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> expireCacheIn <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromHours</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> Request<span class="token punctuation">.</span><span class="token function">ToOptimizedResultUsingCache</span><span class="token punctuation">(</span>Cache<span class="token punctuation">,</span> cacheKey<span class="token punctuation">,</span> expireCacheIn<span class="token punctuation">,</span> 
            <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">//Delegate executed only if item doesn&#39;t already exist in cache </span>
                <span class="token comment">//Any response DTO returned is cached on subsequent requests</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As the name indicates this stores the most optimal representation of the Service Response in the registered <code>ICacheClient</code>, so for example if a client called the above API with <code>Accept: application/json</code> and <code>Accept-Encoding: deflate, gzip</code> HTTP Request Headers ServiceStack would store the deflated serialized JSON bytes in the Cache and on subsequent requests resulting in the same cache key would write the compressed deflated bytes directly to the Response OutputStream - saving both CPU and bandwidth.</p><h4 id="more-optimal-optimizedresults" tabindex="-1">More Optimal OptimizedResults <a class="header-anchor" href="#more-optimal-optimizedresults" aria-hidden="true">#</a></h4><p>But there&#39;s an even more optimal result we could return instead: <strong>Nothing</strong> \u{1F603} and save even more CPU and bandwidth! Which is precisely what the <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html" target="_blank" rel="noopener noreferrer">HTTP Caching</a> directives built into the HTTP spec allow for. To enable it you&#39;d need to return additional HTTP Headers to the client containing the necessary metadata they can use to determine when their locally cached responses are valid. Typically this is the <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html#sec13.3.1" target="_blank" rel="noopener noreferrer">Last-Modified</a> date of when the Response/Resource was last modified or an <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html#sec13.3.2" target="_blank" rel="noopener noreferrer">Entity Tag</a> containing an opaque string the Server can use to determine whether the client has the most up-to-date response.</p><p>The most optimal cache validator we can use for existing <code>ToOptimizedResult*</code> API&#39;s is the <strong>Last Modified</strong> date which is now being cached along with the response. An additional instruction we need to return to the client is the <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9" target="_blank" rel="noopener noreferrer">Cache-Control</a> HTTP Response Header which instructs the client what caching behavior to apply to the server response. As we want the new behavior to work transparently without introducing caching issues to existing Services, we&#39;ve opted for a conservative:</p><div class="language-ini"><pre><code><span class="token key attr-name">Cache-Control: max-age</span><span class="token punctuation">=</span><span class="token value attr-value">0</span>
</code></pre></div><p>Which tells the client to treat the server response as immediately stale and that it should send another request to the Server for identical requests, but this time the client will append a <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.25" target="_blank" rel="noopener noreferrer">If-Modified-Since</a> HTTP Request Header which ServiceStack now automatically looks up to determine if the cache the client has is valid. If no newer cache for this request has been created since, ServiceStack returns a <strong>304 NotModified</strong> Response with an empty Request Body which tells the client it&#39;s safe to use their local cache instead.</p><h4 id="modify-cache-control-for-optimizedresults" tabindex="-1">Modify Cache-Control for OptimizedResults <a class="header-anchor" href="#modify-cache-control-for-optimizedresults" aria-hidden="true">#</a></h4><p>You can change the <code>Cache-Control</code> Header returned for existing <code>ToOptimizedResult</code> responses by modifying the pre-registered <code>HttpCacheFeature</code>, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> cacheFeature <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetPlugin</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>HttpCacheFeature<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cacheFeature<span class="token punctuation">.</span>CacheControlForOptimizedResults <span class="token operator">=</span> <span class="token string">&quot;max-age=3600, must-revalidate&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>This tells the client that they can treat their locally cached server responses as <strong>valid for 1hr</strong><br> but <strong>after 1hr</strong> they must check back with the Server to determine if their cache is still valid.</p><h3 id="http-client-caching" tabindex="-1">HTTP Client Caching <a class="header-anchor" href="#http-client-caching" aria-hidden="true">#</a></h3><p>The Caching features above revolve around enhancing existing <strong>Server Cached</strong> responses with <strong>HTTP Caching</strong> features to further reduce latency and save CPU and bandwidth resources. In addition to <strong>Server Caching</strong> pure stand-alone <strong>HTTP Caching</strong> features (i.e. that don&#39;t cache server responses) are now available as first-class properties on <code>HttpResult</code>:</p><div class="language-csharp"><pre><code><span class="token comment">// Only one Cache Validator below needs to be specified:</span>
<span class="token keyword">string</span> ETag            <span class="token comment">// opaque string representing integrity of response</span>
DateTime<span class="token punctuation">?</span> LastModified <span class="token comment">// the last time the response was Modified</span>

<span class="token comment">// Specify Client/Middleware Cache Behavior</span>
TimeSpan<span class="token punctuation">?</span> MaxAge          <span class="token comment">// How long cached response is considered valid</span>
CacheControl CacheControl <span class="token comment">// More options to specify Cache-Control behavior:</span>
<span class="token keyword">enum</span> <span class="token class-name">CacheControl</span> <span class="token punctuation">{</span>
    None<span class="token punctuation">,</span>
    Public<span class="token punctuation">,</span>
    Private<span class="token punctuation">,</span>
    MustRevalidate<span class="token punctuation">,</span>
    NoCache<span class="token punctuation">,</span>
    NoStore<span class="token punctuation">,</span>
    NoTransform<span class="token punctuation">,</span>
    ProxyRevalidate<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// Available, but rarely used</span>
TimeSpan<span class="token punctuation">?</span> Age      <span class="token comment">// Used by proxies to indicate how old cache is</span>
DateTime<span class="token punctuation">?</span> Expires  <span class="token comment">// Less preferred alternative to MaxAge</span>
</code></pre></div><p>We&#39;ll walk through a couple of real-world examples to show how we can make use of these new properties and explain the HTTP Caching behavior they enable.</p><h4 id="using-etags" tabindex="-1">Using ETags <a class="header-anchor" href="#using-etags" aria-hidden="true">#</a></h4><p>The minimum properties required for HTTP Caching is to specify either an <code>ETag</code> or <code>LastModified</code> Caching Validator. You can use any opaque string for the <code>ETag</code> that uniquely represents a version of the response that you can use to determine what version the client has, which could be an MD5 or SHA Hash of the response but can also be a unique version string. E.g. Adding a <code>RowVersion</code> property to your OrmLite POCO Data Models turns on <a href="https://github.com/ServiceStack/ServiceStack.OrmLite#optimistic-concurrency" target="_blank" rel="noopener noreferrer">OrmLite&#39;s Optimistic Concurrency</a> feature where each time a record is modified it&#39;s automatically populated with a new version, these characteristics makes it ideal for use as an ETag which we can just return as a string:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">GetCustomer</span> request<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> Db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">SingleById</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Customer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpResult</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ETag <span class="token operator">=</span> response<span class="token punctuation">.</span>RowVersion<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Whilst this is the minimum info required in your Services, the client also needs to know how long the cache is valid for as typically indicated by the <code>MaxAge</code> property. If it&#39;s omitted ServiceStack falls back to use the <code>HttpCacheFeature.DefaultMaxAge</code> of <strong>10 minutes</strong> which can be changed in your <code>AppHost</code> with:</p><div class="language-csharp"><pre><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetPlugin</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>HttpCacheFeature<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>DefaultMaxAge <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromHours</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>So the HTTP Response Headers the client receives when calling this Service for the first time is something similar to:</p><div class="language-ini"><pre><code>ETag: &quot;42&quot;
<span class="token key attr-name">Cache-Control: max-age</span><span class="token punctuation">=</span><span class="token value attr-value">600</span>
</code></pre></div><p>Which tells the client that they can use their local cache for identical requests issued within the next 10 minutes. After 10 minutes the cache is considered stale and the client will issue a new request to the server but this time it will include the <strong>ETag</strong> it has associated with the Response, i.e:</p><div class="language-ini"><pre><code>If-None-Match: &quot;42&quot;
</code></pre></div><p>When this happens the Service is still executed as normal and if the Customer hasn&#39;t changed, the <code>HttpCacheFeature</code> will compare the <code>HttpResult.ETag</code> response with the clients <strong>ETag</strong> above and if they match ServiceStack will instead return a <strong>304 NotModified</strong> with an Empty Response Body to indicate to the client that it can continue to use their locally cached response.</p><p>So whilst using a <code>HttpResult</code> <strong>doesn&#39;t cache</strong> the response <strong>on the Server</strong> and save further resources used in executing the Service, it still benefits from allowing the client to use their local cache for <strong>10 minutes</strong> - eliminating server requests and yielding instant response times. Then after <strong>10 minutes</strong> the <strong>304 NotModified</strong> Response Status and <strong>Empty Body</strong> improves latency and saves the Server CPU and bandwidth resources it didn&#39;t have to use for serializing and writing the executed Services response it would have need to do if no Caching was enabled.</p><h4 id="using-lastmodified" tabindex="-1">Using LastModified <a class="header-anchor" href="#using-lastmodified" aria-hidden="true">#</a></h4><p>The alternative to using an <code>ETag</code> is to use the <code>Last-Modified</code> Caching Validator. When you&#39;re constructing a complex response you&#39;ll want to use the <strong>most recent</strong> Last Modified Date from all sources so that you can determine that the cache is no longer valid when any of the sources have been updated.</p><p>If you also want to customize the clients <strong>Cache-Control</strong> behavior you can use the additional <code>HttpResult</code> properties, below is an example of doing both:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">GetCustomerOrders</span> request<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">GetCustomerOrdersResponse</span> <span class="token punctuation">{</span>
        Customer <span class="token operator">=</span> Db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">SingleById</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Customer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">,</span>
        Orders <span class="token operator">=</span> Db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Select</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Order<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>CustomerId <span class="token operator">==</span> request<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> allDates <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>DateTime<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>Orders<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>ModifiedDate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span>Customer<span class="token punctuation">.</span>ModifiedDate<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpResult</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        LastModified <span class="token operator">=</span> allDates<span class="token punctuation">.</span><span class="token function">OrderByDescending</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        MaxAge <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        CacheControl <span class="token operator">=</span> CacheControl<span class="token punctuation">.</span>Public <span class="token operator">|</span> CacheControl<span class="token punctuation">.</span>MustRevalidate<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Which returns the Last Modified Date of the <code>Customer</code> record or any of their <code>Orders</code> as well as the customized <strong>Cache-Control</strong> Header which together returns Response Headers similar to:</p><div class="language-ini"><pre><code>Last-Modified: Fri, 19 April 2016 05:00:00 GMT
<span class="token key attr-name">Cache-Control: max-age</span><span class="token punctuation">=</span><span class="token value attr-value">60, public, must-revalidate</span>
</code></pre></div><p>Then after <strong>60 seconds</strong> have elapsed the client will re-issue a request but instead of sending a <code>If-None-Match</code> Request Header and <strong>ETag</strong>, instead sends <code>If-Modified-Since</code> and the <strong>Last-Modified</strong> date:</p><div class="language-ini"><pre><code>If-Modified-Since: Fri, 19 April 2016 05:00:00 GMT
</code></pre></div><p>The resulting behavior is identical to that of the <strong>ETag</strong> above but instead compares the LastModified dates instead of ETag strings for validity.</p><h3 id="short-circuiting-http-cache-validation" tabindex="-1">Short-circuiting HTTP Cache Validation <a class="header-anchor" href="#short-circuiting-http-cache-validation" aria-hidden="true">#</a></h3><p>A further optimization that can be added to the HTTP Cache workflow is using <code>IRequest.HasValidCache()</code> to short-circuit the execution of a Service after you&#39;ve processed enough information to determine either the <code>ETag</code> or <code>LastModified</code> for the response.</p><p>For example if you had a Service that transcodes video on-the-fly, you can use <code>Request.HasValidCache()</code> to check whether the client already has the latest version of the video, if it does we can return a <strong>304 NotModified</strong> result directly, short-circuiting the Service and saving any resources in executing the remainder of the implementation, which in this case would <strong>bypass reading and transcoding</strong> the .mp4 video:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">GetOggVideo</span> request<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> mp4Video <span class="token operator">=</span> VirtualFileSources<span class="token punctuation">.</span><span class="token function">GetFile</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;/videos/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">request<span class="token punctuation">.</span>Id</span><span class="token punctuation">}</span></span><span class="token string">.mp4&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mp4Video <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> HttpError<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Video #</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">request<span class="token punctuation">.</span>Id</span><span class="token punctuation">}</span></span><span class="token string"> does not exist&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Request<span class="token punctuation">.</span><span class="token function">HasValidCache</span><span class="token punctuation">(</span>mp4Video<span class="token punctuation">.</span>LastModified<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> HttpResult<span class="token punctuation">.</span><span class="token function">NotModified</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name"><span class="token keyword">var</span></span> encodedOggBytes <span class="token operator">=</span> <span class="token function">EncodeToOggVideo</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">ReadAllBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpResult</span><span class="token punctuation">(</span>encodedOggBytes<span class="token punctuation">,</span> <span class="token string">&quot;video/ogg&quot;</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        LastModified <span class="token operator">=</span> mp4Video<span class="token punctuation">.</span>LastModified<span class="token punctuation">,</span>
        MaxAge <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromDays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="http-caching-of-static-files" tabindex="-1">Http Caching of Static Files <a class="header-anchor" href="#http-caching-of-static-files" aria-hidden="true">#</a></h2><p>Returning a static <a href="/virtual-file-system.html">Virtual File</a> or <code>FileInfo</code> in a <code>HttpResult</code> also sets the <strong>Last-Modified</strong> HTTP Response Header whose behavior instructs the pre-configured <code>HttpCacheFeature</code> to generate the necessary HTTP Headers so HTTP Clients are able to validate subsequent requests using the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-Modified-Since" target="_blank" rel="noopener noreferrer">If-Modified-Since</a> HTTP Request Header, allowing them to skip redownloading files they&#39;ve already cached locally.</p><p>This feature is leveraged in all Single Page App templates in its <code>[FallbackRoute]</code> implementation that&#39;s used to enable full page reloads by returning the Home <strong>index.html</strong> page for any unknown Requests, allowing routing to be handled on the client:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FallbackRoute</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/{PathInfo*}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FallbackForClientRoutes</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> PathInfo <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServices</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//Return default.html for unmatched requests so routing is handled on client</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">FallbackForClientRoutes</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpResult</span><span class="token punctuation">(</span>VirtualFileSources<span class="token punctuation">.</span><span class="token function">GetFile</span><span class="token punctuation">(</span><span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>__VP_STATIC_END__`,53),c=[o];function p(i,r,l,u,d,h){return a(),s("div",null,c)}var m=n(t,[["render",p]]);export{g as __pageData,m as default};
