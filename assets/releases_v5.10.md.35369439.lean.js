import{_ as n,c as s,o as a,a as t}from"./app.14440598.js";const g='{"title":"v5.10 Release Notes","description":"","frontmatter":{"title":"v5.10 Release Notes","slug":"v5-10"},"headers":[{"level":2,"title":"Table of Contents","slug":"table-of-contents"},{"level":2,"title":"Creating a multi-user .NET Core Booking system in minutes!","slug":"creating-a-multi-user-net-core-booking-system-in-minutes"},{"level":3,"title":"New features in Studio","slug":"new-features-in-studio"},{"level":3,"title":"Single Patch Partial Update API","slug":"single-patch-partial-update-api"},{"level":3,"title":"Download and Run","slug":"download-and-run"},{"level":3,"title":"Custom project from Scratch","slug":"custom-project-from-scratch"},{"level":3,"title":"Create Booking CRUD Services","slug":"create-booking-crud-services"},{"level":3,"title":"Run in ServiceStack Studio","slug":"run-in-servicestack-studio"},{"level":2,"title":"User Admin Feature","slug":"user-admin-feature"},{"level":3,"title":"Studio User Management UI","slug":"studio-user-management-ui"},{"level":3,"title":"Admin User Services","slug":"admin-user-services"},{"level":3,"title":"AutoQuery CRUD Behaviors","slug":"autoquery-crud-behaviors"},{"level":3,"title":"AutoQuery CRUD Events","slug":"autoquery-crud-events"},{"level":3,"title":"AutoQuery AutoGen Customizations","slug":"autoquery-autogen-customizations"},{"level":3,"title":"Ignore AutoCrud Properties","slug":"ignore-autocrud-properties"},{"level":3,"title":"OrderBy Random","slug":"orderby-random"},{"level":2,"title":"Advanced Native Type Code gen","slug":"advanced-native-type-code-gen"},{"level":3,"title":"Type Generation Filters","slug":"type-generation-filters"},{"level":2,"title":"Async Upgrade","slug":"async-upgrade"},{"level":3,"title":"Redis Async","slug":"redis-async"},{"level":3,"title":"Async DynamoDB PocoDynamo","slug":"async-dynamodb-pocodynamo"},{"level":2,"title":"Async Providers","slug":"async-providers"},{"level":3,"title":"Async Cache Clients","slug":"async-cache-clients"},{"level":3,"title":"Async Auth Repositories","slug":"async-auth-repositories"},{"level":2,"title":"Async Auth Providers","slug":"async-auth-providers"},{"level":3,"title":"Breaking Changes","slug":"breaking-changes"},{"level":3,"title":"Auth Response & URL Redirect Filters","slug":"auth-response-url-redirect-filters"},{"level":3,"title":"Cookie Config Changes","slug":"cookie-config-changes"},{"level":3,"title":"JWT Server Cookie Config","slug":"jwt-server-cookie-config"},{"level":3,"title":"Session Save APIs","slug":"session-save-apis"},{"level":3,"title":"Authenticate & Register Services","slug":"authenticate-register-services"},{"level":3,"title":"Optional *Async Suffixes","slug":"optional-async-suffixes"},{"level":2,"title":"Group Services by Tag","slug":"group-services-by-tag"},{"level":2,"title":"Configure localhost development dev certificate","slug":"configure-localhost-development-dev-certificate"},{"level":3,"title":"When localhost is not allowed","slug":"when-localhost-is-not-allowed"},{"level":3,"title":"When developing for Android","slug":"when-developing-for-android"},{"level":3,"title":"When developing for iOS","slug":"when-developing-for-ios"},{"level":3,"title":"Generating self-signed SSL Certificates for Custom Domains","slug":"generating-self-signed-ssl-certificates-for-custom-domains"},{"level":3,"title":"Trust self-signed certificate","slug":"trust-self-signed-certificate"},{"level":3,"title":"Configure in .NET Core","slug":"configure-in-net-core"},{"level":3,"title":"Accessing from Browsers","slug":"accessing-from-browsers"},{"level":3,"title":"Accessing from C# Clients","slug":"accessing-from-c-clients"},{"level":3,"title":"Accessing from Native Applications","slug":"accessing-from-native-applications"},{"level":3,"title":"Flutter Android","slug":"flutter-android"},{"level":3,"title":"Removing Certificate Artifacts","slug":"removing-certificate-artifacts"},{"level":2,"title":"Sign In with Apple","slug":"sign-in-with-apple"},{"level":3,"title":"github.com/NetCoreApps/AppleSignIn","slug":"github-com-netcoreapps-applesignin"},{"level":3,"title":"Sign In with Apple Requirements","slug":"sign-in-with-apple-requirements"},{"level":3,"title":"Create project with preferred Auth Configuration","slug":"create-project-with-preferred-auth-configuration"},{"level":3,"title":"Clone working Client & Server Project","slug":"clone-working-client-server-project"},{"level":2,"title":"Flutter iOS & Android App","slug":"flutter-ios-android-app"},{"level":3,"title":"signinwith_apple package","slug":"sign-in-with-apple-package"},{"level":3,"title":"New User Registration","slug":"new-user-registration"},{"level":3,"title":"Persistent Authenticated Sessions","slug":"persistent-authenticated-sessions"},{"level":3,"title":"Authenticated API Requests","slug":"authenticated-api-requests"},{"level":3,"title":"Resetting App Sign in","slug":"resetting-app-sign-in"},{"level":3,"title":"Flutter Android signinwith_apple requirements","slug":"flutter-android-sign-in-with-apple-requirements"},{"level":2,"title":"SwiftUI App","slug":"swiftui-app"},{"level":3,"title":"Add ServiceStack.Swift package","slug":"add-servicestack-swift-package"},{"level":3,"title":"Enabling Sign In With Apple Capability","slug":"enabling-sign-in-with-apple-capability"},{"level":3,"title":"SwiftUI Layout","slug":"swiftui-layout"},{"level":3,"title":"Loading persistent JWT Auth Tokens","slug":"loading-persistent-jwt-auth-tokens"},{"level":3,"title":"Authenticated Requests","slug":"authenticated-requests"},{"level":3,"title":"Advanced Configuration","slug":"advanced-configuration"},{"level":2,"title":"Enhanced Dart support","slug":"enhanced-dart-support"},{"level":3,"title":"New Dart Client APIs","slug":"new-dart-client-apis"},{"level":3,"title":"Support for Naked Lists","slug":"support-for-naked-lists"},{"level":2,"title":"Blazor Web Assembly Template","slug":"blazor-web-assembly-template"},{"level":3,"title":"Executing in a Standalone Desktop app","slug":"executing-in-a-standalone-desktop-app"},{"level":2,"title":"Blazor Service Client","slug":"blazor-service-client"},{"level":2,"title":"Vue .NET Core Windows Desktop App Template","slug":"vue-net-core-windows-desktop-app-template"},{"level":3,"title":"Why Chromium Desktop Apps?","slug":"why-chromium-desktop-apps"},{"level":3,"title":"Blazor WASM Starting Project Template","slug":"blazor-wasm-starting-project-template"},{"level":3,"title":"Opinionated App Launcher","slug":"opinionated-app-launcher"},{"level":3,"title":"Native Win32 API Interop","slug":"native-win32-api-interop"},{"level":3,"title":"Fluent Validation","slug":"fluent-validation"},{"level":3,"title":"OrmLite","slug":"ormlite"},{"level":3,"title":"ServiceStack.Text","slug":"servicestack-text"},{"level":3,"title":"HttpError","slug":"httperror"},{"level":2,"title":"Feedback Welcome!","slug":"feedback-welcome"}],"relativePath":"releases/v5.10.md","lastUpdated":1634495308442}',e={},p=t(`__VP_STATIC_START__<p>This release continues to bring improvements across the board with a major async focus on most of ServiceStack&#39;s existing sync APIs gaining pure async implementations allowing your App&#39;s logic to use their preferred <strong>sync</strong> or <strong>async</strong> APIs.</p><p>Improvements to <a href="/autoquery-crud.html">AutoQuery CRUD</a>, ServiceStack <a href="/studio.html">Studio</a> and new <strong>User Admin Module</strong> allows you to develop new systems from scratch at an unprecedented pace using only declarative code-first C# POCOs to define both system Data Models and their Typed API-first System inputs/outputs. Their enhanced declarative featureset lets you easily compose additional functionality from fine-grain <a href="/declarative-validation.html">Validation Rules</a> &amp; Authorization <a href="/declarative-validation.html#type-validators">Access permissions</a> to common CRUD logic made possible by <a href="/autoquery-crud.html#autoquery-crud-attributes">AutoQuery CRUD Attributes</a>.</p><p>ServiceStack Studio can then be used to give <strong>Authorized Users an Instant UI</strong> to access <a href="/autoquery-rdbms.html">AutoQuery</a> Services resulting in an immediate fully queryable (inc. export to Excel) &amp; management UI over system tables within minutes. By virtue of being normal ServiceStack Services, AutoQuery APIs also inherit ServiceStack&#39;s ecosystem of features like <a href="/add-servicestack-reference.html">Add ServiceStack Reference</a> enabling high-performance end-to-end typed API access in all popular Web, Mobile &amp; Desktop platforms.</p><h2 id="table-of-contents" tabindex="-1">Table of Contents <a class="header-anchor" href="#table-of-contents" aria-hidden="true">#</a></h2><ul><li><a href="#creating-a-multi-user-net-core-booking-system-in-minutes">Creating a multi-user .NET Core Booking system in minutes!</a><ul><li><a href="#new-features-in-studio">New features in Studio</a></li><li><a href="#single-patch-partial-update-api">Single Patch Partial Update API</a></li><li><a href="#custom-project-from-scratch">Custom project from Scratch</a></li><li><a href="#create-booking-crud-services">Create Booking CRUD Services</a></li><li><a href="#run-in-servicestack-studio">Run in ServiceStack Studio</a></li></ul></li><li><a href="#">User Admin Feature</a><ul><li><a href="#run-in-servicestack-studio">Studio User Management UI</a></li><li><a href="#admin-user-services">Admin User Services</a></li><li><a href="#autoquery-crud-behaviors">AutoQuery CRUD Behaviors</a></li><li><a href="#autoquery-crud-events">AutoQuery CRUD Events</a></li><li><a href="#autoquery-autogen-customizations">AutoQuery AutoGen Customizations</a></li><li><a href="#ignore-autocrud-properties">Ignore AutoCrud Properties</a></li><li><a href="#orderby-random">OrderBy Random</a></li></ul></li><li><a href="#advanced-native-type-code-gen">Advanced Native Type Code gen</a></li><li><a href="#async-upgrade">Async Upgrade</a><ul><li><a href="#redis-async">Redis Async</a></li><li><a href="#async-dynamodb-pocodynamo">Async DynamoDB PocoDynamo</a></li><li><a href="#async-cache-clients">Async Cache Clients</a></li><li><a href="#async-auth-repositories">Async Auth Repositories</a></li></ul></li><li><a href="#async-auth-providers">Async Auth Providers</a><ul><li><a href="#breaking-changes">Breaking Changes</a></li><li><a href="#auth-response--url-redirect-filters">Auth Response &amp; URL Redirect Filters</a></li><li><a href="#cookie-config-changes">Cookie Config Changes</a></li><li><a href="#jwt-server-cookie-config">JWT Server Cookie Config</a></li><li><a href="#session-save-apis">Session Save APIs</a></li><li><a href="#authenticate--register-services">Authenticate &amp; Register Services</a></li><li><a href="#optional-async-suffixes">Optional *Async Suffixes</a></li><li><a href="#support-for-valuetask">Support for ValueTask</a></li></ul></li><li><a href="#group-services-by-tag">Group Services by Tag</a></li><li><a href="#configure-localhost-development-dev-certificate">Configure localhost development dev certificate</a><ul><li><a href="#when-localhost-is-not-allowed">When localhost is not allowed</a></li><li><a href="#when-developing-for-android">When developing for Android</a></li><li><a href="#when-developing-for-ios">When developing for iOS</a></li><li><a href="#generating-self-signed-ssl-certificates-for-custom-domains">Generating SSL Certificates for Custom Domains</a></li><li><a href="#trust-self-signed-certificate">Trust self-signed certificate</a></li><li><a href="#flutter-android">Flutter Android</a></li></ul></li><li><a href="#sign-in-with-apple">Sign In with Apple</a><ul><li><a href="#sign-in-with-apple-requirements">Sign In with Apple Requirements</a></li><li><a href="#create-project-with-preferred-auth-configuration">Create project with preferred Auth Configuration</a></li><li><a href="#clone-working-client--server-project">Clone working Client &amp; Server Project</a></li><li><a href="#flutter-ios--android-app">Flutter iOS &amp; Android App</a></li><li><a href="#swiftui-app">SwiftUI App</a></li><li><a href="#advanced-configuration">Advanced Configuration</a></li></ul></li><li><a href="#enhanced-dart-support">Enhanced Dart support</a></li><li><a href="#blazor-web-assembly-template">Blazor Web Assembly Template</a><ul><li><a href="#executing-in-a-standalone-desktop-app">Executing in a Standalone Desktop app</a></li></ul></li><li><a href="#blazor-service-client">Blazor Service Client</a></li><li><a href="#vue-net-core-windows-desktop-app-template">Vue .NET Core Windows Desktop App Template</a><ul><li><a href="#why-chromium-desktop-apps">Why Chromium Desktop Apps?</a></li><li><a href="#blazor-wasm-starting-project-template">Blazor WASM Starting Project Template</a><ul><li><a href="#distributed-app-size">Distributed App Size</a></li><li><a href="#live-reload">Live Reload</a></li><li><a href="#reload-time">Reload Time</a></li><li><a href="#native-win32-api-interop">Native Win32 API Interop</a></li></ul></li></ul></li><li><a href="#fluent-validation">Fluent Validation</a></li><li><a href="#ormlite">OrmLite</a></li><li><a href="#servicestacktext">ServiceStack.Text</a></li></ul><h2 id="creating-a-multi-user-net-core-booking-system-in-minutes" tabindex="-1">Creating a multi-user .NET Core Booking system in minutes! <a class="header-anchor" href="#creating-a-multi-user-net-core-booking-system-in-minutes" aria-hidden="true">#</a></h2><p>To see the rapid development of AutoQuery in action we&#39;ve created a quick demo showing how to create a simple multi-user Booking System from an empty <a href="https://github.com/NetCoreTemplates/web" target="_blank" rel="noopener noreferrer">web</a> project, <a href="/mix-tool.html">mixed in</a> with the preferred RDBMS &amp; Auth layered functionality, before enabling <a href="/validation.html">Validation</a>, <a href="/autoquery-rdbms.html">AutoQuery</a>, Admin Users &amp; <a href="/autoquery-audit-log.html">CRUD Event Log</a> plugins - to lay the foundational features before building our App by first defining its <code>Booking</code> data model &amp; its surrounding <strong>Query</strong>, <strong>Create</strong>, <strong>Update</strong> and <strong>Soft Delete</strong> Typed CRUD APIs with rich validation enforced by declarative Validation attributes and multi-layer authorization rules &amp; access permissions protected using Authorization attributes.</p><p>All declarative functionality is accessible in ServiceStack Studio which is used to create new Employee &amp; Manager Users, before signing in with each to hit the ground running and start entering new bookings using Studio&#39;s capability-based UI, with each change visible in its full <strong>Audit History</strong>.</p><blockquote><p>YouTube: <a href="https://youtu.be/XpHAaCTV7jE" target="_blank" rel="noopener noreferrer">youtu.be/XpHAaCTV7jE</a></p></blockquote><p><a href="https://youtu.be/XpHAaCTV7jE" target="_blank" rel="noopener noreferrer"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/studio/bookings-splash.png" alt=""></a></p><h3 id="new-features-in-studio" tabindex="-1">New features in Studio <a class="header-anchor" href="#new-features-in-studio" aria-hidden="true">#</a></h3><p>New features in Studio in this release which made this a more seamless experience include:</p><ul><li>New <strong>User Admin</strong> module for ServiceStack Apps with the <code>UserAdminFeature</code> plugin enabled</li><li>Create &amp; Edit UIs now use optimal Text, Number, Date/Time, Checkbox UI Controls for relevant C# Data Types, inc. drop-down select box for <code>Enum</code> values</li><li>The <code>IPatchDb&lt;T&gt;</code> API can be used for both inline spreadsheet edits as well as updates made by Edit UI</li></ul><h3 id="single-patch-partial-update-api" tabindex="-1">Single Patch Partial Update API <a class="header-anchor" href="#single-patch-partial-update-api" aria-hidden="true">#</a></h3><p>Previously the Edit UI required the full update <code>IUpdateDb&lt;T&gt;</code> API, but now supports falling back to using a partial <code>IPatchDb&lt;T&gt;</code> API (if exists) where it will instead <strong>only update the modified fields</strong> that have changed.</p><p>Ultimately this means for most cases you&#39;ll only need to provide a single <code>IPatchDb&lt;T&gt;</code> API to update your data model as it allows for the most flexible functionality of only updating any <strong>non-null</strong> values provided. This does mean that every property other than the primary key should either be a <strong>nullable reference or Value Type</strong> (i.e. using <code>Nullable</code>).</p><p>Using <code>IPatchDb&lt;T&gt;</code> Partial Updates are also beneficial in <a href="/autoquery-audit-log.html">crud audit logs</a> as they only capture the fields that have changed instead of full record <code>IUpdateDb&lt;T&gt;</code> updates.</p><p><code>IPatchDb&lt;T&gt;</code> APIs can also be used to reset fields to <code>null</code> by specifying them in a <code>Reset</code> DTO string collection Property or <strong>Request Param</strong>, e.g. <code>?reset=Field1,Field2</code>.</p><h3 id="download-and-run" tabindex="-1">Download and Run <a class="header-anchor" href="#download-and-run" aria-hidden="true">#</a></h3><p>The quickest way to run the <a href="https://github.com/NetCoreApps/BookingsCrud" target="_blank" rel="noopener noreferrer">Bookings AutoQuery Example</a> is to install the <a href="/netcore-windows-desktop.html">app tool</a>, download &amp; run the repo:</p><pre><code>$ app download NetCoreApps/BookingsCrud
$ cd BookingsCrud\\Acme
$ dotnet run
</code></pre><h3 id="custom-project-from-scratch" tabindex="-1">Custom project from Scratch <a class="header-anchor" href="#custom-project-from-scratch" aria-hidden="true">#</a></h3><p>If you have different App requirements you can instead create a project from scratch that integrates with your existing preferred infrastructure - the <a href="/mix-tool.html">mix tool</a> and ServiceStack&#39;s layered <a href="/modular-startup.html">Modular Startup</a> configurations makes this a cinch, start with an empty <code>web</code> project:</p><pre><code>$ app new web ProjectName
</code></pre><p>Then mix in your desired features. E.g. In order for this project to be self-hosting it utilizes the embedded SQLite database, which we can configure along with configuration to enable popular Authentication providers and an RDBMS SQLite Auth Repository with:</p><pre><code>$ app mix auth auth-db sqlite
</code></pre><p>But if you also wanted to enable the new <a href="/auth-signin-with-apple.html">Sign in with Apple</a> and use SQL Server you&#39;ll instead run:</p><pre><code>$ app mix auth-ext auth-db sqlserver
</code></pre><p>You can view all DB and Auth options available by searching for available layered gist configurations by tag:</p><pre><code>$ app mix [db]
$ app mix [auth]
</code></pre><p>Typically the only configuration that needs updating is your DB connection string in <a href="https://github.com/NetCoreApps/BookingsCrud/blob/main/Acme/Configure.Db.cs" target="_blank" rel="noopener noreferrer">Configure.Db.cs</a>, in this case it&#39;s changed to use a persistent SQLite DB:</p><div class="language-csharp"><pre><code>services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDbConnectionFactory<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">OrmLiteConnectionFactory</span><span class="token punctuation">(</span>
    Configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;DefaultConnection&quot;</span><span class="token punctuation">)</span> 
        <span class="token operator">??</span> <span class="token string">&quot;bookings.sqlite&quot;</span><span class="token punctuation">,</span>
    SqliteDialect<span class="token punctuation">.</span>Provider<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You&#39;ll also want to create RDBMS tables for any that doesn&#39;t exist:</p><div class="language-csharp"><pre><code><span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> db <span class="token operator">=</span> appHost<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDbConnectionFactory<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">CreateTableIfNotExists</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Booking<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="create-booking-crud-services" tabindex="-1">Create Booking CRUD Services <a class="header-anchor" href="#create-booking-crud-services" aria-hidden="true">#</a></h3><p>The beauty of AutoQuery is that we only need to focus on the definition of our C# POCO Data Models which OrmLite uses to create the RDBMS tables and AutoQuery reuses to generates the Typed API implementations enabling us to build full functional high-performance systems with rich querying capabilities that we can further enhance with declarative validation &amp; authorization permissions and rich integrations with the most popular platforms without needing to write any logic.</p><p>The <code>Booking</code> class defines the Data Model whilst the remaining AutoQuery &amp; CRUD Services define the typed inputs, outputs and behavior of each API available that Queries and Modifies the <code>Booking</code> table.</p><p>An added utilized feature are the <code>[AutoApply]</code> attributes which applies generic behavior to AutoQuery Services. The <code>Behavior.Audit*</code> behaviors below depend on the same property names used in the <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/AuditBase.cs" target="_blank" rel="noopener noreferrer">AuditBase.cs</a> class where:</p><ul><li><code>Behavior.AuditQuery</code> - adds an <a href="/autoquery-crud.html#autofilter">Ensure AutoFilter</a> to filter out any deleted records</li><li><code>Behavior.AuditCreate</code> - populates the <code>Created*</code> and <code>Modified*</code> properties with the Authenticated user info</li><li><code>Behavior.AuditModify</code> - populates the <code>Modified*</code> properties with the Authenticated user info</li><li><code>Behavior.AuditSoftDelete</code> - changes the behavior of the default <strong>Real Delete</strong> to a <strong>Soft Delete</strong> by<br> populating the <code>Deleted*</code> properties</li></ul><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Booking</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AuditBase</span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoIncrement</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">RoomType</span> RoomType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> RoomNumber <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> BookingStartDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> BookingEndDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span></span> Cost <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Notes <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span><span class="token punctuation">?</span></span> Cancelled <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">RoomType</span>
<span class="token punctuation">{</span>
    Single<span class="token punctuation">,</span>
    Double<span class="token punctuation">,</span>
    Queen<span class="token punctuation">,</span>
    Twin<span class="token punctuation">,</span>
    Suite<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Behavior<span class="token punctuation">.</span>AuditQuery<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryBookings</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">QueryDb<span class="token punctuation">&lt;</span>Booking<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Ids <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateHasRole</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Employee&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Behavior<span class="token punctuation">.</span>AuditCreate<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateBooking</span>
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICreateDb<span class="token punctuation">&lt;</span>Booking<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>IdResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiAllowableValues</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">RoomType</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">RoomType</span> RoomType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateGreaterThan</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> RoomNumber <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> BookingStartDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> BookingEndDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateGreaterThan</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span></span> Cost <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Notes <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateHasRole</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Employee&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Behavior<span class="token punctuation">.</span>AuditModify<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpdateBooking</span>
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IPatchDb<span class="token punctuation">&lt;</span>Booking<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>IdResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiAllowableValues</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">RoomType</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">RoomType<span class="token punctuation">?</span></span> RoomType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateGreaterThan</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> RoomNumber <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> BookingStartDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> BookingEndDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateGreaterThan</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span><span class="token punctuation">?</span></span> Cost <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span><span class="token punctuation">?</span></span> Cancelled <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Notes <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateHasRole</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Manager&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Behavior<span class="token punctuation">.</span>AuditSoftDelete<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeleteBooking</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDeleteDb<span class="token punctuation">&lt;</span>Booking<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturnVoid</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="run-in-servicestack-studio" tabindex="-1">Run in ServiceStack Studio <a class="header-anchor" href="#run-in-servicestack-studio" aria-hidden="true">#</a></h3><p>After defining your AutoQuery APIs, start your App then you can use <a href="/studio.html">ServiceStack Studio</a> UI to manage Bookings and Users which can be launched from a URL:</p><h3 id="app-studio" tabindex="-1"><a href="app://studio">app://studio</a> <a class="header-anchor" href="#app-studio" aria-hidden="true">#</a></h3><blockquote><p>If your browser is open, the quickest way to launch it is just to type <code>app://studio</code> in your URL bar</p></blockquote><h2 id="user-admin-feature" tabindex="-1">User Admin Feature <a class="header-anchor" href="#user-admin-feature" aria-hidden="true">#</a></h2><p>We&#39;ve caught a glimpse of the new User Admin Feature in the <a href="https://youtu.be/XpHAaCTV7jE" target="_blank" rel="noopener noreferrer">Bookings CRUD demo</a> who utilizes it to create <strong>Employee</strong> and <strong>Manager</strong> users. The <code>AdminUsersFeature</code> provides Admin User Management APIs enabling remote programmatic access to your registered <a href="/authentication-and-authorization.html#user-auth-repository">User Auth Repository</a>, featuring:</p><ul><li>Works with existing <code>IUserAuthRepository</code> sync or async providers</li><li>Utilizes Progressive enhancement, e.g. search functionality utilizes <code>IQueryUserAuth</code> (if exists) performing a wildcard search over multiple fields, otherwise falls back to exact match on <code>UserName</code> or <code>Email</code></li><li>Supports managing Auth Repositories utilizing custom <code>UserAuth</code> data models</li><li>Flexible UI options for customizing which fields to include in Search Results and Create/Edit UIs</li><li>Rich Metadata aggregating only App-specific Roles &amp; Permissions defined in your App</li><li>User Events allow you to execute custom logic before &amp; after each Created/Updated/Deleted User</li></ul><p>User Admin Plugin is a lightweight API around Auth Repository APIs with no additional dependencies that can be registered as normal:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AdminUsersFeature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="studio-user-management-ui" tabindex="-1">Studio User Management UI <a class="header-anchor" href="#studio-user-management-ui" aria-hidden="true">#</a></h3><p>Where Studio&#39;s compatibility-based API will only enable it for remote ServiceStack instances with the plugin enabled:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/studio/studio-home.png" alt=""></p><p>In the Users Module you&#39;ll need to Sign In as an <strong>Admin</strong> User to gain access which for new Apps created with <code>auth-db</code> mix script will only have the admin user:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/studio/studio-user-results.png" alt=""></p><p>That was created in the <a href="https://github.com/NetCoreApps/BookingsCrud/blob/main/Acme/Configure.AuthRepository.cs" target="_blank" rel="noopener noreferrer">Configure.AuthRepository.cs</a> Modular <a href="/modular-startup.html">Startup</a> script:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IAppHost</span> appHost<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> authRepo <span class="token operator">=</span> appHost<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IAuthRepository<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    authRepo<span class="token punctuation">.</span><span class="token function">InitSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">CreateUser</span><span class="token punctuation">(</span>authRepo<span class="token punctuation">,</span> <span class="token string">&quot;admin@email.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Admin User&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;p@55wOrd&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">roles</span><span class="token punctuation">:</span><span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span> RoleNames<span class="token punctuation">.</span>Admin <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CreateUser</span><span class="token punctuation">(</span><span class="token class-name">IAuthRepository</span> authRepo<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> email<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> pass<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> roles<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>authRepo<span class="token punctuation">.</span><span class="token function">GetUserAuthByUserName</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> authRepo<span class="token punctuation">.</span><span class="token function">CreateUserAuth</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AppUser</span> <span class="token punctuation">{</span> Email <span class="token operator">=</span> email<span class="token punctuation">,</span> DisplayName <span class="token operator">=</span> name <span class="token punctuation">}</span><span class="token punctuation">,</span> pass<span class="token punctuation">)</span><span class="token punctuation">;</span>
    authRepo<span class="token punctuation">.</span><span class="token function">AssignRoles</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> roles<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This screen allows you Search for &amp; edit existing users or create new Users. Both Create &amp; Edit forms will default to only showing the most common User Info fields for creating a new User:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/studio/bookings-crud-screenshot.png" alt=""></p><p>Whilst the Edit UI also lets you perform common actions like changing a Users Password, Locking Users and Assigning Roles &amp; Permissions which are auto populated from the Required &amp; Validation Roles/Permission Attributes used in your App:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/studio/studio-user-default-edit.png" alt=""></p><p>The fields in the Search Results and User forms can also be customized to suit your App. Lets say we want to use a custom <code>AppUser</code> class with a few additional fields, the <code>LastLoginIp</code> and <code>LastLoginDate</code> we&#39;ll want automatically populated using the <a href="https://github.com/NetCoreApps/BookingsCrud/blob/main/Acme/Configure.AuthRepository.cs" target="_blank" rel="noopener noreferrer">OnAuthenticated AuthEvent</a> whilst we want to add the users <code>Currency</code> to both the <code>IncludeUserAuthProperties</code> to include them in the Management forms and the <code>QueryUserAuthProperties</code> so they&#39;re returned in Search Results.</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppUser</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">UserAuth</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> LastLoginIp <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> LastLoginDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Currency <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IAuthRepository<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OrmLiteAuthRepository<span class="token punctuation">&lt;</span>AppUser<span class="token punctuation">,</span> UserAuthDetails<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDbConnectionFactory<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        UseDistinctRoleTables <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            

Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AdminUsersFeature</span> <span class="token punctuation">{</span>
    <span class="token comment">// Defaults to only allow &#39;Admin&#39; users to manage users</span>
    <span class="token comment">// AdminRole = RoleNames.Admin, </span>
    IncludeUserAuthProperties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">nameof</span><span class="token punctuation">(</span>AppUser<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">nameof</span><span class="token punctuation">(</span>AppUser<span class="token punctuation">.</span>Email<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">nameof</span><span class="token punctuation">(</span>AppUser<span class="token punctuation">.</span>DisplayName<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">nameof</span><span class="token punctuation">(</span>AppUser<span class="token punctuation">.</span>FirstName<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">nameof</span><span class="token punctuation">(</span>AppUser<span class="token punctuation">.</span>LastName<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">nameof</span><span class="token punctuation">(</span>AppUser<span class="token punctuation">.</span>Company<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">nameof</span><span class="token punctuation">(</span>AppUser<span class="token punctuation">.</span>PhoneNumber<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">nameof</span><span class="token punctuation">(</span>AppUser<span class="token punctuation">.</span>LockedDate<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">nameof</span><span class="token punctuation">(</span>AppUser<span class="token punctuation">.</span>Currency<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    QueryUserAuthProperties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">nameof</span><span class="token punctuation">(</span>AppUser<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">nameof</span><span class="token punctuation">(</span>AppUser<span class="token punctuation">.</span>Email<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">nameof</span><span class="token punctuation">(</span>AppUser<span class="token punctuation">.</span>FirstName<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">nameof</span><span class="token punctuation">(</span>AppUser<span class="token punctuation">.</span>LastName<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">nameof</span><span class="token punctuation">(</span>AppUser<span class="token punctuation">.</span>Company<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">nameof</span><span class="token punctuation">(</span>AppUser<span class="token punctuation">.</span>Currency<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">nameof</span><span class="token punctuation">(</span>AppUser<span class="token punctuation">.</span>CreatedDate<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// Update denormalized data</span>
    OnAfterUpdateUser <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>newUser<span class="token punctuation">,</span> oldUser<span class="token punctuation">,</span> service<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newUser<span class="token punctuation">.</span>Email <span class="token operator">!=</span> oldUser<span class="token punctuation">.</span>Email<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">await</span> service<span class="token punctuation">.</span>Db<span class="token punctuation">.</span><span class="token function">UpdateOnlyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Customer</span> <span class="token punctuation">{</span> Email <span class="token operator">=</span> newUser<span class="token punctuation">.</span>Email <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">where</span><span class="token punctuation">:</span> q <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>Id <span class="token operator">==</span> oldUser<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> service<span class="token punctuation">.</span>Db<span class="token punctuation">.</span><span class="token function">UpdateOnlyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Subscription</span> <span class="token punctuation">{</span> Email <span class="token operator">=</span> newUser<span class="token punctuation">.</span>Email <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">where</span><span class="token punctuation">:</span> q <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>CustomerId <span class="token operator">==</span> oldUser<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We also don&#39;t want to store any Address info on our Users so we&#39;ve excluded them in our field lists which will result in our Custom UI:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/studio/studio-user-customfields.png" alt=""></p><p>Our Custom Configuration makes use of custom event hooks for performing Custom App logic, in this case it uses the <code>OnAfterUpdateUser</code> event to update denormalized data when it detects a Users email has changed.</p><p>Alternatively you can prevent emails from being changed whilst still displaying them in the UI forms with an <code>OnBeforeUpdateUser</code> event:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AdminUsersFeature</span> <span class="token punctuation">{</span>
    <span class="token comment">// Disable Changing Email</span>
    OnBeforeUpdateUser <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>newUser<span class="token punctuation">,</span> oldUser<span class="token punctuation">,</span> service<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newUser<span class="token punctuation">.</span>Email <span class="token operator">!=</span> oldUser<span class="token punctuation">.</span>Email<span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot change Email&quot;</span><span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>IUserAuth<span class="token punctuation">.</span>Email<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>There are <code>OnBefore</code>/<code>OnAfter</code> hooks for <code>Create</code>/<code>Update</code>/<code>Delete</code> User Events.</p><h3 id="admin-user-services" tabindex="-1">Admin User Services <a class="header-anchor" href="#admin-user-services" aria-hidden="true">#</a></h3><p>Of course user management isn&#39;t limited to Studio&#39;s UI as you can use the back-end APIs integrated within your own Apps. Here are all Admin Users DTOs containing everything needed to call its APIs from <a href="/csharp-client.html">.NET Service Clients</a>. These are contained within <strong>ServiceStack.Client</strong> so no additional dependencies are needed.</p><p>The APIs are fairly straight-forward with each DTO containing on the bare minimum Typed properties with all other UserAuth fields you want updated in the <code>UserAuthProperties</code> Dictionary. Whilst all User result-sets are returned in an unstructured Object Dictionary.</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AdminUserBase</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IMeta</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> UserName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FirstName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> LastName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> DisplayName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Email <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Password <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ProfileUrl <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> UserAuthProperties <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> Meta <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">AdminCreateUser</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AdminUserBase</span><span class="token punctuation">,</span> <span class="token class-name">IPost</span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>AdminUserResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> Roles <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> Permissions <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">AdminUpdateUser</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AdminUserBase</span><span class="token punctuation">,</span> <span class="token class-name">IPut</span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>AdminUserResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span><span class="token punctuation">?</span></span> LockUser <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span><span class="token punctuation">?</span></span> UnlockUser <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> AddRoles <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> RemoveRoles <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> AddPermissions <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> RemovePermissions <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">AdminGetUser</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IGet</span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>AdminUserResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">AdminDeleteUser</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDelete</span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>AdminDeleteUserResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdminDeleteUserResponse</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IHasResponseStatus</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ResponseStatus</span> ResponseStatus <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">AdminUserResponse</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IHasResponseStatus</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> Result <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ResponseStatus</span> ResponseStatus <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">AdminQueryUsers</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IGet</span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>AdminUsersResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Query <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> OrderBy <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> Skip <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> Take <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdminUsersResponse</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IHasResponseStatus</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> Results <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ResponseStatus</span> ResponseStatus <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="autoquery-crud-behaviors" tabindex="-1">AutoQuery CRUD Behaviors <a class="header-anchor" href="#autoquery-crud-behaviors" aria-hidden="true">#</a></h3><p>One of the features the Bookings demo takes advantage of are the new <code>[AutoApply]</code> attributes for applying generic behavior to AutoQuery CRUD Services:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Behavior</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Auto Filter SoftDeleted Results</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> AuditQuery <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Auto Populate CreatedDate, CreatedBy, ModifiedDate &amp; ModifiedBy fields</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> AuditCreate <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditCreate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Auto Populate ModifiedDate &amp; ModifiedBy fields</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> AuditModify <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditModify<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Auto Populate DeletedDate &amp; DeletedBy fields</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> AuditDelete <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditDelete<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Auto Populate DeletedDate &amp; DeletedBy fields and changes IDeleteDb operation to Update</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> AuditSoftDelete <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditSoftDelete<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This functionality is implemented by extending the metadata for AutoQuery CRUD Services with additional attributes in a <code>AutoCrudMetadataFilters</code> where they result in the same behavior as if the Request DTOs were annotated with attributes directly. E.g. Here&#39;s the built-in filter for implementing the above behaviors:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AuditAutoCrudMetadataFilter</span><span class="token punctuation">(</span><span class="token class-name">AutoCrudMetadata</span> meta<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> applyAttr <span class="token keyword">in</span> meta<span class="token punctuation">.</span>AutoApplyAttrs<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>applyAttr<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">case</span> Behavior<span class="token punctuation">.</span>AuditQuery<span class="token punctuation">:</span>
                meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoFilterAttribute</span><span class="token punctuation">(</span>
                    QueryTerm<span class="token punctuation">.</span>Ensure<span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>DeletedDate<span class="token punctuation">)</span><span class="token punctuation">,</span> SqlTemplate<span class="token punctuation">.</span>IsNull<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> Behavior<span class="token punctuation">.</span>AuditCreate<span class="token punctuation">:</span>
            <span class="token keyword">case</span> Behavior<span class="token punctuation">.</span>AuditModify<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>applyAttr<span class="token punctuation">.</span>Name <span class="token operator">==</span> Behavior<span class="token punctuation">.</span>AuditCreate<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoPopulateAttribute</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>CreatedDate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        Eval <span class="token operator">=</span> <span class="token string">&quot;utcNow&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoPopulateAttribute</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>CreatedBy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        Eval <span class="token operator">=</span> <span class="token string">&quot;userAuthName&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoPopulateAttribute</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>ModifiedDate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    Eval <span class="token operator">=</span> <span class="token string">&quot;utcNow&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoPopulateAttribute</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>ModifiedBy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    Eval <span class="token operator">=</span> <span class="token string">&quot;userAuthName&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> Behavior<span class="token punctuation">.</span>AuditDelete<span class="token punctuation">:</span>
            <span class="token keyword">case</span> Behavior<span class="token punctuation">.</span>AuditSoftDelete<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>applyAttr<span class="token punctuation">.</span>Name <span class="token operator">==</span> Behavior<span class="token punctuation">.</span>AuditSoftDelete<span class="token punctuation">)</span>
                    meta<span class="token punctuation">.</span>SoftDelete <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

                meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoPopulateAttribute</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>DeletedDate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    Eval <span class="token operator">=</span> <span class="token string">&quot;utcNow&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoPopulateAttribute</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>DeletedBy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    Eval <span class="token operator">=</span> <span class="token string">&quot;userAuthName&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Which results in the behavior had the AutoQuery Request been annotated with the attributes directly:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Behavior<span class="token punctuation">.</span>AuditQuery<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryBookings</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span> <span class="token comment">// Equivalent to:</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoFilter</span><span class="token attribute-arguments"><span class="token punctuation">(</span>QueryTerm<span class="token punctuation">.</span>Ensure<span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>DeletedDate<span class="token punctuation">)</span><span class="token punctuation">,</span> Template <span class="token operator">=</span> SqlTemplate<span class="token punctuation">.</span>IsNull<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryBookings</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>


<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Behavior<span class="token punctuation">.</span>AuditCreate<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateBooking</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span> <span class="token comment">// Equivalent to:</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>CreatedDate<span class="token punctuation">)</span><span class="token punctuation">,</span>  Eval <span class="token operator">=</span> <span class="token string">&quot;utcNow&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>CreatedBy<span class="token punctuation">)</span><span class="token punctuation">,</span>    Eval <span class="token operator">=</span> <span class="token string">&quot;userAuthName&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>ModifiedDate<span class="token punctuation">)</span><span class="token punctuation">,</span> Eval <span class="token operator">=</span> <span class="token string">&quot;utcNow&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>ModifiedBy<span class="token punctuation">)</span><span class="token punctuation">,</span>   Eval <span class="token operator">=</span> <span class="token string">&quot;userAuthName&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateBooking</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><p>You can use this same functionality to describe your own custom generic functionality, e.g. Lets say you wanted to instead populate your base class with Audit Info containing different named properties with <strong>local</strong> <code>DateTime</code> and UserAuth <code>Id</code>. You can define your own Behavior name for this functionality:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;MyUpdate&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpdateBooking</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><p>and implement it with a custom <code>AutoCrudMetadataFilters</code> that populates the Audit <code>[AutoPopulate]</code> attributes on all Request DTOs marked with your Behavior name, e.g:</p><div class="language-csharp"><pre><code><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MyAuditFilter</span><span class="token punctuation">(</span><span class="token class-name">AutoCrudMetadata</span> meta<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>meta<span class="token punctuation">.</span><span class="token function">HasAutoApply</span><span class="token punctuation">(</span><span class="token string">&quot;MyUpdate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoPopulateAttribute</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MyBase<span class="token punctuation">.</span>MyModifiedDate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Eval <span class="token operator">=</span> <span class="token string">&quot;now&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoPopulateAttribute</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MyBase<span class="token punctuation">.</span>MyModifiedBy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Eval <span class="token operator">=</span> <span class="token string">&quot;userAuthId&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoQueryFeature</span> <span class="token punctuation">{</span>
    AutoCrudMetadataFilters <span class="token operator">=</span> <span class="token punctuation">{</span> MyAuditFilter <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="autoquery-crud-events" tabindex="-1">AutoQuery CRUD Events <a class="header-anchor" href="#autoquery-crud-events" aria-hidden="true">#</a></h3><p>AutoQuery now includes <code>OnBefore*</code> and <code>OnAfter*</code> (sync &amp; async) events for <code>Create</code>, <code>Update</code>, <code>Patch</code> &amp; <code>Delete</code> you can use to execute custom logic before or after each AutoQuery CRUD operation. E.g. if your system implements their own Audit history via RDBMS triggers, you can use the <code>OnBefore</code> <strong>Delete</strong> event to update the record with deleted info before the AutoQuery CRUD operation deletes it:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoQueryFeature</span> <span class="token punctuation">{</span>
    OnBeforeDeleteAsync <span class="token operator">=</span> <span class="token keyword">async</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>Dto <span class="token keyword">is</span> <span class="token class-name">DeleteBooking</span> deleteBooking<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> session <span class="token operator">=</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token function">GetSessionAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>Db<span class="token punctuation">.</span><span class="token function">UpdateOnlyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Booking</span> <span class="token punctuation">{</span>
                DeletedBy <span class="token operator">=</span> session<span class="token punctuation">.</span>UserAuthName<span class="token punctuation">,</span>
                DeletedDate <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">where</span><span class="token punctuation">:</span> x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Id <span class="token operator">==</span> deleteBooking<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>                
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Note: AutoQuery generates <strong>async</strong> Services by default which will invoke the <code>*Async</code> events, but if you implement a <a href="/autoquery-crud.html#custom-autoquery-crud-services">sync Custom AutoQuery CRUD Service</a> it executes the <strong>sync</strong> events instead so you&#39;d need to implement the <code>OnBeforeDelete</code> custom hook instead.</p><h3 id="autoquery-autogen-customizations" tabindex="-1">AutoQuery AutoGen Customizations <a class="header-anchor" href="#autoquery-autogen-customizations" aria-hidden="true">#</a></h3><p>AutoGen&#39;s <a href="/servicify.html">Instantly Servicify existing Systems</a> feature works by automatically generating the AutoQuery &amp; Crud APIs and Data Models for all tables in the configured RDBMS&#39;s. The existing <a href="/autoquery-autogen.html#customize-code-generation-to-include-app-conventions">Customizable Code Generation filters</a> have been extended to allow customization of the DataModel Names, the user-defined Route Path they&#39;re hosted at &amp; the name of individual AutoQuery APIs for each operation.</p><p>So if you had an existing table name called <code>applications</code> the default convention based names would be:</p><ul><li>Data Model: <code>Applications</code></li><li>APIs: <code>CreateApplications</code>, <code>PatchApplications</code>, <code>QueryApplications</code>, etc</li><li>Route: <code>/applications</code>, <code>/applications/{Id}</code></li></ul><p>You can change each of these default conventions with the new <code>GenerateOperationsFilter</code>, e.g:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoQueryFeature</span> <span class="token punctuation">{</span>
    MaxLimit <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    GenerateCrudServices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">GenerateCrudServices</span> <span class="token punctuation">{</span>
        AutoRegister <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        GenerateOperationsFilter <span class="token operator">=</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>TableName <span class="token operator">==</span> <span class="token string">&quot;applications&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                ctx<span class="token punctuation">.</span>DataModelName <span class="token operator">=</span> <span class="token string">&quot;Application&quot;</span><span class="token punctuation">;</span>
                ctx<span class="token punctuation">.</span>PluralDataModelName <span class="token operator">=</span> <span class="token string">&quot;Apps&quot;</span><span class="token punctuation">;</span>
                ctx<span class="token punctuation">.</span>RoutePathBase <span class="token operator">=</span> <span class="token string">&quot;/apps&quot;</span><span class="token punctuation">;</span>
                ctx<span class="token punctuation">.</span>OperationNames <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
                    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoCrudOperation<span class="token punctuation">.</span>Create</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;CreateApp&quot;</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoCrudOperation<span class="token punctuation">.</span>Patch</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;ModifyApp&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Would result in:</p><ul><li>Data Model: <code>Application</code></li><li>APIs: <code>QueryApps</code>, <code>CreateApp</code>, <code>ModifyApp</code></li><li>Route: <code>/apps</code>, <code>/apps/{Id}</code></li></ul><h3 id="ignore-autocrud-properties" tabindex="-1">Ignore AutoCrud Properties <a class="header-anchor" href="#ignore-autocrud-properties" aria-hidden="true">#</a></h3><p>If you&#39;re creating <a href="/autoquery-crud.html#custom-autoquery-crud-services">Custom AutoQuery CRUD Services</a> you can ignore &amp; skip the validation of properties that don&#39;t map to the Request&#39;s Data Model individually annotating properties with the <code>[AutoIgnore]</code> Attribute, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomRockstarService</span> 
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICreateDb<span class="token punctuation">&lt;</span>Rockstar<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>RockstarWithIdResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoIgnore</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">CustomInfo</span> CustomInfo <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span><span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Or you can ignore validation for all properties with the same name by registering it on <code>AutoQuery.IncludeCrudProperties</code> , e.g:</p><div class="language-csharp"><pre><code>AutoQuery<span class="token punctuation">.</span>IncludeCrudProperties<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>CustomInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="orderby-random" tabindex="-1">OrderBy Random <a class="header-anchor" href="#orderby-random" aria-hidden="true">#</a></h3><p>AutoQuery <code>OrderBy</code> includes special support for returning results in Random order using <code>Random</code>, e.g:</p><pre><code>/rockstars?OrderBy=Random
</code></pre><p>Using Service Client:</p><div class="language-csharp"><pre><code>client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">QueryRockstars</span> <span class="token punctuation">{</span> OrderBy <span class="token operator">=</span> <span class="token string">&quot;Random&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="advanced-native-type-code-gen" tabindex="-1">Advanced Native Type Code gen <a class="header-anchor" href="#advanced-native-type-code-gen" aria-hidden="true">#</a></h2><p>To provide even greater flexibility when generating complex Typed DTOs for <a href="https://docs.servicestack.net/add-servicestack-reference" target="_blank" rel="noopener noreferrer">Add ServiceStack Reference</a> languages, you can use <code>[Emit{Language}]</code> attributes to generate code before each type or property.</p><p>You could use these attributes to generate different attributes or annotations to enable client validation for different validation libraries in different languages, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EmitCSharp</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;[Validate]&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EmitTypeScript</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;@Validate()&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EmitCode</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Lang<span class="token punctuation">.</span>Swift <span class="token operator">|</span> Lang<span class="token punctuation">.</span>Dart<span class="token punctuation">,</span> <span class="token string">&quot;@validate()&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EmitCSharp</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;[IsNotEmpty]&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;[IsEmail]&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EmitTypeScript</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;@IsNotEmpty()&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;@IsEmail()&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EmitCode</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Lang<span class="token punctuation">.</span>Swift <span class="token operator">|</span> Lang<span class="token punctuation">.</span>Dart<span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span> <span class="token string">&quot;@isNotEmpty()&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;@isEmail()&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Email <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Which will generate <code>[EmitCsharp]</code> code in C# DTOs:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Validate</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">User</span>
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">IsNotEmpty</span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">IsEmail</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Email <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>[EmitTypeScript]</code> annotations in TypeScript DTOs:</p><div class="language-typescript"><pre><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">Validate</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">IReturn<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span></span>
<span class="token punctuation">{</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsNotEmpty</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsEmail</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">constructor</span><span class="token punctuation">(</span>init<span class="token operator">?</span><span class="token operator">:</span> Partial<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>Object <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">createResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">getTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&#39;User&#39;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Whilst the generic <code>[EmitCode]</code> attribute lets you emit the same code in multiple languages with the same syntax.</p><h3 id="type-generation-filters" tabindex="-1">Type Generation Filters <a class="header-anchor" href="#type-generation-filters" aria-hidden="true">#</a></h3><p>In addition you can use the <code>PreTypeFilter</code>, <code>InnerTypeFilter</code> &amp; <code>PostTypeFilter</code> to generate source code before and after a Type definition, e.g. this will append the <code>@validate()</code> annotation on non enum types:</p><div class="language-csharp"><pre><code>TypeScriptGenerator<span class="token punctuation">.</span>PreTypeFilter <span class="token operator">=</span> <span class="token punctuation">(</span>sb<span class="token punctuation">,</span> type<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">.</span>IsEnum<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        sb<span class="token punctuation">.</span><span class="token function">AppendLine</span><span class="token punctuation">(</span><span class="token string">&quot;@Validate()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>InnerTypeFilter</code> gets invoked just after the Type Definition which can be used to generate common members for all Types and interfaces, e.g:</p><div class="language-csharp"><pre><code>TypeScriptGenerator<span class="token punctuation">.</span>InnerTypeFilter <span class="token operator">=</span> <span class="token punctuation">(</span>sb<span class="token punctuation">,</span> type<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    sb<span class="token punctuation">.</span><span class="token function">AppendLine</span><span class="token punctuation">(</span><span class="token string">&quot;id:string = \`\${Math.random()}\`.substring(2);&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>There&#39;s also <code>PrePropertyFilter</code> &amp; <code>PostPropertyFilter</code> for generating source before and after properties, e.g:</p><div class="language-csharp"><pre><code>TypeScriptGenerator<span class="token punctuation">.</span>PrePropertyFilter <span class="token operator">=</span> <span class="token punctuation">(</span>sb <span class="token punctuation">,</span> prop<span class="token punctuation">,</span> type<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prop<span class="token punctuation">.</span>Name <span class="token operator">==</span> <span class="token string">&quot;Id&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        sb<span class="token punctuation">.</span><span class="token function">AppendLine</span><span class="token punctuation">(</span><span class="token string">&quot;@IsInt()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="async-upgrade" tabindex="-1">Async Upgrade <a class="header-anchor" href="#async-upgrade" aria-hidden="true">#</a></h2><p>Another large focus area for this release was to add Async APIs to most of ServiceStack&#39;s existing sync providers. The new APIs are additive &quot;pure&quot; async APIs which async methods &amp; Services can benefit from whilst sync business logic can continue utilizing existing sync implementations. In addition to new the async APIs, existing async implementations like <code>JsonHttpClient</code> had their manual continuations rewritten to use async/await to <a href="https://stackoverflow.com/a/62527773/85785" target="_blank" rel="noopener noreferrer">resolve issues in Xamarin platforms</a>.</p><h3 id="redis-async" tabindex="-1">Redis Async <a class="header-anchor" href="#redis-async" aria-hidden="true">#</a></h3><p>The <a href="https://servicestack.uservoice.com/forums/176786-feature-requests/suggestions/5701744-provide-async-support-for-redis-client" target="_blank" rel="noopener noreferrer">most requested async library support</a> has now been implemented in <strong>ServiceStack.Redis</strong> available in .NET Core (<strong>.NET Standard 2.0</strong>) or <strong>.NET Framework v4.7.2+</strong> projects where there&#39;s now async API equivalents for most APIs that can be explored in the Redis Async interfaces below:</p><ul><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/IRedisClientsManagerAsync.cs" target="_blank" rel="noopener noreferrer">IRedisClientsManagerAsync.cs</a></li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/IRedisClientAsync.cs" target="_blank" rel="noopener noreferrer">IRedisClientAsync.cs</a></li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/IRedisNativeClientAsync.cs" target="_blank" rel="noopener noreferrer">IRedisNativeClientAsync.cs</a></li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/IRedisSubscriptionAsync.cs" target="_blank" rel="noopener noreferrer">IRedisSubscriptionAsync.cs</a></li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/IRedisTransactionAsync.cs" target="_blank" rel="noopener noreferrer">IRedisTransactionAsync.cs</a></li></ul><h4 id="generic-client-apis" tabindex="-1">Generic Client APIs <a class="header-anchor" href="#generic-client-apis" aria-hidden="true">#</a></h4><ul><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/Generic/IRedisTypedClientAsync.cs" target="_blank" rel="noopener noreferrer">IRedisTypedClientAsync.cs</a></li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/Generic/IRedisTypedQueueableOperationAsync.cs" target="_blank" rel="noopener noreferrer">IRedisTypedQueueableOperationAsync.cs</a></li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/Generic/IRedisTypedTransactionAsync.cs" target="_blank" rel="noopener noreferrer">IRedisTypedTransactionAsync.cs</a></li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/Generic/IRedisTypedPipelineAsync.cs" target="_blank" rel="noopener noreferrer">IRedisTypedPipelineAsync.cs</a></li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/Generic/IRedisHash.Generic.Async.cs" target="_blank" rel="noopener noreferrer">IRedisHash.Generic.Async.cs</a></li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/Generic/IRedisList.Generic.Async.cs" target="_blank" rel="noopener noreferrer">IRedisList.Generic.Async.cs</a></li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/Generic/IRedisSet.Generic.Async.cs" target="_blank" rel="noopener noreferrer">IRedisSet.Generic.Async.cs</a></li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/Generic/IRedisSortedSet.Generic.Async.cs" target="_blank" rel="noopener noreferrer">IRedisSortedSet.Generic.Async.cs</a></li></ul><h4 id="server-collection-apis" tabindex="-1">Server Collection APIs <a class="header-anchor" href="#server-collection-apis" aria-hidden="true">#</a></h4><ul><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/IRedisHashAsync.cs" target="_blank" rel="noopener noreferrer">IRedisHashAsync.cs</a></li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/IRedisListAsync.cs" target="_blank" rel="noopener noreferrer">IRedisListAsync.cs</a></li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/IRedisSetAsync.cs" target="_blank" rel="noopener noreferrer">IRedisSetAsync.cs</a></li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/IRedisSortedSetAsync.cs" target="_blank" rel="noopener noreferrer">IRedisSortedSetAsync.cs</a></li></ul><h4 id="pipeline-apis" tabindex="-1">Pipeline APIs <a class="header-anchor" href="#pipeline-apis" aria-hidden="true">#</a></h4><ul><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/Pipeline/IRedisPipelineSharedAsync.cs" target="_blank" rel="noopener noreferrer">IRedisPipelineSharedAsync.cs</a></li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/Pipeline/IRedisQueueCompletableOperationAsync.cs" target="_blank" rel="noopener noreferrer">IRedisQueueCompletableOperationAsync.cs</a></li><li><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Redis/Pipeline/IRedisQueueableOperationAsync.cs" target="_blank" rel="noopener noreferrer">IRedisQueueableOperationAsync.cs</a></li></ul><h4 id="redis-async-usage" tabindex="-1">Redis Async Usage <a class="header-anchor" href="#redis-async-usage" aria-hidden="true">#</a></h4><p>All Redis Client Managers implement both <code>IRedisClientsManager</code> and <code>IRedisClientsManagerAsync</code> so no changes are needed for existing registrations which can continue to register against the existing <code>IRedisClientsManager</code> interface, e.g:</p><div class="language-csharp"><pre><code>container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Register</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IRedisClientsManager<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> 
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RedisManagerPool</span><span class="token punctuation">(</span>redisConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Where it can be used to resolve both sync <code>IRedisClient</code> and async <code>IRedisClientAsync</code> clients, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> syncRedis <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IRedisClientsManager<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> asyncRedis <span class="token operator">=</span> <span class="token keyword">await</span> container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IRedisClientsManager<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetClientAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Whilst inside ServiceStack Services &amp; Controllers we recommend using <code>GetRedisAsync()</code> to resolve an <code>IRedisClientAsync</code>, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">MyRequest</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> redis <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">GetRedisAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> redis<span class="token punctuation">.</span><span class="token function">IncrementAsync</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MyRequest<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HomeController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ServiceStackController</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> redis <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">GetRedisAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> redis<span class="token punctuation">.</span><span class="token function">IncrementAsync</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>HomeController<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The async support in ServiceStack.Redis differs from other async APIs in that it aimed for maximum efficiency so uses <code>ValueTask</code> &amp; other modern Async APIs so it requires a minimum of <strong>.NET Standard 2.0</strong> (i.e. .NET Core) or <strong>.NET Framework v4.7.2+</strong> project. All other Async APIs return the more interoperable Task responses for their async APIs.</p><p>If you\u2019re using ServiceStack.Redis in your own (i.e. non ServiceStack) projects you could just register <code>IRedisClientsManagerAsync</code> to force usage of async APIs as it only lets you resolve async only <code>IRedisClientAsync</code> and <code>ICacheClientAsync</code> clients, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IRedisClientsManagerAsync<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RedisManagerPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//... </span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDep</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">IRedisClientsManagerAsync</span> manager<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">MyDep</span><span class="token punctuation">(</span><span class="token class-name">IRedisClientsManagerAsync</span> manager<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>manager <span class="token operator">=</span> manager<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">long</span><span class="token punctuation">&gt;</span></span> <span class="token function">Incr</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> key<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">uint</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> redis <span class="token operator">=</span> <span class="token keyword">await</span> manager<span class="token punctuation">.</span><span class="token function">GetClientAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">await</span> redis<span class="token punctuation">.</span><span class="token function">IncrementAsync</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="async-dynamodb-pocodynamo" tabindex="-1">Async DynamoDB PocoDynamo <a class="header-anchor" href="#async-dynamodb-pocodynamo" aria-hidden="true">#</a></h3><p>The other major client to add async support is <a href="https://github.com/ServiceStack/PocoDynamo" target="_blank" rel="noopener noreferrer">DynamoDB PocoDynamo</a> with the <code>PocoDynamo</code> client implementing both <a href="https://github.com/ServiceStack/ServiceStack.Aws/blob/master/src/ServiceStack.Aws/DynamoDb/IPocoDynamo.cs" target="_blank" rel="noopener noreferrer">IPocoDynamo</a> and <a href="https://github.com/ServiceStack/ServiceStack.Aws/blob/master/src/ServiceStack.Aws/DynamoDb/IPocoDynamoAsync.cs" target="_blank" rel="noopener noreferrer">IPocoDynamoAsync</a> interfaces which allows calling both sync &amp; async APIs with the same client instance, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> awsDb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AmazonDynamoDBClient</span><span class="token punctuation">(</span><span class="token string">&quot;keyId&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AmazonDynamoDBConfig</span> <span class="token punctuation">{</span> ServiceURL<span class="token operator">=</span><span class="token string">&quot;http://localhost:8000&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PocoDynamo</span><span class="token punctuation">(</span>awsDb<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> newTodo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Todo</span> <span class="token punctuation">{</span>
    Content <span class="token operator">=</span> <span class="token string">&quot;Learn PocoDynamo&quot;</span><span class="token punctuation">,</span>
    Order <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">PutItem</span><span class="token punctuation">(</span>newTodo<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> savedTodo <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetItemAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Todo<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>newTodo<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="async-providers" tabindex="-1">Async Providers <a class="header-anchor" href="#async-providers" aria-hidden="true">#</a></h2><p>With all major ServiceStack client libraries gaining async support, ServiceStack&#39;s other providers and abstractions have also gained pure async implementations which ServiceStack now utilizes internally where they would yield for optimal performance.</p><h3 id="async-cache-clients" tabindex="-1">Async Cache Clients <a class="header-anchor" href="#async-cache-clients" aria-hidden="true">#</a></h3><p>All ServiceStack&#39;s remote <a href="/caching.html">Caching Providers</a> now implement the <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Caching/ICacheClientAsync.cs" target="_blank" rel="noopener noreferrer">ICacheClientAsync</a> async APIs whilst any other <code>ICacheClient</code> only providers like the local in-memory <code>MemoryCacheClient</code> are still able to use the <code>ICacheClientAsync</code> interface as they&#39;ll return an <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack/Caching/CacheClientAsyncWrapper.cs" target="_blank" rel="noopener noreferrer">Async Wrapper</a> over the underlying sync APIs.</p><p>So even if you&#39;re currently only using <code>MemoryCacheClient</code> or your own <code>ICacheClient</code> sync implementation, you can still use the async Caching Provider API now and easily switch to an async caching provider in future without code changes.</p><p>The Async Caching Provider APIs are accessible via the <code>CacheAsync</code> property in ServiceStack <code>Service</code> or <code>ServiceStackController</code> classes, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">MyRequest</span> request<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> item <span class="token operator">=</span> <span class="token keyword">await</span> CacheAsync<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Item<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//....</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HomeController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ServiceStackController</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> item <span class="token operator">=</span> <span class="token keyword">await</span> CacheAsync<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Item<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Whilst outside of ServiceStack you can <code>AppHost.GetCacheClientAsync()</code>, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> cache <span class="token operator">=</span> HostContext<span class="token punctuation">.</span>AppHost<span class="token punctuation">.</span><span class="token function">GetCacheClientAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> item <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Item<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="async-auth-repositories" tabindex="-1">Async Auth Repositories <a class="header-anchor" href="#async-auth-repositories" aria-hidden="true">#</a></h3><p>All built-in ServiceStack Auth Repositories now also implement <code>IUserAuthRepositoryAsync</code> which you can use inside ServiceStack Services with the <code>AuthRepositoryAsync</code> property, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> <span class="token function">Post</span><span class="token punctuation">(</span><span class="token class-name">GetUserAuth</span> request<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> userAuth <span class="token operator">=</span> <span class="token keyword">await</span> AuthRepositoryAsync<span class="token punctuation">.</span><span class="token function">GetUserAuthByUserNameAsync</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>UserName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userAuth <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> HttpError<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>UserName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> userAuth<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Outside of ServiceStack you can access it from the AppHost.GetAuthRepositoryAsync() API, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> authRepo <span class="token operator">=</span> HostContext<span class="token punctuation">.</span>AppHost<span class="token punctuation">.</span><span class="token function">GetAuthRepositoryAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> <span class="token keyword">using</span> <span class="token punctuation">(</span>authRepo <span class="token keyword">as</span> <span class="token class-name">IAsyncDisposable</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Like the caching providers the async Auth Repositories makes use of the existing <code>IAuthRepository</code> registration so no additional configuration is needed and your Services can use the <code>IAuthRepositoryAsync</code> APIs above even for your own sync <code>IAuthRepository</code> providers as it will return a <code>IAuthRepositoryAsync</code> wrapper API in its place.</p><h2 id="async-auth-providers" tabindex="-1">Async Auth Providers <a class="header-anchor" href="#async-auth-providers" aria-hidden="true">#</a></h2><p>To make usage of the new async API functionality all of ServiceStack\u2019s built-in Auth Providers were rewritten to use the new Async APIs. If you\u2019re only using ServiceStack&#39;s existing Auth Providers this will be a transparent detail, however your own Custom Auth Providers will need to change as all existing Sync I/O base class APIs have been refactored into Async APIs.</p><h3 id="breaking-changes" tabindex="-1">Breaking Changes <a class="header-anchor" href="#breaking-changes" aria-hidden="true">#</a></h3><p>The recommendation would be change your existing custom Auth Providers to use the new Async APIs which all follow the same async method convention, i.e:</p><ul><li>Has an <code>*Async</code> suffix</li><li>Takes an optional <code>CancellationToken</code> as its last parameter</li><li>Returns a <code>Task</code></li></ul><p>Here&#39;s an example of all these changes to convert a sync into an async method:</p><div class="language-csharp"><pre><code><span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> <span class="token function">AddAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> token <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>So if your custom Auth Provider inherits from <code>CredentialsAuthProvider</code> it would now need to be changed to override Async APIs, e.g:</p><div class="language-csharp"><pre><code><span class="token comment">//Async</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomCredentialsAuthProvider</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">CredentialsAuthProvider</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> <span class="token function">TryAuthenticateAsync</span><span class="token punctuation">(</span><span class="token class-name">IServiceBase</span> authService<span class="token punctuation">,</span> 
        <span class="token class-name"><span class="token keyword">string</span></span> userName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> password<span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> token<span class="token operator">=</span><span class="token keyword">default</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//Add here your custom auth logic (database calls etc)</span>
        <span class="token comment">//Return true if credentials are valid, otherwise false</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> <span class="token function">AuthenticateAsync</span><span class="token punctuation">(</span><span class="token class-name">IServiceBase</span> authService<span class="token punctuation">,</span> 
        <span class="token class-name">IAuthSession</span> session<span class="token punctuation">,</span> <span class="token class-name">Authenticate</span> request<span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> token <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//Fill IAuthSession with data you want to retrieve in the app eg:</span>
        session<span class="token punctuation">.</span>FirstName <span class="token operator">=</span> <span class="token string">&quot;some_firstname_from_db&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">//Call base method to Save Session and fire Auth/Session callbacks:</span>
        <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">AuthenticateAsync</span><span class="token punctuation">(</span>authService<span class="token punctuation">,</span> session<span class="token punctuation">,</span> tokens<span class="token punctuation">,</span> authInfo<span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Alternatively to simplify migration of existing Auth Providers when upgrading ServiceStack, the popular Auth Providers below used to implement Custom Auth Providers now have a <code>Sync</code> suffix:</p><ul><li><code>CredentialsAuthProviderSync</code></li><li><code>BasicAuthProviderSync</code></li><li><code>AuthProviderSync</code></li><li><code>OAuthProviderSync</code></li><li><code>OAuth2ProviderSync</code></li></ul><p>So the easiest way to migrate would be to just add a <code>*Sync</code> suffix to your base class, e.g:</p><div class="language-csharp"><pre><code><span class="token comment">//Sync</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomCredentialsAuthProvider</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">CredentialsAuthProviderSync</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">TryAuthenticate</span><span class="token punctuation">(</span><span class="token class-name">IServiceBase</span> authService<span class="token punctuation">,</span> 
        <span class="token class-name"><span class="token keyword">string</span></span> userName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> password<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">IHttpResult</span> <span class="token function">OnAuthenticated</span><span class="token punctuation">(</span><span class="token class-name">IServiceBase</span> authService<span class="token punctuation">,</span> 
        <span class="token class-name">IAuthSession</span> session<span class="token punctuation">,</span> <span class="token class-name">IAuthTokens</span> tokens<span class="token punctuation">,</span> 
        <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> authInfo<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnAuthenticated</span><span class="token punctuation">(</span>authService<span class="token punctuation">,</span> session<span class="token punctuation">,</span> tokens<span class="token punctuation">,</span> authInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="auth-response-url-redirect-filters" tabindex="-1">Auth Response &amp; URL Redirect Filters <a class="header-anchor" href="#auth-response-url-redirect-filters" aria-hidden="true">#</a></h3><p>If your AuthProvider implements <code>IAuthResponseFilter</code> to implement for intercepting successful Authenticate Request DTO requests, the interface gains an additional <code>ResultFilterAsync</code> method for intercepting successful OAuth redirect responses:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IAuthResponseFilter</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Intercept successful Authenticate Request DTO requests</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Execute</span><span class="token punctuation">(</span><span class="token class-name">AuthFilterContext</span> authContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Intercept successful OAuth redirect requests</span>
    <span class="token return-type class-name">Task</span> <span class="token function">ResultFilterAsync</span><span class="token punctuation">(</span><span class="token class-name">AuthResultContext</span> context<span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Which you can provide an empty implementation by returning a completed task, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token return-type class-name">Task</span> <span class="token function">ResultFilterAsync</span><span class="token punctuation">(</span><span class="token class-name">AuthResultContext</span> context<span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> token<span class="token punctuation">)</span>
     <span class="token operator">=&gt;</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
</code></pre></div><p>The OAuth URL Filters have changed from being passed an <code>AuthProvider</code> to an <code>AuthContext</code>, if your URL filter made use of the <code>AuthProvider</code> it can be accessed from <code>AuthContext.AuthProvider</code>, e.g:</p><div class="language-csharp"><pre><code>SuccessRedirectUrlFilter <span class="token operator">=</span> <span class="token punctuation">(</span>authProvider<span class="token punctuation">,</span>url<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">;</span>

SuccessRedirectUrlFilter <span class="token operator">=</span> <span class="token punctuation">(</span>authContext<span class="token punctuation">,</span>url<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> authContext<span class="token punctuation">.</span>AuthProvider <span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre></div><p>Together these features is used to implement the new <code>JwtAuthProvider.UseTokenCookie</code> feature below:</p><h3 id="cookie-config-changes" tabindex="-1">Cookie Config Changes <a class="header-anchor" href="#cookie-config-changes" aria-hidden="true">#</a></h3><ul><li><code>Config.UseSameSiteCookies</code> changed to a use a tri-state <code>bool?</code> where <code>null</code> defaults to <code>samesite=lax</code></li><li><code>Config.UseHttpOnlyCookies</code> renamed from <code>AllowNonHttpOnlyCookies</code>, default to <code>true</code></li></ul><p>The default Cookie behavior from this release is:</p><div class="language-csharp"><pre><code><span class="token function">SetConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">HostConfig</span>
<span class="token punctuation">{</span>
    UseHttpOnlyCookies <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//default ;HttpOnly</span>
    UseSecureCookies <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token comment">//default ;Secure (https)</span>
    UseSameSiteCookies <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//default ;SameSite=Lax</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="jwt-server-cookie-config" tabindex="-1">JWT Server Cookie Config <a class="header-anchor" href="#jwt-server-cookie-config" aria-hidden="true">#</a></h3><p>When JWT is enabled if you wanted to return your Authenticated UserSession into a stateless JWT Token Cookie your clients would&#39;ve needed to request it with <a href="/jwt-authprovider.html#request-jwt-cookie-is-set-on-authentication">UseTokenCookie on the Authenticate Request</a> or in a <a href="/jwt-authprovider.html#switching-existing-sites-to-jwt">hidden FORM Input</a>. This capability was only available for <code>Authenticate</code> requests as OAuth requests would&#39;ve needed a separate call to <a href="/jwt-authprovider.html#ajax-clients">Convert their Server Session into a JWT Cookie</a>.</p><p>Now you can configure this behavior to return Authenticated Sessions in a stateless JWT Token on the server with the new <code>UseTokenCookie</code> on the JWT Auth Provider:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span><span class="token punctuation">(</span>appSettings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    UseTokenCookie <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Which now works for both successful <code>Authenticate</code> Requests &amp; <strong>OAuth Web Flow</strong> Sign Ins.</p><h3 id="session-save-apis" tabindex="-1">Session Save APIs <a class="header-anchor" href="#session-save-apis" aria-hidden="true">#</a></h3><p>Whilst ServiceStack has been changed to use async APIs it will only fire <code>OnSaveSessionAsync()</code> AppHost callback to save the session. So if you previously have overridden <code>OnSaveSession</code> in your AppHost to intercept when sessions are saved you&#39;ll need to change it to override <code>OnSaveSessionAsync</code> instead, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Obsolete</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Use OnSaveSessionAsync&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnSaveSession</span><span class="token punctuation">(</span><span class="token class-name">IRequest</span> httpReq<span class="token punctuation">,</span> <span class="token class-name">IAuthSession</span> session<span class="token punctuation">,</span> <span class="token class-name">TimeSpan<span class="token punctuation">?</span></span> expiresIn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">OnSaveSessionAsync</span><span class="token punctuation">(</span>
    <span class="token class-name">IRequest</span> httpReq<span class="token punctuation">,</span> <span class="token class-name">IAuthSession</span> session<span class="token punctuation">,</span> <span class="token class-name">TimeSpan<span class="token punctuation">?</span></span> expiresIn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> token<span class="token operator">=</span><span class="token keyword">default</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Note that if you have code that calls the sync <code>SaveSession()</code> to save a Users Session you would either need to change it to use <code>SaveSessionAsync()</code> or override both APIs above if you&#39;re intercepting session saves.</p><h3 id="authenticate-register-services" tabindex="-1">Authenticate &amp; Register Services <a class="header-anchor" href="#authenticate-register-services" aria-hidden="true">#</a></h3><p>If you&#39;re using <code>HostContext.ResolveService&lt;T&gt;</code> to call either the <code>AuthenticateService</code> or <code>RegisterService</code> APIs, e.g. to Authenticate or impersonate a user:</p><div class="language-csharp"><pre><code><span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> authService <span class="token operator">=</span> HostContext<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ResolveService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AuthenticateService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> authService<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span>
<span class="token punctuation">{</span>
    provider <span class="token operator">=</span> Name<span class="token punctuation">,</span>
    UserName <span class="token operator">=</span> userName<span class="token punctuation">,</span>
    Password <span class="token operator">=</span> password
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>Post()</code> API implementation is now a deprecated &quot;sync over async&quot; implementation which although will continue to work, you&#39;re encouraged to change it to use the async version, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> authService<span class="token punctuation">.</span><span class="token function">PostAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>These are the main gotchas from the refactor to use async APIs internally, most of the time the Async APIs are just additive so</p><h3 id="optional-async-suffixes" tabindex="-1">Optional *Async Suffixes <a class="header-anchor" href="#optional-async-suffixes" aria-hidden="true">#</a></h3><p>In addition to the expanded support for Async, your Services can now optionally have the <code>*Async</code> suffix which by .NET Standard (and ServiceStack) guidelines is preferred for Async methods to telegraph to client call sites that its response should be awaited.</p><p>If both exists (e.g. <code>Post()</code> and <code>PostAsync()</code>) the <code>*Async</code> method will take precedence and be invoked instead.</p><p>Allowing both is useful if you have internal services directly invoking other Services using <code>HostContext.ResolveService&lt;T&gt;()</code> where you can upgrade your Service to use an Async implementation without breaking existing clients, e.g. this is used in <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack/Auth/RegisterService.cs" target="_blank" rel="noopener noreferrer">RegisterService.cs</a>:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Obsolete</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Use PostAsync&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Post</span><span class="token punctuation">(</span><span class="token class-name">Register</span> request<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> task <span class="token operator">=</span> <span class="token function">PostAsync</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> task<span class="token punctuation">.</span><span class="token function">GetResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> e<span class="token punctuation">.</span><span class="token function">UnwrapIfSingleException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// Create new Registration</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> <span class="token function">PostAsync</span><span class="token punctuation">(</span><span class="token class-name">Register</span> request<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//... async impl</span>
<span class="token punctuation">}</span>            
</code></pre></div><p>To change to use an async implementation whilst retaining backwards compatibility with existing call sites, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> service <span class="token operator">=</span> HostContext<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ResolveService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>RegisterService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>Request<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Register</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This is important if the response is ignored as the C# compiler wont give you any hints to await the response which can lead to timing issues where the Services is invoked but User Registration hasn&#39;t completed as-is often assumed.</p><p>Alternatively you can rename your method to use <code>*Async</code> suffix so the C# compiler will fail on call sites so you can replace the call-sites to <code>await</code> the async <code>Task</code> response, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> service <span class="token operator">=</span> HostContext<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ResolveService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>RegisterService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>Request<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> service<span class="token punctuation">.</span><span class="token function">PostAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Register</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="support-for-valuetask" tabindex="-1">Support for ValueTask <a class="header-anchor" href="#support-for-valuetask" aria-hidden="true">#</a></h4><p>ServiceStack Services now also supports returning <code>ValueTask&lt;object&gt;</code> responses.</p><h2 id="group-services-by-tag" tabindex="-1">Group Services by Tag <a class="header-anchor" href="#group-services-by-tag" aria-hidden="true">#</a></h2><p>We&#39;ve extended the <a href="https://swagger.io/docs/specification/grouping-operations-with-tags/" target="_blank" rel="noopener noreferrer">Tag support in Open API</a> to group related Services by annotating <strong>Request DTOs</strong> with the <code>[Tag]</code> attribute, e.g. you can use this to tag which Services are used by different platforms:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Tag</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;web&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebApi</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>MyResponse<span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Tag</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;mobile&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MobileApi</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>MyResponse<span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Tag</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;web&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">,</span><span class="token class-name">Tag</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;mobile&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebAndMobileApi</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>MyResponse<span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>Where they&#39;ll now appear as a tab to additionally filter APIs in metadata pages:</p><p><img src="https://forums.servicestack.net/uploads/default/original/2X/3/329ba71fca1005c62d4752612b6fc1e1ca6619f6.png" alt=""></p><p>Support for tags was also added to <a href="https://docs.servicestack.net/add-servicestack-reference" target="_blank" rel="noopener noreferrer">Add ServiceStack Reference</a> where it can be used in the <a href="https://docs.servicestack.net/csharp-add-servicestack-reference#includetypes" target="_blank" rel="noopener noreferrer">IncludeTypes</a> DTO customization option where tags can be specified using braces in the format <code>{tag}</code> or <code>{tag1,tag2,tag3}</code>, e.g:</p><div class="language-"><pre><code>/* Options:
IncludeTypes: {web,mobile}
</code></pre></div><p>Or individually:</p><div class="language-"><pre><code>/* Options:
IncludeTypes: {web},{mobile}
</code></pre></div><p>It works similar to <a href="https://docs.servicestack.net/csharp-add-servicestack-reference#include-request-dto-and-its-dependent-types" target="_blank" rel="noopener noreferrer">Dependent Type References wildcard syntax</a> where it expands all Request DTOs with the tag to include all its reference types so including a <code>{web}</code> tag would be equivalent to including all Request DTOs &amp; reference types with that reference, e.g:</p><div class="language-"><pre><code>/* Options:
IncludeTypes: WebApi.*,WebAndMobileApi.*
</code></pre></div><h2 id="configure-localhost-development-dev-certificate" tabindex="-1">Configure localhost development dev certificate <a class="header-anchor" href="#configure-localhost-development-dev-certificate" aria-hidden="true">#</a></h2><p>As it&#39;s common to use the same ServiceStack Instance to support both Web &amp; Mobile Apps, it can be tricky to configure your local development environment to support all target platforms. Due to the pressure to <a href="https://web.dev/why-https-matters/" target="_blank" rel="noopener noreferrer">use HTTPS everywhere</a> with <a href="https://blog.google/products/chrome/milestone-chrome-security-marking-http-not-secure/" target="_blank" rel="noopener noreferrer">Browsers marking HTTP as not secure</a> and <a href="https://developer.apple.com/documentation/security/preventing_insecure_network_connections" target="_blank" rel="noopener noreferrer">operating systems and mobile platforms</a> requiring all connections to be secure by default, it&#39;s become the defacto standard to both host production sites with HTTPS as well as <a href="https://www.hanselman.com/blog/DevelopingLocallyWithASPNETCoreUnderHTTPSSSLAndSelfSignedCerts.aspx" target="_blank" rel="noopener noreferrer">developing locally under HTTPS with a Self-Signed Certificate</a>.</p><p>In most cases it&#39;s sufficient to run .NET Core Apps on <code>https://localhost:5001</code> for normal browser development and if you receive an invalid certificate error you can run:</p><pre><code>$ dotnet dev-certs https --trust
</code></pre><p>To trust the local development certificate and remove the SSL Certificate error in your browser.</p><h3 id="when-localhost-is-not-allowed" tabindex="-1">When localhost is not allowed <a class="header-anchor" href="#when-localhost-is-not-allowed" aria-hidden="true">#</a></h3><p>However for Apps needing to support OAuth providers that don&#39;t allow <strong>localhost</strong> domains like <strong>Sign In with Apple</strong> you would need to use a different domain. A popular workaround is to use a DNS name that resolves to <strong>127.0.0.1</strong> in which case you can use our:</p><pre><code>local.servicestack.com
</code></pre><p>Which you can use to view your local Web App typically on <code>https://localhost:5001</code> at <code>https://local.servicestack.com:5001</code> which will allow you to register as valid domains &amp; callback URLs in OAuth Apps you want to support. As this is a real DNS A record it will also work in emulators &amp; different environments like WSL.</p><h3 id="when-developing-for-android" tabindex="-1">When developing for Android <a class="header-anchor" href="#when-developing-for-android" aria-hidden="true">#</a></h3><p>But to be able to access your local dev server from an Android Emulator you&#39;d instead need to use the special <code>10.0.2.2</code> loopback IP, which you could support by <a href="https://stackoverflow.com/a/53929946/85785" target="_blank" rel="noopener noreferrer">updating your Android Emulator /system/etc/hosts file</a> mapping to include:</p><pre><code>10.0.2.2       local.servicestack.com
</code></pre><p>Which can be quite cumbersome to change, alternatively an easier solution is to use a DNS record that resolves to <code>10.0.2.2</code>:</p><pre><code>dev.servicestack.com
</code></pre><p>and instead update your OS hosts file (e.g. <code>%SystemRoot%\\System32\\drivers\\etc\\hosts</code> for Windows or <code>/etc/hosts</code> on macOS/Linux) to include:</p><pre><code>127.0.0.1       dev.servicestack.com
</code></pre><p>Which will let you use the same <code>dev.servicestack.com</code> to access your local dev server in both Android Emulators and your Host OS so you can have a single domain &amp; callback URL you can use in your OAuth Apps configuration.</p><h3 id="when-developing-for-ios" tabindex="-1">When developing for iOS <a class="header-anchor" href="#when-developing-for-ios" aria-hidden="true">#</a></h3><p>As iOS is a heavily locked down OS you wont have the same opportunity to modify iOS&#39;s hosts file, instead the easiest way to configure a custom address for a given domain is to configure it on the DNS Server. Fortunately this easy to setup in macOS with a <a href="https://passingcuriosity.com/2013/dnsmasq-dev-osx/" target="_blank" rel="noopener noreferrer">lightweight, easy to configure DNS Server like Dnsmasq</a> which lets you easily add custom DNS rules whilst falling back to use its default DNS resolution for non-configured addresses.</p><p>For a step-by-step guide, see our <a href="/netcore-localhost-cert.html#when-developing-for-ios">docs for enabling Dnsmasq in iOS</a>.</p><h3 id="generating-self-signed-ssl-certificates-for-custom-domains" tabindex="-1">Generating self-signed SSL Certificates for Custom Domains <a class="header-anchor" href="#generating-self-signed-ssl-certificates-for-custom-domains" aria-hidden="true">#</a></h3><p>Whether you use <code>local.servicestack.com</code> or <code>dev.servicestack.com</code> or your own hostname, you&#39;ll need to create and trust a self-signed certificate to be able to view it in a browser without certificate errors.</p><p>To simplify creation of self-signed certificate for <code>*.servicestack.com</code> you can use the <a href="/mix-tool.html">dotnet mix tool</a> to download the openssl script and running it:</p><pre><code>$ x mix gen-dev-crt.sh
$ bash gen-dev-crt.sh
</code></pre><p>Which will write this script below to your projects HOST project:</p><div class="language-csharp"><pre><code>PASSWORD<span class="token operator">=</span>dev
<span class="token keyword">if</span> <span class="token punctuation">[</span> $# <span class="token operator">-</span>ge <span class="token number">1</span> <span class="token punctuation">]</span>
  <span class="token class-name">then</span>
    PASSWORD<span class="token operator">=</span>$<span class="token number">1</span>
fi

openssl req <span class="token operator">-</span>x509 <span class="token operator">-</span><span class="token keyword">out</span> dev<span class="token punctuation">.</span>crt <span class="token operator">-</span>keyout dev<span class="token punctuation">.</span>key <span class="token operator">-</span>days <span class="token number">825</span> \\
  <span class="token operator">-</span><span class="token class-name">newkey</span> rsa<span class="token punctuation">:</span><span class="token number">2048</span> <span class="token operator">-</span>nodes <span class="token operator">-</span>sha256 \\
  <span class="token operator">-</span>subj &#39;<span class="token operator">/</span>CN<span class="token operator">=</span><span class="token operator">*</span><span class="token punctuation">.</span>servicestack<span class="token punctuation">.</span>com&#39; <span class="token operator">-</span>extensions EXT <span class="token operator">-</span>config <span class="token operator">&lt;</span><span class="token punctuation">(</span> \\
   printf <span class="token string">&quot;[dn]\\nCN=*.servicestack.com\\n[req]\\ndistinguished_name = dn\\n[EXT]\\nsubjectAltName=DNS:*.servicestack.com\\nkeyUsage=digitalSignature\\nextendedKeyUsage=serverAuth&quot;</span><span class="token punctuation">)</span>

openssl pkcs12 <span class="token operator">-</span>export <span class="token operator">-</span><span class="token keyword">out</span> dev<span class="token punctuation">.</span>pfx <span class="token operator">-</span>inkey dev<span class="token punctuation">.</span>key <span class="token operator">-</span><span class="token keyword">in</span> dev<span class="token punctuation">.</span>crt <span class="token operator">-</span><span class="token class-name">password</span> pass<span class="token punctuation">:</span>$PASSWORD
</code></pre></div><p>Which uses OpenSSL to generate a self-signed certificate <code>dev.crt</code>, private key <code>dev.key</code> and a PKCS #12 <code>dev.pfx</code> certificate in macOS, Linux &amp; Windows using WSL.</p><h3 id="trust-self-signed-certificate" tabindex="-1">Trust self-signed certificate <a class="header-anchor" href="#trust-self-signed-certificate" aria-hidden="true">#</a></h3><p>After generating a new self-signed certificate you&#39;ll need to trust it in your OS&#39;s certificate store so it&#39;s recognized &amp; treated as a valid certificate.</p><h4 id="windows" tabindex="-1">Windows <a class="header-anchor" href="#windows" aria-hidden="true">#</a></h4><p>On Windows you can trust certificates by running the powershell command below in <strong>Administrator</strong> mode:</p><div class="language-"><pre><code>Import-Certificate -FilePath dev.crt -CertStoreLocation Cert:\\CurrentUser\\Root
</code></pre></div><p>Where it will import the Certificate into the <a href="https://docs.microsoft.com/en-us/windows/win32/seccrypto/system-store-locations#cert_system_store_current_user" target="_blank" rel="noopener noreferrer">Current User Certificate Store</a> which you can view/remove in <strong>regedit.msc</strong> at:</p><pre><code>Computer\\HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\SystemCertificates\\Root\\Certificates\\
</code></pre><h4 id="macos" tabindex="-1">macOS <a class="header-anchor" href="#macos" aria-hidden="true">#</a></h4><p>In macOS you can <a href="https://derflounder.wordpress.com/2011/03/13/adding-new-trusted-root-certificates-to-system-keychain/" target="_blank" rel="noopener noreferrer">add a trusted root certificate to your System.keychain</a> with:</p><pre><code>$ sudo security add-trusted-cert -d -r trustRoot -k &quot;/Library/Keychains/System.keychain&quot; dev.crt
</code></pre><h4 id="linux" tabindex="-1">Linux <a class="header-anchor" href="#linux" aria-hidden="true">#</a></h4><p>Unfortunately it&#39;s not as cohesive in Linux where different Distro&#39;s &amp; Apps handle it differently, however this existing answer covers <a href="https://unix.stackexchange.com/a/90607/698" target="_blank" rel="noopener noreferrer">installation in Debian/Ubuntu distributions</a>.</p><h3 id="configure-in-net-core" tabindex="-1">Configure in .NET Core <a class="header-anchor" href="#configure-in-net-core" aria-hidden="true">#</a></h3><p>You can configure the .NET Core to use this self-signed certificate during development by specifying the path to <code>dev.pfx</code> and the password used in your <code>appsettings.Development.json</code>:</p><div class="language-json"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;Kestrel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;Endpoints&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;Http&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;Url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://*:5001&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Protocols&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Http1&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Certificate&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;Path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dev.pfx&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;Password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dev&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="accessing-from-browsers" tabindex="-1">Accessing from Browsers <a class="header-anchor" href="#accessing-from-browsers" aria-hidden="true">#</a></h3><p>Now after restarting your browser to reset its SSL caches you&#39;ll be able to use either <code>*.servicestack.com</code> domains to view your local development without SSL Errors:</p><p><img src="https://docs.servicestack.net/images/security/dev-certs.png" alt=""></p><h3 id="accessing-from-c-clients" tabindex="-1">Accessing from C# Clients <a class="header-anchor" href="#accessing-from-c-clients" aria-hidden="true">#</a></h3><p>As .NET has access your OS&#39;s trusted certificates you&#39;ll be able to access the custom domains without additional configuration:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span><span class="token string">&quot;https://dev.servicestack.com:5001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//.NET HttpWebRequest</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Hello</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;World&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonHttpClient</span><span class="token punctuation">(</span><span class="token string">&quot;https://dev.servicestack.com:5001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//.NET HttpClient</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Hello</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;World&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="accessing-from-native-applications" tabindex="-1">Accessing from Native Applications <a class="header-anchor" href="#accessing-from-native-applications" aria-hidden="true">#</a></h3><p>Something you want to avoid is including your <a href="https://letsencrypt.org/docs/certificates-for-localhost/#for-native-apps-talking-to-web-apps" target="_blank" rel="noopener noreferrer">certificate &amp; private key with your Native application</a> which is considered a compromise of your private key that attackers can use to implement a successful <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" target="_blank" rel="noopener noreferrer">MitM attack</a>.</p><h3 id="flutter-android" tabindex="-1">Flutter Android <a class="header-anchor" href="#flutter-android" aria-hidden="true">#</a></h3><p>Instead you&#39;ll want to either <a href="https://blog.netspi.com/four-ways-bypass-android-ssl-verification-certificate-pinning/" target="_blank" rel="noopener noreferrer">install the self-signed certificate</a> on your local device/emulator where it wont be trusted by anyone else.</p><p>Otherwise a far easier solution is to ignore SSL certificates when accessing your local dev server which you can do with Dart/Flutter using the <code>HttpClient</code> <a href="https://api.flutter.dev/flutter/dart-io/HttpClient/badCertificateCallback.html" target="_blank" rel="noopener noreferrer">badCertificateCallback</a> property:</p><div class="language-dart"><pre><code><span class="token keyword">var</span> httpClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span>badCertificateCallback <span class="token operator">=</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">X509Certificate</span> cert<span class="token punctuation">,</span> <span class="token class-name">String</span> host<span class="token punctuation">,</span> int port<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> host <span class="token operator">==</span> <span class="token string">&#39;dev.servicestack.com&#39;</span> <span class="token operator">&amp;&amp;</span> port <span class="token operator">==</span> <span class="token number">5001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Although ideally you&#39;d use a constant value like <a href="https://api.flutter.dev/flutter/foundation/kDebugMode-constant.html" target="_blank" rel="noopener noreferrer">kDebugMode</a> so that the <code>badCertificateCallback</code> pass-through doesn&#39;t make it into production builds. Here&#39;s an example configuring a <a href="/dart-add-servicestack-reference.html">ServiceStack Dart Service Client</a> to use development or production APIs:</p><div class="language-dart"><pre><code><span class="token keyword">var</span> client <span class="token operator">=</span> kDebugMode
    <span class="token operator">?</span> <span class="token class-name">ClientFactory</span><span class="token punctuation">.</span><span class="token function">createWith</span><span class="token punctuation">(</span><span class="token class-name">ClientOptions</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">:</span><span class="token string">&#39;https://dev.servicestack.com:5001&#39;</span><span class="token punctuation">,</span> ignoreCert<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">:</span> <span class="token class-name">ClientFactory</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;https://prod.app&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token class-name">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span>name<span class="token operator">==</span><span class="token string">&#39;World&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="removing-certificate-artifacts" tabindex="-1">Removing Certificate Artifacts <a class="header-anchor" href="#removing-certificate-artifacts" aria-hidden="true">#</a></h3><p>If you&#39;re only using Windows you&#39;ll typically only end up using the PKCS #12 <code>dev.pfx</code> certificate combining both certificate &amp; private key which can be safely removed to clear unnecessary generated artifacts &amp; clear-text copy of the private key:</p><pre><code>$ del dev.key
$ del dev.crt
</code></pre><p>Where as other OS&#39;s predominantly use Certificates &amp; Private Keys, which if needed can be later extracted from the <code>dev.pfx</code>:</p><h4 id="extract-certificate" tabindex="-1">Extract Certificate <a class="header-anchor" href="#extract-certificate" aria-hidden="true">#</a></h4><pre><code>$ openssl pkcs12 -in dev.pfx -clcerts -nokeys -out dev.crt
</code></pre><h4 id="extract-private-key" tabindex="-1">Extract Private Key <a class="header-anchor" href="#extract-private-key" aria-hidden="true">#</a></h4><pre><code>$ openssl pkcs12 -in dev.pfx -nocerts -nodes | openssl rsa -out dev.key
</code></pre><h2 id="sign-in-with-apple" tabindex="-1">Sign In with Apple <a class="header-anchor" href="#sign-in-with-apple" aria-hidden="true">#</a></h2><p>As mobile Apps is a target use-case for ServiceStack, this release also includes 1st class integration with <strong>Sign In with Apple</strong> OAuth provider. To assist with adoption we&#39;ve also developed Sign In with Apple Integration Examples for iOS, Android &amp; Web with working implementations for Flutter iOS/Android &amp; SwiftUI Apps at:</p><h3 id="github-com-netcoreapps-applesignin" tabindex="-1"><a href="https://github.com/NetCoreApps/AppleSignIn" target="_blank" rel="noopener noreferrer">github.com/NetCoreApps/AppleSignIn</a> <a class="header-anchor" href="#github-com-netcoreapps-applesignin" aria-hidden="true">#</a></h3><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dev/web-signin-with-apple-login.png" alt=""></p><h3 id="sign-in-with-apple-requirements" tabindex="-1">Sign In with Apple Requirements <a class="header-anchor" href="#sign-in-with-apple-requirements" aria-hidden="true">#</a></h3><p>Whilst configuring <code>AppleAuthProvider</code> is as straightforward as ServiceStack&#39;s other OAuth providers, it requires more initial setup effort to enable Sign in with your App &amp; gather the required information which can be summarized by these high-level steps:</p><ul><li>Membership <strong>Team ID</strong> from <a href="https://developer.apple.com/account/#/membership/" target="_blank" rel="noopener noreferrer">https://developer.apple.com/account/#/membership/</a></li><li>Create &amp; configure <strong>App ID</strong> from <a href="https://developer.apple.com/account/resources/identifiers/list" target="_blank" rel="noopener noreferrer">https://developer.apple.com/account/resources/identifiers/list</a></li><li>Use <strong>App ID</strong> to create &amp; configure <strong>Service ID</strong> from <a href="https://developer.apple.com/account/resources/identifiers/list/serviceId" target="_blank" rel="noopener noreferrer">https://developer.apple.com/account/resources/identifiers/list/serviceId</a></li><li>Use <strong>App ID</strong> to create &amp; configure <strong>Private Key</strong> from <a href="https://developer.apple.com/account/resources/authkeys/list" target="_blank" rel="noopener noreferrer">https://developer.apple.com/account/resources/authkeys/list</a></li></ul><h4 id="app-requirements-walkthrough" tabindex="-1">App Requirements Walkthrough <a class="header-anchor" href="#app-requirements-walkthrough" aria-hidden="true">#</a></h4><p>Okta has a <a href="https://developer.okta.com/blog/2019/06/04/what-the-heck-is-sign-in-with-apple" target="_blank" rel="noopener noreferrer">good walkthrough explaining Sign In with Apple</a> and steps required to create the above resources.</p><p>Note: Service ID must be configured with non-localhost trusted domain and HTTPS callback URL, for development you can use:</p><ul><li>Domain: <code>dev.servicestack.com</code></li><li>Callback URL: <code>https://dev.servicestack.com:5001/auth/apple</code></li></ul><p>See docs on <a href="/netcore-localhost-cert.html">Configure localhost development dev certificate</a> for instructions &amp; info for being able to use a single <code>local.servicestack.com</code> or <code>dev.servicestack.com</code> local DNS names to support local development of all platforms.</p><h4 id="apple-services-id-configuration" tabindex="-1">Apple Services ID configuration <a class="header-anchor" href="#apple-services-id-configuration" aria-hidden="true">#</a></h4><p>If you also need to support Android you&#39;ll also need to register the <code>https://dev.servicestack.com:5001/auth/apple?ReturnUrl=android:com.servicestack.auth</code> URL will as a valid Callback URL in your Apple <strong>Services ID</strong> configuration.</p><h3 id="create-project-with-preferred-auth-configuration" tabindex="-1">Create project with preferred Auth Configuration <a class="header-anchor" href="#create-project-with-preferred-auth-configuration" aria-hidden="true">#</a></h3><p>As the crypto algorithms required to integrate with Sign In with Apple requires .NET Core 3 APIs, the <code>AppleAuthProvider</code> is implemented in the <strong>ServiceStack.Extensions</strong> NuGet Package.</p><p>A quick way to can create a working project from scratch with your preferred configuration using the <a href="/mix-tool.html">mix tool</a>, e.g:</p><pre><code>$ mkdir web &amp;&amp; cd web
$ x mix init auth-ext auth-db sqlite
</code></pre><p>This creates an empty project, with Auth Enabled, adds the <strong>ServiceStack.Extensions</strong> NuGet package, registers OrmLite, SQLite and the <code>OrmLiteAuthRepository</code>.</p><p>Copy your Apple <strong>Private Key</strong> to your Apps <strong>Content Folder</strong> then configure your OAuth providers in <strong>appsettings.json</strong>:</p><div class="language-json"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;oauth.apple.RedirectUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://dev.servicestack.com:5001/&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;oauth.apple.CallbackUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://dev.servicestack.com:5001/auth/apple&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;oauth.apple.TeamId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{Team ID}&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;oauth.apple.ClientId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{Service ID}&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;oauth.apple.BundleId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{Bundle ID}&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;oauth.apple.KeyId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{Private KeyId}&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;oauth.apple.KeyPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AuthKey_{Private KeyId}.p8&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;jwt.AuthKeyBase64&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{Base64 JWT Auth Key}&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>See JWT docs for how to <a href="https://docs.servicestack.net/jwt-authprovider#generate-new-auth-key" target="_blank" rel="noopener noreferrer">Generate a new Auth Key</a></p></blockquote><p>When needing to support Mobile or Desktop Apps using OAuth Providers like Sign In with Apple, we recommend using it in combination with the <a href="https://docs.servicestack.net/jwt-authprovider" target="_blank" rel="noopener noreferrer">JWT Auth Provider</a> with <code>UseTokenCookie</code> feature enabled so the Authorization is returned in a stateless JWT Token that can be persisted for optimal Authentication across App restarts, e.g:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthFeature</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomUserSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IAuthProvider<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            UseTokenCookie <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AppleAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>AppleAuthFeature<span class="token punctuation">.</span>FlutterSignInWithApple<span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="clone-working-client-server-project" tabindex="-1">Clone working Client &amp; Server Project <a class="header-anchor" href="#clone-working-client-server-project" aria-hidden="true">#</a></h3><p>For a working example you can <strong>clone</strong> or <strong>fork</strong> this repo or alternatively download the latest master <code>.zip</code> with:</p><pre><code>$ x download NetCoreApps/AppleSignIn
</code></pre><p>Then after updating <strong>appsettings.json</strong> with your iOS App&#39;s configuration, copying your Private Key into the <code>web</code> Content Folder you&#39;re all set to run your App:</p><pre><code>$ dotnet run
</code></pre><h4 id="android-support" tabindex="-1">Android Support <a class="header-anchor" href="#android-support" aria-hidden="true">#</a></h4><p>To support Android we recommend using <code>dev.servicestack.com</code> which resolves to the <code>10.0.2.2</code> special IP in the Android Emulator that maps to <code>127.0.0.1</code> on your Host OS. To also be able to use it during development you&#39;ll need to add an entry in your OS&#39;s <code>hosts</code> file (e.g. <code>%SystemRoot%\\System32\\drivers\\etc\\hosts</code> for Windows or <code>/system/etc/hosts</code> on macOS/Linux):</p><pre><code>127.0.0.1       dev.servicestack.com
</code></pre><p>If you don&#39;t need to support android you can use <code>local.servicestack.com</code> instead which resolves to <code>127.0.0.1</code>, please see <a href="https://docs.servicestack.net/netcore-localhost-cert" target="_blank" rel="noopener noreferrer">configuring localhost development dev certificate</a> for more info.</p><p>Then you can view your App using the non-localhost domain name:</p><pre><code>https://dev.servicestack.com:5001/
</code></pre><p>You can then use the <a href="https://docs.servicestack.net/authentication-and-authorization#embedded-login-page-fallback" target="_blank" rel="noopener noreferrer">Embedded Login Page</a> which renders the Sign In button for each of the registered OAuth providers in your <code>AuthFeature</code>:</p><pre><code>https://dev.servicestack.com:5001/login
</code></pre><p>Clicking on <strong>Sign in with Apple</strong> button should let you Sign In with Apple. After successfully signing in you can view the <code>AllUsersInfo</code> Service to view a dump of all User Sessions &amp; User Auth Info stored in the registered RDBMS:</p><pre><code>https://dev.servicestack.com:5001/users
</code></pre><h2 id="flutter-ios-android-app" tabindex="-1">Flutter iOS &amp; Android App <a class="header-anchor" href="#flutter-ios-android-app" aria-hidden="true">#</a></h2><p>A reference client Flutter iOS &amp; Android App showcasing integration with Sign In with Apple is available at <a href="https://github.com/NetCoreApps/AppleSignIn/tree/master/flutter/auth" target="_blank" rel="noopener noreferrer">/flutter/auth</a>.</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dev/android-flutter-auth.png" alt=""></p><p>The first task the App does is to create an instance of the <code>IServiceClient</code> it should use using the recommended <code>ClientFactory</code> API which in combination with the conditional import below returns the appropriate configured Service Client implementation for the platform it&#39;s running on, for iOS &amp; Android it uses the native <code>JsonServiceClient</code>:</p><div class="language-dart"><pre><code><span class="token keyword">import</span> <span class="token string">&#39;package:servicestack/web_client.dart&#39;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>dart<span class="token punctuation">.</span><span class="token keyword">library</span><span class="token punctuation">.</span>io<span class="token punctuation">)</span> <span class="token string">&#39;package:servicestack/client.dart&#39;</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>

<span class="token class-name">AppState</span><span class="token punctuation">(</span>client<span class="token punctuation">:</span> kDebugMode
  <span class="token operator">?</span> <span class="token class-name">ClientFactory</span><span class="token punctuation">.</span><span class="token function">createWith</span><span class="token punctuation">(</span><span class="token class-name">ClientOptions</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">:</span><span class="token string">&#39;https://dev.servicestack.com:5001&#39;</span><span class="token punctuation">,</span> ignoreCert<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">:</span> <span class="token class-name">ClientFactory</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;https://prod.app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Using a constant like <code>kDebugMode</code> ensures that create Service Clients that ignore SSL Certificate errors are stripped from production builds.</p><h3 id="sign-in-with-apple-package" tabindex="-1">sign_in_with_apple package <a class="header-anchor" href="#sign-in-with-apple-package" aria-hidden="true">#</a></h3><p>To support both iOS and Android we&#39;re utilizing the <a href="https://pub.dev/packages/sign_in_with_apple" target="_blank" rel="noopener noreferrer">sign_in_with_apple</a> <code>SignInWithAppleButton</code> which takes care of invoking iOS&#39;s native Sign In with Apple behavior as well as enabling support for Android by wrapping an OAuth Web Flow in a WebView. Both approaches, if successful will result in an Authenticated IdentityToken which you can use to Authenticate with your ServiceStack instance to establish an Authenticated session.</p><p>The <code>SignInWithAppleButton</code> functions as a normal button which is placed in your Widgets <code>build()</code> method where you want the UI Button to appear, in this case it&#39;ll render the <strong>Sign in with Apple</strong> button if the user is not Authenticated otherwise it renders a <strong>Sign Out</strong> <code>FlatButton</code>:</p><div class="language-dart"><pre><code>state<span class="token punctuation">.</span>isAuthenticated
  <span class="token operator">?</span> <span class="token class-name">FlatButton</span><span class="token punctuation">(</span>onPressed<span class="token punctuation">:</span> state<span class="token punctuation">.</span>signOut<span class="token punctuation">,</span> child<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string">&#39;Sign Out&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">:</span> <span class="token class-name">SignInWithAppleButton</span><span class="token punctuation">(</span>onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span> <span class="token keyword">await</span> <span class="token function">handleSignIn</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>When either is pressed it invokes its <code>onPressed</code> event where the Apple Sign in functionality is initiated, within the <code>handleSignIn</code> implementation which reflects the behavior of the different platforms with Android using the OAuth Web Flow to authenticate with its ReturnUrl needing the Android&#39;s App Id that it should redirect to.</p><p>The native integration in iOS is more streamlined with iOS handling the Auth flow with Apple&#39;s servers:</p><div class="language-dart"><pre><code><span class="token keyword">var</span> clientID <span class="token operator">=</span> <span class="token string">&quot;net.servicestack.myappid&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> redirect <span class="token operator">=</span> <span class="token string">&quot;https://dev.servicestack.com:5001/auth/apple?ReturnUrl=android:com.servicestack.auth&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> scopes <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token class-name">AppleIDAuthorizationScopes</span><span class="token punctuation">.</span>email<span class="token punctuation">,</span> <span class="token class-name">AppleIDAuthorizationScopes</span><span class="token punctuation">.</span>fullName <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> credentials <span class="token operator">=</span> <span class="token class-name">Platform</span><span class="token punctuation">.</span>isAndroid
  <span class="token operator">?</span> <span class="token keyword">await</span> <span class="token class-name">SignInWithApple</span><span class="token punctuation">.</span><span class="token function">getAppleIDCredential</span><span class="token punctuation">(</span>scopes<span class="token punctuation">:</span>scopes<span class="token punctuation">,</span>
      webAuthenticationOptions<span class="token punctuation">:</span><span class="token class-name">WebAuthenticationOptions</span><span class="token punctuation">(</span>clientId<span class="token punctuation">:</span>clientID<span class="token punctuation">,</span>redirectUri<span class="token punctuation">:</span><span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>redirect<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">:</span> <span class="token keyword">await</span> <span class="token class-name">SignInWithApple</span><span class="token punctuation">.</span><span class="token function">getAppleIDCredential</span><span class="token punctuation">(</span>scopes<span class="token punctuation">:</span>scopes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="new-user-registration" tabindex="-1">New User Registration <a class="header-anchor" href="#new-user-registration" aria-hidden="true">#</a></h3><p>When a user signs into your App the first time they&#39;ll be presented with the option on what name they want to use and whether or not they want to provide their own email or use Apple&#39;s hidden email forwarding service:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dev/ios-flutter-sign-in-with-apple-new-user.png" alt=""></p><p>Subsequent re-authentication attempts in iOS are more seamless &amp; effortless for users whilst Android users will still need to go through the OAuth web flow:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dev/android-flutter-auth-request.png" alt=""></p><p>If Sign in is successful it will return the identity token which we can use to Authenticate against our remote ServiceStack instance. Importantly Apple only returns the Users name on its initial sign in which we&#39;ll need to include in our <code>Authenticate</code> request in order for it to be used when creating the new user account. The same code can also be used to re-authenticate existing users:</p><div class="language-dart"><pre><code><span class="token comment">// Sign in with Apple success!</span>
<span class="token keyword">var</span> idToken <span class="token operator">=</span> credentials<span class="token punctuation">.</span>identityToken<span class="token punctuation">;</span>

<span class="token comment">// Authenticate with server using idToken &amp; convert into stateless JWT Cookie + persistent auth token</span>
<span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">await</span> state<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token class-name">Authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span>provider <span class="token operator">=</span> <span class="token string">&#39;apple&#39;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span>accessToken <span class="token operator">=</span> idToken<span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&#39;authorizationCode&#39;</span><span class="token punctuation">:</span> credentials<span class="token punctuation">.</span>authorizationCode<span class="token punctuation">,</span>
        <span class="token string">&#39;givenName&#39;</span><span class="token punctuation">:</span> credentials<span class="token punctuation">.</span>givenName<span class="token punctuation">,</span>
        <span class="token string">&#39;familyName&#39;</span><span class="token punctuation">:</span> credentials<span class="token punctuation">.</span>familyName<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// JwtAuthProvider.UseTokenCookie returns session as JWT</span>

state<span class="token punctuation">.</span><span class="token function">saveAuth</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="persistent-authenticated-sessions" tabindex="-1">Persistent Authenticated Sessions <a class="header-anchor" href="#persistent-authenticated-sessions" aria-hidden="true">#</a></h3><p>We recommend using JWT to store authenticated sessions as it allows using a single approach to support multiple OAuth providers, inc. Username/Password Credentials Auth if you want your App to support it, it&#39;s also the fastest &amp; most resilient Auth Provider which requires no I/O to validate &amp; no server state as it&#39;s all encapsulated within the stateless client JWT token.</p><p>As all DTOs are JSON Serializable, the easiest way to persist Authentication is to save the <code>AuthenticateResponse</code> (which contains both JWT Bearer &amp; Refresh Tokens) in Flutter&#39;s <code>SharedPreferences</code> abstraction which has implementations available in all its supported platforms.</p><p>Populating a Service Client with <code>bearerToken</code> and <code>refreshToken</code> enables it to make authenticated requests which is done on successful Sign in requests and when the App is initialized which is also what allows for persistent authentication across App restarts.</p><div class="language-dart"><pre><code><span class="token keyword">class</span> <span class="token class-name">AppState</span> <span class="token keyword">extends</span> <span class="token class-name">ChangeNotifier</span> <span class="token punctuation">{</span>
  <span class="token class-name">SharedPreferences</span> prefs<span class="token punctuation">;</span>
  <span class="token class-name">IServiceClient</span> client<span class="token punctuation">;</span>
  <span class="token class-name">AuthenticateResponse</span> auth<span class="token punctuation">;</span>
  bool hasInit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  bool <span class="token keyword">get</span> isAuthenticated <span class="token operator">=</span><span class="token operator">&gt;</span> auth <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token class-name">AppState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>client<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AppState</span><span class="token punctuation">&gt;</span></span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    prefs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token class-name">SharedPreferences</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> json <span class="token operator">=</span> prefs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&#39;auth&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    auth <span class="token operator">=</span> json <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token class-name">AuthenticateResponse</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span><span class="token function">jsonDecode</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token function">initClientAuth</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> auth<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>auth <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">await</span> <span class="token function">checkIsAuthenticated</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      auth <span class="token operator">=</span> client<span class="token punctuation">.</span>bearerToken <span class="token operator">=</span> client<span class="token punctuation">.</span>refreshToken <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      prefs<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&#39;auth&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    hasInit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">signOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">saveAuth</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">saveAuth</span><span class="token punctuation">(</span><span class="token class-name">AuthenticateResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    auth <span class="token operator">=</span> response<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>auth <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> json <span class="token operator">=</span> <span class="token function">jsonEncode</span><span class="token punctuation">(</span>auth<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      prefs<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token string">&#39;auth&#39;</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      prefs<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&#39;auth&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">initClientAuth</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> auth<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">notifyListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">initClientAuth</span><span class="token punctuation">(</span><span class="token class-name">IServiceClient</span> client<span class="token punctuation">,</span> <span class="token class-name">AuthenticateResponse</span> auth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  client<span class="token punctuation">.</span>bearerToken <span class="token operator">=</span> auth<span class="token operator">?</span><span class="token punctuation">.</span>bearerToken<span class="token punctuation">;</span>
  client<span class="token punctuation">.</span>refreshToken <span class="token operator">=</span> auth<span class="token operator">?</span><span class="token punctuation">.</span>refreshToken<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>auth <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    client<span class="token punctuation">.</span><span class="token function">clearCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span>bool<span class="token punctuation">&gt;</span></span> <span class="token function">checkIsAuthenticated</span><span class="token punctuation">(</span><span class="token class-name">IServiceClient</span> client<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token class-name">Authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When signing out we also want to remove its cookies to clear its <code>ss-tok</code> authenticated JWT Cookie inc. any other user identifying cookies.</p><p>The call to <code>notifyListeners()</code> is part of Flutter&#39;s <code>ChangeNotifier</code><a href="https://flutter.dev/docs/development/data-and-backend/state-mgmt/simple" target="_blank" rel="noopener noreferrer">Simple app state management</a> solution which notifies widgets using it of state changes, triggering re-rendering of its UI.</p><h3 id="authenticated-api-requests" tabindex="-1">Authenticated API Requests <a class="header-anchor" href="#authenticated-api-requests" aria-hidden="true">#</a></h3><p>To test Authentication the App makes a call to <code>HelloSecure</code> Secured C# ServiceStack Service that validates Auth only access using the <code>[ValidateIsAuthenticated]</code> <a href="https://docs.servicestack.net/declarative-validation" target="_blank" rel="noopener noreferrer">declarative validation attribute</a>:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateIsAuthenticated</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/hello/secure&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/hello/secure/{Name}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloSecure</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>HelloResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloResponse</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Result <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServices</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">HelloSecure</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HelloResponse</span> <span class="token punctuation">{</span> Result <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;Secure </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">request<span class="token punctuation">.</span>Name</span><span class="token punctuation">}</span></span><span class="token string">!&quot;</span></span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Which uses the Dart client DTOs generated using the <a href="https://docs.servicestack.net/dart-add-servicestack-reference" target="_blank" rel="noopener noreferrer">Dart ServiceStack Reference</a> feature to perform its Typed API Request:</p><div class="language-dart"><pre><code>  floatingActionButton<span class="token punctuation">:</span> <span class="token class-name">FloatingActionButton</span><span class="token punctuation">(</span>
    onPressed<span class="token punctuation">:</span> _callService<span class="token punctuation">,</span>
    tooltip<span class="token punctuation">:</span> <span class="token string">&#39;HTTP API Example&#39;</span><span class="token punctuation">,</span>
    child<span class="token punctuation">:</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span><span class="token class-name">Icons</span><span class="token punctuation">.</span>play_arrow<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// This trailing comma makes auto-formatting nicer for build methods.</span>

<span class="token comment">//...</span>

  <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token keyword">void</span><span class="token punctuation">&gt;</span></span> <span class="token function">_callService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> client <span class="token operator">=</span> <span class="token class-name">Provider</span><span class="token punctuation">.</span>of<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AppState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> listen<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span>client<span class="token punctuation">;</span>
      <span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token class-name">HelloSecure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Flutter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> response<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">on</span> <span class="token class-name">WebServiceException</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> <span class="token string">&quot;\${e.statusCode}: \${e.message}&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>Which if authenticated will update the UI with API Response for both iOS:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dev/ios-flutter-auth-request.jpeg" alt=""></p><p>and Android:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dev/android-flutter-secure.png" alt=""></p><p>Or fail with an <code>Unauthorized: Not Authenticated</code> error if the user is not Signed in.</p><h3 id="resetting-app-sign-in" tabindex="-1">Resetting App Sign in <a class="header-anchor" href="#resetting-app-sign-in" aria-hidden="true">#</a></h3><p>As the Sign in behavior is different for new &amp; existing users you may need to find yourself needing to retest the new user workflow which you can do by removing your existing relationship to your App by signing into your Apple Id:</p><ul><li><a href="https://appleid.apple.com" target="_blank" rel="noopener noreferrer">appleid.apple.com</a></li></ul><p>Then under <strong>Security</strong> click on <strong>Manage apps &amp; websites...</strong></p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dev/appleid-manage-signin.png" alt=""></p><p>Which will let you delete your existing user id and relationship with existing Apps you&#39;ve signed into:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dev/appleid-reset-signin.png" alt=""></p><p>Now next time you Sign in to your App it will behave as an initial new User request complete with a new unique user id.</p><h3 id="flutter-android-sign-in-with-apple-requirements" tabindex="-1">Flutter Android sign_in_with_apple requirements <a class="header-anchor" href="#flutter-android-sign-in-with-apple-requirements" aria-hidden="true">#</a></h3><p>It&#39;s already configured in this project, but to be able to use <a href="https://pub.dev/packages/sign_in_with_apple" target="_blank" rel="noopener noreferrer">sign_in_with_apple</a> in your own Flutter Android Apps you&#39;ll need to register this Android intent in your <strong>AndroidManifest.xml</strong>:</p><div class="language-xml"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>application</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Set up the Sign in with Apple activity, such that it&#39;s callable from the browser-redirect --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.aboutyou.dart_packages.sign_in_with_apple.SignInWithAppleCallback<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.action.VIEW<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.category.DEFAULT<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.category.BROWSABLE<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name"><span class="token namespace">android:</span>scheme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>signinwithapple<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name"><span class="token namespace">android:</span>path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>callback<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!-- Don&#39;t delete the meta-data below.
            This is used by the Flutter tool to generate GeneratedPluginRegistrant.java --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta-data</span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flutterEmbedding<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>application</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="servicestack-appleauthprovider-configuration" tabindex="-1">ServiceStack AppleAuthProvider configuration <a class="header-anchor" href="#servicestack-appleauthprovider-configuration" aria-hidden="true">#</a></h4><p>This client App configuration works in combination with the Server&#39;s <code>AppleAuthProvider</code> to redirect to your Android&#39;s App intent which needs to be configured with:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AppleAuthProvider</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>AppleAuthFeature<span class="token punctuation">.</span>FlutterSignInWithApple<span class="token punctuation">)</span><span class="token punctuation">,</span> 
</code></pre></div><p>Where it adds support for <code>?ReturnUrl=android:&lt;android-package-id&gt;</code> Callback URLs that your Flutter Android App needs to use.</p><h2 id="swiftui-app" tabindex="-1">SwiftUI App <a class="header-anchor" href="#swiftui-app" aria-hidden="true">#</a></h2><p>There&#39;s also a SwiftUI iOS Example App available at <a href="https://github.com/NetCoreApps/AppleSignIn/tree/master/swift/MyApp" target="_blank" rel="noopener noreferrer">/swift/MyApp</a> as it&#39;ll likely end up being another popular platform that will utilize <strong>Sign in with Apple</strong>.</p><p>It&#39;s a good idea to checkout Apple&#39;s official docs for their recommended approach for <a href="https://developer.apple.com/documentation/authenticationservices/implementing_user_authentication_with_sign_in_with_apple" target="_blank" rel="noopener noreferrer">Implementing User Authentication with Sign in with Apple</a> in Swift Apps which includes a sample iOS Storyboard Swift App which enlists the built-in <a href="https://developer.apple.com/documentation/authenticationservices" target="_blank" rel="noopener noreferrer">Authentication Services Framework</a> for iOS&#39;s native Sign in feature.</p><p>For simplicity &amp; comparison purposes we&#39;ve developed an App similar to the Flutter example using Apple&#39;s new declarative state-of-the-art <a href="https://developer.apple.com/xcode/swiftui/" target="_blank" rel="noopener noreferrer">SwiftUI Framework</a>, which like Flutter is a declarative Reactive UI Framework allowing you to construct your App&#39;s UI &amp; logic in code - most of which is contained within <a href="https://github.com/NetCoreApps/AppleSignIn/blob/master/swift/MyApp/MyApp/ContentView.swift" target="_blank" rel="noopener noreferrer">ContentView.swift</a>.</p><h4 id="real-device-needed-to-test-sign-in-with-apple" tabindex="-1">Real device needed to test Sign in with Apple <a class="header-anchor" href="#real-device-needed-to-test-sign-in-with-apple" aria-hidden="true">#</a></h4><p>Whilst the iOS Simulator can run the rest of the App, a real device was needed to test the actual Sign in functionality which otherwise hangs in the simulator which has been reported is due to 2FA which is required to use Sign in with Apple.</p><h3 id="add-servicestack-swift-package" tabindex="-1">Add ServiceStack.Swift package <a class="header-anchor" href="#add-servicestack-swift-package" aria-hidden="true">#</a></h3><p>From Xcode 12 the Swift Package Manager is built into Xcode.</p><p>Go to <strong>File</strong> &gt; <strong>Swift Packages</strong> &gt; <strong>Add Package Dependency</strong>:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dev/xcode-swift-add-package.png" alt=""></p><p>Add a reference to the ServiceStack.Swift GitHub repo:</p><pre><code>https://github.com/ServiceStack/ServiceStack.Swift
</code></pre><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dev/xcode-add-servicestack-swift.png" alt=""></p><p>After adding the dependency both <a href="https://github.com/ServiceStack/ServiceStack.Swift" target="_blank" rel="noopener noreferrer">ServiceStack.Swift</a> and its <a href="https://github.com/mxcl/PromiseKit" target="_blank" rel="noopener noreferrer">PromiseKit</a> dependency will be added to your project:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dev/xcode-servicestack-swift-added.png" alt=""></p><h3 id="enabling-sign-in-with-apple-capability" tabindex="-1">Enabling Sign In With Apple Capability <a class="header-anchor" href="#enabling-sign-in-with-apple-capability" aria-hidden="true">#</a></h3><p>To enable Sign In functionality in your iOS App you&#39;ll need to add the <strong>Sign in with Apple</strong> capability in your App&#39;s <strong>Target</strong> &gt; <strong>Signing &amp; Capabilities</strong> window:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dev/ios-swiftui-xcode-capability.png" alt=""></p><h3 id="swiftui-layout" tabindex="-1">SwiftUI Layout <a class="header-anchor" href="#swiftui-layout" aria-hidden="true">#</a></h3><p>SwiftUI&#39;s declarative API is able to expressively capture our UI in its different states within this code fragment below:</p><div class="language-swift"><pre><code><span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token attribute atrule">@ObservedObject</span> <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token class-name">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
         <span class="token class-name">VStack</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token operator">!</span>vm<span class="token punctuation">.</span>hasInit <span class="token punctuation">{</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Loading...&quot;</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Go!&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    vm<span class="token punctuation">.</span><span class="token function">doSecureRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token keyword">let</span> auth <span class="token operator">=</span> vm<span class="token punctuation">.</span>auth <span class="token punctuation">{</span>
                    <span class="token class-name">VStack</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Hi </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">auth<span class="token punctuation">.</span>displayName <span class="token operator">??</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> vm<span class="token punctuation">.</span>authState <span class="token operator">!=</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span> <span class="token punctuation">{</span>
                            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;authState: </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">vm<span class="token punctuation">.</span>authState</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>authState <span class="token operator">==</span> <span class="token string-literal"><span class="token string">&quot;authorized&quot;</span></span> <span class="token operator">?</span> <span class="token punctuation">.</span>green <span class="token punctuation">:</span> <span class="token punctuation">.</span>primary<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                        <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Sign Out&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> vm<span class="token punctuation">.</span><span class="token function">signOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">AppleSignInButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span>onTapGesture <span class="token punctuation">{</span>
                            <span class="token keyword">self</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">AppleSignInButton</span><span class="token punctuation">:</span> <span class="token class-name">UIViewRepresentable</span> <span class="token punctuation">{</span>
 <span class="token keyword">func</span> <span class="token function-definition function">makeUIView</span><span class="token punctuation">(</span>context<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">ASAuthorizationAppleIDButton</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token class-name">ASAuthorizationAppleIDButton</span><span class="token punctuation">(</span>
    authorizationButtonType<span class="token punctuation">:</span> <span class="token punctuation">.</span>signUp<span class="token punctuation">,</span>
    authorizationButtonStyle<span class="token punctuation">:</span> <span class="token punctuation">.</span>white<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">func</span> <span class="token function-definition function">updateUIView</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> uiView<span class="token punctuation">:</span> <span class="token class-name">ASAuthorizationAppleIDButton</span><span class="token punctuation">,</span> context<span class="token punctuation">:</span><span class="token class-name">Context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Which for an initialized unauthenticated user will render the <strong>Go!</strong> button with a Sign in button:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dev/ios-swiftui-home.png" alt=""></p><p>The Sign in buttons UI is defined by <code>AppleSignInButton()</code> which is our wrapper around Apple&#39;s <code>ASAuthorizationAppleIDButton()</code> that allows for several customizations to change its appearance. When the button is pressed it calls our ViewModel <code>getRequest()</code> method to initiate the Sign in request.</p><p><code>@ObservedObject</code> is one of SwiftUI&#39;s constructs for managing state, effectively it&#39;s the mechanism by which your App modifies to re-render its UI. A good article explaining the features and differences of each construct can be found in <a href="https://purple.telstra.com/blog/swiftui---state-vs--stateobject-vs--observedobject-vs--environme" target="_blank" rel="noopener noreferrer">SwiftUI: @State vs @StateObject vs @ObservedObject vs @EnvironmentObject</a>.</p><p>Inside <code>getRequest()</code> we can see it&#39;s just calling <code>signInWithApple.getAppleRequest()</code> which is our custom controller used to manage the Sign in request.</p><div class="language-swift"><pre><code><span class="token keyword">class</span> <span class="token class-name">ViewModel</span><span class="token punctuation">:</span> <span class="token class-name">ObservableObject</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">lazy</span> <span class="token keyword">var</span> signInWithApple <span class="token operator">=</span> <span class="token class-name">SignInWithAppleCoordinator</span><span class="token punctuation">(</span>vm<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">lazy</span> <span class="token keyword">var</span> client <span class="token operator">=</span> <span class="token function">createClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">func</span> <span class="token function-definition function">createClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">JsonServiceClient</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> client <span class="token operator">=</span> <span class="token class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;https://dev.servicestack.com:5001&quot;</span></span><span class="token punctuation">)</span>
        client<span class="token punctuation">.</span>ignoreCert <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">return</span> client
    <span class="token punctuation">}</span>
    
    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> auth<span class="token punctuation">:</span> <span class="token class-name">AuthenticateResponse</span><span class="token operator">?</span>
    <span class="token keyword">var</span> isAuthenticated<span class="token punctuation">:</span><span class="token class-name">Bool</span> <span class="token punctuation">{</span> auth <span class="token operator">!=</span> <span class="token nil constant">nil</span> <span class="token punctuation">}</span>
    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> hasInit<span class="token punctuation">:</span><span class="token class-name">Bool</span> <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> result<span class="token punctuation">:</span><span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span>
    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> authState<span class="token punctuation">:</span><span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span>
    
    <span class="token keyword">func</span> <span class="token function-definition function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        signInWithApple<span class="token punctuation">.</span><span class="token function">getAppleRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//....</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>SignInWithAppleCoordinator</code> uses the <code>ASAuthorizationController</code> to initiate the request and assigns itself as the <code>ASAuthorizationControllerDelegate</code> used to handle its success &amp; error callbacks:</p><div class="language-swift"><pre><code><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">SignInWithAppleCoordinator</span> <span class="token punctuation">:</span> <span class="token class-name">NSObject</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> vm<span class="token punctuation">:</span> <span class="token class-name">ViewModel</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>vm<span class="token punctuation">:</span><span class="token class-name">ViewModel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm
    <span class="token punctuation">}</span>
    
    <span class="token keyword">func</span> <span class="token function-definition function">getAppleRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> appleIdProvider <span class="token operator">=</span> <span class="token class-name">ASAuthorizationAppleIDProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> request <span class="token operator">=</span> appleIdProvider<span class="token punctuation">.</span><span class="token function">createRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        request<span class="token punctuation">.</span>requestedScopes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>fullName<span class="token punctuation">,</span> <span class="token punctuation">.</span>email<span class="token punctuation">]</span>
        <span class="token keyword">let</span> authController <span class="token operator">=</span> <span class="token class-name">ASAuthorizationController</span><span class="token punctuation">(</span>authorizationRequests<span class="token punctuation">:</span> <span class="token punctuation">[</span>request<span class="token punctuation">]</span><span class="token punctuation">)</span>
        authController<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span>
        authController<span class="token punctuation">.</span><span class="token function">performRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">setUserInfo</span><span class="token punctuation">(</span><span class="token keyword">for</span> credential<span class="token punctuation">:</span> <span class="token class-name">ASAuthorizationAppleIDCredential</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ASAuthorizationAppleIDProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCredentialState</span><span class="token punctuation">(</span>forUserID<span class="token punctuation">:</span> credential<span class="token punctuation">.</span>user<span class="token punctuation">,</span> completion<span class="token punctuation">:</span> <span class="token punctuation">{</span> 
          credentialState<span class="token punctuation">,</span> error <span class="token keyword">in</span>
            <span class="token keyword">var</span> authState<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span>
            <span class="token keyword">switch</span> credentialState <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span>authorized<span class="token punctuation">:</span> authState <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;authorized&quot;</span></span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span>notFound<span class="token punctuation">:</span> authState <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;notFound&quot;</span></span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span>revoked<span class="token punctuation">:</span> authState <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;revoked&quot;</span></span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span>transferred<span class="token punctuation">:</span> authState <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;transferred&quot;</span></span>
            <span class="token attribute atrule">@unknown</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>credential<span class="token punctuation">:</span>credential<span class="token punctuation">,</span> authState<span class="token punctuation">:</span>authState<span class="token operator">!</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token class-name">SignInWithAppleCoordinator</span> <span class="token punctuation">:</span> <span class="token class-name">ASAuthorizationControllerDelegate</span> 
<span class="token punctuation">{</span>    
    <span class="token keyword">func</span> <span class="token function-definition function">authorizationController</span><span class="token punctuation">(</span>controller<span class="token punctuation">:</span> <span class="token class-name">ASAuthorizationController</span><span class="token punctuation">,</span> 
      didCompleteWithAuthorization authorization<span class="token punctuation">:</span> <span class="token class-name">ASAuthorization</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> credential <span class="token operator">=</span> authorization<span class="token punctuation">.</span>credential <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">ASAuthorizationAppleIDCredential</span> <span class="token punctuation">{</span>
            <span class="token function">setUserInfo</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> credential<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">func</span> <span class="token function-definition function">authorizationController</span><span class="token punctuation">(</span>controller<span class="token punctuation">:</span> <span class="token class-name">ASAuthorizationController</span><span class="token punctuation">,</span> didCompleteWithError error<span class="token punctuation">:</span> <span class="token class-name">Error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Sign In with Apple Error: </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">error<span class="token punctuation">.</span>localizedDescription</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The Sign in request is initiated with <code>authController.performRequests()</code> which on first usage launches a splash screen explaining the benefits of <strong>Sign in with Apple</strong>:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dev/ios-swiftui-signin-with-apple-splash.png" alt=""></p><p>Then new users will be able to customize the name &amp; email they&#39;ll share with your App:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dev/ios-swiftui-signin-with-apple-new-user.png" alt=""></p><p>Upon successful authentication the <code>authorizationController</code> callback gets invoked with the users credentials captured in the <code>ASAuthorizationAppleIDCredential</code> struct that eventually calls <code>setUser()</code> with both the authenticated <code>credential</code> and its <code>authState</code>.</p><p><code>setUser()</code> then uses the authorized <code>credential</code> to authenticate with our remote ServiceStack instance, passing through the <code>givenName</code> and <code>familyName</code> that are only populated on a new Users initial Sign in request with the App.</p><div class="language-swift"><pre><code><span class="token keyword">func</span> <span class="token function-definition function">setUser</span><span class="token punctuation">(</span>credential<span class="token punctuation">:</span> <span class="token class-name">ASAuthorizationAppleIDCredential</span><span class="token punctuation">,</span> authState<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>authState <span class="token operator">=</span> authState

        <span class="token keyword">if</span> authState <span class="token operator">==</span> <span class="token string-literal"><span class="token string">&quot;authorized&quot;</span></span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token class-name">Authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            request<span class="token punctuation">.</span>provider <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;apple&quot;</span></span>
            request<span class="token punctuation">.</span>accessToken <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>decoding<span class="token punctuation">:</span>credential<span class="token punctuation">.</span>identityToken<span class="token operator">!</span><span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> UTF8<span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span>
            request<span class="token punctuation">.</span>meta <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token string-literal"><span class="token string">&quot;authorizationCode&quot;</span></span><span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">(</span>decoding<span class="token punctuation">:</span>credential<span class="token punctuation">.</span>authorizationCode<span class="token operator">!</span><span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> UTF8<span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string-literal"><span class="token string">&quot;givenName&quot;</span></span><span class="token punctuation">:</span> credential<span class="token punctuation">.</span>fullName<span class="token operator">?</span><span class="token punctuation">.</span>givenName <span class="token operator">??</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span><span class="token punctuation">,</span>
                <span class="token string-literal"><span class="token string">&quot;familyName&quot;</span></span><span class="token punctuation">:</span> credential<span class="token punctuation">.</span>fullName<span class="token operator">?</span><span class="token punctuation">.</span>familyName <span class="token operator">??</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span>
            <span class="token omit keyword">_</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">postAsync</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
                <span class="token punctuation">.</span>done <span class="token punctuation">{</span> r <span class="token keyword">in</span>
                    <span class="token keyword">self</span><span class="token punctuation">.</span>auth <span class="token operator">=</span> r
                    <span class="token class-name">UserDefaults</span><span class="token punctuation">.</span>standard<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;auth&quot;</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">self</span><span class="token punctuation">.</span>client<span class="token punctuation">.</span>bearerToken <span class="token operator">=</span> r<span class="token punctuation">.</span>bearerToken
                    <span class="token keyword">self</span><span class="token punctuation">.</span>client<span class="token punctuation">.</span>refreshToken <span class="token operator">=</span> r<span class="token punctuation">.</span>refreshToken
                <span class="token punctuation">}</span>
                <span class="token punctuation">.</span><span class="token keyword">catch</span> <span class="token punctuation">{</span> error <span class="token keyword">in</span>
                    <span class="token keyword">let</span> status<span class="token punctuation">:</span><span class="token class-name">ResponseStatus</span> <span class="token operator">=</span> error<span class="token punctuation">.</span><span class="token function">convertUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span>
                    <span class="token keyword">self</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">status<span class="token punctuation">.</span>errorCode <span class="token operator">??</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">: </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">status<span class="token punctuation">.</span>message <span class="token operator">??</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Like the Flutter example, we save the JSON serialized <code>AuthenticateResponse</code> DTO to enable persistent Authentication across App restarts and populate the <code>JsonServiceClient</code> with the JWT <code>bearerToken</code> and <code>refreshToken</code> to configure the authenticated Service Client.</p><p>To Sign out the user we can use a new fresh client instance and remove any shared cookies that were created by the previous client.</p><div class="language-swift"><pre><code><span class="token keyword">func</span> <span class="token function-definition function">signOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>auth <span class="token operator">=</span> <span class="token nil constant">nil</span>
        <span class="token class-name">HTTPCookieStorage</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span>cookies<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">HTTPCookieStorage</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span>deleteCookie<span class="token punctuation">)</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>client <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">createClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">UserDefaults</span><span class="token punctuation">.</span>standard<span class="token punctuation">.</span><span class="token function">removeObject</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;auth&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="loading-persistent-jwt-auth-tokens" tabindex="-1">Loading persistent JWT Auth Tokens <a class="header-anchor" href="#loading-persistent-jwt-auth-tokens" aria-hidden="true">#</a></h3><p>Which is restored on App start and verified the JWT Token is still valid by calling the <code>Authenticate</code> Service with an empty DTO which returns if Authenticated otherwise throws a <strong>401 Unauthorized</strong> Error if they&#39;re not.</p><div class="language-swift"><pre><code><span class="token keyword">class</span> <span class="token class-name">ViewModel</span><span class="token punctuation">:</span> <span class="token class-name">ObservableObject</span> <span class="token punctuation">{</span>
  <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token comment">//...</span>

  <span class="token keyword">func</span> <span class="token function-definition function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token keyword">let</span> authJson <span class="token operator">=</span> <span class="token class-name">UserDefaults</span><span class="token punctuation">.</span>standard<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;auth&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">let</span> auth <span class="token operator">=</span> <span class="token class-name">AuthenticateResponse</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>authJson<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          client<span class="token punctuation">.</span>bearerToken <span class="token operator">=</span> auth<span class="token punctuation">.</span>bearerToken
          client<span class="token punctuation">.</span>refreshToken <span class="token operator">=</span> auth<span class="token punctuation">.</span>refreshToken
          client<span class="token punctuation">.</span><span class="token function">postAsync</span><span class="token punctuation">(</span><span class="token class-name">Authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span>done <span class="token punctuation">{</span> r <span class="token keyword">in</span>
                  <span class="token keyword">self</span><span class="token punctuation">.</span>auth <span class="token operator">=</span> auth
              <span class="token punctuation">}</span>
              <span class="token punctuation">.</span><span class="token keyword">catch</span> <span class="token punctuation">{</span> error <span class="token keyword">in</span>
                  <span class="token keyword">self</span><span class="token punctuation">.</span>client<span class="token punctuation">.</span>bearerToken <span class="token operator">=</span> <span class="token nil constant">nil</span>
                  <span class="token keyword">self</span><span class="token punctuation">.</span>client<span class="token punctuation">.</span>refreshToken <span class="token operator">=</span> <span class="token nil constant">nil</span>
                  <span class="token class-name">UserDefaults</span><span class="token punctuation">.</span>standard<span class="token punctuation">.</span><span class="token function">removeObject</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;auth&quot;</span></span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
              <span class="token punctuation">.</span>finally <span class="token punctuation">{</span>
                  <span class="token keyword">self</span><span class="token punctuation">.</span>hasInit <span class="token operator">=</span> <span class="token boolean">true</span>
              <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">self</span><span class="token punctuation">.</span>hasInit <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="apple-recommends-maintaining-auth-tokens-in-keychain" tabindex="-1">Apple recommends maintaining Auth tokens in Keychain <a class="header-anchor" href="#apple-recommends-maintaining-auth-tokens-in-keychain" aria-hidden="true">#</a></h4><p>Whilst this example uses <code>UserDefaults</code>, Apple&#39;s recommendation is to instead <a href="https://developer.apple.com/documentation/authenticationservices/implementing_user_authentication_with_sign_in_with_apple#3546459" target="_blank" rel="noopener noreferrer">save auth tokens in the User&#39;s Keychain</a>.</p><h3 id="authenticated-requests" tabindex="-1">Authenticated Requests <a class="header-anchor" href="#authenticated-requests" aria-hidden="true">#</a></h3><p>With our Service Client configured with our JWT Auth Tokens it can now be used to perform authenticated requests using the generic <code>JsonServiceClient</code> to send typed Swift DTOs generated from the <a href="https://docs.servicestack.net/swift-add-servicestack-reference" target="_blank" rel="noopener noreferrer">Swift ServiceStack Reference</a> feature:</p><div class="language-swift"><pre><code><span class="token keyword">func</span> <span class="token function-definition function">doSecureRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span>
    <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token class-name">HelloSecure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        request<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;SwiftUI&quot;</span></span>
        <span class="token omit keyword">_</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">getAsync</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
            <span class="token punctuation">.</span>done <span class="token punctuation">{</span> r <span class="token keyword">in</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>result <span class="token operator">=</span> r<span class="token punctuation">.</span>result <span class="token operator">??</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token keyword">catch</span> <span class="token punctuation">{</span> error <span class="token keyword">in</span>
                <span class="token keyword">let</span> status<span class="token punctuation">:</span><span class="token class-name">ResponseStatus</span> <span class="token operator">=</span> error<span class="token punctuation">.</span><span class="token function">convertUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">status<span class="token punctuation">.</span>errorCode <span class="token operator">??</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">: </span><span class="token interpolation-punctuation punctuation">\\(</span><span class="token interpolation">status<span class="token punctuation">.</span>message <span class="token operator">??</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Which when sent from an authenticated Service Client will result in the expected:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dev/ios-swiftui-auth-request.jpeg" alt=""></p><h3 id="advanced-configuration" tabindex="-1">Advanced Configuration <a class="header-anchor" href="#advanced-configuration" aria-hidden="true">#</a></h3><p>As with ServiceStack&#39;s other <a href="https://docs.servicestack.net/authentication-and-authorization#oauth-providers" target="_blank" rel="noopener noreferrer">OAuth Providers</a>, the behavior of the <code>AppleAuthProvider</code> can be further customized with the below configuration, when registering the <code>AppleAuthProvider</code> or in your App&#39;s configured <a href="https://docs.servicestack.net/appsettings" target="_blank" rel="noopener noreferrer">App Settings</a>:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppleAuthProvider</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Apple Developer Membership Team ID</span>
    <span class="token comment">// appsettings: oauth.apple.TeamId</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> TeamId
    
    <span class="token comment">// Service ID</span>
    <span class="token comment">// appsettings: oauth.apple.ClientId</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> ClientId
        
    <span class="token comment">// Bundle ID</span>
    <span class="token comment">// appsettings: oauth.apple.BundleId</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> BundleId

    <span class="token comment">// The Private Key ID</span>
    <span class="token comment">// appsettings: oauth.apple.KeyId</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> KeyId
    
    <span class="token comment">// Path to .p8 Private Key </span>
    <span class="token comment">// appsettings: oauth.apple.KeyPath</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> KeyPath

    <span class="token comment">// Base64 of .p8 Private Key bytes </span>
    <span class="token comment">// appsettings: oauth.apple.KeyBase64</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> KeyBase64
    
    <span class="token comment">// .p8 Private Key bytes </span>
    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> KeyBytes
    
    <span class="token comment">// Customize ClientSecret JWT</span>
    <span class="token keyword">public</span> Func<span class="token operator">&lt;</span>AppleAuthProvider<span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token operator">&gt;</span> ClientSecretFactory
    
    <span class="token comment">// When JWT Client Secret expires, defaults to Apple Max 6 Month Expiry </span>
    <span class="token comment">// default: 6 months in secs </span>
    <span class="token comment">// appsettings: oauth.apple.ClientSecretExpiry</span>
    <span class="token keyword">public</span> TimeSpan ClientSecretExpiry
    
    <span class="token comment">// JSON list of Apple&#39;s public keys, defaults to fetching from https://appleid.apple.com/auth/keys</span>
    <span class="token comment">// appsettings: oauth.apple.IssuerSigningKeysJson</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> IssuerSigningKeysJson

    <span class="token comment">// Whether to cache private Key if loading from KeyPath, </span>
    <span class="token comment">// default: true</span>
    <span class="token comment">// appsettings: oauth.apple.CacheKey</span>
    <span class="token keyword">public</span> <span class="token keyword">bool</span> CacheKey

    <span class="token comment">// Whether to cache Apple&#39;s public keys</span>
    <span class="token comment">// default: true</span>
    <span class="token comment">// appsettings: oauth.apple.CacheKey</span>
    <span class="token keyword">public</span> <span class="token keyword">bool</span> CacheIssuerSigningKeys

    <span class="token comment">// How long before re-validating Sign in RefreshToken, default: 1 day.</span>
    <span class="token comment">// Set to null to disable RefreshToken validation.</span>
    <span class="token keyword">public</span> TimeSpan<span class="token punctuation">?</span> ValidateRefreshTokenExpiry

    <span class="token comment">// Custom DisplayName resolver function when not sent by Apple</span>
    <span class="token keyword">public</span> Func<span class="token operator">&lt;</span>IAuthSession<span class="token punctuation">,</span>IAuthTokens<span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token operator">&gt;</span> ResolveUnknownDisplayName
<span class="token punctuation">}</span>
</code></pre></div><h2 id="enhanced-dart-support" tabindex="-1">Enhanced Dart support <a class="header-anchor" href="#enhanced-dart-support" aria-hidden="true">#</a></h2><p>The recommended way to create Dart Service Client instances is now to use the new <code>ClientFactory</code> which enables source-compatible Service Client instance creation in both Dart VM / Flutter <code>JsonServiceClient</code> and Dart Web <code>JsonWebClient</code> IServiceClient&#39;s that can be created with:</p><div class="language-dart"><pre><code><span class="token keyword">import</span> <span class="token string">&#39;package:servicestack/web_client.dart&#39;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>dart<span class="token punctuation">.</span><span class="token keyword">library</span><span class="token punctuation">.</span>io<span class="token punctuation">)</span> <span class="token string">&#39;package:servicestack/client.dart&#39;</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>

<span class="token keyword">var</span> client <span class="token operator">=</span> <span class="token class-name">ClientFactory</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or using <code>ClientOptions</code> for more advanced configuration, e.g:</p><div class="language-dart"><pre><code><span class="token keyword">var</span> client <span class="token operator">=</span> <span class="token class-name">ClientFactory</span><span class="token punctuation">.</span><span class="token function">createWith</span><span class="token punctuation">(</span>
    <span class="token class-name">ClientOptions</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">:</span><span class="token string">&#39;https://dev.servicestack.com:5001&#39;</span><span class="token punctuation">,</span> ignoreCert<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>All instances created with <code>ClientFactory</code> can be further customized by the <code>initClient</code> lambda to configure all ServiceClients instances, e.g. you could configure them to use the same JWT Token with:</p><div class="language-dart"><pre><code><span class="token class-name">ClientConfig</span><span class="token punctuation">.</span>initClient <span class="token operator">=</span> <span class="token punctuation">(</span>client<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> client<span class="token punctuation">.</span>bearerToken <span class="token operator">=</span> jwtToken<span class="token punctuation">;</span>
</code></pre></div><h3 id="new-dart-client-apis" tabindex="-1">New Dart Client APIs <a class="header-anchor" href="#new-dart-client-apis" aria-hidden="true">#</a></h3><p>All Service Client implementations now implement <code>clearCookies()</code> to remove traces of previously assigned cookies:</p><div class="language-dart"><pre><code><span class="token keyword">void</span> <span class="token function">clearCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="support-for-naked-lists" tabindex="-1">Support for Naked Lists <a class="header-anchor" href="#support-for-naked-lists" aria-hidden="true">#</a></h3><p>Resolved a <a href="https://github.com/dart-lang/language/issues/1056" target="_blank" rel="noopener noreferrer">Dart VM on Device issue</a> reporting different types in its Type introspection APIs where <code>JsonConverters.TypeFactories</code> are now populated with additional concrete Type mappings for all generic types to add support for returning naked lists, e.g:</p><div class="language-dart"><pre><code><span class="token keyword">class</span> <span class="token class-name">GetFoo</span> <span class="token punctuation">:</span> <span class="token class-name">OrderedRequest</span><span class="token punctuation">,</span> <span class="token class-name">IReturn</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">FooDto</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="blazor-web-assembly-template" tabindex="-1">Blazor Web Assembly Template <a class="header-anchor" href="#blazor-web-assembly-template" aria-hidden="true">#</a></h2><p><a href="https://github.com/nukedbit" target="_blank" rel="noopener noreferrer">Sebastian Faltoni</a> from the ServiceStack community continues to improve <a href="https://github.com/nukedbit/blazor-wasm-servicestack" target="_blank" rel="noopener noreferrer">Blazor WASM Template</a>, now with new support for .NET 5.0!</p><p>A New ServiceStack + Blazor WASM templates can be created with:</p><pre><code>$ x new nukedbit/blazor-wasm-servicestack ProjectName
</code></pre><h3 id="executing-in-a-standalone-desktop-app" tabindex="-1">Executing in a Standalone Desktop app <a class="header-anchor" href="#executing-in-a-standalone-desktop-app" aria-hidden="true">#</a></h3><p>For an even better integrated Desktop App Experience you can also use ServiceStack&#39;s <a href="https://docs.servicestack.net/netcore-windows-desktop" target="_blank" rel="noopener noreferrer">app dotnet tool</a> to run your Blazor Desktop Apps as a Chromium Desktop App:</p><pre><code>$ dotnet tool update -g app
$ x new nukedbit/blazor-wasm-servicestack Acme
$ cd Acme\\Acme
$ dotnet public -c Release
$ cd bin\\Release\\net5.0\\publish
$ app Acme.dll
</code></pre><p><img src="https://raw.githubusercontent.com/nukedbit/blazor-wasm-servicestack/master/blazor-wasm-servicestack.png" alt=""></p><h2 id="blazor-service-client" tabindex="-1">Blazor Service Client <a class="header-anchor" href="#blazor-service-client" aria-hidden="true">#</a></h2><p>As we track Blazor&#39;s progress we&#39;ve created an official API for creating C#/.NET Service Client instances with:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> BlazorClient<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Which returns a <code>JsonHttpClient</code> stripped of features that are known not to work in Blazor, we&#39;ll keep it updated as Blazor gains support for additional features.</p><p>This API also lets you modify the MessageHandler all Blazor client instances are configured with:</p><div class="language-csharp"><pre><code>BlazorClient<span class="token punctuation">.</span>MessageHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpClientHandler</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="vue-net-core-windows-desktop-app-template" tabindex="-1">Vue .NET Core Windows Desktop App Template <a class="header-anchor" href="#vue-net-core-windows-desktop-app-template" aria-hidden="true">#</a></h2><p>During this Release we also released the <a href="https://github.com/NetCoreTemplates/vue-desktop" target="_blank" rel="noopener noreferrer">vue-desktop</a> Project Template which lets you create .NET Core Vue Single Page Apps that can also be packaged &amp; deployed as <a href="https://sharpscript.net/sharp-apps/gist-desktop-apps" target="_blank" rel="noopener noreferrer">Gist Desktop Apps</a> which is ideal for quickly &amp; effortlessly creating &amp; deploying small to medium .NET Core Windows Desktop Apps packaged within a Chromium Web Vue UI within minutes!</p><p>Create new project with <a href="https://docs.servicestack.net/netcore-windows-desktop" target="_blank" rel="noopener noreferrer">app dotnet tool</a>:</p><pre><code>$ dotnet tool install -g app
$ app new vue-desktop ProjectName
</code></pre><blockquote><p>YouTube: <a href="https://youtu.be/kRnQSWdqH6U" target="_blank" rel="noopener noreferrer">youtu.be/kRnQSWdqH6U</a></p></blockquote><p><a href="https://youtu.be/kRnQSWdqH6U" target="_blank" rel="noopener noreferrer"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/app/vue-desktop/vuedesktop-screenshot.png" alt=""></a></p><h3 id="why-chromium-desktop-apps" tabindex="-1">Why Chromium Desktop Apps? <a class="header-anchor" href="#why-chromium-desktop-apps" aria-hidden="true">#</a></h3><p>With the investment into advancing Web Browsers &amp; Web technologies, many new modern Desktop Apps developed today like: Spotify, VS Code, GitHub Desktop, Skype, Slack, Discord, Whats App, Microsoft Teams, etc. are being built using Web Technologies and rendered with a Chromium webview, using either the popular <a href="https://www.electronjs.org/" target="_blank" rel="noopener noreferrer">Electron Framework</a> or the <a href="http://opensource.spotify.com/cefbuilds/index.html" target="_blank" rel="noopener noreferrer">Chromium Embedded Framework (CEF)</a> directly.</p><p>Following <a href="https://code.visualstudio.com/updates/" target="_blank" rel="noopener noreferrer">VS Code frequent releases</a> makes it clear why they&#39;ve decided on developing it with Web Technologies using Electron where they&#39;ve been able to iterate faster and ship new features at an unprecedented pace. In addition to its superior productivity, they&#39;re able to effortlessly support multiple Operating Systems as well as enable reuse for running on the Web as done with its <a href="https://microsoft.github.io/monaco-editor/" target="_blank" rel="noopener noreferrer">Monaco Editor</a> powering VS Code as well as innovative online solutions like <a href="https://github.com/features/codespaces" target="_blank" rel="noopener noreferrer">GitHub Code Spaces</a>.</p><p>These attributes in addition to the amount of investment that major technology companies like Google, Apple, Microsoft &amp; Firefox invest each year in improving Web &amp; browser technologies will ensure the platform will be continually supported &amp; improved unlike most Desktop UI Technologies.</p><h3 id="blazor-wasm-starting-project-template" tabindex="-1">Blazor WASM Starting Project Template <a class="header-anchor" href="#blazor-wasm-starting-project-template" aria-hidden="true">#</a></h3><p>But as it&#39;s the latest technology developed &amp; promoted by .NET PR it&#39;s going to be the Web UI technology compared to most, so this project template is based on the UI of an empty Blazor WASM project, rewritten to use Vue SPA UI &amp; a back-end .NET Core App. It&#39;s an enhanced version that also includes examples of commonly useful features:</p><ol><li><a href="https://github.com/NetCoreTemplates/vue-desktop/blob/master/src/components/Home.ts" target="_blank" rel="noopener noreferrer">Home page</a> includes example of using <a href="https://docs.servicestack.net/typescript-add-servicestack-reference" target="_blank" rel="noopener noreferrer">TypeScript Service Reference</a> to consume typed APIs</li><li><a href="https://github.com/NetCoreTemplates/vue-desktop/blob/master/src/components/FetchData.ts" target="_blank" rel="noopener noreferrer">Fetch data page</a> sources it&#39;s data from an embedded SQLite database querying an <a href="https://docs.servicestack.net/autoquery-rdbms" target="_blank" rel="noopener noreferrer">AutoQuery Service</a></li><li>Utilizes <a href="https://docs.servicestack.net/svg" target="_blank" rel="noopener noreferrer">built-in SVG support</a> for using Material Design &amp; Custom SVG Icons</li><li>Utilizes <a href="https://sharpscript.net/sharp-apps/win32" target="_blank" rel="noopener noreferrer">Win 32 Integration</a> showcasing how to call Win32 APIs from the UI</li></ol><h4 id="distributed-app-size" tabindex="-1">Distributed App Size <a class="header-anchor" href="#distributed-app-size" aria-hidden="true">#</a></h4><p>The first comparison is a direct result of the approaches used in each technology, where in addition to all your App&#39;s assets Blazor WASM has to also bundle a dotnet WASM runtime &amp; linked/tree-shaken .dll&#39;s. Whilst <code>app</code> Desktop Apps is on opposite side of the spectrum where it only requires distribution of <strong>App-specific functionality</strong> as all popular Vue JS libraries, Bootstrap CSS, Material Design SVG icons or ServiceStack .dll&#39;s used are pre-bundled with the global <code>app</code> dotnet tool.</p><p>For the comparison we ran the <code>publish-app</code> script &amp; Blazor&#39;s <strong>Publish to Folder</strong> tool &amp; compared the <strong>.zip</strong> of each folder which resulted in:</p><h4 id="_15kb-vue-desktop-app-vs-6207kb-blazor-wasm-413x-smaller" tabindex="-1"><code>15kb</code> Vue Desktop App vs <code>6207kb</code> Blazor WASM (413x smaller) <a class="header-anchor" href="#_15kb-vue-desktop-app-vs-6207kb-blazor-wasm-413x-smaller" aria-hidden="true">#</a></h4><p>The end result that even our <strong>enhanced</strong> Blazor WASM starting project template is <strong>413.8x</strong> or <strong>2.6x</strong> orders of magnitude smaller than Blazor WASM. A more apt comparison of its tiny footprint, is the enhanced Vue Desktop App is roughly equivalent to <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/?view=aspnetcore-3.1" target="_blank" rel="noopener noreferrer">Blazor WASM&#39;s 12kb partial screenshot of its App</a>:</p><p><img src="https://docs.microsoft.com/en-us/aspnet/core/blazor/index/_static/dialog.png?view=aspnetcore-3.1" alt=""></p><p>In addition, the <code>app</code> tool also bundles a Chromium Desktop App shell in order for your Vue Desktop Apps to appear like Native Desktop Apps, to get the same experience with Blazor WASM App you would also need to manage the installation of a Chromium wrapper like <a href="https://github.com/chromelyapps/Chromely" target="_blank" rel="noopener noreferrer">Chromely</a>.</p><p>When App sizes are this small you have a lot more flexibility in how to distribute &amp; manage the App, which is how Vue Desktop Apps can be published to Gists and always download &amp; open the latest released version - enabling <strong>transparent updates by default</strong>.</p><h4 id="live-reload" tabindex="-1">Live Reload <a class="header-anchor" href="#live-reload" aria-hidden="true">#</a></h4><p>A notable omission from a modern UI FX is there doesn&#39;t to be any kind of Live Reload capability for any page, including static <strong>.html</strong> or <strong>.css</strong> resources.</p><p>Vue Desktop Apps naive live reload feature works as you&#39;d expect where the UI automatically refreshes on each file change, e.g:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/app/vue-desktop/vuedesktop-livereload.gif" alt=""></p><p>This is a good example of why we prefer to avoid complex tooling as what&#39;s normally a <a href="https://docs.servicestack.net/hot-reloading" target="_blank" rel="noopener noreferrer">trivially implementable feature</a> requires much more effort &amp; time to implement when you&#39;re reliant on a complex architecture &amp; heavy tooling.</p><p>The only build tool required to enable Live Reload in Vue Desktop Apps is TypeScript&#39;s watch feature which monitors and automatically transpiles all <code>*.ts</code> file changes:</p><pre><code>$ tsc -w
</code></pre><h4 id="reload-time" tabindex="-1">Reload Time <a class="header-anchor" href="#reload-time" aria-hidden="true">#</a></h4><p>The lack of a live reload feature is exacerbated when having to manually reload your App to view every change which has noticeable delay in Blazor WASM which is otherwise instant in a normal .NET Core Web App:</p><h4 id="blazor-wasm" tabindex="-1">Blazor WASM <a class="header-anchor" href="#blazor-wasm" aria-hidden="true">#</a></h4><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/app/vue-desktop/blazorwasm-refresh.gif" alt=""></p><h4 id="vue-desktop" tabindex="-1">Vue Desktop <a class="header-anchor" href="#vue-desktop" aria-hidden="true">#</a></h4><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/app/vue-desktop/vuedesktop-refresh.gif" alt=""></p><h3 id="opinionated-app-launcher" tabindex="-1">Opinionated App Launcher <a class="header-anchor" href="#opinionated-app-launcher" aria-hidden="true">#</a></h3><p>The <code>app</code> dotnet tool is essentially just a .NET Core Desktop App launcher hosted within a Chromium Desktop Shell, whether it&#39;s launching our <a href="https://sharpscript.net/sharp-apps/" target="_blank" rel="noopener noreferrer">app Desktop Apps</a> or existing <a href="https://docs.servicestack.net/netcore-windows-desktop#launch-net-core-app-inside-a-windows-chromium-desktop-app" target="_blank" rel="noopener noreferrer">.NET Core Web App .dll or .exe&#39;s</a>.</p><p>It&#39;s opinionated in the shared libraries it includes, namely:</p><ul><li>Vue, React &amp; jQuery</li><li>Bootstrap CSS</li><li>Material Design &amp; Fontawesome SVG icons</li><li><a href="https://www.nuget.org/profiles/servicestack" target="_blank" rel="noopener noreferrer">ServiceStack .NET Packages</a> &amp; Dependencies</li></ul><blockquote><p>You can use your own client/server libraries but they&#39;d need to be distributed with the App</p></blockquote><p>Intended for developing small/medium Desktop Apps that can be published to a GitHub Gist (or repo) &amp; opened over a URL, e,g: <a href="https://sharpscript.net/sharp-apps/redis" target="_blank" rel="noopener noreferrer">Redis Admin UI</a>, generic <a href="https://sharpscript.net/sharp-apps/sharpdata" target="_blank" rel="noopener noreferrer">DB Viewer</a> or our <a href="https://docs.servicestack.net/studio" target="_blank" rel="noopener noreferrer">ServiceStack Studio</a> API Management tool which all package down to small footprints.</p><p>Given you can <a href="https://youtu.be/kRnQSWdqH6U" target="_blank" rel="noopener noreferrer">build &amp; distribute an App within minutes</a>, it&#39;s suitable for quick UI&#39;s around a single purpose Task you may want to distribute internally, e.g. a dynamic reporting viewer, edit forms, surveys, email composer, or see the <a href="https://sharpscript.net/sharp-apps/app-index" target="_blank" rel="noopener noreferrer">Desktop App Index</a> for other examples.</p><h3 id="native-win32-api-interop" tabindex="-1">Native Win32 API Interop <a class="header-anchor" href="#native-win32-api-interop" aria-hidden="true">#</a></h3><p>As <a href="https://sharpscript.net/" target="_blank" rel="noopener noreferrer">#Script</a> is a scripting language utilizing JS syntax to invoke .NET APIs, the <a href="https://sharpscript.net/sharp-apps/win32" target="_blank" rel="noopener noreferrer">Win 32 support</a> ends up being both simple &amp; intuitive.</p><p>Where it calls the <a href="https://github.com/NetCoreTemplates/vue-desktop/blob/master/CustomMethods.cs" target="_blank" rel="noopener noreferrer">CustomMethods.cs</a> .NET Win 32 APIs (wrapped in a <a href="https://sharpscript.net/docs/methods" target="_blank" rel="noopener noreferrer">#Script method</a>) directly from JS as done in <a href="https://github.com/NetCoreTemplates/vue-desktop/blob/master/src/App.ts" target="_blank" rel="noopener noreferrer">App.ts</a> which can be invoked using JS syntax using the <code>evaluateCode</code> TypeScript API, e.g:</p><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> evaluateCode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@servicestack/desktop&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> <span class="token function">evaluateCode</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">chooseColor()</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> <span class="token function">evaluateCode</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">chooseColor(&#39;#336699&#39;)</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>app</code> dotnet tool already includes these <a href="https://github.com/dotnet/pinvoke" target="_blank" rel="noopener noreferrer">dotnet/pinvoke</a> .NET Wrapper API NuGet packages below so they can be used within your App without needing to distribute them with your App:</p><div class="language-xml"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.AdvApi32<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.BCrypt<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.Crypt32<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.DwmApi<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.Gdi32<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.Hid<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.Kernel32<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.Magnification<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.MSCorEE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.Msi<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.Fusion<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.NCrypt<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.NetApi32<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.NTDll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.Psapi<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.SetupApi<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.Shell32<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.SHCore<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.User32<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.Userenv<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.UxTheme<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>PInvoke.WtsApi32<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.6.49<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>See <a href="https://sharpscript.net/sharp-apps/win32" target="_blank" rel="noopener noreferrer">Win32 App</a> for more info &amp; examples on Win32 integration.</p><p>For more info checkout the <a href="http://github.com/NetCoreTemplates/vue-desktop" target="_blank" rel="noopener noreferrer">github.com/NetCoreTemplates/vue-desktop</a> project template docs.</p><h3 id="fluent-validation" tabindex="-1">Fluent Validation <a class="header-anchor" href="#fluent-validation" aria-hidden="true">#</a></h3><p>ServiceStack&#39;s interned version of <a href="https://fluentvalidation.net/" target="_blank" rel="noopener noreferrer">fluentvalidation.net</a> was upgraded to their latest v9.3 preview release. Please refer to their <a href="https://docs.fluentvalidation.net/en/latest/upgrading-to-9.html" target="_blank" rel="noopener noreferrer">9.0 Upgrade Guide</a> for changes.</p><h3 id="ormlite" tabindex="-1">OrmLite <a class="header-anchor" href="#ormlite" aria-hidden="true">#</a></h3><p>SqlExpression&#39;s new <code>ComputeHash()</code> can be used to generate a unique SHA1 hash should you want to maintain your own local results cache for popular queries, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> q <span class="token operator">=</span> Db<span class="token punctuation">.</span>From<span class="token operator">&lt;</span>Table<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> cacheKey <span class="token operator">=</span> q<span class="token punctuation">.</span><span class="token function">ComputeHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> results <span class="token operator">=</span> LocalCache<span class="token punctuation">.</span><span class="token function">GetOrCreate</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">,</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Whilst the new <code>SqlExpression.Dump()</code> API lets you capture an SQL Expression&#39;s state and parameter values which you can quickly view an SQL Expressions content, e.g:</p><div class="language-csharp"><pre><code>q<span class="token punctuation">.</span><span class="token function">Dump</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">includeParams</span><span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>New Async APIs available for RDBMS inspection:</p><ul><li><code>DoesTableExistAsync()</code></li><li><code>DoesColumnExistAsync()</code></li><li><code>DoesSchemaExistAsync()</code></li><li><code>DoesSequenceExistAsync()</code></li></ul><h3 id="servicestack-text" tabindex="-1">ServiceStack.Text <a class="header-anchor" href="#servicestack-text" aria-hidden="true">#</a></h3><p>New APIs for downloading asynchronously from a Stream:</p><ul><li><code>Stream.ReadFullyAsync()</code></li><li><code>Stream.ReadFullyAsMemoryAsync()</code></li></ul><p>Uploading Files from configured <code>WebRequest</code> or URL:</p><ul><li><code>WebRequest.UploadFile()</code></li><li><code>WebRequest.UploadFileAsync()</code></li><li><code>string.PostFileToUrl()</code></li><li><code>string.PostFileToUrlAsync()</code></li><li><code>string.PutFileToUrl()</code></li><li><code>string.PutFileToUrlAsync()</code></li></ul><p>Fast ToHex encoding API:</p><ul><li><code>byte[].ToHex()</code></li></ul><h3 id="httperror" tabindex="-1">HttpError <a class="header-anchor" href="#httperror" aria-hidden="true">#</a></h3><p>New static Type helpers for returning other remaining HTTP Errors:</p><div class="language-csharp"><pre><code><span class="token keyword">throw</span> HttpError<span class="token punctuation">.</span><span class="token function">PreconditionFailed</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">throw</span> HttpError<span class="token punctuation">.</span><span class="token function">ExpectationFailed</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">throw</span> HttpError<span class="token punctuation">.</span><span class="token function">NotImplemented</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">throw</span> HttpError<span class="token punctuation">.</span><span class="token function">ServiceUnavailable</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="feedback-welcome" tabindex="-1">Feedback Welcome! <a class="header-anchor" href="#feedback-welcome" aria-hidden="true">#</a></h2><p>We hope you enjoy the new capabilities in this release, as always if you have any questions or feedback in this release please let us know in the <a href="https://forums.servicestack.net/" target="_blank" rel="noopener noreferrer">Customer Forums</a>.</p>__VP_STATIC_END__`,527),o=[p];function c(i,l,u,r,k,d){return a(),s("div",null,o)}var m=n(e,[["render",c]]);export{g as __pageData,m as default};
