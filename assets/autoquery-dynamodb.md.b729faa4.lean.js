import{_ as s,c as e,o as t,a,b as n,e as o}from"./app.14440598.js";const w='{"title":"AutoQuery DynamoDB Data Source","description":"","frontmatter":{"slug":"autoquery-dynamodb","title":"AutoQuery DynamoDB Data Source"},"headers":[{"level":3,"title":"Optimal DynamoDB Queries","slug":"optimal-dynamodb-queries"},{"level":3,"title":"Download","slug":"download"},{"level":3,"title":"Simple AutoQuery Data Example","slug":"simple-autoquery-data-example"},{"level":3,"title":"Typed AutoQuery DynamoDB Queries","slug":"typed-autoquery-dynamodb-queries"},{"level":3,"title":"AutoQuery DynamoDB Global Index Queries","slug":"autoquery-dynamodb-global-index-queries"},{"level":3,"title":"Custom POCO Result Mappings","slug":"custom-poco-result-mappings"},{"level":3,"title":"Caching AutoQuery Services","slug":"caching-autoquery-services"},{"level":3,"title":"More Info","slug":"more-info"}],"relativePath":"autoquery-dynamodb.md","lastUpdated":1634495307610}',p={},c=a('',10),r=n("div",{class:"package-reference-box"},[n("div",{class:"flex"},[n("div",{class:"flex-grow pre-container",style:{background:"#002440"}},[n("pre",{class:"sh copy m-0 p-0 pl-2 py-1 align-middle",style:{background:"#002440"}},[n("p",null,[n("code",null,'<PackageReference Include="ServiceStack.Aws" Version="5.*" />')]),o(`
`)])]),n("div",{class:"flex-shrink"},[n("i",{class:"svg-copy inline-block w-8 h-full",title:"copy",onclick:"copy(this)"}),n("b")])]),n("div",{class:"copy-text w-full text-right h-6"})],-1),l=a(`__VP_STATIC_START__<h3 id="simple-autoquery-data-example" tabindex="-1">Simple AutoQuery Data Example <a class="header-anchor" href="#simple-autoquery-data-example" aria-hidden="true">#</a></h3><p>To illustrate how to use AutoQuery with DynamoDB we&#39;ll walk through a simple example of querying Rockstars Albums. For this example we&#39;ll specify <a href="/autoquery.html#explicit-conventions">explicit conventions</a> so we can use ServiceStack&#39;s <a href="/csharp-client.html">typed .NET Service Clients</a> to show which fields we&#39;re going to query and also lets us call the Service with a convenient typed API:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/rockstar-albums&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryRockstarAlbums</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">QueryData<span class="token punctuation">&lt;</span>RockstarAlbum<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>         <span class="token comment">// Primary Key | Range Key</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> RockstarId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// Foreign key | Hash Key</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Genre <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> IdBetween <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Here we see that creating DynamoDB Queries is no different to any other AutoQuery Data Service, where the same definition is used irrespective if the data source was populated from a <code>MemorySource</code>, <code>ServiceSource</code> or <code>DynamoDbSource</code> and the only thing that would need to change to have it query an RDBMS instead is the <code>QueryDb&lt;T&gt;</code> base class.</p><p>The text in comments highlight that when the <code>RockstarAlbum</code> POCO is stored in an RDBMS <a href="https://github.com/ServiceStack/ServiceStack.OrmLite" target="_blank" rel="noopener noreferrer">OrmLite</a> creates the table with the <code>Id</code> as the Primary Key and <code>RockstarId</code> as a Foreign Key to the <code>Rockstar</code> table. This is different in DynamoDB where <a href="https://github.com/ServiceStack/PocoDynamo" target="_blank" rel="noopener noreferrer">PocoDynamo</a> behavior is to keep related records together so they can be efficiently queried and will instead Create the <code>RockstarAlbum</code> DynamoDB Table with the <code>RockstarId</code> as the Hash Key and its unique <code>Id</code> as the Range Key.</p><h4 id="register-dynamodbsource" tabindex="-1">Register DynamoDbSource <a class="header-anchor" href="#register-dynamodbsource" aria-hidden="true">#</a></h4><p>To use DynamoDB AutoQuery&#39;s you need to first configure <a href="https://github.com/ServiceStack/PocoDynamo#download" target="_blank" rel="noopener noreferrer">PocoDynamo</a> which is just a matter of passing an an initialized <code>AmazonDynamoDBClient</code> and telling PocoDynamo which DynamoDB tables you intend to use:</p><div class="language-csharp"><pre><code>container<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PocoDynamo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AmazonDynamoDBClient</span><span class="token punctuation">(</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterTable</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rockstar<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterTable</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>RockstarAlbum<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Then before using PocoDynamo, call <code>InitSchema()</code> to tell it to automatically go through and create all DynamoDB Tables that were registered but don&#39;t yet exist in DynamoDB:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> dynamo <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IPocoDynamo<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dynamo<span class="token punctuation">.</span><span class="token function">InitSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>So the first time <code>InitSchema()</code> is run it will create both <code>Rockstar</code> and <code>RockstarAlbum</code> tables but will no longer create any tables on any subsequent runs. After <code>InitSchema()</code> has completed we&#39;re assured that both <code>Rockstar</code> and <code>RockstarAlbum</code> tables exist so we can start using PocoDynamo&#39;s typed APIs to populate them with Data:</p><div class="language-csharp"><pre><code>dynamo<span class="token punctuation">.</span><span class="token function">PutItems</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Rockstar<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dynamo<span class="token punctuation">.</span><span class="token function">PutItems</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">RockstarAlbum<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>Behind the scenes PocoDynamo efficiently creates the minimum number of <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_BatchWriteItem.html" target="_blank" rel="noopener noreferrer">BatchWriteItem</a> requests as necessary to store all Rockstar and RockstarAlbum&#39;s.</p></blockquote><p>Now that we have data we can query we can register the AutoQuery Data plugin along with the <code>Rockstar</code> and <code>RockstarAlbum</code> DynamoDB Tables we want to be able to query:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoQueryDataFeature</span> <span class="token punctuation">{</span> MaxLimit <span class="token operator">=</span> <span class="token number">100</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token function">AddDataSource</span><span class="token punctuation">(</span>ctx <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">DynamoDbSource</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rockstar<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddDataSource</span><span class="token punctuation">(</span>ctx <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">DynamoDbSource</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>RockstarAlbum<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="rockstaralbum-poco-table-definition" tabindex="-1">RockstarAlbum POCO Table Definition <a class="header-anchor" href="#rockstaralbum-poco-table-definition" aria-hidden="true">#</a></h4><p>Where <code>RockstarAlbum</code> is just a simple POCO and can be used as-is throughout all of ServiceStack&#39;s libraries inc. OrmLite, Redis, Caching Providers, Serializers, etc:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RockstarAlbum</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoIncrement</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">References</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Rockstar</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> RockstarId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Index</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Genre <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>PocoDynamo uses the same generic metadata attributes in <strong>ServiceStack.Interfaces</strong> as OrmLite.</p><p>When this POCO is created in OrmLite it creates:</p><ul><li>A <code>RockstarAlbum</code> table with an <code>Id</code> auto incrementing <strong>Primary Key</strong></li><li>The <code>RockstarId</code> as the <strong>Foreign Key</strong> for the <code>Rockstar</code> table</li><li>Adds an <strong>Index</strong> on the <code>Genre</code> column.</li></ul><p>Whereas in DynamoDB, PocoDynamo creates:</p><ul><li>The <code>RockstarAlbum</code> table with the <code>Id</code> as an auto incrementing <strong>Range Key</strong></li><li>The <code>RockstarId</code> as the <strong>Hash Key</strong></li><li>Creates a <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/LSI.html" target="_blank" rel="noopener noreferrer">Local Secondary Index</a> for the Genre attribute.</li></ul><h3 id="typed-autoquery-dynamodb-queries" tabindex="-1">Typed AutoQuery DynamoDB Queries <a class="header-anchor" href="#typed-autoquery-dynamodb-queries" aria-hidden="true">#</a></h3><p>Since the properties we want to query are explicitly typed we can make use of ServiceStack&#39;s nice typed Service Client API&#39;s to call this Service and fetch Kurt Cobains <strong>Grunge</strong> Albums out of the first 5 recorded:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">QueryRockstarAlbums</span> <span class="token punctuation">{</span> <span class="token comment">//QUERY </span>
    RockstarId <span class="token operator">=</span> kurtCobainId<span class="token punctuation">,</span> <span class="token comment">//Key Condition</span>
    IdBetween <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//Key Condition</span>
    Genre <span class="token operator">=</span> <span class="token string">&quot;Grunge&quot;</span><span class="token punctuation">,</span>          <span class="token comment">//Filter Condition</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

response<span class="token punctuation">.</span><span class="token function">PrintDump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Pretty print results to Console</span>
</code></pre></div><p>As illustrated in the comments, DynamoDB AutoQuery performs the most efficient DynamoDB Query required in order to satisfy this request where it will create a <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/QueryAndScan.html#QueryAndScan.Query" target="_blank" rel="noopener noreferrer">Query Request</a> with the <code>RockstarId</code> and <code>IdBetween</code> conditions added to the <strong>Key Condition</strong> and the remaining <code>Genre</code> added as a <strong>Filter Expression</strong>.</p><p>If we instead wanted to fetch all of Kurt Cobains <strong>Grunge</strong> Albums where there was no longer a condition on the Album <code>Id</code> <strong>Range Key</strong>, i.e:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">QueryRockstarAlbums</span> <span class="token punctuation">{</span> <span class="token comment">//QUERY</span>
    RockstarId <span class="token operator">=</span> kurtCobainId<span class="token punctuation">,</span> <span class="token comment">//Key Condition</span>
    Genre <span class="token operator">=</span> <span class="token string">&quot;Grunge&quot;</span><span class="token punctuation">,</span>          <span class="token comment">//Key Condition</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>It would instead create a <strong>Query Request</strong> configured to use the Genre <strong>Local Secondary Index</strong> and have added both <code>RockstarId</code> Hash Key and index <code>Genre</code> to the <strong>Key Condition</strong>.</p><p>But if you instead wanted to view all Grunge Albums, i.e:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">QueryRockstarAlbums</span> <span class="token punctuation">{</span> <span class="token comment">//SCAN</span>
    Genre <span class="token operator">=</span> <span class="token string">&quot;Grunge&quot;</span>            <span class="token comment">//Filter Condition</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>As no Hash Key was specified it would instead create a <strong>SCAN Request</strong> where as there&#39;s no index, it adds all conditions to the <strong>Filter Expression</strong>.</p><h3 id="autoquery-dynamodb-global-index-queries" tabindex="-1">AutoQuery DynamoDB Global Index Queries <a class="header-anchor" href="#autoquery-dynamodb-global-index-queries" aria-hidden="true">#</a></h3><p>For times when you need to perform an efficient <strong>Query Request</strong> across multiple hash keys you will need to create a <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/GSI.html" target="_blank" rel="noopener noreferrer">Global Secondary Index</a>. Luckily this is easy to do in PocoDynamo where you can define Global Indexes with a simple POCO class definition:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RockstarAlbumGenreIndex</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IGlobalIndex<span class="token punctuation">&lt;</span>RockstarAlbum<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HashKey</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Genre <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RangeKey</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token comment">// projected property</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> RockstarId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// projected property</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Global Indexes can be thought of as &quot;automatically synced tables&quot; specified with a different Hash Key. Just like DynamoDB tables you can specify the <strong>Hash Key</strong> you want to globally query and create the Index on as well as a separate <strong>Range Key</strong> you want to be able to perform efficient <strong>Key Condition</strong> queries on. You&#39;ll also want to specify any properties you want returned when querying the Global Index so they&#39;ll be automatically projected and stored with the Global Index, ensuring fast access.</p><p>Then to have PocoDynamo create the Global Index it should be referenced on the table the Global Index is on:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">References</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">RockstarAlbumGenreIndex</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RockstarAlbum</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><p>When referenced, <code>InitSchema()</code> will create the <code>RockstarAlbumGenreIndex</code> Global Secondary Index when it creates the <code>RockstarAlbum</code> DynamoDB Table.</p><p>With the Global Index created we can now query it just like we would any other DynamoDB AutoQuery but instead of querying a table, we query the Index instead:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryRockstarAlbumsGenreIndex</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">QueryData<span class="token punctuation">&lt;</span>RockstarAlbumGenreIndex<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Genre <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>     <span class="token comment">// Hash Key</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> IdBetween <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// Range Key</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Once defined you can query it just like any other AutoQuery Service where you&#39;re now able to perform efficient queries by <strong>Genre</strong> across all Rockstar Album&#39;s:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> QueryRockstarAlbumsGenreIndex <span class="token comment">//QUERY</span>
<span class="token punctuation">{</span>
    Genre <span class="token operator">=</span> <span class="token string">&quot;Grunge&quot;</span><span class="token punctuation">,</span>              <span class="token comment">//Key Condition</span>
    IdBetween <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//Key Condition</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="custom-poco-result-mappings" tabindex="-1">Custom POCO Result Mappings <a class="header-anchor" href="#custom-poco-result-mappings" aria-hidden="true">#</a></h3><p>A noticeable difference from querying a Global Index instead of the Table directly is that results are returned in a different <code>RockstarAlbumGenreIndex</code> POCO. Luckily we can use AutoQuery&#39;s <a href="/autoquery.html#returning-custom-results">Custom Results Feature</a> to map the properties back into the original table <code>RockstarAlbum</code> with:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryRockstarAlbumsGenreIndex</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">QueryData<span class="token punctuation">&lt;</span>RockstarAlbumGenreIndex<span class="token punctuation">,</span>RockstarAlbum<span class="token punctuation">&gt;</span></span></span> 
<span class="token punctuation">{</span> 
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Genre <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> IdBetween <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now when we query the Index we get our results populated in <code>RockstarAlbum</code> DTO&#39;s instead:</p><div class="language-csharp"><pre><code><span class="token class-name">QueryResponse<span class="token punctuation">&lt;</span>RockstarAlbum<span class="token punctuation">&gt;</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">QueryRockstarAlbumsGenreIndex</span>
<span class="token punctuation">{</span>
    Genre <span class="token operator">=</span> <span class="token string">&quot;Grunge&quot;</span><span class="token punctuation">,</span>              <span class="token comment">//Key Condition</span>
    IdBetween <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//Key Condition</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="caching-autoquery-services" tabindex="-1">Caching AutoQuery Services <a class="header-anchor" href="#caching-autoquery-services" aria-hidden="true">#</a></h3><p>One of the many benefits of AutoQuery Services being just regular ServiceStack Services is that we get access to ServiceStack&#39;s rich ecosystem of enhanced functionality around existing Services. An example added in this release is ServiceStack&#39;s new HTTP Caching feature which lets you easily cache a Service with the new <code>[CacheResponse]</code> attribute, letting you declaratively specify how long you want to cache identical requests for on the <strong>Server</strong> as well as a <code>MaxAge</code> option for instructing the <strong>Client</strong> how long they should consider their local cache is valid for and any custom <code>Cache-Control</code> behavior you want them to have, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/rockstar-albums&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CacheResponse</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Duration <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">,</span> MaxAge <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> CacheControl <span class="token operator">=</span> CacheControl<span class="token punctuation">.</span>MustRevalidate<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryRockstarAlbums</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">QueryData<span class="token punctuation">&lt;</span>RockstarAlbum<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>         
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> RockstarId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Genre <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> IdBetween <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>So with just the above single Request DTO we&#39;ve declaratively created a fully-queryable DynamoDB AutoQuery Service that transparently executes the most ideal DynamoDB queries for each request, has it&#39;s optimal representation efficiently cached on both Server and clients, whose Typed DTO can be reused as-is on the client to call Services with an end-to-end Typed API using any <a href="/csharp-client.html">.NET Service Client</a>, that&#39;s also available to external developers in a clean typed API, natively in their preferred language of choice, accessible with just a right-click menu integrated inside <a href="http://VS.NET" target="_blank" rel="noopener noreferrer">VS.NET</a>, Xcode, Android Studio, IntelliJ and Eclipse - serving both PCL Xamarin.iOS/Android as well as native iOS and Android developers by just<br><a href="/add-servicestack-reference.html">Adding a ServiceStack Reference</a> to the base URL of a remote ServiceStack Instance - all without needing to write any implementation!</p><h3 id="more-info" tabindex="-1">More Info <a class="header-anchor" href="#more-info" aria-hidden="true">#</a></h3><p>For more examples exploring different AutoQuery Data features checkout the <a href="https://github.com/ServiceStack/ServiceStack/blob/master/tests/ServiceStack.WebHost.Endpoints.Tests/AutoQueryDataTests.cs" target="_blank" rel="noopener noreferrer">AutoQuery Data Tests</a> and <a href="https://github.com/ServiceStack/ServiceStack/blob/master/tests/ServiceStack.WebHost.Endpoints.Tests/AutoQueryDataTests.Dynamo.cs" target="_blank" rel="noopener noreferrer">AutoQuery DynamoDB Tests</a> that can be compared on a feature-by-feature basis against the existing <a href="https://github.com/ServiceStack/ServiceStack/blob/master/tests/ServiceStack.WebHost.Endpoints.Tests/AutoQueryTests.cs" target="_blank" rel="noopener noreferrer">AutoQuery Tests</a> they were originally based on.</p>__VP_STATIC_END__`,55),u=[c,r,l];function i(k,d,y,m,h,g){return t(),e("div",null,u)}var f=s(p,[["render",i]]);export{w as __pageData,f as default};
