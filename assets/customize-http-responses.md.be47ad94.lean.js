import{_ as n,c as s,o as a,a as t}from"./app.14440598.js";const y='{"title":"Customize HTTP Responses","description":"","frontmatter":{"slug":"customize-http-responses","title":"Customize HTTP Responses"},"headers":[{"level":3,"title":"Short-circuiting the Request Pipeline","slug":"short-circuiting-the-request-pipeline"},{"level":3,"title":"Using a Global Request or Response Filter","slug":"using-a-global-request-or-response-filter"},{"level":3,"title":"Using a Request or Response Filter Attribute","slug":"using-a-request-or-response-filter-attribute"},{"level":2,"title":"Custom Serialized Responses","slug":"custom-serialized-responses"},{"level":2,"title":"Request and Response Converters","slug":"request-and-response-converters"},{"level":3,"title":"Request Converters","slug":"request-converters"},{"level":3,"title":"Response Converters","slug":"response-converters"},{"level":3,"title":"Intercept Service Requests","slug":"intercept-service-requests"},{"level":3,"title":"Using a Custom ServiceRunner","slug":"using-a-custom-servicerunner"}],"relativePath":"customize-http-responses.md","lastUpdated":1634495307614}',e={},p=t(`__VP_STATIC_START__<p>ServiceStack provides multiple ways to customize your services HTTP response. Each option gives you complete control of the final HTTP Response that&#39;s returned by your service:</p><ol><li>Decorating it inside a <code>HttpResult</code> object</li><li>Throwing a <code>HttpError</code></li><li>Returning a <code>HttpError</code></li><li>Using a Request or Response <a href="/filter-attributes.html">Filter Attribute</a> like the built-in <code>[AddHeader]</code> (or your own) or using a <a href="/request-and-response-filters.html">Global Request or Response Filter</a>.</li><li>Modifying output by accessing your services <code>base.Response</code> <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Web/IHttpResponse.cs" target="_blank" rel="noopener noreferrer">IHttpResponse API</a></li><li>Returning responses in a decorated <code>HttpResult</code></li></ol><p>Here are some code examples below using these different approaches:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span> 
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token class-name">Hello</span> request<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span> 
        <span class="token comment">//1. Returning a custom Status and Description with Response DTO body:</span>
        <span class="token class-name"><span class="token keyword">var</span></span> responseDto <span class="token operator">=</span> <span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpResult</span><span class="token punctuation">(</span>responseDto<span class="token punctuation">,</span> HttpStatusCode<span class="token punctuation">.</span>Conflict<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            StatusDescription <span class="token operator">=</span> <span class="token string">&quot;Computer says no&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">//2. Throw a HttpError:</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpError</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>Conflict<span class="token punctuation">,</span> <span class="token string">&quot;Some Error Message&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//3. Return a HttpError:</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpError</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>Conflict<span class="token punctuation">,</span> <span class="token string">&quot;Some Error Message&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//4. Modify the Request&#39;s IHttpResponse</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span>Response<span class="token punctuation">.</span>StatusCode <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>HttpStatusCode<span class="token punctuation">.</span>Redirect<span class="token punctuation">;</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">AddHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Location&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://path/to/new/uri&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">EndRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Short-circuits Request Pipeline</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//5. Using a Request or Response Filter </span>
    <span class="token punctuation">[</span><span class="token function">AddHeader</span><span class="token punctuation">(</span>ContentType <span class="token operator">=</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AddHeader</span><span class="token attribute-arguments"><span class="token punctuation">(</span>ContentDisposition <span class="token operator">=</span> <span class="token string">&quot;attachment; filename=hello.txt&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token class-name">Hello</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token interpolation-string"><span class="token string">$&quot;Hello, </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">request<span class="token punctuation">.</span>Name</span><span class="token punctuation">}</span></span><span class="token string">!&quot;</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//6. Returning responses in a decorated HttpResult</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token class-name">Hello</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpResult</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Hello, </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">request<span class="token punctuation">.</span>Name</span><span class="token punctuation">}</span></span><span class="token string">!&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ContentType <span class="token operator">=</span> MimeTypes<span class="token punctuation">.</span>PlainText<span class="token punctuation">,</span>
            Headers <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpHeaders<span class="token punctuation">.</span>ContentDisposition</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;attachment; filename=\\&quot;hello.txt\\&quot;&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="short-circuiting-the-request-pipeline" tabindex="-1">Short-circuiting the Request Pipeline <a class="header-anchor" href="#short-circuiting-the-request-pipeline" aria-hidden="true">#</a></h3><p>At anytime you can short-circuit the Request Pipeline and end the response by calling <code>IResponse.EndRequest()</code>, e.g:</p><div class="language-csharp"><pre><code>res<span class="token punctuation">.</span><span class="token function">EndRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you only have access to the <code>IRequest</code> you can access the <code>IResponse</code> via the Response property, e.g:</p><div class="language-csharp"><pre><code>req<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">EndRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="using-a-global-request-or-response-filter" tabindex="-1">Using a <a href="/request-and-response-filters.html">Global Request or Response Filter</a> <a class="header-anchor" href="#using-a-global-request-or-response-filter" aria-hidden="true">#</a></h3><p>You can use a Global Request Filter to set Custom HTTP Headers and then short-circuit the request:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">Container</span> container<span class="token punctuation">)</span> 
<span class="token punctuation">{</span> 
    GlobalRequestFilters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> requestDto<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>Verb <span class="token operator">==</span> HttpMethods<span class="token punctuation">.</span>Head <span class="token operator">&amp;&amp;</span> requestDto <span class="token keyword">is</span> <span class="token class-name">DownloadTrack</span> track<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> dep <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">TryResolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDependency<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            res<span class="token punctuation">.</span>ContentType <span class="token operator">=</span> <span class="token string">&quot;audio/mpeg&quot;</span><span class="token punctuation">;</span>
            res<span class="token punctuation">.</span><span class="token function">AddHeader</span><span class="token punctuation">(</span><span class="token string">&quot;X-Genre&quot;</span><span class="token punctuation">,</span> dep<span class="token punctuation">.</span><span class="token function">GetGenre</span><span class="token punctuation">(</span>track<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            res<span class="token punctuation">.</span><span class="token function">SetContentLength</span><span class="token punctuation">(</span>dep<span class="token punctuation">.</span><span class="token function">CalculateLength</span><span class="token punctuation">(</span>track<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            res<span class="token punctuation">.</span><span class="token function">EndRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="using-a-request-or-response-filter-attribute" tabindex="-1">Using a <a href="/filter-attributes.html">Request or Response Filter Attribute</a> <a class="header-anchor" href="#using-a-request-or-response-filter-attribute" aria-hidden="true">#</a></h3><p>Example 4). uses the in-built <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack/AddHeaderAttribute.cs" target="_blank" rel="noopener noreferrer">AddHeaderAttribute</a> to modify the HTTP Response using a <a href="/filter-attributes.html">Request Filter attribute</a>. You can also modify all HTTP Service Responses by using a <a href="/request-and-response-filters.html">Global Request or Response Filter</a>:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddHeaderAttribute</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">RequestFilterAttribute</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Value <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token function">AddHeaderAttribute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">AddHeaderAttribute</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        Value <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Execute</span><span class="token punctuation">(</span><span class="token class-name">IRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">IResponse</span> res<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> requestDto<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>Name<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>Value<span class="token punctuation">)</span><span class="token punctuation">)</span> 
            <span class="token keyword">return</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>Name<span class="token punctuation">.</span><span class="token function">EqualsIgnoreCase</span><span class="token punctuation">(</span>HttpHeaders<span class="token punctuation">.</span>ContentType<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span>ContentType <span class="token operator">=</span> Value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">AddHeader</span><span class="token punctuation">(</span>Name<span class="token punctuation">,</span> Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="custom-serialized-responses" tabindex="-1">Custom Serialized Responses <a class="header-anchor" href="#custom-serialized-responses" aria-hidden="true">#</a></h2><p>The new <code>IHttpResult.ResultScope</code> API provides an opportunity to execute serialization within a custom scope, e.g. this can be used to customize the serialized response of adhoc services that&#39;s different from the default global configuration with:</p><div class="language-csharp"><pre><code><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpResult</span><span class="token punctuation">(</span>dto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ResultScope <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> JsConfig<span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Config</span> <span class="token punctuation">{</span> IncludeNullValues <span class="token operator">=</span>  <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Which enables custom serialization behavior by performing the serialization within the custom scope, equivalent to:</p><div class="language-csharp"><pre><code><span class="token keyword">using</span> <span class="token punctuation">(</span>JsConfig<span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Config</span> <span class="token punctuation">{</span> IncludeNullValues <span class="token operator">=</span>  <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> customSerializedResponse <span class="token operator">=</span> <span class="token function">Serialize</span><span class="token punctuation">(</span>dto<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="request-and-response-converters" tabindex="-1">Request and Response Converters <a class="header-anchor" href="#request-and-response-converters" aria-hidden="true">#</a></h2><p>The <a href="/encrypted-messaging.html">Encrypted Messaging Feature</a> takes advantage of Request and Response Converters that let you change the Request DTO and Response DTO&#39;s that get used in ServiceStack&#39;s Request Pipeline where:</p><h3 id="request-converters" tabindex="-1">Request Converters <a class="header-anchor" href="#request-converters" aria-hidden="true">#</a></h3><p>Request Converters are executed directly after any <a href="/serialization-deserialization.html#create-a-custom-request-dto-binder">Custom Request Binders</a>:</p><div class="language-csharp"><pre><code>appHost<span class="token punctuation">.</span>RequestConverters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> requestDto<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//Return alternative Request DTO or null to retain existing DTO</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="response-converters" tabindex="-1">Response Converters <a class="header-anchor" href="#response-converters" aria-hidden="true">#</a></h3><p>Response Converters are executed directly after the Service:</p><div class="language-csharp"><pre><code>appHost<span class="token punctuation">.</span>ResponseConverters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token comment">//Return alternative Response or null to retain existing Service response</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="intercept-service-requests" tabindex="-1">Intercept Service Requests <a class="header-anchor" href="#intercept-service-requests" aria-hidden="true">#</a></h3><p>As an alternative to creating a <a href="#using-a-custom-servicerunner">Custom Service Runner</a> to intercept different events when processing ServiceStack Requests, you can instead override the <code>OnBeforeExecute()</code>, <code>OnAfterExecute()</code> and <code>OnExceptionAsync()</code> callbacks in your <code>Service</code> class (or base class) to intercept and modify Request DTOs, Responses or Error Responses, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">class</span> <span class="token class-name">MyServices</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">// Log all Request DTOs that implement IHasSessionId</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnBeforeExecute</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> requestDto<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>requestDto <span class="token keyword">is</span> <span class="token class-name">IHasSessionId</span> dtoSession<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Log<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>OnBeforeExecute<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">dtoSession<span class="token punctuation">.</span>SessionId</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//Return Response DTO Name in HTTP Header with Response</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">OnAfterExecute</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> response<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpResult</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Headers <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token punctuation">[</span><span class="token string">&quot;X-Response&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//Return custom error with additional metadata</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> <span class="token function">OnExceptionAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> requestDto<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> error <span class="token operator">=</span> DtoUtils<span class="token punctuation">.</span><span class="token function">CreateErrorResponse</span><span class="token punctuation">(</span>requestDto<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token keyword">is</span> <span class="token class-name">IHttpError</span> httpError<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>                
            <span class="token class-name"><span class="token keyword">var</span></span> errorStatus <span class="token operator">=</span> httpError<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">GetResponseStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            errorStatus<span class="token punctuation">.</span>Meta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
                <span class="token punctuation">[</span><span class="token string">&quot;InnerType&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> ex<span class="token punctuation">.</span>InnerException<span class="token punctuation">?.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="async-callbacks" tabindex="-1">Async Callbacks <a class="header-anchor" href="#async-callbacks" aria-hidden="true">#</a></h4><p>For async callbacks your Services can implement <code>IServiceBeforeFilterAsync</code> and <code>IServiceAfterFilterAsync</code>, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServices</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span><span class="token punctuation">,</span> <span class="token class-name">IServiceBeforeFilterAsync</span><span class="token punctuation">,</span> <span class="token class-name">IServiceAfterFilterAsync</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">OnBeforeExecuteAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> requestDto<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//...</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> <span class="token function">OnAfterExecuteAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> response<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//...</span>
        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you&#39;re implementing <code>IService</code> instead of inheriting the concrete <code>Service</code> class, you can implement the interfaces directly:</p><div class="language-csharp"><pre><code><span class="token comment">// Handle all callbacks</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServices</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IService</span><span class="token punctuation">,</span> <span class="token class-name">IServiceFilters</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//..</span>
<span class="token punctuation">}</span>

<span class="token comment">// Or individually, just the callbacks you want</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServices</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IService</span><span class="token punctuation">,</span> <span class="token class-name">IServiceBeforeFilter</span><span class="token punctuation">,</span> <span class="token class-name">IServiceAfterFilter</span><span class="token punctuation">,</span> <span class="token class-name">IServiceErrorFilter</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//..</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="using-a-custom-servicerunner" tabindex="-1">Using a Custom ServiceRunner <a class="header-anchor" href="#using-a-custom-servicerunner" aria-hidden="true">#</a></h3><p>The ability to extend ServiceStack&#39;s service execution pipeline with Custom Hooks is an advanced customization feature that for most times is not needed as the preferred way to add composable functionality to your services is to use <a href="/filter-attributes.html">Request / Response Filter attributes</a> or apply them globally with <a href="/request-and-response-filters.html">Global Request/Response Filters</a>.</p><p>To be able to add custom hooks without needing to subclass any service, we&#39;ve introduced a <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Web/IServiceRunner.cs" target="_blank" rel="noopener noreferrer">IServiceRunner</a> that decouples the execution of your service from the implementation of it.</p><p>To add your own Service Hooks you just need to override the default Service Runner in your AppHost from its default implementation:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">IServiceRunner<span class="token punctuation">&lt;</span>TRequest<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">CreateServiceRunner</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TRequest<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
    <span class="token class-name">ActionContext</span> actionContext<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Cached per Service Action</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ServiceRunner<span class="token punctuation">&lt;</span>TRequest<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> actionContext<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>With your own:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">IServiceRunner<span class="token punctuation">&lt;</span>TRequest<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">CreateServiceRunner</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TRequest<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
    <span class="token class-name">ActionContext</span> actionContext<span class="token punctuation">)</span>
<span class="token punctuation">{</span>           
    <span class="token comment">//Cached per Service Action</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyServiceRunner<span class="token punctuation">&lt;</span>TRequest<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> actionContext<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>Where <code>MyServiceRunner&lt;T&gt;</code> is just a custom class implementing the custom hooks you&#39;re interested in, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServiceRunner<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ServiceRunner<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span> 
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnBeforeExecute</span><span class="token punctuation">(</span>
        <span class="token class-name">IRequest</span> requestContext<span class="token punctuation">,</span> <span class="token class-name">TRequest</span> request<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
      <span class="token comment">// Called just before any Action is executed</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">OnAfterExecute</span><span class="token punctuation">(</span>
        <span class="token class-name">IRequest</span> requestContext<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> response<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
      <span class="token comment">// Called just after any Action is executed.</span>
      <span class="token comment">// You can modify the response returned here as well</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">HandleException</span><span class="token punctuation">(</span>
        <span class="token class-name">IRequest</span> requestContext<span class="token punctuation">,</span> <span class="token class-name">TRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
      <span class="token comment">// Called whenever an exception is thrown in your Services Action</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>__VP_STATIC_END__`,45),o=[p];function c(u,l,i,r,k,d){return a(),s("div",null,o)}var h=n(e,[["render",c]]);export{y as __pageData,h as default};
