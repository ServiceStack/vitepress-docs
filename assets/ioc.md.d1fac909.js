import{_ as n,c as s,o as a,a as t}from"./app.14440598.js";const y=`{"title":"ServiceStack's IOC","description":"","frontmatter":{"slug":"ioc","title":"ServiceStack's IOC"},"headers":[{"level":2,"title":".NET Core Compatible Registration APIs","slug":"net-core-compatible-registration-apis"},{"level":2,"title":"Autowire Registration","slug":"autowire-registration"},{"level":2,"title":"Custom Registration","slug":"custom-registration"},{"level":3,"title":"Using Custom Factories","slug":"using-custom-factories"},{"level":3,"title":"Register instances","slug":"register-instances"},{"level":2,"title":"Object lifetime","slug":"object-lifetime"},{"level":3,"title":"Supported Lifetime Scopes","slug":"supported-lifetime-scopes"},{"level":3,"title":"ASP.NET Core IServiceProvider APIs","slug":"asp-net-core-iserviceprovider-apis"},{"level":2,"title":"Advanced Usages","slug":"advanced-usages"},{"level":3,"title":"Autowiring Generic Type Definitions","slug":"autowiring-generic-type-definitions"},{"level":2,"title":"Use another IoC container","slug":"use-another-ioc-container"},{"level":3,"title":"Use Ninject","slug":"use-ninject"},{"level":3,"title":"Use StructureMap","slug":"use-structuremap"},{"level":3,"title":"Use Windsor","slug":"use-windsor"},{"level":3,"title":"Use Autofac","slug":"use-autofac"},{"level":3,"title":"Use SimpleInjector","slug":"use-simpleinjector"},{"level":3,"title":"Use Unity","slug":"use-unity"},{"level":3,"title":"Disposing of your services","slug":"disposing-of-your-services"}],"relativePath":"ioc.md","lastUpdated":1634495308418}`,e={},p=t(`<p>ServiceStack uses a slightly modified version of <a href="http://funq.codeplex.com/" target="_blank" rel="noopener noreferrer">Funq</a> - which was adopted because of its excellent <a href="http://www.servicestack.net/benchmarks/" target="_blank" rel="noopener noreferrer">performance and memory characteristics</a>. ServiceStack&#39;s version of Funq has been enhanced with Expression-based Auto-wiring and lifetime Request Scope.</p><p>If you so wish, you can still elect to use your favourite IOC by creating an <code>IContainerAdapter</code> for them. See below for examples of adapters for popular IOC&#39;s. All ServiceStack&#39;s customizable hooks support Auto-wiring out-of-the-box, namely:</p><ul><li><a href="/your-first-webservice-explained.html">Services</a></li><li><a href="/filter-attributes.html">Request and Response Filter attributes</a> <em>(are executed before a service gets called)</em></li><li><a href="/validation.html">Validators</a> <em>(validates a request DTO before the service gets called)</em></li></ul><p>For each of these features, dependencies are resolved for all parameters in the constructor that has the most arguments as well as all public properties.</p><h2 id="net-core-compatible-registration-apis" tabindex="-1">.NET Core Compatible Registration APIs <a class="header-anchor" href="#net-core-compatible-registration-apis" aria-hidden="true">#</a></h2><p>To retain the same nomenclature that .NET Core uses to register dependencies you can use the <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack/ContainerNetCoreExtensions.cs" target="_blank" rel="noopener noreferrer">.NET Core-compatible overloads</a> letting you use a single consistent API to register dependencies in both ServiceStack&#39;s and .NET Core&#39;s IOC making it easy to move registrations between the two, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">Container</span> container<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Register Singleton instance using Factory function</span>
    container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IBar<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Bar</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Equivalent to:</span>
    container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Register</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IBar<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Bar</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//Register Auto-Wired Transient instance</span>
    container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddTransient</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IFoo<span class="token punctuation">,</span> Foo<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Equivalent to:</span>
    container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterAutoWiredAs</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Foo<span class="token punctuation">,</span>IFoo<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReusedWithin</span><span class="token punctuation">(</span>ReuseScope<span class="token punctuation">.</span>None<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//Register Auto-Wired Request Scope instance</span>
    container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IScoped<span class="token punctuation">,</span> Scoped<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Equivalent to:</span>
    container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterAutoWiredAs</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Foo<span class="token punctuation">,</span>IFoo<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReusedWithin</span><span class="token punctuation">(</span>ReuseScope<span class="token punctuation">.</span>Request<span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>
</code></pre></div><h2 id="autowire-registration" tabindex="-1">Autowire Registration <a class="header-anchor" href="#autowire-registration" aria-hidden="true">#</a></h2><p>You can register dependencies so that all the dependencies are automatically auto-wired. Just like the hooks above, once resolved Funq will create a new instance resolving dependencies for the constructor that has the most arguments as well as all public properties.</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">Container</span> container<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
   container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterAutoWired</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MyType<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterAutoWiredAs</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MyType<span class="token punctuation">,</span>IMyType<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>There&#39;s also support for registration of run-time types with these APIs below:</p><div class="language-csharp"><pre><code>container<span class="token punctuation">.</span><span class="token function">RegisterAutoWiredType</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MyType</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
container<span class="token punctuation">.</span><span class="token function">RegisterAutoWiredType</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MyType</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">IMyType</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
container<span class="token punctuation">.</span><span class="token function">RegisterAutoWiredTypes</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MyType</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MyType2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MyType3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="custom-registration" tabindex="-1">Custom Registration <a class="header-anchor" href="#custom-registration" aria-hidden="true">#</a></h2><p>Funq also supports custom creation of instances. When used no auto-wiring is performed and it&#39;s left up to you to explicitly resolve all your dependencies.</p><h3 id="using-custom-factories" tabindex="-1">Using Custom Factories <a class="header-anchor" href="#using-custom-factories" aria-hidden="true">#</a></h3><p>In addition to Auto-wiring Funq allows you to customize the creation of your instance with custom delegates. This is useful when your dependencies require custom configuration. E.g:</p><div class="language-csharp"><pre><code>container<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyType</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDependency<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> connectionString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Register</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IMyType<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyType</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDependency<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> connectionString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
container<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> <span class="token function">CreateAndInitializeMyType</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDependency1<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>Resolve<span class="token operator">&lt;</span>IDependency2<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="register-instances" tabindex="-1">Register instances <a class="header-anchor" href="#register-instances" aria-hidden="true">#</a></h3><p>Other than factories, you can also register custom instances where instead of returning a lambda above you can return an instance:</p><div class="language-csharp"><pre><code>container<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyType</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDependency<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> connectionString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>When using the methods above, the properties and the constructor of the registered type aren&#39;t auto-wired (ie <strong>the properties and the constructor are not injected</strong>)</p></div><h2 id="object-lifetime" tabindex="-1">Object lifetime <a class="header-anchor" href="#object-lifetime" aria-hidden="true">#</a></h2><p>By default all dependencies registered in Funq have singleton scope, where the same instance is injected into all dependencies. This behaviour can be changed by defining the scope explicitly, which is supported with the following APIs:</p><div class="language-csharp"><pre><code>container<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReusedWithin</span><span class="token punctuation">(</span>ReuseScope<span class="token punctuation">.</span>None<span class="token punctuation">)</span><span class="token punctuation">;</span> 
container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterAutoWired</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MyType<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReusedWithin</span><span class="token punctuation">(</span>ReuseScope<span class="token punctuation">.</span>None<span class="token punctuation">)</span><span class="token punctuation">;</span> 
container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterAutoWiredAs</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MyType<span class="token punctuation">,</span>IMyType<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReusedWithin</span><span class="token punctuation">(</span>ReuseScope<span class="token punctuation">.</span>None<span class="token punctuation">)</span><span class="token punctuation">;</span> 
container<span class="token punctuation">.</span><span class="token function">RegisterAutoWiredType</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MyType</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ReuseScope<span class="token punctuation">.</span>None<span class="token punctuation">)</span><span class="token punctuation">;</span> 
container<span class="token punctuation">.</span><span class="token function">RegisterAutoWiredType</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MyType</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">IMyType</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ReuseScope<span class="token punctuation">.</span>None<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><h3 id="supported-lifetime-scopes" tabindex="-1">Supported Lifetime Scopes <a class="header-anchor" href="#supported-lifetime-scopes" aria-hidden="true">#</a></h3><ul><li><code>ReuseScope.Container</code>: Singleton scope (a instance is used per application lifetime)</li><li><code>ReuseScope.Request</code>: Request scope (a instance is used per request lifetime)</li><li><code>ReuseScope.None</code>: Transient scope (a new instance is created every time)</li></ul><h4 id="scoped-dependencies" tabindex="-1">Scoped Dependencies <a class="header-anchor" href="#scoped-dependencies" aria-hidden="true">#</a></h4><p>In <a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET</a> Core ServiceStack is pre-configured to use a <code>NetCoreContainerAdapter</code> where it will also resolve any dependencies declared in your .NET Core Startup using <code>app.ApplicationServices</code>. One side-effect of this is that when resolving <strong>Scoped</strong> dependencies it resolves them in a Singleton scope instead of the Request Scope had they instead been resolved from <code>context.RequestServices.GetService&lt;T&gt;()</code>.</p><p>One way to be able to inject scoped dependencies into your Services is to register the <code>IHttpContextAccessor</code> where they&#39;ll be resolved from <a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET</a> Core&#39;s RequestServices context:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
     services<span class="token punctuation">.</span><span class="token function">AddHttpContextAccessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IScoped<span class="token punctuation">,</span> Scoped<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Otherwise if you need to resolve Request Scoped .NET Core dependencies you can resolve them from <code>IRequest</code>, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">MyRequest</span> request<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> requestScope <span class="token operator">=</span> <span class="token keyword">base</span><span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">TryResolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IScoped<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Alternatively you can register the dependencies in ServiceStack&#39;s IOC instead, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">Container</span> container<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterAutoWiredAs</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Scoped<span class="token punctuation">,</span>IScoped<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ReusedWithin</span><span class="token punctuation">(</span>ReuseScope<span class="token punctuation">.</span>Request<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Where they&#39;d be resolved within ServiceStack&#39;s Request Scope instead of via <a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET</a> Core&#39;s RequestServices.</p><h3 id="asp-net-core-iserviceprovider-apis" tabindex="-1"><a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET</a> Core IServiceProvider APIs <a class="header-anchor" href="#asp-net-core-iserviceprovider-apis" aria-hidden="true">#</a></h3><p>Registering dependencies in ServiceStack&#39;s IOC are only available within ServiceStack, you can access <strong>scoped <a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET</a> Core dependencies</strong> and create Custom IOC Scopes using the <code>IRequest</code> APIs below:</p><ul><li><code>IRequest.TryResolveScoped&lt;T&gt;()</code></li><li><code>IRequest.TryResolveScoped()</code></li><li><code>IRequest.ResolveScoped&lt;T&gt;()</code></li><li><code>IRequest.ResolveScoped()</code></li><li><code>IRequest.CreateScope()</code></li><li><code>IRequest.GetServices()</code></li><li><code>IRequest.GetServices&lt;T&gt;()</code></li></ul><p>Which can be used to create custom scopes that utilizes <a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET</a> Entity Framework Identity classes in your ServiceStack Services:</p><div class="language-csharp"><pre><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> scope <span class="token operator">=</span> Request<span class="token punctuation">.</span><span class="token function">CreateScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> RoleManager <span class="token operator">=</span> scope<span class="token punctuation">.</span>ServiceProvider<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRequiredService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>RoleManager<span class="token punctuation">&lt;</span>IdentityRole<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> UserManager <span class="token operator">=</span> scope<span class="token punctuation">.</span>ServiceProvider<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRequiredService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserManager<span class="token punctuation">&lt;</span>ApplicationUser<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> managerUser <span class="token operator">=</span> <span class="token keyword">await</span> UserManager<span class="token punctuation">.</span><span class="token function">FindByEmailAsync</span><span class="token punctuation">(</span><span class="token string">&quot;manager@gmail.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>managerUser <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">assertResult</span><span class="token punctuation">(</span><span class="token keyword">await</span> UserManager<span class="token punctuation">.</span><span class="token function">CreateAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ApplicationUser</span> <span class="token punctuation">{</span>
            DisplayName <span class="token operator">=</span> <span class="token string">&quot;Test Manager&quot;</span><span class="token punctuation">,</span>
            Email <span class="token operator">=</span> <span class="token string">&quot;manager@gmail.com&quot;</span><span class="token punctuation">,</span>
            UserName <span class="token operator">=</span> <span class="token string">&quot;manager@gmail.com&quot;</span><span class="token punctuation">,</span>
            FirstName <span class="token operator">=</span> <span class="token string">&quot;Test&quot;</span><span class="token punctuation">,</span>
            LastName <span class="token operator">=</span> <span class="token string">&quot;Manager&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;p@55wOrd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        managerUser <span class="token operator">=</span> <span class="token keyword">await</span> UserManager<span class="token punctuation">.</span><span class="token function">FindByEmailAsync</span><span class="token punctuation">(</span><span class="token string">&quot;manager@gmail.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> UserManager<span class="token punctuation">.</span><span class="token function">AddToRoleAsync</span><span class="token punctuation">(</span>managerUser<span class="token punctuation">,</span> <span class="token string">&quot;Manager&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="advanced-usages" tabindex="-1">Advanced Usages <a class="header-anchor" href="#advanced-usages" aria-hidden="true">#</a></h2><h3 id="autowiring-generic-type-definitions" tabindex="-1">Autowiring Generic Type Definitions <a class="header-anchor" href="#autowiring-generic-type-definitions" aria-hidden="true">#</a></h3><p>Whilst ServiceStack&#39;s IOC doesn&#39;t have a native support for registering types based on a generic type definition, it&#39;s easy to use the Runtime Type APIs and register them yourself. E.g the example below will register and autowire all types that implement <code>ICommand&lt;T&gt;</code> in the current assembly:</p><div class="language-csharp"><pre><code><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">.</span><span class="token function">GetTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">IsOrHasGenericInterfaceTypeOf</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">ICommand<span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">Each</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> container<span class="token punctuation">.</span><span class="token function">RegisterAutoWiredType</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="use-another-ioc-container" tabindex="-1">Use another IoC container <a class="header-anchor" href="#use-another-ioc-container" aria-hidden="true">#</a></h2><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IResolver</span> <span class="token punctuation">{</span>
    <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">TryResolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IContainerAdapter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IResolver</span></span> <span class="token punctuation">{</span>
    <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="example-usage" tabindex="-1">Example Usage <a class="header-anchor" href="#example-usage" aria-hidden="true">#</a></h4><div class="language-csharp"><pre><code><span class="token class-name">IKernel</span> kernel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StandardKernel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
container<span class="token punctuation">.</span>Adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NinjectIocAdapter</span><span class="token punctuation">(</span>kernel<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Adding a custom ContainerAdapter allows your services to resolve its dependencies from an alternative IOC, in this way they act like a <strong>dependency repository</strong> where the services are still registered in Funq but all their dependencies are resolved by the ContainerAdapter specified. Dependencies in constructors are resolved by calling <code>IContainerAdapter.Resolve&lt;T&gt;()</code> whilst public property dependencies are resolved with <code>IContainerAdapter.TryResolve&lt;T&gt;()</code>, the idea is you can have missing constructor dependencies throw an exception whilst you can be more lax about property dependencies, where your service can continue to execute without them (should you wish).</p><p>Here are some example how to use some popular IoC containers side-by-side with Funq. Of course you&#39;re not only limited to the these IoC containers here:</p><h3 id="use-ninject" tabindex="-1">Use Ninject <a class="header-anchor" href="#use-ninject" aria-hidden="true">#</a></h3><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NinjectIocAdapter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IContainerAdapter</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IKernel</span> kernel<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">NinjectIocAdapter</span><span class="token punctuation">(</span><span class="token class-name">IKernel</span> kernel<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>kernel <span class="token operator">=</span> kernel<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kernel<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">TryResolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kernel<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">CanResolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kernel<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then in the <code>AppHost</code> <code>Configure(Container container)</code> method you need to enable this adapter:</p><div class="language-csharp"><pre><code><span class="token comment">//Create Ninject IoC container</span>
<span class="token class-name">IKernel</span> kernel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StandardKernel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Now register all depedencies to your custom IoC container</span>
<span class="token comment">//...</span>

<span class="token comment">//Register Ninject IoC container, so ServiceStack can use it</span>
container<span class="token punctuation">.</span>Adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NinjectIocAdapter</span><span class="token punctuation">(</span>kernel<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="use-structuremap" tabindex="-1">Use StructureMap <a class="header-anchor" href="#use-structuremap" aria-hidden="true">#</a></h3><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StructureMapContainerAdapter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IContainerAdapter</span></span>
<span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">TryResolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span> ObjectFactory<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">TryGetInstance</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span> ObjectFactory<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">TryGetInstance</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In <code>AppHost</code> <code>Configure</code>:</p><div class="language-csharp"><pre><code><span class="token comment">//Configure User Defined REST Paths</span>
container<span class="token punctuation">.</span>Adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StructureMapContainerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Register your dependencies</span>
ObjectFactory<span class="token punctuation">.</span><span class="token function">Inject</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">IFoo</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Due to a behavior of StructureMap, you need your <code>AppHost</code> declare as <code>internal</code>, eg: <code>internal class AppHost : AppHostBase</code></p></div><h3 id="use-windsor" tabindex="-1">Use Windsor <a class="header-anchor" href="#use-windsor" aria-hidden="true">#</a></h3><div class="language-csharp"><pre><code><span class="token comment">// The &quot;ApplicationAssemblyFilter&quot; is a custom class that just helps to </span>
<span class="token comment">// automate registration to assemblies which match a particular pattern </span>
<span class="token comment">// in the app path</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationAssemblyFilter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AssemblyFilter</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">ApplicationAssemblyFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>AppDomain<span class="token punctuation">.</span>CurrentDomain<span class="token punctuation">.</span>BaseDirectory<span class="token punctuation">,</span> Assembly<span class="token punctuation">.</span><span class="token function">GetExecutingAssembly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">&quot;.*.dll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WindsorContainerAdapter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IContainerAdapter</span><span class="token punctuation">,</span> <span class="token class-name">IDisposable</span></span> 
<span class="token punctuation">{</span> 
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IWindsorContainer</span> container<span class="token punctuation">;</span> 

    <span class="token keyword">public</span> <span class="token function">WindsorContainerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span> 
        container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WindsorContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Install</span><span class="token punctuation">(</span>FromAssembly<span class="token punctuation">.</span><span class="token function">InThisApplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
             FromAssembly<span class="token punctuation">.</span><span class="token function">InDirectory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ApplicationAssemblyFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 

    <span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">TryResolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span> 
       <span class="token keyword">if</span> <span class="token punctuation">(</span>container<span class="token punctuation">.</span>Kernel<span class="token punctuation">.</span><span class="token function">HasComponent</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span>container<span class="token punctuation">.</span><span class="token function">Resolve</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token keyword">return</span> <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 

    <span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span> 
        <span class="token keyword">return</span> container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span> 
        container<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
</code></pre></div><h3 id="use-autofac" tabindex="-1">Use Autofac <a class="header-anchor" href="#use-autofac" aria-hidden="true">#</a></h3><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutofacIocAdapter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IContainerAdapter</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">Autofac<span class="token punctuation">.</span>IContainer</span> container<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">AutofacIocAdapter</span><span class="token punctuation">(</span><span class="token class-name">Autofac<span class="token punctuation">.</span>IContainer</span> container<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
        <span class="token keyword">this</span><span class="token punctuation">.</span>container <span class="token operator">=</span> container<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">TryResolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">TryResolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Autofac<span class="token punctuation">.</span>ILifetimeScope<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">var</span></span> scope<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
            scope<span class="token punctuation">.</span><span class="token function">TryResolve</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">var</span></span> scopeComponent<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span>scopeComponent<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token function">TryResolve</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">var</span></span> component<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span>component<span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> ret <span class="token operator">=</span> <span class="token generic-method"><span class="token function">TryResolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">!</span>ret<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span>
            <span class="token punctuation">?</span> ret
            <span class="token punctuation">:</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Error trying to resolve &#39;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name</span><span class="token punctuation">}</span></span><span class="token string">&#39;&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then in the <code>AppHost</code> <code>Configure(Container container)</code> method you need to enable this adapter:</p><div class="language-csharp"><pre><code><span class="token comment">//Create Autofac builder</span>
<span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ContainerBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Now register all depedencies to your custom IoC container</span>
<span class="token comment">//...</span>

<span class="token comment">//Register Autofac IoC container adapter, so ServiceStack can use it</span>
<span class="token class-name">IContainerAdapter</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutofacIocAdapter</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
container<span class="token punctuation">.</span>Adapter <span class="token operator">=</span> adapter<span class="token punctuation">;</span>
</code></pre></div><h3 id="use-simpleinjector" tabindex="-1">Use SimpleInjector <a class="header-anchor" href="#use-simpleinjector" aria-hidden="true">#</a></h3><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleInjectorIocAdapter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IContainerAdapter</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">Container</span> container<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">SimpleInjectorIocAdapter</span><span class="token punctuation">(</span><span class="token class-name">Container</span> container<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>container <span class="token operator">=</span> container<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">GetInstance</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">TryResolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> registration <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">GetRegistration</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> registration <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token punctuation">?</span> <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span>registration<span class="token punctuation">.</span><span class="token function">GetInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then in the <code>AppHost</code> <code>Configure(Container container)</code> method you need to enable this adapter:</p><div class="language-csharp"><pre><code><span class="token comment">//Create SimpleInjector IoC container</span>
<span class="token class-name">Container</span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Now register all depedencies to your custom IoC container</span>
<span class="token comment">//...</span>

<span class="token comment">//Register SimpleInjector IoC container, so ServiceStack can use it</span>
container<span class="token punctuation">.</span>Adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SimpleInjectorIocAdapter</span> <span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="use-unity" tabindex="-1">Use Unity <a class="header-anchor" href="#use-unity" aria-hidden="true">#</a></h3><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnityIocAdapter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IContainerAdapter</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IUnityContainer</span> container<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">UnityIocAdapter</span><span class="token punctuation">(</span><span class="token class-name">IUnityContainer</span> container<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>container <span class="token operator">=</span> container<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">TryResolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">IsRegistered</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then in the <code>AppHost</code> <code>Configure(Container container)</code> method you need to enable this adapter:</p><div class="language-csharp"><pre><code><span class="token comment">//Create Unity IoC container</span>
<span class="token class-name"><span class="token keyword">var</span></span> unityContainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UnityContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Now register all depedencies to your custom IoC container</span>
<span class="token comment">//...</span>

<span class="token comment">//Register SimpleInjector IoC container, so ServiceStack can use it</span>
container<span class="token punctuation">.</span>Adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UnityIocAdapter</span><span class="token punctuation">(</span>unityContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="disposing-of-your-services" tabindex="-1">Disposing of your services <a class="header-anchor" href="#disposing-of-your-services" aria-hidden="true">#</a></h3><p>The <code>AppHost.Release(instance)</code> method gets called for every resolved service right after it&#39;s used. This is the <a href="https://github.com/ServiceStack/ServiceStack/blob/f2d8eadaf5f4eecf1eadae918243472b039e5dfe/src/ServiceStack/ServiceStackHost.cs#L787-L805" target="_blank" rel="noopener noreferrer">default implementation</a> (which can be overridden):</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> iocAdapterReleases <span class="token operator">=</span> Container<span class="token punctuation">.</span>Adapter <span class="token keyword">as</span> <span class="token class-name">IRelease</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>iocAdapterReleases <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    iocAdapterReleases<span class="token punctuation">.</span><span class="token function">Release</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> 
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> disposable <span class="token operator">=</span> instance <span class="token keyword">as</span> <span class="token class-name">IDisposable</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>disposable <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        disposable<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Which will first try to call your ContainerAdapter if it implements <code>IRelease</code> otherwise if the service is <code>IDisposable</code> it will just dispose of it itself.</p><p>So to have resolved services released back into your IOC, implement the <code>IRelease</code> interface on your IContainerAdapter, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WindsorContainerAdapter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IContainerAdapter</span><span class="token punctuation">,</span> <span class="token class-name">IRelease</span></span>
<span class="token punctuation">{</span> 
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IWindsorContainer</span> _container<span class="token punctuation">;</span> 

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Release</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> instance<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> 
        _container<span class="token punctuation">.</span><span class="token function">Release</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Otherwise you can override default implementation in your <code>AppHost.Release(instance)</code> if you want to do something other than the default implementation.</p><h1 id="community-resources" tabindex="-1">Community Resources <a class="header-anchor" href="#community-resources" aria-hidden="true">#</a></h1><ul><li><a href="http://www.agile-code.com/blog/servicestack-ioc-with-microsoft-unity/" target="_blank" rel="noopener noreferrer">ServiceStack: IoC with Microsoft Unity</a> by <a href="https://twitter.com/zoranmax" target="_blank" rel="noopener noreferrer">@zoranmax</a></li><li><a href="http://bhameyie.com/2013/09/03/servicestack-extensibility-using-mef/" target="_blank" rel="noopener noreferrer">ServiceStack extensibility using MEF</a> by <a href="https://twitter.com/bhameyie" target="_blank" rel="noopener noreferrer">@bhameyie</a></li></ul>`,82),o=[p];function c(l,i,u,r,k,d){return a(),s("div",null,o)}var g=n(e,[["render",c]]);export{y as __pageData,g as default};
