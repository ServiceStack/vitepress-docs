import{_ as t,c as e,o,a,b as n,e as s}from"./app.14440598.js";const w=`{"title":"v5.1 Release Notes","description":"","frontmatter":{"title":"v5.1 Release Notes","slug":"v5-1-0"},"headers":[{"level":2,"title":"v5.1 Release Notes","slug":"v5-1-release-notes"},{"level":2,"title":"Dart and Flutter!","slug":"dart-and-flutter"},{"level":3,"title":"Flavors of Dart","slug":"flavors-of-dart"},{"level":3,"title":"Dart ServiceStack Reference","slug":"dart-servicestack-reference"},{"level":3,"title":"Example Usage","slug":"example-usage"},{"level":3,"title":"Rich Generated Models","slug":"rich-generated-models"},{"level":3,"title":"JsonServiceClient","slug":"jsonserviceclient"},{"level":3,"title":"JsonWebClient","slug":"jsonwebclient"},{"level":3,"title":"IServiceClient API","slug":"iserviceclient-api"},{"level":3,"title":"HelloFlutter App","slug":"helloflutter-app"},{"level":3,"title":"HelloFlutter UI","slug":"helloflutter-ui"},{"level":3,"title":"Angular Dart","slug":"angular-dart"},{"level":2,"title":"Swift","slug":"swift"},{"level":2,"title":"Kotlin","slug":"kotlin"},{"level":2,"title":"New Single Page App Templates!","slug":"new-single-page-app-templates"},{"level":2,"title":"Nuxt.js","slug":"nuxt-js"},{"level":3,"title":"ServiceStack Integration","slug":"servicestack-integration"},{"level":3,"title":"Getting Started","slug":"getting-started"},{"level":3,"title":"Dev Workflow","slug":"dev-workflow"},{"level":3,"title":"Update DTOs","slug":"update-dtos"},{"level":3,"title":"Generate Static Production Build","slug":"generate-static-production-build"},{"level":3,"title":"Publishing App for Deployment","slug":"publishing-app-for-deployment"},{"level":3,"title":"Host static content on Netlify's CDN for free","slug":"host-static-content-on-netlify-s-cdn-for-free"},{"level":3,"title":"Nuxt Templates","slug":"nuxt-templates"},{"level":3,"title":"Vuetify","slug":"vuetify"},{"level":2,"title":"The New TechStacks","slug":"the-new-techstacks"},{"level":3,"title":"Resilience of ServiceStack","slug":"resilience-of-servicestack"},{"level":3,"title":"Netlify CDN","slug":"netlify-cdn"},{"level":3,"title":"AWS LightSail","slug":"aws-lightsail"},{"level":3,"title":"ServiceStack Community Resources","slug":"servicestack-community-resources"},{"level":3,"title":"The new Community enhanced TechStacks","slug":"the-new-community-enhanced-techstacks"},{"level":3,"title":"ServiceStack Community Changes","slug":"servicestack-community-changes"},{"level":3,"title":"techstacks.io/servicestack","slug":"techstacks-io-servicestack"},{"level":2,"title":"Solution Highlights","slug":"solution-highlights"},{"level":3,"title":"Deployments","slug":"deployments"},{"level":3,"title":"Client / Server Validation with Vuetify","slug":"client-server-validation-with-vuetify"},{"level":3,"title":"Extensible AutoQuery Services","slug":"extensible-autoquery-services"},{"level":2,"title":"Background MQ Service","slug":"background-mq-service"},{"level":3,"title":"Using Background Service to send Emails","slug":"using-background-service-to-send-emails"},{"level":3,"title":"Replaying Messages","slug":"replaying-messages"},{"level":3,"title":"MQ Status","slug":"mq-status"},{"level":2,"title":"New Vue Components","slug":"new-vue-components"},{"level":3,"title":"Vuetify Markdown Editor","slug":"vuetify-markdown-editor"},{"level":3,"title":"Beautiful, free Hero Backgrounds","slug":"beautiful-free-hero-backgrounds"},{"level":3,"title":"Image Upload Vue Component","slug":"image-upload-vue-component"},{"level":2,"title":"Stripe Gateway","slug":"stripe-gateway"},{"level":2,"title":"ServiceStack.Text","slug":"servicestack-text"},{"level":3,"title":"Accept arbitrary JavaScript or JSON Objects","slug":"accept-arbitrary-javascript-or-json-objects"},{"level":3,"title":"Populate Objects from Read Only Dictionary","slug":"populate-objects-from-read-only-dictionary"},{"level":3,"title":"Support for [EnumMember]","slug":"support-for-enummember"},{"level":2,"title":"OrmLite","slug":"ormlite"},{"level":3,"title":"Support for SQL Server 2012 Sequences","slug":"support-for-sql-server-2012-sequences"},{"level":3,"title":"Auto populated Guid Ids","slug":"auto-populated-guid-ids"},{"level":3,"title":"Select Multiple Join Alias Tables","slug":"select-multiple-join-alias-tables"},{"level":3,"title":"Support for [Unique] and [UniqueConstraint]","slug":"support-for-unique-and-uniqueconstraint"},{"level":3,"title":"Order by dynamic expressions","slug":"order-by-dynamic-expressions"},{"level":3,"title":"New BeforeExecFilter and AfterExecFilter filters","slug":"new-beforeexecfilter-and-afterexecfilter-filters"},{"level":3,"title":"Typed Sql.Cast() SQL Modifier","slug":"typed-sql-cast-sql-modifier"},{"level":3,"title":"Typed Column<T> and Table<T> APIs","slug":"typed-column-t-and-table-t-apis"},{"level":3,"title":"Dapper Upgraded","slug":"dapper-upgraded"},{"level":3,"title":"New Live Create Table Schemas Example","slug":"new-live-create-table-schemas-example"},{"level":2,"title":".NET Core Extensibility in WebApps","slug":"net-core-extensibility-in-webapps"},{"level":3,"title":"JWT","slug":"jwt"},{"level":3,"title":"Support for multiple Audiences","slug":"support-for-multiple-audiences"},{"level":3,"title":"New JWT APIs","slug":"new-jwt-apis"},{"level":2,"title":"Metadata","slug":"metadata"},{"level":3,"title":"Native Type Wildcards","slug":"native-type-wildcards"},{"level":3,"title":"Call Internal and External Services from URLs","slug":"call-internal-and-external-services-from-urls"},{"level":2,"title":"ServiceStack","slug":"servicestack"},{"level":3,"title":"Logging","slug":"logging"},{"level":3,"title":"ServerEvents Client","slug":"serverevents-client"},{"level":3,"title":"Sessions","slug":"sessions"},{"level":3,"title":"Minor Features","slug":"minor-features"},{"level":3,"title":"Open API","slug":"open-api"},{"level":2,"title":"Community","slug":"community"},{"level":2,"title":"Patch Release Versions","slug":"patch-release-versions"}],"relativePath":"releases/v5.1.0.md","lastUpdated":1634495308438}`,p={},c=a(`__VP_STATIC_START__<p>As these release notes have become apologetically long we&#39;re including a Table of Contents so you can jump quickly to features you&#39;re interested in:</p><h1 id="table-of-contents" tabindex="-1">Table of Contents <a class="header-anchor" href="#table-of-contents" aria-hidden="true">#</a></h1><p><strong><a href="#dart-and-flutter">Dart and Flutter!</a></strong></p><ul><li><a href="#flavors-of-dart">Flavors of Dart</a></li><li><a href="#dart-servicestack-reference">Dart ServiceStack Reference</a></li><li><a href="#example-usage">Example Usage</a></li><li><a href="#rich-generated-models">Rich Generated Models</a><ul><li>JsonCodec compatible</li><li>Default Constructor</li><li>IConvertible</li></ul></li><li><a href="#jsonserviceclient">JsonServiceClient</a></li><li><a href="#jsonwebclient">JsonWebClient</a></li><li><a href="#iserviceclient-api">IServiceClient API</a></li><li><a href="#helloflutter-app">HelloFlutter App</a><ul><li>HelloFlutter UI</li><li>Standard API Requests</li><li>Authenticated Requests</li><li>JWT RefreshToken Requests</li><li>AutoQuery Requests</li><li>Generating Unknown Types</li><li>Auto Batched Requests</li><li>Binary Requests</li></ul></li><li><a href="#angular-dart">Angular Dart</a></li></ul><p><strong><a href="#swift">Swift</a></strong></p><p><strong><a href="#kotlin">Kotlin</a></strong></p><p><strong><a href="#new-single-page-app-templates">New Single Page App Templates!</a></strong></p><ul><li><a href="#nuxtjs">Nuxt.js</a><ul><li>ServiceStack Integration</li><li>Getting Started</li><li>Dev Workflow</li><li>Update DTOs</li><li>Generate Static Production Build</li><li>Publishing App for Deployment</li><li>Host static content on Netlify&#39;s CDN for free</li><li>Nuxt Templates</li></ul></li><li><a href="#vuetify">Vuetify</a><ul><li>Vue App</li><li>Vue Nuxt App</li></ul></li></ul><p><strong><a href="#the-new-techstacks">The New TechStacks</a></strong></p><ul><li><a href="#resilience-of-servicestack">Resilience of ServiceStack</a></li><li><a href="#netlify-cdn">Netlify CDN</a></li><li><a href="#aws-lightsail">AWS LightSail</a></li><li><a href="#servicestack-community-resources">ServiceStack Community Resources</a></li><li><a href="#the-new-community-enhanced-techstacks">The new Community enhanced TechStacks</a></li><li><a href="#servicestack-community-changes">ServiceStack Community Changes</a></li></ul><p><strong><a href="#solution-highlights">Solution Highlights</a></strong></p><ul><li><a href="#deployments">Deployments</a></li><li><a href="#client--server-validation-with-vuetify">Client / Server Validation with Vuetify</a></li><li><a href="#extensible-autoquery-services">Extensible AutoQuery Services</a></li></ul><p><strong><a href="#background-mq-service">Background MQ Service</a></strong></p><ul><li><a href="#using-background-service-to-send-emails">Using Background Service to send Emails</a></li><li><a href="#replaying-messages">Replaying Messages</a></li><li><a href="#mq-status">MQ Status</a></li></ul><p><strong><a href="#new-vue-components">New Vue Components</a></strong></p><ul><li><a href="#vuetify-markdown-editor">Vuetify Markdown Editor</a></li><li><a href="#beautiful-free-hero-backgrounds">Beautiful, free Hero Backgrounds</a></li><li><a href="#image-upload-vue-component">Image Upload Vue Component</a></li></ul><p><strong><a href="#stripe-gateway">Stripe Gateway</a></strong></p><p><strong><a href="#servicestacktext">ServiceStack.Text</a></strong></p><ul><li><a href="#accept-arbitrary-javascript-or-json-objects">Accept arbitrary JavaScript or JSON Objects</a></li><li><a href="#populate-objects-from-read-only-dictionary">Populate Objects from Read Only Dictionary</a></li><li><a href="#support-for-enummember">Support for [EnumMember]</a></li></ul><p><strong><a href="#ormlite">OrmLite</a></strong></p><ul><li><a href="#support-for-sql-server-2012-sequences">Support for SQL Server 2012 Sequences</a><ul><li>SQL Server Dialects</li></ul></li><li><a href="#auto-populated-guid-ids">Auto populated Guid Ids</a></li><li><a href="#select-multiple-join-alias-tables">Select Multiple Join Alias Tables</a></li><li><a href="#support-for-unique-and-uniqueconstraint">Support for [Unique] and [UniqueConstraint]</a></li><li><a href="#order-by-dynamic-expressions">Order by dynamic expressions</a></li><li><a href="#new-beforeexecfilter-and-afterexecfilter-filters">New BeforeExecFilter and AfterExecFilter filters</a></li><li><a href="#typed-sqlcast-sql-modifier">Typed Sql.Cast() SQL Modifier</a></li><li><a href="#typed-columnt-and-tablet-apis">Typed Column and Table APIs</a></li><li><a href="#dapper-upgraded">Dapper Upgraded</a></li><li><a href="#new-live-create-table-schemas-example">New Live Create Table Schemas Example</a></li></ul><p><strong><a href="#net-core-extensibility-in-apps">.NET Core Extensibility in WebApps</a></strong></p><p><strong><a href="#jwt">JWT</a></strong></p><ul><li><a href="#support-for-multiple-audiences">Support for multiple Audiences</a></li><li><a href="#new-jwt-apis">New JWT APIs</a></li></ul><p><strong><a href="#metadata">Metadata</a></strong></p><ul><li><a href="#native-type-wildcards">Native Type Wildcards</a><ul><li>Include Request DTO and its dependent types</li><li>Include All Types within a C# namespace</li></ul></li><li><a href="#use-a-different-baseurl">Use a different BaseUrl</a></li><li><a href="#call-internal-and-external-services-from-urls">Call Internal and External Services from URLs</a></li></ul><p><strong><a href="#servicestack">ServiceStack</a></strong></p><ul><li><a href="#logging">Logging</a></li><li><a href="#serverevents-client">ServerEvents Client</a></li><li><a href="#sessions">Sessions</a></li><li><a href="#minor-features">Minor Features</a></li><li><a href="#open-api">Open API</a></li></ul><p><strong><a href="#community">Community</a></strong></p><p><strong><a href="#patch-release-versions">Patch Release Versions</a></strong></p><p>We&#39;ll aim for shorter release cycles in future to make the Release Notes easier to get through.</p><h2 id="v5-1-release-notes" tabindex="-1">v5.1 Release Notes <a class="header-anchor" href="#v5-1-release-notes" aria-hidden="true">#</a></h2><p>One of the goals of ServiceStack is to provide a highly productive development experience for powering Mobile Apps with an end-to-end typed API for the most popular Mobile frameworks, including developing iOS, Android and UWP Apps with <a href="https://github.com/ServiceStackApps/HelloMobile" target="_blank" rel="noopener noreferrer">Xamarin and C#</a>, iOS and Android Apps with <a href="https://github.com/ServiceStackApps/typescript-server-events" target="_blank" rel="noopener noreferrer">React Native and JavaScript</a>, Native Android Apps using <a href="/kotlin-add-servicestack-reference.html">Kotlin</a> or <a href="/java-add-servicestack-reference.html">Java</a> and Native iOS Apps using <a href="/swift-add-servicestack-reference.html">Swift</a>. This release extends the value proposition of existing ServiceStack Services by providing seamless integration with Google&#39;s exciting new Mobile iOS and Android Framework:</p><h2 id="dart-and-flutter" tabindex="-1">Dart and Flutter! <a class="header-anchor" href="#dart-and-flutter" aria-hidden="true">#</a></h2><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dart/dart.png" alt=""></p><p>We&#39;re super excited to announce first-class support for <a href="https://www.dartlang.org" target="_blank" rel="noopener noreferrer">Dart</a> and <a href="https://flutter.io" target="_blank" rel="noopener noreferrer">Flutter</a>! - Google\u2019s premier new mobile UI framework for crafting high-quality native interfaces for iOS and Android from a single code-base in record time with a Reactive development model simplifying the effort for building Complex UIs in similar vein to development models pioneered in popular JavaScript frameworks like React, React Native, Vue and Angular. It&#39;s offers a beautiful blend of rapid development cycles with its built-in Hot Reloading giving you instant iterative feedback of changes to your Mobile App in milliseconds, whilst still offering high-performance native experiences at runtime where Dart code is AOT compiled into native ARM in iOS and Android.</p><p>Backed by a well-resourced and highly talented team at Google, it offers a comprehensive cross-platform productivity featureset starting with a <a href="https://flutter.io/widgets/" target="_blank" rel="noopener noreferrer">suite of reusable widgets</a>, an <a href="https://flutter.io/tutorials/layout/" target="_blank" rel="noopener noreferrer">intuitive layout model</a>, <a href="https://flutter.io/animations/" target="_blank" rel="noopener noreferrer">animations</a>, <a href="https://flutter.io/gestures/" target="_blank" rel="noopener noreferrer">gestures</a> and an <a href="https://flutter.io/assets-and-images/" target="_blank" rel="noopener noreferrer">asset system</a> that integrates with the underlying Android and iOS platforms.</p><p>Despite being still in Beta, Flutter provides a refreshingly simple and productive approach to Mobile App development where it has quickly become one of the most compelling solutions available for developing both iOS and Android Apps from a single code base.</p><h3 id="flavors-of-dart" tabindex="-1">Flavors of Dart <a class="header-anchor" href="#flavors-of-dart" aria-hidden="true">#</a></h3><p>The Dart language itself mix between a dynamically typed JavaScript and a statically typed C# which can run on a number of <a href="https://www.dartlang.org/guides/platforms" target="_blank" rel="noopener noreferrer">different platforms</a>. E.g Flutter&#39;s Hot Reload feature runs in the Dart VM where Dart is JIT compiled and modified code is hot-swappable at runtime. But when Flutter Apps are run on Android or iOS, Dart is AOT compiled into native ARM, whilst Servers, Console Apps or Tests use the Dart VM and when <a href="https://webdev.dartlang.org" target="_blank" rel="noopener noreferrer">Dart is run in Browsers</a> it&#39;s transpiled into JavaScript which is what ends up being executed by browsers.</p><p>In addition to the different platforms, Dart 2 enables Strong Mode where <a href="https://www.dartlang.org/guides/language/sound-dart" target="_blank" rel="noopener noreferrer">Dart&#39;s Type System</a> is now sound. Any solution that wants to support all Dart platforms needs to target the minimum feature set available, which to support AOT Flutter Apps means no Mirror/Reflection as it needs to be able to take advantage of tree-shaking to produce the smallest App binaries possible.</p><h3 id="dart-servicestack-reference" tabindex="-1">Dart ServiceStack Reference <a class="header-anchor" href="#dart-servicestack-reference" aria-hidden="true">#</a></h3><p>We&#39;re happy to report that Dart ServiceStack Reference supports <strong>all Dart platforms!</strong> with and without Dart 2&#39;s Strong Mode - in the same optimal development workflow pioneered in <a href="/add-servicestack-reference.html">Add ServiceStack Reference</a> where it doesn&#39;t requiring any additional tooling, transformers or build steps.</p><p>Due to the lack of reflection and Mirror support, consuming JSON APIs can be quite <a href="https://flutter.io/cookbook/networking/fetch-data/" target="_blank" rel="noopener noreferrer">cumbersome in Flutter</a>. But we&#39;ve been able to achieve the same productive development experience available in <a href="/add-servicestack-reference.html">all supported languages</a> where you can use the generated Dart DTOs from any remote v5.1+ ServiceStack endpoint with ServiceStack&#39;s Smart generic <a href="https://pub.dartlang.org/documentation/servicestack/0.0.7/client/JsonServiceClient-class.html" target="_blank" rel="noopener noreferrer">JsonServiceClient</a> available in the <a href="https://pub.dartlang.org/packages/servicestack#-installing-tab-" target="_blank" rel="noopener noreferrer">servicestack Dart package</a>, to enable an end-to-end Typed API for calling Services by <a href="/architecture-overview.html#client-architecture">sending and receiving native DTOs</a>.</p><h3 id="example-usage" tabindex="-1">Example Usage <a class="header-anchor" href="#example-usage" aria-hidden="true">#</a></h3><p>You can use the same <a href="https://github.com/ServiceStack/servicestack-cli#servicestackcli" target="_blank" rel="noopener noreferrer">@servicestack/cli</a> simple command-line utility to easily Add and Update ServiceStack References for all supported languages:</p><pre><code>$ npm install -g @servicestack/cli
</code></pre><p>This makes the <code>dart-ref</code> script globally available in your <code>PATH</code> which you can execute with the URL of the remote ServiceStack Instance you want to generated DTOs for, e.g:</p><pre><code>$ dart-ref https://techstacks.io
</code></pre><p>This will generate Dart DTOs for the <a href="https://techstacks.io/metadata" target="_blank" rel="noopener noreferrer">entire TechStacks API</a>:</p><pre><code>Saved to: techstacks.dtos.dart
</code></pre><blockquote><p>If no name is specified in the 2nd argument, it&#39;s inferred from the URL, in this case it uses <code>techstacks</code>.</p></blockquote><p>To make API calls we need to use the <code>JsonServiceClient</code>, installed by adding the <a href="https://pub.dartlang.org/packages/servicestack#-installing-tab-" target="_blank" rel="noopener noreferrer">servicestack</a> package to our Dart projects <code>pubspec.yaml</code>:</p><div class="language-yaml"><pre><code><span class="token key atrule">dependencies</span><span class="token punctuation">:</span>
  <span class="token key atrule">servicestack</span><span class="token punctuation">:</span> ^1.0.8
</code></pre></div><p>Saving <code>pubspec.yaml</code> in VS Code with the <a href="https://dartcode.org" target="_blank" rel="noopener noreferrer">Dart Code Extension</a> automatically calls <code>flutter packages get</code> to add any new dependencies to your project.</p><p>We now have everything we need to be able to make typed API requests to any of <a href="https://techstacks.io/metadata" target="_blank" rel="noopener noreferrer">TechStacks APIs</a> with a shared <code>JsonServiceClient</code> instance populated with the base URL of the remote endpoint, e.g:</p><div class="language-dart"><pre><code><span class="token keyword">import</span> <span class="token string">&#39;package:servicestack/client.dart&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&#39;techstacks.dtos.dart&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonServiceClient</span><span class="token punctuation">(</span><span class="token string">&quot;https://techstacks.io&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GetTechnology</span><span class="token punctuation">(</span>slug<span class="token punctuation">:</span> <span class="token string">&quot;flutter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;\${response.technology.name}: \${response.technology.vendorUrl}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Like C#, Dart has Generics and Type Inference so the <code>response</code> returned is the typed <code>HelloResponse</code> DTO giving us rich intelli-sense and compiler type safety.</p><h3 id="rich-generated-models" tabindex="-1">Rich Generated Models <a class="header-anchor" href="#rich-generated-models" aria-hidden="true">#</a></h3><p>Thanks to the direct C# to Dart model code generation we&#39;re able to create the ideal idiomatic message-based APIs utilizing rich typed models with broad support for many of the C#/.NET features used when defining DTOs inc. Generics, Inheritance, multiple Interfaces, Enums (inc. int and Flag Enums), Tuples, metadata Attributes emitted in comments (emitting additional documentation in the generated models) whilst also taking care of mapping built-in C# Types like <code>DateTime</code>, <code>TimeSpan</code>, <code>byte[]</code> and <code>Stream</code> into their equivalent native Dart <a href="https://api.dartlang.org/stable/1.24.3/dart-core/DateTime-class.html" target="_blank" rel="noopener noreferrer">DateTime</a>, <a href="https://api.dartlang.org/stable/1.24.3/dart-core/Duration-class.html" target="_blank" rel="noopener noreferrer">Duration</a> and <a href="https://api.dartlang.org/stable/1.24.3/dart-typed_data/Uint8List-class.html" target="_blank" rel="noopener noreferrer">Uint8List</a> types, C# generic collections are also converted into their equivalent Dart generic collection Type.</p><h4 id="jsoncodec-compatible" tabindex="-1">JsonCodec compatible <a class="header-anchor" href="#jsoncodec-compatible" aria-hidden="true">#</a></h4><p>The generated DTOs follow Dart&#39;s <a href="https://api.dartlang.org/stable/1.24.3/dart-convert/JsonCodec-class.html" target="_blank" rel="noopener noreferrer">JsonCodec</a> pattern allowing them to be individually serializable with Dart&#39;s universal JSON encode/decode APIs, e.g:</p><div class="language-dart"><pre><code><span class="token comment">//Serialization</span>
<span class="token keyword">var</span> dto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyDto</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> jsonString <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>dto<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Deserialization</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> jsonObj <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fromJson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyDto</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>jsonObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="default-constructor" tabindex="-1">Default Constructor <a class="header-anchor" href="#default-constructor" aria-hidden="true">#</a></h4><p>All DTOs also include a default constructor containing all properties as optional arguments providing a wrist-friendly syntax for creating and populating DTOs in a single constructor expression, e.g:</p><div class="language-dart"><pre><code><span class="token keyword">var</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyDto</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Only the properties of each DTO are included in its default constructor so you&#39;ll need to use property accessors to initialize any fields in base classes, but thanks to Dart&#39;s support for method cascades you can still populate an entire DTO with a single expression, e.g:</p><div class="language-dart"><pre><code><span class="token keyword">var</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FindTechnologies</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span><span class="token string">&quot;Flutter&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span>fields <span class="token operator">=</span> <span class="token string">&quot;id,slug,vendorName,productUrl&quot;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span>orderBy <span class="token operator">=</span> <span class="token string">&quot;created,-viewCount&quot;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span>take <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="iconvertible" tabindex="-1">IConvertible <a class="header-anchor" href="#iconvertible" aria-hidden="true">#</a></h4><p>All DTOs implement the <code>IConvertible</code> interface below where each instance can be converted to and from a Map of values, giving each model dynamism that&#39;s otherwise not possible in Flutter:</p><div class="language-csharp"><pre><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">IConvertible</span>
<span class="token punctuation">{</span>
    <span class="token class-name">TypeContext</span> context<span class="token punctuation">;</span>
    <span class="token function">fromMap</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token return-type class-name">Map<span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> <span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The conversion logic that handles the behind-the-scenes conversion into and out of Dart Types is maintained in the extensible <a href="https://pub.dartlang.org/documentation/servicestack/0.0.7/client/JsonConverters/Converters.html" target="_blank" rel="noopener noreferrer">JsonConverters</a> class which lets you replace built-in converters with your own implementation or register new Converters when you want to take over handling of specific types.</p><h3 id="jsonserviceclient" tabindex="-1">JsonServiceClient <a class="header-anchor" href="#jsonserviceclient" aria-hidden="true">#</a></h3><p>The <code>JsonServiceClient</code> is a smart full-featured Service Client implementation with a number of high-level features that make consuming ServiceStack APIs a seamless experience, with built-in support for:</p><ul><li>HTTP Basic Auth (inc. <a href="/api-key-authprovider.html">API Key support</a>)</li><li><a href="/sessions.html">Cookies, Sessions and Credential Auth</a></li><li><a href="/jwt-authprovider.html">JWT, including using RefreshTokens to auto-fetch new JWT Bearer Tokens</a></li><li><a href="/error-handling.html">Structured Error Handling</a></li><li><a href="/auto-batched-requests.html">Auto Batched Requests</a></li><li>Global and per-instance Request, Response and Exception Filters</li><li><code>onAuthenticationRequired</code> hook to handle re-authentication and transparent replay of failed 401 requests</li></ul><p>Behind the scenes <code>JsonServiceClient</code> leverages the optimal <a href="https://docs.flutter.io/flutter/dart-io/HttpClient-class.html" target="_blank" rel="noopener noreferrer"><code>HttpClient</code> in dart:io</a> to perform HTTP Requests in Flutter and Dart VM Apps.</p><h3 id="jsonwebclient" tabindex="-1">JsonWebClient <a class="header-anchor" href="#jsonwebclient" aria-hidden="true">#</a></h3><p>The <code>servicestack</code> Dart package also includes an alternative <code>JsonWebClient</code> implementation which instead performs HTTP Requests using <a href="https://webdev.dartlang.org/angular/guide/server-communication" target="_blank" rel="noopener noreferrer">dart:html BrowserClient</a> to use the browsers built-in <code>XMLHttpRequest</code> object. Despite their implementation differences <code>JsonWebClient</code> also supports the same feature-set as the Dart VM&#39;s <code>JsonServiceClient</code> above.</p><p>AngularDart or Dart Web Apps can use <code>JsonWebClient</code> by importing <code>web_client.dart</code>, e.g:</p><div class="language-dart"><pre><code><span class="token keyword">import</span> <span class="token string">&#39;package:servicestack/web_client.dart&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonWebClient</span><span class="token punctuation">(</span><span class="token string">&quot;https://techstacks.io&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="iserviceclient-api" tabindex="-1">IServiceClient API <a class="header-anchor" href="#iserviceclient-api" aria-hidden="true">#</a></h3><p>Both JSON Service Client variants implement the same flexible <code>IServiceClient</code> API below, use the same DTOs and implementation and throws the same structured <code>WebServiceException</code> which results in Typed API Requests being source-compatible between Dart Web Apps, Dart VM Server and AOT compiled Flutter Web Apps:</p><div class="language-csharp"><pre><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">IServiceClient</span> <span class="token punctuation">{</span>
  <span class="token class-name">String</span> baseUrl<span class="token punctuation">;</span>
  <span class="token class-name">String</span> bearerToken<span class="token punctuation">;</span>
  <span class="token class-name">String</span> refreshToken<span class="token punctuation">;</span>
  <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
  <span class="token class-name">String</span> password<span class="token punctuation">;</span>

  Future<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token generic-method"><span class="token function">get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> request<span class="token punctuation">,</span> <span class="token punctuation">{</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">&gt;</span> args<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span>Map<span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token punctuation">{</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">&gt;</span> args<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">getAs</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token class-name">Map<span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> args<span class="token punctuation">,</span> T responseAs<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">post</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> request<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token class-name"><span class="token keyword">dynamic</span></span> body<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">&gt;</span> args<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span>Map<span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">postToUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">dynamic</span></span> body<span class="token punctuation">,</span> <span class="token punctuation">{</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">&gt;</span> args<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">postAs</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">dynamic</span></span> body<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token class-name">Map<span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> args<span class="token punctuation">,</span> T responseAs<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">delete</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> request<span class="token punctuation">,</span> <span class="token punctuation">{</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">&gt;</span> args<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span>Map<span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">deleteUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token punctuation">{</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">&gt;</span> args<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">deleteAs</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token class-name">Map<span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> args<span class="token punctuation">,</span> T responseAs<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">put</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> request<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token class-name"><span class="token keyword">dynamic</span></span> body<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">&gt;</span> args<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span>Map<span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">putToUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">dynamic</span></span> body<span class="token punctuation">,</span> <span class="token punctuation">{</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">&gt;</span> args<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">putAs</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">dynamic</span></span> body<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token class-name">Map<span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> args<span class="token punctuation">,</span> T responseAs<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">patch</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> request<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token class-name"><span class="token keyword">dynamic</span></span> body<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">&gt;</span> args<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span>Map<span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">patchToUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">dynamic</span></span> body<span class="token punctuation">,</span> <span class="token punctuation">{</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">&gt;</span> args<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">patchAs</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">dynamic</span></span> body<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token class-name">Map<span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> args<span class="token punctuation">,</span> T responseAs<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span>List<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">sendAll</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">Iterable<span class="token punctuation">&lt;</span>IReturn<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> requests<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span><span class="token keyword">void</span><span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">sendAllOneWay</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">Iterable<span class="token punctuation">&lt;</span>IReturn<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> requests<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token return-type class-name">Future<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">send</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> request<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token class-name">String</span> method<span class="token punctuation">,</span> <span class="token class-name">Map<span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token punctuation">&gt;</span></span> args<span class="token punctuation">,</span> T responseAs<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="concrete-specific-functionality" tabindex="-1">Concrete-specific functionality <a class="header-anchor" href="#concrete-specific-functionality" aria-hidden="true">#</a></h4><p>In addition to implementing the <code>IServiceClient</code> above, each Service Client includes additional concrete specific functionality allowing for finer-grained access to their underlying HTTP Clients, e.g. as the Request/Response filters have different Type signatures (dart:io&#39;s <code>HttpClientResponse</code> vs Browser&#39;s <code>Response</code>) they can&#39;t be declared in the shared <code>IServiceClient</code> interface, but thanks to Dart&#39;s type inference many of the extended concrete APIs are still source-compatible, e.g:</p><div class="language-dart"><pre><code><span class="token keyword">var</span> vmClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span>responseFilter <span class="token operator">=</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&quot;X-Args&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> webClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonWebClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span>responseFilter <span class="token operator">=</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&quot;X-Args&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="comprehensive-test-suite" tabindex="-1">Comprehensive Test Suite <a class="header-anchor" href="#comprehensive-test-suite" aria-hidden="true">#</a></h4><p>To ensure a high quality implementation we&#39;ve ported the <a href="https://github.com/ServiceStack/servicestack-client" target="_blank" rel="noopener noreferrer">TypeScript @servicestack/client</a> test suite over to Dart which is itself a good resource for discovering <a href="https://github.com/ServiceStack/servicestack-dart/tree/master/test" target="_blank" rel="noopener noreferrer">different supported features and flexible HTTP Request options</a> available.</p><h3 id="helloflutter-app" tabindex="-1">HelloFlutter App <a class="header-anchor" href="#helloflutter-app" aria-hidden="true">#</a></h3><p>To showcase popular API Requests in action we&#39;ve created a basic <a href="https://github.com/ServiceStackApps/HelloFlutter" target="_blank" rel="noopener noreferrer">HelloFlutter</a> App that mimics functionality in the <a href="https://github.com/ServiceStackApps/HelloMobile" target="_blank" rel="noopener noreferrer">HelloMobile</a> App used to provide working examples of the same ServiceStack Service Client features running in the different supported Mobile and Desktop platforms.</p><p><a href="https://github.com/ServiceStackApps/HelloFlutter" target="_blank" rel="noopener noreferrer">HelloFlutter</a> was created in VS Code with the <a href="https://dartcode.org" target="_blank" rel="noopener noreferrer">DartCode extension</a> using the <a href="https://flutter.io/get-started/test-drive/#vscode" target="_blank" rel="noopener noreferrer">Flutter: New Project</a> action in VS Code&#39;s Command Palette.</p><p>This creates a basic Flutter App which you can run in your Android Device or Android Emulator where it&#39;s automatically picked and made visible in the <strong>bottom right</strong> of VS Code&#39;s status bar.</p><p>Then to use <code>JsonServiceClient</code> add the <code>servicestack</code> dependency to your apps <a href="https://github.com/ServiceStackApps/HelloFlutter/blob/master/pubspec.yaml" target="_blank" rel="noopener noreferrer">pubspec.yaml</a>:</p><p>dependencies: servicestack: ^1.0.8</p><p>Saving <code>pubspec.yaml</code> automatically runs <a href="https://flutter.io/using-packages/" target="_blank" rel="noopener noreferrer">flutter packages get</a> to install any new dependencies in your App.</p><p>Our App will be making API calls to 2 different ServiceStack instances which we&#39;ll need to get typed DTOs for using the <code>dart-ref</code> command-line utility:</p><pre><code>cd lib
dart-ref https://techstacks.io
dart-ref http://test.servicestack.net test
</code></pre><p>Which will save the DTOs for each endpoint in different files:</p><pre><code>Saved to: techstacks.dtos.dart
Saved to: test.dtos.dart
</code></pre><p>Incidentally you can get the latest version for all Dart Service References by running <code>dart-ref</code> without arguments:</p><pre><code>dart-ref
</code></pre><p>Which updates all Dart references in the current directory, including any customization options available in the header of each file:</p><pre><code>Updated: test.dtos.dart
Updated: techstacks.dtos.dart
</code></pre><p>This gives us everything we need to call Web Services in our Flutter App, by importing <code>package:servicestack/client.dart</code> containing <code>JsonServiceClient</code> as well as any generated DTOs.</p><p>Then create new <code>JsonServiceClient</code> instances initialized with the <code>BaseUrl</code> for each of the remote endpoints we want to call:</p><div class="language-dart"><pre><code><span class="token keyword">import</span> <span class="token string">&#39;package:servicestack/client.dart&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&#39;test.dtos.dart&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&#39;techstacks.dtos.dart&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token class-name">TestBaseUrl</span> <span class="token operator">=</span> <span class="token string">&quot;http://test.servicestack.net&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token class-name">TechStacksBaseUrl</span> <span class="token operator">=</span> <span class="token string">&quot;https://techstacks.io&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> testClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonServiceClient</span><span class="token punctuation">(</span><span class="token class-name">TestBaseUrl</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> techstacksClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonServiceClient</span><span class="token punctuation">(</span><span class="token class-name">TechStacksBaseUrl</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="helloflutter-ui" tabindex="-1">HelloFlutter UI <a class="header-anchor" href="#helloflutter-ui" aria-hidden="true">#</a></h3><p>Flutter works similarly to React and React Native where you need to return the entire UI layout for your Widget in its <code>Widget build(BuildContext context)</code> method, akin to React&#39;s <code>render()</code> method. For complete reference the app is contained in <a href="https://github.com/ServiceStackApps/HelloFlutter/blob/master/lib/main.dart" target="_blank" rel="noopener noreferrer">lib/main.dart</a>, but for clarity we&#39;ll just highlight the relevant parts in each section.</p><p>Our widget requires some state to render its UI so our widget needs to inherit <code>StatefulWidget</code>. Stateful widgets require an additional supporting class for reasons <a href="https://github.com/flutter/flutter/issues/8794" target="_blank" rel="noopener noreferrer">explained in this Thread</a>:</p><blockquote><p>With a stateful widget, it&#39;s common to make closures whose life cycle are tied to the state&#39;s life cycle, which lasts through multiple widgets. With a stateless widget, it&#39;s common to make closures whose life cycle are tied to the widget&#39;s life cycle, which doesn&#39;t cause a problem.</p></blockquote><p>Ultimately this results in following the same dual class pattern below where the <code>HelloFlutterState</code> defines the state it needs as instance fields, this state is preserved across Hot Module reloads which is how Dart can update a live running App despite the implementation of the class changing.</p><div class="language-dart"><pre><code><span class="token keyword">class</span> <span class="token class-name">HelloFlutter</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StatefulWidget</span><span class="token punctuation">&gt;</span></span> <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">new</span> <span class="token class-name">HelloFlutterState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">HelloFlutterState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HelloFlutter</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token comment">//State for this widget</span>
  <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  <span class="token class-name">Uint8List</span> imageBytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8List</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token comment">//...</span>
      <span class="token keyword">new</span> <span class="token class-name">RaisedButton</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Async&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token keyword">await</span> testClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Async&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result <span class="token operator">=</span> r<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>

      <span class="token comment">//...</span>
      result <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> result <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> 
          <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> 
          <span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">.</span><span class="token function">memory</span><span class="token punctuation">(</span>imageBytes<span class="token punctuation">,</span> width<span class="token punctuation">:</span><span class="token number">500.0</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span><span class="token number">170.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>HelloFlutter&#39;s UI consists of 6 buttons across the top of the screen and an area to display the results of each call in the Widget&#39;s body. Each of the example Requests will populate either the <code>result</code> String for standard JSON responses or <code>imageBytes</code> for the <code>HelloImage</code> Service returning binary data.</p><h4 id="standard-api-requests" tabindex="-1">Standard API Requests <a class="header-anchor" href="#standard-api-requests" aria-hidden="true">#</a></h4><p>The first <strong>Async</strong> example shows an example of the most popular API Request for calling ServiceStack Services, simply by sending a populated Request DTO that returns a populated Response DTO, in this case sending a <code>Hello</code> Request DTO that returns a <code>HelloResponse</code> DTO:</p><div class="language-dart"><pre><code><span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token keyword">await</span> testClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Async&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  result <span class="token operator">=</span> r<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To update the UI any modified State needs to be done within the <code>setState((){ })</code> closure which triggers re-rendering of the Widget with the new state.</p><p>This results in displaying the contents of the <code>result</code> String in a <code>Text</code> widget that was returned by the remote <code>Hello</code> Service:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dart/flutter/helloflutter-01.png" alt=""></p><h4 id="authenticated-requests" tabindex="-1">Authenticated Requests <a class="header-anchor" href="#authenticated-requests" aria-hidden="true">#</a></h4><p>This example shows how to make Authenticated Requests where first the <code>JsonServiceClient</code> instance is authenticated by sending a <code>Authenticate</code> request with valid Username/Password credentials which is validated against the servers configured <a href="/authentication-and-authorization.html#auth-providers">CredentialsAuthProvider</a>. If successful this will return <a href="/sessions.html">Session Cookies</a> containing a reference to the Authenticated UserSession stored on the server. The Cookies are automatically saved on the <code>JsonServiceClient</code> instance and re-sent on subsequent requests which is how it&#39;s able to make an Authenticated request to the <a href="https://github.com/ServiceStack/Test/blob/3cc559d8de79e1c70ff7f4327458040ca055dea3/src/Test/Test.ServiceInterface/TestAuthService.cs#L18-L19" target="_blank" rel="noopener noreferrer">protected <code>HelloAuth</code> Service</a>:</p><div class="language-dart"><pre><code><span class="token keyword">new</span> <span class="token class-name">RaisedButton</span><span class="token punctuation">(</span>
  child<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Auth&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>

    <span class="token keyword">var</span> auth <span class="token operator">=</span> <span class="token keyword">await</span> testClient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Authenticate</span><span class="token punctuation">(</span>
        provider<span class="token punctuation">:</span> <span class="token string">&quot;credentials&quot;</span><span class="token punctuation">,</span>
        userName<span class="token punctuation">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
        password<span class="token punctuation">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token keyword">await</span> testClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HelloAuth</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Auth&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">=</span> <span class="token string">&quot;\${r.result} your JWT is: \${auth.bearerToken}&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><p>If the Username and Password were valid it will display the result of the <code>HelloAuth</code> Service along with the encapsulated JWT Token returned in the initial <code>AuthenticateResponse</code> call.</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dart/flutter/helloflutter-02.png" alt=""></p><p>JWT&#39;s encapsulate a signed, stateless Authenticated UserSession which is able to Authenticate with remote Services that have an <code>JwtAuthProvider</code> registered with the same AES or RSA Key used to sign the JWT Token. As they enable <a href="/jwt-authprovider.html#stateless-auth-microservices">Authentication with stateless Services they&#39;re ideal for use in Microservices</a>.</p><h4 id="jwt-refreshtoken-requests" tabindex="-1">JWT RefreshToken Requests <a class="header-anchor" href="#jwt-refreshtoken-requests" aria-hidden="true">#</a></h4><p>The JWT sample shows an example of authenticating via JWT, but instead of configuring the <code>JsonServiceClient</code> instance with the JWT BearerToken above (and what&#39;s needed to make JWT Authenticated Requests), it&#39;s only populating the <a href="/jwt-authprovider.html#refresh-tokens">long-lived RefreshToken</a> which the client automatically uses behind the scenes to fetch a new JWT Bearer Token from the remote ServiceStack endpoint, which if the User is still allowed to Sign In will populate the instance with a new JWT Bearer Token encapsulated with the latest UserSession.</p><div class="language-dart"><pre><code><span class="token keyword">new</span> <span class="token class-name">RaisedButton</span><span class="token punctuation">(</span>
  child<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string">&quot;JWT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> auth <span class="token operator">=</span> <span class="token keyword">await</span> testClient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Authenticate</span><span class="token punctuation">(</span>
        provider<span class="token punctuation">:</span> <span class="token string">&quot;credentials&quot;</span><span class="token punctuation">,</span>
        userName<span class="token punctuation">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
        password<span class="token punctuation">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> newClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonServiceClient</span><span class="token punctuation">(</span><span class="token class-name">TestBaseUrl</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span>refreshToken <span class="token operator">=</span> auth<span class="token punctuation">.</span>refreshToken<span class="token punctuation">;</span>
    
    <span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token keyword">await</span> newClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HelloAuth</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">&quot;JWT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">=</span> <span class="token string">&quot;\${r.result} your RefreshToken is: \${auth.refreshToken}&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><p>The RefreshToken is smaller than a JWT Bearer Token as it just contains a signed token with permission to fetch new JWT Tokens and not the actual UserSession contained in the JWT Bearer Token.</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dart/flutter/helloflutter-03.png" alt=""></p><h4 id="autoquery-requests" tabindex="-1">AutoQuery Requests <a class="header-anchor" href="#autoquery-requests" aria-hidden="true">#</a></h4><p><a href="/autoquery-rdbms.html">AutoQuery</a> lets us effortlessly creating queryable high-performance RDBMS APIs with just a Request DTO class definition, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/technology/search&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FindTechnologies</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">QueryDb<span class="token punctuation">&lt;</span>Technology<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> NameContains <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ServiceStack takes care of creating the implementation for this Service from this definition which queries the <code>Technology</code> RDBMS table.</p><p>Any properties added to the AutoQuery Request DTO will be generated in the Dart <code>FindTechnologies</code> Request DTO. However AutoQuery also lets you query any other property on the <code>Technology</code> table using any of the configured <a href="/autoquery-rdbms.html#implicit-conventions">Implicit Conventions</a>.</p><p>We can include any additional arguments that are not explicitly defined on the Request DTO using the optional <code>args</code> parameter available in each <code>IServiceClient</code> API.</p><p>This examples calls 2 different AutoQuery Services, first to retrieve the <strong>Flutter</strong> <code>Technology</code> in <a href="https://techstacks.io" target="_blank" rel="noopener noreferrer">https://techstacks.io</a> to retrieve its <code>id</code> which it uses to query the latest <code>Announcement</code> or <code>Showcase</code> posted in the <strong>Flutter</strong> organization:</p><div class="language-dart"><pre><code><span class="token keyword">new</span> <span class="token class-name">RaisedButton</span><span class="token punctuation">(</span>
  child<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Query&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">var</span> techs <span class="token operator">=</span> <span class="token keyword">await</span> techstacksClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FindTechnologies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&quot;slug&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;flutter&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">var</span> posts <span class="token operator">=</span> <span class="token keyword">await</span> techstacksClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryPosts</span><span class="token punctuation">(</span>
        anyTechnologyIds<span class="token punctuation">:</span> <span class="token punctuation">[</span>techs<span class="token punctuation">.</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span>
        types<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;Announcement&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Showcase&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span>take <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">=</span> <span class="token string">&quot;Latest Flutter Announcement:\\n\u201C\${posts.results[0].title}\u201D&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><p>The 2nd Request calls the <code>QueryPosts</code> AutoQuery Service highlighting the Service Client&#39;s support for <a href="/serialization-deserialization.html#passing-complex-objects-in-the-query-string">sending complex type arguments on the QueryString</a> and an example of using Dart&#39;s method cascade operator to populate the <code>take</code> field in the <a href="/autoquery-rdbms.html#iquery">inherited QueryBase class</a>.</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dart/flutter/helloflutter-04.png" alt=""></p><h4 id="auto-batched-requests" tabindex="-1">Auto Batched Requests <a class="header-anchor" href="#auto-batched-requests" aria-hidden="true">#</a></h4><p>The <code>sendAll</code> and <code>sendAllOneWay</code> APIs lets you use ServiceStack&#39;s <a href="/auto-batched-requests.html">Auto Batched Requests</a> feature to batch multiple Requests DTOs of the same Type in a single Request that returns all Responses in a single Response, e.g:</p><div class="language-dart"><pre><code><span class="token keyword">new</span> <span class="token class-name">RaisedButton</span><span class="token punctuation">(</span>
  child<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Batch&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">var</span> requests <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;bar&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;qux&#39;</span><span class="token punctuation">]</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">var</span> responses <span class="token operator">=</span> <span class="token keyword">await</span> testClient<span class="token punctuation">.</span><span class="token function">sendAll</span><span class="token punctuation">(</span>requests<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">=</span> <span class="token string">&quot;Batch Responses:\\n\${responses.map((r) =&gt; r.result).join(&#39;\\n&#39;)}&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dart/flutter/helloflutter-05.png" alt=""></p><h4 id="generating-unknown-types" tabindex="-1">Generating Unknown Types <a class="header-anchor" href="#generating-unknown-types" aria-hidden="true">#</a></h4><p>This is one area where we hit limitations of not being able to use Reflection in Dart which requires generating factories ahead-of-time for each type we need to create instances of at runtime. This is typically inferred by inspecting all Types referenced in each DTO, but as Auto Batched Requests lets you combine multiple requests for every Service, in the interest for reducing the amount of code-generation needed ServiceStack doesn&#39;t generate an explicit Service Contract for the Batched version of each API.</p><p>Instead you&#39;ll need to specify missing types needed, the easiest solution to do this is to create a Dummy Service containing properties of any missing Types needed, in this case we need to generate a factory for the <code>List&lt;HelloResponse&gt;</code> used to return the batched <code>HelloResponse</code> DTOs in:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DummyTypes</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>HelloResponse<span class="token punctuation">&gt;</span></span> HelloResponses <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DummyTypesService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">DummyTypes</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> request<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="binary-requests" tabindex="-1">Binary Requests <a class="header-anchor" href="#binary-requests" aria-hidden="true">#</a></h4><p>Most API Requests typically involve sending a populated Request DTO that returns a Typed Response DTO although ServiceStack Services can also <a href="/service-return-types.html">return raw data</a> like <code>String</code>, <code>byte[]</code> and <code>Stream</code> responses which the <code>JsonServiceClient</code> also seamlessly supports where instead of returning a Typed DTO it returns the raw HTTP Body as a <code>String</code> for Request DTOs implementing <code>IReturn&lt;String&gt;</code> or an <code>Uint8List</code> for any binary responses (e.g. Services implementing <code>IReturn&lt;byte[]&gt;</code> or <code>IReturn&lt;Stream&gt;</code>).</p><p>This example calls the <a href="https://github.com/ServiceStack/Test/blob/90678a1d57ac63daaafea7322e0a4f542a93488f/src/Test/Test.ServiceInterface/ImageService.cs#L137" target="_blank" rel="noopener noreferrer"><code>HelloImage</code> Service</a> which dynamically creates and returns an image based on the different properties on the incoming <code>HelloImage</code> Request DTO. As it implements <code>IReturn&lt;byte[]&gt;</code> the <code>JsonServiceClient</code> returns the binary contents of the HTTP Response in a <code>Uint8List</code> - the preferred type for bytes in Dart.</p><div class="language-dart"><pre><code><span class="token keyword">new</span> <span class="token class-name">RaisedButton</span><span class="token punctuation">(</span>
  child<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Image&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>

    <span class="token class-name">Uint8List</span> bytes <span class="token operator">=</span> <span class="token keyword">await</span> testClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HelloImage</span><span class="token punctuation">(</span>
        name<span class="token punctuation">:</span> <span class="token string">&quot;Flutter&quot;</span><span class="token punctuation">,</span>
        fontFamily<span class="token punctuation">:</span> <span class="token string">&quot;Roboto&quot;</span><span class="token punctuation">,</span>
        background<span class="token punctuation">:</span> <span class="token string">&quot;#0091EA&quot;</span><span class="token punctuation">,</span>
        width<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">170</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
      imageBytes <span class="token operator">=</span> bytes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token comment">//...</span>
result <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> result <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> 
    <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> 
    <span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">.</span><span class="token function">memory</span><span class="token punctuation">(</span>imageBytes<span class="token punctuation">,</span> width<span class="token punctuation">:</span><span class="token number">500.0</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span><span class="token number">170.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><p>To display the image we assign the response to the <code>imageBytes</code> field within the stateful widget&#39;s <code>setState()</code> which triggers a re-render of the UI containing the generated Image displayed using the <a href="https://docs.flutter.io/flutter/widgets/Image-class.html" target="_blank" rel="noopener noreferrer">Image widget</a>:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dart/flutter/helloflutter-06.png" alt=""></p><h3 id="angular-dart" tabindex="-1">Angular Dart <a class="header-anchor" href="#angular-dart" aria-hidden="true">#</a></h3><p>The <a href="https://github.com/ServiceStackApps/HelloAngularDart" target="_blank" rel="noopener noreferrer">HelloAngularDart</a> project demonstrates the same functionality in an AngularDart Web App running inside a Web Browser.</p><p>The only difference is having to import <code>web_client.dart</code> containing the <code>JsonWebClient</code>:</p><div class="language-dart"><pre><code><span class="token keyword">import</span> <span class="token string">&#39;package:servicestack/web_client.dart&#39;</span><span class="token punctuation">;</span>
</code></pre></div><p>and changing the clients to use the <code>JsonWebClient</code> instead, e.g:</p><div class="language-dart"><pre><code><span class="token keyword">var</span> testClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonWebClient</span><span class="token punctuation">(</span><span class="token class-name">TestBaseUrl</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> techstacksClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonWebClient</span><span class="token punctuation">(</span><span class="token class-name">TechStacksBaseUrl</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>But otherwise the actual client source code for all of the Typed API requests remains exactly the same.</p><p>The <code>HelloAngularDart</code> App is contained within the <a href="https://github.com/ServiceStackApps/HelloAngularDart/tree/master/lib/src/hello_world" target="_blank" rel="noopener noreferrer">hello_world</a> component with all Dart logic in:</p><h4 id="hello-world-dart" tabindex="-1"><a href="https://github.com/ServiceStackApps/HelloAngularDart/blob/master/lib/src/hello_world/hello_world.dart" target="_blank" rel="noopener noreferrer">hello_world.dart</a> <a class="header-anchor" href="#hello-world-dart" aria-hidden="true">#</a></h4><div class="language-dart"><pre><code><span class="token keyword">import</span> <span class="token string">&#39;dart:typed_data&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&#39;dart:convert&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&#39;package:angular/angular.dart&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&#39;package:servicestack/web_client.dart&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&#39;../dtos/test.dtos.dart&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&#39;../dtos/techstacks.dtos.dart&#39;</span><span class="token punctuation">;</span>

@<span class="token class-name">Component</span><span class="token punctuation">(</span>
  selector<span class="token punctuation">:</span> <span class="token string">&#39;hello-world&#39;</span><span class="token punctuation">,</span>
  styleUrls<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token string">&#39;hello_world.css&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  templateUrl<span class="token punctuation">:</span> <span class="token string">&#39;hello_world.html&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">HelloWorldComponent</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> imageSrc <span class="token operator">=</span> <span class="token string">&quot;data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 1x1 pixel</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token class-name">TestBaseUrl</span> <span class="token operator">=</span> <span class="token string">&quot;http://test.servicestack.net&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token class-name">TechStacksBaseUrl</span> <span class="token operator">=</span> <span class="token string">&quot;https://techstacks.io&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> testClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonWebClient</span><span class="token punctuation">(</span><span class="token class-name">TestBaseUrl</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> techstacksClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonWebClient</span><span class="token punctuation">(</span><span class="token class-name">TechStacksBaseUrl</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">doAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token keyword">await</span> testClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Async&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> r<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">doAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> auth <span class="token operator">=</span> <span class="token keyword">await</span> testClient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Authenticate</span><span class="token punctuation">(</span>
        provider<span class="token punctuation">:</span> <span class="token string">&quot;credentials&quot;</span><span class="token punctuation">,</span> userName<span class="token punctuation">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token keyword">await</span> testClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HelloAuth</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Auth&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token string">&quot;\${r.result} your JWT is: \${auth.bearerToken}&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">doJWT</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> auth <span class="token operator">=</span> <span class="token keyword">await</span> testClient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Authenticate</span><span class="token punctuation">(</span>
        provider<span class="token punctuation">:</span> <span class="token string">&quot;credentials&quot;</span><span class="token punctuation">,</span> userName<span class="token punctuation">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> newClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonWebClient</span><span class="token punctuation">(</span><span class="token class-name">TestBaseUrl</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span>refreshToken <span class="token operator">=</span> auth<span class="token punctuation">.</span>refreshToken<span class="token punctuation">;</span>
    <span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token keyword">await</span> newClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HelloAuth</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">&quot;JWT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token string">&quot;\${r.result} your RefreshToken is: \${auth.refreshToken}&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">doQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> techs <span class="token operator">=</span> <span class="token keyword">await</span> techstacksClient
        <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FindTechnologies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&quot;slug&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;flutter&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> posts <span class="token operator">=</span> <span class="token keyword">await</span> techstacksClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryPosts</span><span class="token punctuation">(</span>
        anyTechnologyIds<span class="token punctuation">:</span> <span class="token punctuation">[</span>techs<span class="token punctuation">.</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span>
        types<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;Announcement&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Showcase&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span>take <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token string">&quot;Latest Flutter Announcement:\\n\u201C\${posts.results[0].title}\u201D&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">doBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> requests <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;bar&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;qux&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> responses <span class="token operator">=</span> <span class="token keyword">await</span> testClient<span class="token punctuation">.</span><span class="token function">sendAll</span><span class="token punctuation">(</span>requests<span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token string">&quot;Batch Responses:\\n\${responses.map((r) =&gt; r.result).join(&#39;\\n&#39;)}&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">doImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token class-name">Uint8List</span> bytes <span class="token operator">=</span> <span class="token keyword">await</span> testClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HelloImage</span><span class="token punctuation">(</span>
        name<span class="token punctuation">:</span> <span class="token string">&quot;Flutter&quot;</span><span class="token punctuation">,</span>
        fontFamily<span class="token punctuation">:</span> <span class="token string">&quot;Roboto&quot;</span><span class="token punctuation">,</span>
        background<span class="token punctuation">:</span> <span class="token string">&quot;#0091EA&quot;</span><span class="token punctuation">,</span>
        width<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">170</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    result <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    imageSrc <span class="token operator">=</span> <span class="token string">&quot;data:image/png;base64,&quot;</span> <span class="token operator">+</span> base64<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="hello-world-html" tabindex="-1"><a href="https://github.com/ServiceStackApps/HelloAngularDart/blob/master/lib/src/hello_world/hello_world.html" target="_blank" rel="noopener noreferrer">hello_world.html</a> <a class="header-anchor" href="#hello-world-html" aria-hidden="true">#</a></h4><p>Which uses this template markup to render its UI:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>doAsync()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Async<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>doAuth()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Auth<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>doJWT()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>JWT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>doQuery()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Query<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>doBatch()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Batch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>doImage()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Image<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>result<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{result}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{imageSrc}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Where it runs a functionally equivalent App in a browser:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/dart/angulardart/helloangulardart-01.png" alt=""></p><h2 id="swift" tabindex="-1">Swift <a class="header-anchor" href="#swift" aria-hidden="true">#</a></h2><p><a href="/swift-add-servicestack-reference.html">Swift Add ServiceStack Reference</a> was upgraded to use <a href="https://github.com/mxcl/PromiseKit" target="_blank" rel="noopener noreferrer">PromiseKit v5.0.6</a> which introduced a few breaking changes that they&#39;ve documented in their <a href="http://promisekit.org/news/2018/02/PromiseKit-6.0-Released/" target="_blank" rel="noopener noreferrer">Migration Guide</a>. The main breaking change we&#39;ve found was <a href="http://promisekit.org/news/2018/02/PromiseKit-6.0-Released/#why-promisekit-56" target="_blank" rel="noopener noreferrer">renaming some <code>then</code> overloads to <code>done</code> or <code>map</code></a>, from their migration guide:</p><blockquote><p>With PromiseKit our <code>then</code> did multiple things, and we relied on Swift to infer the correct <code>then</code> from context. However with multiple line <code>then</code>s it would fail to do this, and instead of telling you that the situation was ambiguous it would invent some other error. Often the dreaded <code>cannot convert T to AnyPromise</code>. We have a troubleshooting guide to combat this but I believe in tools that just work, and when you spend 4 years waiting for Swift to fix the issue and Swift doesn\u2019t fix the issue, what do you do? We chose to find a solution at the higher level.</p></blockquote><blockquote><p>So we split <code>then</code> into <code>then</code>, <code>done</code> and <code>map</code>.</p></blockquote><ul><li><code>then</code> is fed the previous promise value and requires you return a promise.</li><li><code>done</code> is fed the previous promise value and returns a Void promise (which is 80% of chain usage)</li><li><code>map</code> is fed the previous promise value and requires you return a non-promise, ie. a value.</li></ul><h2 id="kotlin" tabindex="-1">Kotlin <a class="header-anchor" href="#kotlin" aria-hidden="true">#</a></h2><p>A new version of the <a href="/kotlin-add-servicestack-reference.html">Kotlin ServiceStack Client</a> was published to work with the latest version of Kotlin.</p><h2 id="new-single-page-app-templates" tabindex="-1">New Single Page App Templates! <a class="header-anchor" href="#new-single-page-app-templates" aria-hidden="true">#</a></h2><p>We&#39;re continually on the lookout to provide great integration with the most productive and innovative technology stacks for developing sophisticated Web Apps. For most of the .NET ecosystem this typically means using Razor to develop server-generated HTML Websites. But Razor is rarely our preferred choice, in cases where we&#39;d want to develop server-generated websites (e.g. for Content Heavy websites) we&#39;ll prefer to use the much simpler and dependency/tooling free <a href="https://sharpscript.net" target="_blank" rel="noopener noreferrer">#Script</a> whilst for the development of more complex and interactive Applications we prefer to leverage one of the popular SPA JavaScript Frameworks as it&#39;s where most of the innovation in front-end Web Development is happening.</p><p>In addition to their thriving ecosystems and superior tooling, adopting a Single Page App Framework enables an <a href="/why-not-razor.html#end-user-language-with-low-roi">API First Development model</a> where you&#39;ll be able to develop the same set of APIs to serve all Web, Mobile and Desktop Apps. In our ever-increasing mobile world this trait is becoming more valuable with each passing year. Consolidating server functionality for powering all Apps behind a single set of APIs reduces the maintenance and development burden whilst being able to deploy new system features that are immediately accessible to each App.</p><p>We&#39;re happy to add new integrated SPA Templates for <a href="https://nuxtjs.org" target="_blank" rel="noopener noreferrer">Nuxt.js</a> and <a href="https://vuetifyjs.com" target="_blank" rel="noopener noreferrer">Vuetify</a> in this release - 2 exciting new frameworks which make development of a large class of Web Apps both simpler and faster.</p><h2 id="nuxt-js" tabindex="-1"><a href="https://github.com/NetCoreTemplates/vue-nuxt" target="_blank" rel="noopener noreferrer">Nuxt.js</a> <a class="header-anchor" href="#nuxt-js" aria-hidden="true">#</a></h2><p><a href="https://github.com/NetCoreTemplates/vue-nuxt" target="_blank" rel="noopener noreferrer"><img src="https://raw.githubusercontent.com/ServiceStack/Assets/master/csharp-templates/vue-nuxt.png" alt=""></a></p><p>If you&#39;ve been intimidated with amount of complexity and knowledge required to develop an App using one of the major JS frameworks, we highly recommend evaluating Nuxt.js. Nuxt is an opinionated framework that integrates the most popular Vue components together in a pre-configured solution. It&#39;s like developing within guard rails where it lets you develop entire websites using just <a href="https://vuejs.org/v2/guide/single-file-components.html" target="_blank" rel="noopener noreferrer">Vue Single File Components</a> placed in a <a href="https://nuxtjs.org/guide/routing" target="_blank" rel="noopener noreferrer">conventional file and directory structure</a> where Nuxt will take care of managing the routing and abstracts away the build configuration to generate optimal production builds where it employs advanced packaging techniques like automatic code splitting, link prefetching, SPA navigation of statically-generated cacheable assets and integrated support for ES6/7 transpilation, linting and js/css bundling and minification.</p><p>Its watched builds enables Hot Module Replacement to enable the optimal development experience where it you will be able to see changes in real-time without needing to manually build or refresh pages. The Nuxt templates are also configured to support <a href="/templates-websites.html#watched-net-core-builds">.NET Core&#39;s watched builds</a> which automatically detects changes to your .NET Core App and re-compiles and restarts them with the new changes.</p><h3 id="servicestack-integration" tabindex="-1">ServiceStack Integration <a class="header-anchor" href="#servicestack-integration" aria-hidden="true">#</a></h3><p>Whilst Nuxt and ServiceStack are 2 different frameworks, we&#39;ve combined them in a single seamlessly integrated .NET Core project. ServiceStack shines here where as the <a href="/typescript-add-servicestack-reference.html#typescript-serviceclient">TypeScript JsonServiceClient</a> utilizes ServiceStack&#39;s <a href="/routing.html#pre-defined-routes">pre-defined Routes</a> we can proxy all JSON API requests to our .NET Core App with a single config in <a href="https://github.com/NetCoreTemplates/vue-nuxt/blob/master/MyApp/nuxt.config.js" target="_blank" rel="noopener noreferrer">nuxt.config.js</a> and an additional entry to proxy links to any configured <a href="/authentication-and-authorization.html#oauth-providers">OAuth Providers</a>:</p><div class="language-js"><pre><code>  proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&#39;/json&#39;</span><span class="token operator">:</span> <span class="token string">&#39;http://localhost:5000/&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;/auth&#39;</span><span class="token operator">:</span> <span class="token string">&#39;http://localhost:5000/&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>This lets us use Nuxt&#39;s Web Dev Server during development to take advantage of its incremental compilation, Live Reloading and instant UI updates.</p><h3 id="getting-started" tabindex="-1">Getting Started <a class="header-anchor" href="#getting-started" aria-hidden="true">#</a></h3><p>To experience App development with Nuxt.js, create a new Nuxt Project using <a href="/dotnet-new.html">dotnet-new</a>:</p><pre><code>$ dotnet-new vue-nuxt ProjectName
</code></pre><p>Download npm and .NET Core dependencies:</p><pre><code>$ npm install
$ dotnet restore
</code></pre><h3 id="dev-workflow" tabindex="-1">Dev Workflow <a class="header-anchor" href="#dev-workflow" aria-hidden="true">#</a></h3><p>Start a <a href="/templates-websites.html#watched-net-core-builds">watched .NET Core build</a> in the background from the command-line with:</p><pre><code>$ dotnet watch run
</code></pre><p>In a new terminal window start a watched Nuxt dev server build with:</p><pre><code>$ npm run dev
</code></pre><p>Then open <code>http://localhost:3000</code> in your browser to view your App served directly from Nuxt&#39;s dev server which will proxy all Server requests to ServiceStack Server running on <code>http://localhost:5000</code>. Any changes you make to your front-end will be automatically re-compiled and reloaded by the watched <code>Nuxt</code> build whilst any changes to your Server app will be automatically be rebuilt and restarted by the watched <code>dotnet</code> process.</p><h3 id="update-dtos" tabindex="-1">Update DTOs <a class="header-anchor" href="#update-dtos" aria-hidden="true">#</a></h3><p>Whilst Nuxt is a JavaScript (ES 6/7) App it still benefits from ServiceStack&#39;s <a href="/typescript-add-servicestack-reference.html">TypeScript Add Reference feature</a> where you can generate typed DTOs with the <code>dtos</code> npm script:</p><pre><code>$ npm run dtos
</code></pre><p>This will update the Servers <code>dtos.ts</code> and generate its corresponding <code>dtos.js</code> which can be natively imported as seen in <a href="https://github.com/NetCoreTemplates/vue-nuxt/blob/master/MyApp/src/shared/gateway.js#L3" target="_blank" rel="noopener noreferrer">gateway.js</a>. Despite the App not being built with TypeScript, developing using a &quot;TypeScript-aware&quot; IDE like VS Code will still be able to utilize the generated <code>dtos.ts</code> to provide a rich intelli-sense experience.</p><h3 id="generate-static-production-build" tabindex="-1">Generate Static Production Build <a class="header-anchor" href="#generate-static-production-build" aria-hidden="true">#</a></h3><p>Most of the time during development you&#39;ll be viewing your App through Nuxt&#39;s dev server to take advantage of it&#39;s instant UI updates. At any time you can also view a production build of your App with:</p><pre><code>$ npm run build
</code></pre><p>This will generate a static encapsulated production build of your App in .NET Core&#39;s <code>/wwwroot</code> which you can view served from your ServiceStack Server App directly at:</p><ul><li><a href="http://localhost:5000" target="_blank" rel="noopener noreferrer">http://localhost:5000</a></li></ul><h3 id="publishing-app-for-deployment" tabindex="-1">Publishing App for Deployment <a class="header-anchor" href="#publishing-app-for-deployment" aria-hidden="true">#</a></h3><p>To create a complete client and server build of your App run:</p><pre><code>$ npm run publish
</code></pre><p>This publishes your App to <code>bin/Release/netcoreapp2.0/publish</code> that can then be deployed like any normal .NET Core App.</p><h3 id="host-static-content-on-netlify-s-cdn-for-free" tabindex="-1">Host static content on Netlify&#39;s CDN for free <a class="header-anchor" href="#host-static-content-on-netlify-s-cdn-for-free" aria-hidden="true">#</a></h3><p>One of the advantages of using Nuxt is that it generates a front-end UI with static <code>.html</code> files for all pages. This allows the static content of your Web App to be cleanly decoupled from your back-end your Server App and hosted independently on a CDN. Netlify makes this effortless where you can <a href="https://app.netlify.com/signup" target="_blank" rel="noopener noreferrer">Sign In with your GitHub account</a> and get it to create a new Site from a GitHub repository where you can tell it to host the static content in your .NET Core Apps <code>/wwwroot</code> folder on its CDN. It also synchronizes updates with every check-in so it automatically updates whenever you check-in a new version of your .NET Core project.</p><p>Netlify has built first-class support for hosting Single Page Apps like Nuxt where it lets you check-in a <a href="https://www.netlify.com/docs/redirects/" target="_blank" rel="noopener noreferrer">simple _redirects file</a> with all routes you want to be served by your .NET Core App and it will transparently proxy any API requests to your back-end server without needing to enable CORS. So the same .NET Core App that runs locally will be able to run without code changes when deployed despite having all its bandwidth intensive content served directly from Netlify&#39;s CDN. This opens up a nice scalability option for your App Servers, maximizing their efficiency as .NET Core Apps just ends up serving dynamic JSON API requests.</p><h3 id="nuxt-templates" tabindex="-1">Nuxt Templates <a class="header-anchor" href="#nuxt-templates" aria-hidden="true">#</a></h3><p>There are 2 variants of Nuxt templates available for both .NET Core and .NET Framework:</p><p><a href="https://github.com/NetCoreTemplates/vue-nuxt" target="_blank" rel="noopener noreferrer"><img src="https://raw.githubusercontent.com/ServiceStack/Assets/master/csharp-templates/vue-nuxt.png" alt=""></a></p><h4 id="net-core" tabindex="-1">.NET Core <a class="header-anchor" href="#net-core" aria-hidden="true">#</a></h4><ul><li><a href="https://github.com/NetCoreTemplates/vue-nuxt" target="_blank" rel="noopener noreferrer">vue-nuxt</a> - Vue + Nuxt</li><li><a href="https://github.com/NetCoreTemplates/vuetify-nuxt" target="_blank" rel="noopener noreferrer">vuetify-nuxt</a> - Vue + Nuxt + Vuetify</li></ul><h4 id="net-framework" tabindex="-1">.NET Framework <a class="header-anchor" href="#net-framework" aria-hidden="true">#</a></h4><ul><li><a href="https://github.com/NetFrameworkTemplates/vue-nuxt-netfx" target="_blank" rel="noopener noreferrer">vue-nuxt-netfx</a> - Vue + Nuxt</li><li><a href="https://github.com/NetFrameworkTemplates/vuetify-nuxt-netfx" target="_blank" rel="noopener noreferrer">vuetify-nuxt-netfx</a> - Vue + Nuxt + Vuetify</li></ul><h3 id="vuetify" tabindex="-1"><a href="https://vuetifyjs.com/en/" target="_blank" rel="noopener noreferrer">Vuetify</a> <a class="header-anchor" href="#vuetify" aria-hidden="true">#</a></h3><p>Quite simply Vuetify is a suite of rich high-level reusable Vue Components that makes it easy to develop beautiful Material designed applications. In many ways it realizes the promise that <a href="https://www.webcomponents.org/introduction" target="_blank" rel="noopener noreferrer">Web Components</a> were meant to deliver by being able to quickly compose rich Applications from a pre-set of reusable high-level components which have often been marred by their poor integration with the premier JavaScript frameworks Apps are built with.</p><p>We believe Vuetify is one of the best UI Component libraries available which realizes this promise of increased productivity with its broad number of actively maintained and beautifully designed components that offers both a consistent development model and a consistent visual aesthetic that follows <a href="https://material.io/guidelines/" target="_blank" rel="noopener noreferrer">Google&#39;s Material Design</a>. Behind the scenes Vuetify components are just Vue components that can be added to any existing Vue App where you can choose to use as much of or as little of Vuetify components as you&#39;d like.</p><p>Given the productivity value Vuetify adds, we&#39;ve created Vuetify templates for both Vue and Nuxt Single Page App templates for both .NET Core and .NET Framework projects:</p><h4 id="vue-app" tabindex="-1">Vue App <a class="header-anchor" href="#vue-app" aria-hidden="true">#</a></h4><p><a href="https://github.com/NetCoreTemplates/vuetify-spa" target="_blank" rel="noopener noreferrer"><img src="https://raw.githubusercontent.com/ServiceStack/Assets/master/csharp-templates/vuetify-spa.png" alt=""></a></p><ul><li><a href="https://github.com/NetCoreTemplates/vuetify-spa" target="_blank" rel="noopener noreferrer">vuetify-spa</a> - .NET Core 2.0 Vuetify Material Webpack App</li><li><a href="https://github.com/NetFrameworkTemplates/vuetify-spa-netfx" target="_blank" rel="noopener noreferrer">vuetify-spa-netfx</a> - .NET Framework Vuetify Material Webpack App</li></ul><h4 id="vue-nuxt-app" tabindex="-1">Vue Nuxt App <a class="header-anchor" href="#vue-nuxt-app" aria-hidden="true">#</a></h4><p><a href="https://github.com/NetCoreTemplates/vuetify-nuxt" target="_blank" rel="noopener noreferrer"><img src="https://raw.githubusercontent.com/ServiceStack/Assets/master/csharp-templates/vuetify-nuxt.png" alt=""></a></p><ul><li><a href="https://github.com/NetCoreTemplates/vuetify-nuxt" target="_blank" rel="noopener noreferrer">vuetify-nuxt</a> - .NET Core 2.0 Vuetify Material Nuxt.js SPA Web App</li><li><a href="https://github.com/NetFrameworkTemplates/vuetify-nuxt-netfx" target="_blank" rel="noopener noreferrer">vuetify-nuxt-netfx</a> - .NET Framework Vuetify Material Nuxt.js SPA Web App</li></ul><h2 id="the-new-techstacks" tabindex="-1">The New TechStacks <a class="header-anchor" href="#the-new-techstacks" aria-hidden="true">#</a></h2><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/release-notes/techstacks-new.png" alt=""></p><p>Given the impressive development velocity enabled by the Nuxt and Vuetify power combo, we decided to rewrite <a href="https://techstacks.io" target="_blank" rel="noopener noreferrer">https://techstacks.io</a> using it. The <a href="http://angular.techstacks.io" target="_blank" rel="noopener noreferrer">original TechStacks website</a> was built in <strong>2014</strong> with what was considered the state-of-the-art Technology Stack for .NET SPA at the time: i.e. Angular 1.x / Bootstrap Website hosted on .NET&#39;s recommended system software of <a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET</a> / IIS / Windows Server.</p><p>A lot has changed since then, in both the JavaScript and .NET Server ecosystems. <a href="https://angularjs.org" target="_blank" rel="noopener noreferrer">Angular 1.x</a> was surpassed by a complete rewrite of Angular 2+ in TypeScript in its <a href="https://angular.io" target="_blank" rel="noopener noreferrer">latest version</a>. During that time both have since been eclipsed in popularity by <a href="https://github.com/facebook/react" target="_blank" rel="noopener noreferrer">React</a> and <a href="https://github.com/vuejs/vue" target="_blank" rel="noopener noreferrer">Vue</a> with nearly 3x the popularity by stars on GitHub. We like React for true Single Page Apps like IDEs and what we used to <a href="https://github.com/ServiceStack/Gistlyn" target="_blank" rel="noopener noreferrer">develop Gistlyn</a>. But for multi-page Apps we prefer Vue which has a higher fidelity and better encapsulation of HTML pages with its <a href="https://vuejs.org/v2/guide/single-file-components.html" target="_blank" rel="noopener noreferrer">Single File Components</a>.</p><p>Nuxt further enhances Vue with an opinionated convention-based framework that combines the most popular Vue libraries into a unified solution, perfect for multi-page Web Apps like TechStacks. Nuxt provides the prescribed architecture, development model and core functionality whilst Vuetify provides the UI Layout and comprehensive suite of UI Components - combining into an elegant solution that dramatically reduces the development and design effort to develop a Single Page Apps like TechStacks.</p><p>On the .NET side, .NET Core became the future platform for hosting .NET Apps with its leaner, faster and cross-platform runtime. It&#39;s ability to run flawlessly on Linux makes it our default choice for new projects where we readily take advantage of its superior automation and ecosystem.</p><h4 id="before-and-after" tabindex="-1">Before and After <a class="header-anchor" href="#before-and-after" aria-hidden="true">#</a></h4><p>So given the current ecosystem we ported TechStacks to what we consider is the state-of-the-art Technology Stack for developing .NET Apps in <strong>2018</strong>, starting from the .NET Core <a href="https://github.com/NetCoreTemplates/vuetify-nuxt" target="_blank" rel="noopener noreferrer">vuetify-nuxt</a> Template. Visually the before/after Technology Stack for TechStacks is:</p><p><a href="https://techstacks.io/stacks/techstacks/" target="_blank" rel="noopener noreferrer"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/release-notes/techstacks-before-after.png" alt=""></a></p><h3 id="resilience-of-servicestack" tabindex="-1">Resilience of ServiceStack <a class="header-anchor" href="#resilience-of-servicestack" aria-hidden="true">#</a></h3><p>What&#39;s noteworthy about the development of the new TechStacks Website was that despite having a completely rewritten UI on the front-end, running on the new .NET Core Runtime and Linux Operating System on the back-end, the one thing that could be reused as-is was its Services implementation - which speaks to both the timelessness of <a href="/api-design.html">ServiceStack&#39;s API Design</a> for cleanly capturing the intent of its declarative Service Contracts and the near-perfect source-code compatibility with .NET Core - preserving and future-proofing existing ServiceStack investments by making it trivial to port to .NET Core as and when needed.</p><p>Also despite some existing tables being modified to support the expanded feature-set, the <a href="http://angular.techstacks.io" target="_blank" rel="noopener noreferrer">Old TechStacks Website</a> continues to run, using the old OrmLite POCO Data Models to connect to the same database as the New TechStacks Website. This resilience also extends to the existing <a href="https://github.com/ServiceStackApps/TechStacksApp" target="_blank" rel="noopener noreferrer">Swift TechStacks iOS App</a> which continues to run unmodified despite now accessing enhanced modified Services that&#39;s now being proxied through Netlify&#39;s CDN. The primary disruptive change to Services was that they now use .NET Core&#39;s default <strong>camelCase</strong> property names which also doesn&#39;t impact existing iOS Mobile Apps thanks to the <a href="/swift-add-servicestack-reference.html">Swift JsonServiceClient</a> supporting case-insensitive properties.</p><p>For comparison purposes we&#39;re continuing to host the old Website:</p><h4 id="new-techstacks" tabindex="-1">New TechStacks <a class="header-anchor" href="#new-techstacks" aria-hidden="true">#</a></h4><ul><li>URL: <a href="https://techstacks.io" target="_blank" rel="noopener noreferrer">techstacks.io</a></li><li>Source Code: <a href="https://github.com/NetCoreApps/TechStacks" target="_blank" rel="noopener noreferrer">github.com/NetCoreApps/TechStacks</a></li></ul><h4 id="old-techstacks" tabindex="-1">Old TechStacks <a class="header-anchor" href="#old-techstacks" aria-hidden="true">#</a></h4><ul><li>URL: <a href="http://angular.techstacks.io" target="_blank" rel="noopener noreferrer">angular.techstacks.io</a></li><li>Source Code: <a href="https://github.com/ServiceStackApps/TechStacks" target="_blank" rel="noopener noreferrer">github.com/ServiceStackApps/TechStacks</a></li></ul><p>Both code-bases are Open Source and provide a good reference of our preferences in developing a mildly complex medium-sized ServiceStack App which now exceeds <strong>100 Services</strong> to support its expanded feature-set.</p><h3 id="netlify-cdn" tabindex="-1">Netlify CDN <a class="header-anchor" href="#netlify-cdn" aria-hidden="true">#</a></h3><p>One of the goals for TechStacks is to develop an efficient implementation that maximizes the scalability of the App Server. Some of the techniques include utilizing PostgreSQL&#39;s rich data types to minimize/eliminate table joins, Indexes for popular queries, maintenance of manual caches of aggregate query results, simple response caching, etc.</p><p>Another strategy adopted to reduce the load off the App Server is to host the static Nuxt generated website in <code>/wwwroot</code> on Netlify&#39;s CDN as <a href="#host-static-content-on-netlifys-cdn-for-free">described above</a> which is configured to proxy all API requests and built-in ServiceStack features using this <a href="https://github.com/NetCoreApps/TechStacks/blob/master/src/TechStacks/src/static/_redirects" target="_blank" rel="noopener noreferrer">_redirects</a> file.</p><p>Whilst proxying provides the cleanest and most transparent solution, it can add a noticeable sub-second latency to API Requests so we&#39;ve opted instead to <a href="https://github.com/NetCoreApps/TechStacks/blob/17bbcdde189de4c59075942fb3985a2c75da07a1/src/TechStacks/Startup.cs#L255" target="_blank" rel="noopener noreferrer">enable CORS</a> and have API Requests call the App Server directly, done by configuring 2 Service Clients:</p><div class="language-ts"><pre><code><span class="token keyword">const</span> usingProxy <span class="token operator">=</span> location<span class="token punctuation">.</span>host <span class="token operator">==</span> <span class="token string">&quot;techstacks.io&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> BaseUrl <span class="token operator">=</span> usingProxy
    <span class="token operator">?</span> <span class="token string">&quot;https://techstacks.io/&quot;</span>  <span class="token comment">// .NET Core App Server on AWS LightSail</span>
    <span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> AuthBaseUrl <span class="token operator">=</span> usingProxy
    <span class="token operator">?</span> <span class="token string">&quot;https://techstacks.io/&quot;</span>      <span class="token comment">// Netlify</span>
    <span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonServiceClient</span><span class="token punctuation">(</span>BaseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> authClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonServiceClient</span><span class="token punctuation">(</span>AuthBaseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>Where <a href="https://techstacks.io" target="_blank" rel="noopener noreferrer">https://techstacks.io</a> serves the static website hosted from Netlify&#39;s CDN and <a href="https://techstacks.io" target="_blank" rel="noopener noreferrer">https://techstacks.io</a> serves content directly from the App Server via an nginx reverse proxy.</p><p>The different domains means we need to transfer the Authenticated Session that&#39;s attached to the <a href="https://techstacks.io" target="_blank" rel="noopener noreferrer">techstacks.io</a> domain by converting the Authenticated Session into a JWT Token that&#39;s sent to the App Server in parallel requests to retrieve the Authenticated User Info and convert the JWT Token into a Cookie so it&#39;s re-sent on every subsequent request to the App Server:</p><div class="language-ts"><pre><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getSessionInfo</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//Converts Session to JWT Token Cookie</span>
        <span class="token keyword">const</span> authResponse <span class="token operator">=</span> <span class="token keyword">await</span> authClient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConvertSessionToToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        client<span class="token punctuation">.</span>bearerToken <span class="token operator">=</span> authResponse<span class="token punctuation">.</span>accessToken<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>response<span class="token punctuation">,</span> authResponse2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SessionInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConvertSessionToToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//Remove unnecessary JWT from HTTP Headers so only JWT Cookie is used</span>
        client<span class="token punctuation">.</span>bearerToken <span class="token operator">=</span> authClient<span class="token punctuation">.</span>bearerToken <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&#39;Authorization&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        authClient<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&#39;Authorization&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="aws-lightsail" tabindex="-1">AWS LightSail <a class="header-anchor" href="#aws-lightsail" aria-hidden="true">#</a></h3><p>With these pro-active efficiency techniques we&#39;re confident in hosting on <a href="https://aws.amazon.com/lightsail/" target="_blank" rel="noopener noreferrer">AWS&#39;s $5/mo LightSail Server</a> which we&#39;re happy to see still yielding a fast and responsive User Experience. We&#39;ll monitor the resource usage and report back on how much load it can withstand before requiring a hardware bump.</p><h3 id="servicestack-community-resources" tabindex="-1">ServiceStack Community Resources <a class="header-anchor" href="#servicestack-community-resources" aria-hidden="true">#</a></h3><p>One of the primary motivations for rewriting TechStacks was to create useful resource for the ServiceStack Community to be able to collaborate and contribute to as currently ServiceStack community content is scattered across several different sites:</p><ul><li><a href="https://forums.servicestack.net" target="_blank" rel="noopener noreferrer">Questions/Issues/Discussion/Announcements on Discourse Forums</a></li><li><a href="https://stackoverflow.com/search?q=servicestack" target="_blank" rel="noopener noreferrer">Questions/Issues on StackOverflow</a></li><li><a href="https://github.com/ServiceStack/Issues" target="_blank" rel="noopener noreferrer">Issues on GitHub</a></li><li><a href="https://servicestack.uservoice.com/forums/176786-feature-requests" target="_blank" rel="noopener noreferrer">Feature Requests on UserVoice</a></li><li><a href="https://twitter.com/ServiceStack" target="_blank" rel="noopener noreferrer">Announcements on Twitter</a></li><li><a href="https://plus.google.com/u/0/communities/112445368900682590445" target="_blank" rel="noopener noreferrer">Discussion/Announcements on Google+</a></li></ul><p>This situation is less than ideal as developers don&#39;t have a single resource they can frequent to find existing content and get in touch with the rest of the Community. There&#39;s also several things we dislike about all sites. Despite Discourse being one of the best forum software available we see a few issues with it like its search and discovery features aren&#39;t great, doesn&#39;t display threaded conversations well, not optimal for contributing developer content. StackOverflow is very strict about what content it will accept, lacks a welcoming community atmosphere and its markdown support isn&#39;t as good as GitHub Flavored Markdown. UserVoice is poor at moderation, editing and discussion, Twitter&#39;s only ideal for notifications and Google+ is poor at nearly all forms of rich content, discovery, threaded comments, etc.</p><p>None of the resources are particularly great at sharing community content like showcasing people&#39;s creations, blog posts, announcements or their preferred technology stacks they&#39;ve used to create their Apps with - which is the kind of community content we&#39;re most interested in seeing more of and why TechStacks was originally created.</p><p>It should also be easy for Developers to be able to subscribe to just the content their interested in which we don&#39;t believe any sites do particularly well, at least none that&#39;s optimized for programming/technology content so we decided to enhance TechStacks with the community features we&#39;ve always wanted with a blend of our favorite features from Reddit, Hacker News, Discourse, StackOverflow and UserVoice. This is less daunting than it sounds given there are whole companies dedicated full-time to creating collaborative software, but armed with the most productive technology stack we&#39;ve had the pleasure of using in Nuxt, Vuetify, ServiceStack, OrmLite and PostgreSQL - we knew we could churn out the features for a useful MVP in record time, and what we ended up doing.</p><h3 id="the-new-community-enhanced-techstacks" tabindex="-1">The new Community enhanced TechStacks <a class="header-anchor" href="#the-new-community-enhanced-techstacks" aria-hidden="true">#</a></h3><p>We&#39;re extremely happy with the current state of the new TechStacks which has been enhanced to make it easy to find, discuss and share information on your favorite technologies with others sharing similar interests.</p><p>You can utilize the rich markup and syntax highlighting features in <a href="https://guides.github.com/features/mastering-markdown/" target="_blank" rel="noopener noreferrer">GitHub Flavored Markdown</a> within a developer-friendly Markdown Editor to post news, announcements and showcase stuff you&#39;re working on to reach and get feedback on your creations, which you can either post in a wide topic like a programming language or create and invite others to your own organization - your own space where to be able to collaborate with users of your technology or App.</p><p>TechStacks is ideal for technology organizations to host their own communities. Each organization can take advantage of multiple levels of moderation with different moderation features available to Owners and Moderators to control access for Organization Members and non-members. Moderators have complete control over any content posted within their organization, where they can delete, edit unwanted posts and comments, lock or hide controversial posts, or if preferred can choose to limit contributions between approved invite-only members as well as enlisting others to help moderate. To help with mitigating unwanted content each post and comment can be reported in which Moderators can quickly act upon, or set a threshold to automatically delete controversial content when it reaches a user-defined limit.</p><p>The ServiceStack Organization Admin page gives a preview of the different moderation features available:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/release-notes/techstacks-organization-moderation.png" alt=""></p><p>Whilst members contribute content, collaborate and subscribe to receive notifications within their respective Organizations, all content is aggregated on the homepage to make it easy for people find and subscribe to content on technology they&#39;re interested in, within a fast and enjoyable experience. Our aim is to improve the discoverability of technologies by making it easy to filter out unwanted noise and drill down to each technology to select the types of content you&#39;re interested in. For example you can click on the <code>javascript</code> tag and select <a href="https://techstacks.io/?types=Announcement,Showcase&amp;t=javascript" target="_blank" rel="noopener noreferrer"><code>Announcements</code> and <code>Showcase</code></a> tabs to find news and interesting JavaScript content.</p><p>Our choice to develop TechStacks as a Nuxt SPA lets us add high-productivity features like Keyboard shortcuts and gestures which would otherwise yield a subpar experience on a traditional full-page reload website. As a result frequent users can benefit from site-wide shortcuts to quickly navigate, edit, contribute and browse around the site. Shortcut keys are discoverable in the labels of links and buttons across the site or by typing <strong><code>?</code></strong> to bring up the shortcuts dialog:</p><p><img src="https://imgur.com/w4CdC6U.png" alt="shortcuts dialog"></p><h3 id="servicestack-community-changes" tabindex="-1">ServiceStack Community Changes <a class="header-anchor" href="#servicestack-community-changes" aria-hidden="true">#</a></h3><p>The new TechStacks ServiceStack Community is open and available at:</p><h3 id="techstacks-io-servicestack" tabindex="-1"><a href="https://techstacks.io/servicestack" target="_blank" rel="noopener noreferrer">techstacks.io/servicestack</a> <a class="header-anchor" href="#techstacks-io-servicestack" aria-hidden="true">#</a></h3><p>It&#39;s now open to all ServiceStack Customers to ask questions, submit posts and feature requests or showcase their creations or useful projects they would like to share to the rest of the Community. Currently Sign In&#39;s are currently limited to GitHub and Twitter Accounts where you&#39;ll need to <a href="https://servicestack.net/account/support" target="_blank" rel="noopener noreferrer">register your email or GitHub username</a> before signing in.</p><p>In an effort to consolidate community content into a single location, all existing <strong>feature requests</strong> have been imported from UserVoice and <strong>new posts</strong> are being synced daily from the Discourse Customer Forums. We&#39;ll also be syncing any ServiceStack Questions and Answers posted on StackOverflow as we improve searchability and discoverability over all imported content.</p><p>We&#39;re going to continue hosting the <a href="https://servicestack.net/account/support" target="_blank" rel="noopener noreferrer">Discourse Customer Forums</a> in parallel until we&#39;ve implemented enough missing features that the majority of our active Customer base prefer it over Discourse. Although it may be the case that most people will always prefer Discourse in which case we&#39;ll leave it open and focus our efforts on providing better searchability of the imported content and improving overall discoverability whilst tailoring it for bespoke content like executable snippets, show cases, articles, etc.</p><p>But as their mostly operating as disconnected silos, we&#39;ll be <strong>closing down UserVoice and the Google+ community</strong> and directing users to contribute and subscribe to the <a href="https://techstacks.io/servicestack" target="_blank" rel="noopener noreferrer">ServiceStack Organization on TechStacks</a> for updates.</p><h2 id="solution-highlights" tabindex="-1">Solution Highlights <a class="header-anchor" href="#solution-highlights" aria-hidden="true">#</a></h2><p>An important part of improving ServiceStack&#39;s usability is to <a href="https://github.com/ServiceStackApps/LiveDemos" target="_blank" rel="noopener noreferrer">routinely create new Apps</a> to test new features in practice so we can identify and resolve any friction points with either new/enhanced features or documented working strategies.</p><h3 id="deployments" tabindex="-1">Deployments <a class="header-anchor" href="#deployments" aria-hidden="true">#</a></h3><p>One of the reasons we love .NET Core is being able to leverage the rich simple tooling in the Linux ecosystem which is also available from inside Windows via <a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10" target="_blank" rel="noopener noreferrer">Windows Subsystem for Linux</a>. After a <a href="https://sharpscript.net/docs/deploying-sharp-apps#deploying-multiple-web-apps-to-ubuntu" target="_blank" rel="noopener noreferrer">one-time setup of configuring nginx and supervisord</a> our deployments are reduced down to:</p><pre><code>$ npm run deploy
</code></pre><p>Which runs these <a href="https://github.com/NetCoreApps/TechStacks/blob/b933edac8219a4cc02cef640a89515a9895c700e/src/TechStacks/package.json#L10-L11" target="_blank" rel="noopener noreferrer">npm scripts</a> in the project&#39;s <code>package.json</code>:</p><pre><code>&quot;publish&quot;: &quot;nuxt build &amp;&amp; dotnet publish -c Release&quot;,
&quot;deploy&quot;: &quot;npm run publish &amp;&amp; bash deploy.sh&quot;,
</code></pre><p>To generate a client and server production build of the App that then runs <a href="https://github.com/NetCoreApps/TechStacks/blob/master/src/TechStacks/deploy.sh" target="_blank" rel="noopener noreferrer">deploy.sh</a> with WSL bash:</p><div class="language-shell"><pre><code><span class="token function">rsync</span> -avz -e <span class="token string">&#39;ssh&#39;</span> bin/Release/netcoreapp2.0/publish/ ubuntu@lightsail.web-app.io:/home/deploy/apps/techstacks
<span class="token function">ssh</span> ubuntu@lightsail.web-app.io <span class="token string">&quot;sudo supervisorctl restart web-techstacks&quot;</span>
</code></pre></div><p>Deploying the published App to TechStack&#39;s remote Ubuntu AWS LightSail server instance using <code>rsync</code> to only copy the incremental parts of the App that&#39;s changed (typically completing in &lt;1s) and <code>ssh</code> to run a remote command to restart the <code>suprvisord</code> process, starting the .NET Core App with the latest deployed version.</p><h3 id="client-server-validation-with-vuetify" tabindex="-1">Client / Server Validation with Vuetify <a class="header-anchor" href="#client-server-validation-with-vuetify" aria-hidden="true">#</a></h3><p>TechStacks uses <a href="https://vuetifyjs.com/en/components/forms" target="_blank" rel="noopener noreferrer">Vuetify Form Components</a> for all Input controls, one of the advantages they provide is a consistent validation model across all their controls which supports validation rules in the form of an array of lambda expressions and an <code>error-message</code> property for manually assigning error messages.</p><p>We&#39;ll walk through the <a href="https://github.com/NetCoreApps/TechStacks/blob/master/src/TechStacks/src/components/CategoryEdit.vue" target="_blank" rel="noopener noreferrer">CategoryEdit.vue</a> as a simple example of a CRUD form built with Vue/Vuetify which is used to <strong>Update</strong> and <strong>Delete</strong> existing categories or <strong>Create</strong> new ones. Refer to the source code for the complete implementation, we&#39;ll highlight and document the main parts containing the functionality to validate the form and send the API Requests.</p><p>All forms follows the same approach where they each have a validation <code>errorSummary</code> to display any General Service Exceptions and Vuetify Input controls configured to show both client-side and server validation errors. The <code>rules</code> attribute is where <strong>client validation rules</strong> are assigned, they can be declared in-line within the template but as the same rules are shared across multiple components they&#39;re declared in <a href="https://github.com/NetCoreApps/TechStacks/blob/master/src/TechStacks/src/shared/utils.js" target="_blank" rel="noopener noreferrer">/shared/utils.js</a>.</p><p>Each validation rule is a lambda that returns either <code>true</code> if the rule is valid or the Error Message String to show attached to the control. Here are the three validation rules for <code>slugRules</code>:</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">const</span> slugCounter <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> slugRules <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token operator">!</span>v <span class="token operator">||</span> <span class="token string">&quot;Required&quot;</span><span class="token punctuation">,</span>
  <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>v <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> slugCounter<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Max </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>slugCounter<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> characters</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
  <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>v <span class="token operator">&amp;&amp;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[a-z0-9\\-]+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Only lowercase letters, numbers or hyphens allowed</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>counter</code> attribute is a nice UX feature of Vuetify Text Input controls to show the current and maximum characters for each field. The <code>errorResponse</code> is a method in <code>@servicestack/client</code> which returns the error message or errorCode of a specific field in a ServiceStack Error Response. Any Errors that aren&#39;t covered by specific field errors are shown in the form&#39;s summary <code>&lt;v-alert/&gt;</code> component. Here&#39;s the Vue Template which utilizes all these features using declarative markup:</p>__VP_STATIC_END__`,299),l=n("div",null,[n("div",{class:"language-html"},[n("pre",{"v-pre":""},[n("code",null,[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("template")]),n("span",{class:"token punctuation"},">")]),s(`

`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-form")]),s(),n("span",{class:"token attr-name"},"v-model"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("valid"),n("span",{class:"token punctuation"},'"')]),s(),n("span",{class:"token attr-name"},"ref"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("form"),n("span",{class:"token punctuation"},'"')]),s(),n("span",{class:"token attr-name"},"lazy-validation"),n("span",{class:"token punctuation"},">")]),s(`
  `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-container")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-alert")]),s(),n("span",{class:"token attr-name"},"outline"),s(),n("span",{class:"token attr-name"},"color"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("error"),n("span",{class:"token punctuation"},'"')]),s(),n("span",{class:"token attr-name"},"icon"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("warning"),n("span",{class:"token punctuation"},'"')]),s(),n("span",{class:"token attr-name"},":value"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("errorSummary"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s("{{ errorSummary }}"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-alert")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-layout")]),s(),n("span",{class:"token attr-name"},"column"),n("span",{class:"token punctuation"},">")]),s(`

      `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-text-field")]),s(`
        `),n("span",{class:"token attr-name"},"label"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("Name"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},"v-model"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("name"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},"required"),s(`                        
        `),n("span",{class:"token attr-name"},":rules"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("nameRules"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},":counter"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("nameCounter"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},":error-messages"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("errorResponse("),n("span",{class:"token punctuation"},"'"),s("name"),n("span",{class:"token punctuation"},"'"),s(")"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token punctuation"},">")]),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-text-field")]),n("span",{class:"token punctuation"},">")]),s(`

      `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-text-field")]),s(`
        `),n("span",{class:"token attr-name"},"label"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("Slug"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},"v-model"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("slug"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},"required"),s(`
        `),n("span",{class:"token attr-name"},":rules"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("slugRules"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},":counter"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("slugCounter"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},":error-messages"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("errorResponse("),n("span",{class:"token punctuation"},"'"),s("slug"),n("span",{class:"token punctuation"},"'"),s(")"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token punctuation"},">")]),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-text-field")]),n("span",{class:"token punctuation"},">")]),s(`

      `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-text-field")]),s(`
        `),n("span",{class:"token attr-name"},"label"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("Summary"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},"v-model"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("description"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},":counter"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("summaryCounter"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},"multi-line"),s(`
        `),n("span",{class:"token attr-name"},":rows"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("2"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},":rules"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("summaryRulesOptional"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},":error-messages"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("errorResponse("),n("span",{class:"token punctuation"},"'"),s("description"),n("span",{class:"token punctuation"},"'"),s(")"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token punctuation"},">")]),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-text-field")]),n("span",{class:"token punctuation"},">")]),s(`

      `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-select")]),s(`
        `),n("span",{class:"token attr-name"},"label"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("Select Technologies"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},"autocomplete"),s(`
        `),n("span",{class:"token attr-name"},":loading"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("loading"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},"multiple"),s(`
        `),n("span",{class:"token attr-name"},"chips"),s(`
        `),n("span",{class:"token attr-name"},":error-messages"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("errorResponse("),n("span",{class:"token punctuation"},"'"),s("technologyIds"),n("span",{class:"token punctuation"},"'"),s(")"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},":items"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("technologySelectItems"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token attr-name"},"v-model"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("technologyIds"),n("span",{class:"token punctuation"},'"')]),s(`
        `),n("span",{class:"token punctuation"},">")]),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-select")]),n("span",{class:"token punctuation"},">")]),s(`

    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-layout")]),n("span",{class:"token punctuation"},">")]),s(`
  `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-container")]),n("span",{class:"token punctuation"},">")]),s(`
`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-form")]),n("span",{class:"token punctuation"},">")]),s(`

`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-layout")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-flex")]),s(),n("span",{class:"token attr-name"},"xs2"),n("span",{class:"token punctuation"},">")]),s(`
      `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-btn")]),s(),n("span",{class:"token attr-name"},"small"),s(),n("span",{class:"token attr-name"},"@click"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("submit"),n("span",{class:"token punctuation"},'"')]),s(),n("span",{class:"token attr-name"},"color"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("primary"),n("span",{class:"token punctuation"},'"')]),s(),n("span",{class:"token attr-name"},":disabled"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("!valid || loading"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s(`
        {{category ? 'Update' : 'Add'}}
      `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-btn")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-flex")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-flex")]),s(),n("span",{class:"token attr-name"},"xs2"),n("span",{class:"token punctuation"},">")]),s(`
      `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-btn")]),s(),n("span",{class:"token attr-name"},"small"),s(),n("span",{class:"token attr-name"},"@click"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("reset()"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s("Close"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-btn")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-flex")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-flex")]),s(),n("span",{class:"token attr-name"},"xs4"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-flex")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-flex")]),n("span",{class:"token punctuation"},">")]),s(`
      `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-layout")]),n("span",{class:"token punctuation"},">")]),s(`
        `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-checkbox")]),s(),n("span",{class:"token attr-name"},"small"),s(),n("span",{class:"token attr-name"},"label"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("confirm"),n("span",{class:"token punctuation"},'"')]),s(),n("span",{class:"token attr-name"},"v-model"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("allowDelete"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-checkbox")]),n("span",{class:"token punctuation"},">")]),s(`
        `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("v-btn")]),s(),n("span",{class:"token attr-name"},"small"),s(),n("span",{class:"token attr-name"},"@click"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("remove"),n("span",{class:"token punctuation"},'"')]),s(),n("span",{class:"token attr-name"},":disabled"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("!allowDelete"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s(`
            Delete
        `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-btn")]),n("span",{class:"token punctuation"},">")]),s(`                    
      `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-layout")]),n("span",{class:"token punctuation"},">")]),s(`
    `),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-flex")]),n("span",{class:"token punctuation"},">")]),s(`
`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("v-layout")]),n("span",{class:"token punctuation"},">")]),s(`

`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("template")]),n("span",{class:"token punctuation"},">")]),s(`
`)])])])],-1),i=a(`__VP_STATIC_START__<p>Which renders the UI for Updating or Adding new Categories that looks like:</p><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/release-notes/techstacks-category-update.png" alt=""></p><p>The documented implementation below explains the different parts of the component:</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mapGetters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vuex&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> toObject<span class="token punctuation">,</span> errorResponse<span class="token punctuation">,</span> errorResponseExcept <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@servicestack/client&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> category <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// All fields to send to the gateway when Updating or Adding a new Category</span>
  organizationId<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  id<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  slug<span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  description<span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  technologyIds<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">errorSummary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// Return any other error that isn&#39;t assigned to an Input Control in the Forms Alert Component</span>
      <span class="token keyword">return</span> <span class="token function">errorResponseExcept</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">&#39;name,slug,description,technologyIds&#39;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;,&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">isUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token comment">// Whether this component is updating an existing category or creating a new one</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>category <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;loading&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;isAuthenticated&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;isAdmin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;technologySelectItems&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">//...</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>

    <span class="token function">reset</span><span class="token punctuation">(</span><span class="token parameter">changed<span class="token punctuation">,</span> deleted</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                 <span class="token comment">// Reset form back to initial empty state</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>responseStatus <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>slug <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>description <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>technologyIds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&#39;done&#39;</span><span class="token punctuation">,</span> changed<span class="token punctuation">,</span> deleted<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Fire @done callback allowing parent component to close this form</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token keyword">async</span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// Validate any client-side validation rules before continuing</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&#39;loading&#39;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Set global &#39;loading&#39; state for the App &amp; disable submit button</span>
            
            <span class="token comment">// Create an object populated with all category property values in this Component</span>
            <span class="token keyword">const</span> fields <span class="token operator">=</span> <span class="token function">toObject</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isUpdate       <span class="token comment">// Either Add a New or Update Existing Category</span>
                <span class="token operator">?</span> <span class="token keyword">await</span> <span class="token function">updateCategory</span><span class="token punctuation">(</span>fields<span class="token punctuation">)</span>
                <span class="token operator">:</span> <span class="token keyword">await</span> <span class="token function">addCategory</span><span class="token punctuation">(</span>fields<span class="token punctuation">)</span><span class="token punctuation">;</span>
              
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Reset form back to initial empty state</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>responseStatus <span class="token operator">=</span> e<span class="token punctuation">.</span>responseStatus <span class="token operator">||</span> e<span class="token punctuation">;</span> <span class="token comment">// Bind ServiceStack&#39;s ErrorResponse to this Component</span>
          <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&#39;loading&#39;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Unset the &#39;loading&#39; state</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token keyword">async</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&#39;loading&#39;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">deleteCategory</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>organizationId<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>responseStatus <span class="token operator">=</span> e<span class="token punctuation">.</span>responseStatus <span class="token operator">||</span> e<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&#39;loading&#39;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    errorResponse<span class="token punctuation">,</span>          <span class="token comment">// Make the errorResponse method available to the template</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// If this component was called with an existing category, populate its fields</span>
        Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>category<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>organizationId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orgId<span class="token punctuation">;</span> <span class="token comment">// Assign which organization to add new Category to</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token operator">...</span>category<span class="token punctuation">,</span>           <span class="token comment">// Make all properties in category reactive field in this component</span>
      valid<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>           <span class="token comment">// Whether to show the user </span>
      allowDelete<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token comment">// Unlock delete button when user checks &#39;Confirm&#39; checkbox</span>
      nameCounter<span class="token punctuation">,</span> nameRules<span class="token punctuation">,</span> slugCounter<span class="token punctuation">,</span> slugRules<span class="token punctuation">,</span> summaryCounter<span class="token punctuation">,</span> summaryRulesOptional<span class="token punctuation">,</span>
      responseStatus<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>  <span class="token comment">// placeholder for ServiceStack&#39;s structured Error Response</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The functionality relevant to ServiceStack includes assigning <code>this.responseStatus</code> which is all that&#39;s required to bind the Services structured Error Response to the Form and Input Controls:</p><div class="language-js"><pre><code><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>responseStatus <span class="token operator">=</span> e<span class="token punctuation">.</span>responseStatus <span class="token operator">||</span> e<span class="token punctuation">;</span> <span class="token comment">// Bind ServiceStack&#39;s ErrorResponse to this Component</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The code that sends the API Requests for Updating and Adding a new Category is:</p><div class="language-js"><pre><code><span class="token comment">// Create an object populated with all category property values in this Component</span>
<span class="token keyword">const</span> fields <span class="token operator">=</span> <span class="token function">toObject</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isUpdate
    <span class="token operator">?</span> <span class="token keyword">await</span> <span class="token function">updateCategory</span><span class="token punctuation">(</span>fields<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token keyword">await</span> <span class="token function">addCategory</span><span class="token punctuation">(</span>fields<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Which calls the methods below defined in <a href="https://github.com/NetCoreApps/TechStacks/blob/master/src/TechStacks/src/shared/gateway.js" target="_blank" rel="noopener noreferrer">gateway.js</a> which encapsulates all API access sent within the App. All the custom logic for Adding, Updating and Deleting categories is just:</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">addCategory</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
  <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AddOrganizationCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">updateCategory</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
  <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpdateOrganizationCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">deleteCategory</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">organizationId<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
  <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DeleteOrganizationCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> organizationId<span class="token punctuation">,</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Which is just using the DTOs generated with <code>npm run dtos</code> with ServiceStack&#39;s generic <code>JsonServiceClient</code>.</p><h3 id="extensible-autoquery-services" tabindex="-1">Extensible AutoQuery Services <a class="header-anchor" href="#extensible-autoquery-services" aria-hidden="true">#</a></h3><p>We want to make a special call out to the implementation of the <code>QueryPosts</code> Services given it&#39;s one of the most important Services that powers every Post feed in TechStacks but unlike most <a href="/autoquery-rdbms.html">AutoQuery Services</a> which have no implementation, <code>QueryPosts</code> uses a custom implementation which in addition to inheriting all queryable functionality of an AutoQuery Service adds high-level functionality for custom <code>AnyTechnologyIds</code> and <code>Is</code> properties which don&#39;t directly map to any column.</p><p>The custom implementation below is used to:</p><ul><li>Prevent returning any <code>Deleted</code> Posts</li><li>Prevent returning any posts with a <code>closed</code> status unless the query specifically targets a closed label or status</li><li>Avoid any table joins by using PostgreSQL advanced Array data type for querying post <code>string</code> <strong>labels</strong> or <code>int</code> <strong>technology ids</strong></li><li>Uses <code>AnyTechnologyIds</code> to return any posts in <strong>an Organization linked to</strong> or <strong>tagged with</strong> the specified technologies</li></ul><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/posts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryPosts</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">QueryDb<span class="token punctuation">&lt;</span>Post<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token comment">// Handled by AutoQuery</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Ids <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> OrganizationId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> OrganizationIds <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Types <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// Handled by Custom Implementation</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> AnyTechnologyIds <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Is <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CacheResponse</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Duration <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostPublicServices</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">PostServicesBase</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IAutoQueryDb</span> AutoQuery <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">QueryPosts</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> q <span class="token operator">=</span> AutoQuery<span class="token punctuation">.</span><span class="token function">CreateQuery</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> Request<span class="token punctuation">.</span><span class="token function">GetRequestParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        q<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Deleted <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name"><span class="token keyword">var</span></span> states <span class="token operator">=</span> request<span class="token punctuation">.</span>Is <span class="token operator">??</span> TypeConstants<span class="token punctuation">.</span>EmptyStringArray<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>states<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;closed&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> states<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;completed&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> states<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;declined&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            q<span class="token punctuation">.</span><span class="token function">And</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Status <span class="token operator">==</span> <span class="token string">&quot;closed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            q<span class="token punctuation">.</span><span class="token function">And</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Hidden <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>Status <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> x<span class="token punctuation">.</span>Status <span class="token operator">!=</span> <span class="token string">&quot;closed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>states<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> labelSlugs <span class="token operator">=</span> states<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x <span class="token operator">!=</span> <span class="token string">&quot;closed&quot;</span> <span class="token operator">&amp;&amp;</span> x <span class="token operator">!=</span> <span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">GenerateSlug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>labelSlugs<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                q<span class="token punctuation">.</span><span class="token function">And</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;ARRAY[</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlInValues</span><span class="token punctuation">(</span>labelSlugs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToSqlInString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">] &amp;&amp; labels&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>request<span class="token punctuation">.</span>AnyTechnologyIds<span class="token punctuation">.</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> techIds <span class="token operator">=</span> request<span class="token punctuation">.</span>AnyTechnologyIds<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> orgIds <span class="token operator">=</span> request<span class="token punctuation">.</span>AnyTechnologyIds<span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span>id <span class="token operator">=&gt;</span> <span class="token function">GetOrganizationByTechnologyId</span><span class="token punctuation">(</span>Db<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>orgIds<span class="token punctuation">)</span><span class="token punctuation">)</span>
                orgIds <span class="token operator">=</span> <span class="token string">&quot;NULL&quot;</span><span class="token punctuation">;</span>

            q<span class="token punctuation">.</span><span class="token function">And</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;(ARRAY[</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">techIds</span><span class="token punctuation">}</span></span><span class="token string">] &amp;&amp; technology_ids OR organization_id in (</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">orgIds</span><span class="token punctuation">}</span></span><span class="token string">))&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> AutoQuery<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The custom implementation also caches all <code>QueryPosts</code> responses as a result of being defined in a Service annotated with <a href="/cacheresponse-attribute.html"><code>[CacheResponse]</code> attribute</a>.</p><p>As it&#39;s difficult to invalidate cached search results when individual results change, TechStacks uses the naive approach of invalidating the cache after every write. This strategy yields a less efficient hit cache rate % but ensures no cached responses are stale whilst still providing a <em>cache shield</em> protecting high read pages like post feeds from performing multiple identical queries.</p><h2 id="background-mq-service" tabindex="-1">Background MQ Service <a class="header-anchor" href="#background-mq-service" aria-hidden="true">#</a></h2><p>One of the areas we didn&#39;t have a good solution for was <strong>running managed background jobs</strong> as the previous InMemory Service MQ was a basic <code>IMessageService</code> implementation that executed requests synchronously, which although fulfilling its purpose as infrastructure-free In Memory placeholder until it was replaced by a <a href="/messaging.html">proper MQ Server</a>, it&#39;s not suitable for Queueing Background Tasks (to run in the background) after Services have been executed and their response returned to clients.</p><p>That was until now, the new <code>BackgroundMqService</code> is a full-featured <code>IMessageService</code> implementation that provides the functionality of <a href="/messaging.html">distributed MQ Server</a> but doesn&#39;t require any infrastructure dependencies. You can queue long-running background tasks by publishing Request DTOs, control execution throughput by creating different sized Thread Pools per message type, inspect the status and statistics of different MQ Workers, stop and restart processing messages, etc. It&#39;s a complete implementation implementing the same <a href="/messaging.html#message-workflow">MQ Message flow</a> and passes the existing MQ Test suites so you&#39;ll be able to substitute it for any of the other MQ Servers. But it still doesn&#39;t persist messages across App restarts so we recommend using it in combination with persistence to an external data source - generally a good idea for tracking the status of long-running jobs.</p><p>To illustrate an example we&#39;ll walkthrough TechStacks implementation of what&#39;s likely the most popular use of background job in Web Apps - sending emails...</p><h3 id="using-background-service-to-send-emails" tabindex="-1">Using Background Service to send Emails <a class="header-anchor" href="#using-background-service-to-send-emails" aria-hidden="true">#</a></h3><p>Configuring the <code>BackgroundMqService</code> is the same as every other MQ Server, i.e. register it in the IOC and register handlers for the Request DTO of each Service you want to be able to run in the background:</p><div class="language-csharp"><pre><code>container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Register</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IMessageService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BackgroundMqService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> mqServer <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IMessageService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

mqServer<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterHandler</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SendNotification<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>ExecuteMessage<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mqServer<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterHandler</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SendSystemEmail<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>ExecuteMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>

AfterInitCallbacks<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>host <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    mqServer<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ExecuteService</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">RetryPendingNotifications</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The one difference is that we also register an <code>AfterInitCallbacks</code> to Execute the <a href="https://github.com/NetCoreApps/TechStacks/blob/c89920d92e1e11a5495bf88a45fea60aea9d199e/src/TechStacks.ServiceInterface/Admin/NotificationServices.cs#L51" target="_blank" rel="noopener noreferrer">RetryPendingNotifications</a> Service after the AppHost has started. We&#39;ll look at the implementation later, but it&#39;s for re-queueing any incomplete Background Jobs that failed to complete.</p><p>With the handlers registered, any Service can queue any of these Services to Execute in the background by publishing a populated Request DTO of that Type. One place where TechStacks does this is to notify all subscribers when someone creates a post, which it does by <a href="https://github.com/NetCoreApps/TechStacks/blob/973eecdc334687e13008aa9f07444e7c6affcfd9/src/TechStacks.ServiceInterface/PostServices.cs#L62" target="_blank" rel="noopener noreferrer">calling SendNotificationAsync()</a>:</p><div class="language-csharp"><pre><code><span class="token keyword">await</span> <span class="token function">SendNotificationAsync</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>CreatePost<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>Post<span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>A common API that inserts an entry in the <code>Notification</code> table and publishes a <code>SendNotification</code> message to have the Service executed in the background by 1 of the 4 MQ Workers configured at Startup:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">SendNotificationAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> eventName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> refType<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">long</span></span> refId<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> notificationId <span class="token operator">=</span> <span class="token keyword">await</span> Db<span class="token punctuation">.</span><span class="token function">InsertAsync</span><span class="token punctuation">(</span><span class="token function">ToNotification</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> refType<span class="token punctuation">,</span> refId<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">selectIdentity</span><span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">PublishMessage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SendNotification</span> <span class="token punctuation">{</span> Id <span class="token operator">=</span> notificationId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token return-type class-name">Notification</span> <span class="token function">ToNotification</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> eventName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> refType<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">long</span></span> refId<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Notification</span> <span class="token punctuation">{</span>
    Event <span class="token operator">=</span> eventName<span class="token punctuation">,</span>
    RefId <span class="token operator">=</span> refId<span class="token punctuation">,</span>
    RefType <span class="token operator">=</span> refType<span class="token punctuation">,</span>
    RefUrn <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;urn:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">refType</span><span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">refId</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span>
    Created <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
</code></pre></div><p><code>SendNotification</code> is a regular ServiceStack Service except we only want it accessible to Admin Users so it&#39;s annotated with <code>[ExcludeMetadata]</code> to hide it from the public metadata services.</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ExcludeMetadata</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/notifications/{Id}/send&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendNotification</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturnVoid</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For the complete reference <a href="https://github.com/NetCoreApps/TechStacks/blob/master/src/TechStacks.ServiceInterface/Admin/NotificationServices.cs" target="_blank" rel="noopener noreferrer">NotificationServices.cs</a> contains all the background Email Services and bespoke code to send the different Email types whilst <a href="https://github.com/NetCoreApps/TechStacks/blob/master/src/TechStacks.ServiceInterface/Admin/NotificationServices.Utils.cs" target="_blank" rel="noopener noreferrer">NotificationServices.Utils.cs</a> contains reusable functionality shared by the different email implementations.</p><p>The <code>SendNotification</code> Service sends a different Email based on the Notification Event Type which are all executed within the same managed implementation below where it takes care of marking the completion of the notification, either with the time it successfully completed or the Exception the notification it failed with:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RequiredRole</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Admin&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">NotificationServices</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ILog</span> log <span class="token operator">=</span> LogManager<span class="token punctuation">.</span><span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">NotificationServices</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token return-type class-name">Func<span class="token punctuation">&lt;</span>Notification<span class="token punctuation">,</span> Task<span class="token punctuation">&gt;</span></span> <span class="token function">GetEventHandler</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> eventName<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>eventName<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>CreatePost<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> SendNewPostEmail<span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>UserPostReport<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> SendReportPostEmail<span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>UserPostCommentReport<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> SendReportCommentEmail<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">SendNotification</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> notification <span class="token operator">=</span> <span class="token function">AssertNotification</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> eventHandler <span class="token operator">=</span> <span class="token function">GetEventHandler</span><span class="token punctuation">(</span>notification<span class="token punctuation">.</span>Event<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>eventHandler <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">await</span> <span class="token function">eventHandler</span><span class="token punctuation">(</span>notification<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">await</span> Db<span class="token punctuation">.</span><span class="token function">UpdateOnlyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Notification</span> <span class="token punctuation">{</span>
                        Completed <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token keyword">where</span><span class="token punctuation">:</span> x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Id <span class="token operator">==</span> notification<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">await</span> Db<span class="token punctuation">.</span><span class="token function">UpdateOnlyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Notification</span> <span class="token punctuation">{</span>
                        Failed <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">,</span>
                        Error <span class="token operator">=</span> ex<span class="token punctuation">.</span>Message <span class="token operator">+</span> Environment<span class="token punctuation">.</span>NewLine <span class="token operator">+</span> ex
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token keyword">where</span><span class="token punctuation">:</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Id <span class="token operator">==</span> notification<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">throw</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">Warn</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Received notification of unknown Event Type: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">notification<span class="token punctuation">.</span>Event</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The creation of Email Template is split into different steps to ensure all users are sent the same rendered Email snapshot, even if the task failed midway through and had to be replayed.</p><p>Each template follows the same approach:</p><ul><li>Work out all users the email should be sent to</li><li>Retrieve all data required by the template and inject it into a new <a href="https://sharpscript.net/docs/installation" target="_blank" rel="noopener noreferrer">ServiceStack ScriptContext</a></li><li>Use the context to render the specified <a href="https://github.com/NetCoreApps/TechStacks/tree/master/src/TechStacks/emails" target="_blank" rel="noopener noreferrer">email template</a>.</li></ul><p>In this case it renders the <a href="https://github.com/NetCoreApps/TechStacks/blob/master/src/TechStacks/emails/post-new.html" target="_blank" rel="noopener noreferrer">post-new.html</a> Template inside the <a href="https://github.com/NetCoreApps/TechStacks/blob/master/src/TechStacks/emails/_layout.html" target="_blank" rel="noopener noreferrer">_layout.html</a> - which is based on the <a href="https://github.com/seanpowell/Email-Boilerplate/blob/master/email_commentsremoved.html" target="_blank" rel="noopener noreferrer">Email Bootstrap Template</a> and used as the layout for all email templates.</p><div class="language-csharp"><pre><code><span class="token keyword">private</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">SendNewPostEmail</span><span class="token punctuation">(</span><span class="token class-name">Notification</span> notification<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">EmailTemplate</span> template <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>notification<span class="token punctuation">.</span>EmailTemplateId <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> post <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">AssertPost</span><span class="token punctuation">(</span>notification<span class="token punctuation">.</span>RefId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> org <span class="token operator">=</span> <span class="token keyword">await</span> Db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">SingleByIdAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Organization<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>OrganizationId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> <span class="token keyword">await</span> Db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">SingleByIdAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CustomUserAuth<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>UserId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> q <span class="token operator">=</span> Db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">From</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrganizationSubscription<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>OrganizationId <span class="token operator">==</span> post<span class="token punctuation">.</span>OrganizationId<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">And</span><span class="token punctuation">(</span><span class="token string">&quot;ARRAY[{0}] &amp;&amp; post_types&quot;</span><span class="token punctuation">,</span> post<span class="token punctuation">.</span>Type<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>UserId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> postTypeSubscriberUserIds <span class="token operator">=</span> <span class="token keyword">await</span> Db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ColumnAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> context <span class="token operator">=</span> <span class="token function">CreateEmailTemplateContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> templatePath <span class="token operator">=</span> <span class="token string">&quot;emails/post-new&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> page <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">GetPage</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PageResult</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Args <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token punctuation">[</span><span class="token string">&quot;baseUrl&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> AppSettings<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;PublicBaseUrl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> post<span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">&quot;organization&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> org<span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        template <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">CreateAndSaveEmailTemplate</span><span class="token punctuation">(</span>notification<span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>SendNewPostEmail<span class="token punctuation">)</span><span class="token punctuation">,</span> templatePath<span class="token punctuation">,</span> 
            <span class="token named-parameter punctuation">toUserIds</span><span class="token punctuation">:</span> postTypeSubscriberUserIds<span class="token punctuation">,</span> 
            <span class="token named-parameter punctuation">fromName</span><span class="token punctuation">:</span>  user<span class="token punctuation">.</span>DisplayName <span class="token operator">??</span> user<span class="token punctuation">.</span>UserName<span class="token punctuation">,</span> 
            <span class="token named-parameter punctuation">ccName</span><span class="token punctuation">:</span>    org<span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">&quot; Subscribed&quot;</span><span class="token punctuation">,</span> 
            <span class="token named-parameter punctuation">subject</span><span class="token punctuation">:</span>   <span class="token interpolation-string"><span class="token string">$&quot;[</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">post<span class="token punctuation">.</span>Type</span><span class="token punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">post<span class="token punctuation">.</span>Title</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span> 
            <span class="token named-parameter punctuation">html</span><span class="token punctuation">:</span>      <span class="token keyword">await</span> result<span class="token punctuation">.</span><span class="token function">RenderToStringAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        template <span class="token operator">=</span> <span class="token keyword">await</span> Db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">SingleByIdAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>EmailTemplate<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>notification<span class="token punctuation">.</span>EmailTemplateId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">await</span> <span class="token function">SendEmailsToRemainingUsers</span><span class="token punctuation">(</span>notification<span class="token punctuation">,</span> template<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The end result of each email is to create an entry in the generic <a href="https://github.com/NetCoreApps/TechStacks/blob/master/src/TechStacks.ServiceInterface/DataModel/EmailTemplate.cs" target="_blank" rel="noopener noreferrer">EmailTemplate</a> table with the rendered email to send and all users to send it to. It&#39;s then handed to the managed <code>SendEmailsToRemainingUsers</code> routine to send the emails.</p><p>The final step is to send the email to all designated users, which is ultimately done by the <a href="https://github.com/NetCoreApps/TechStacks/blob/master/src/TechStacks.ServiceInterface/Notifications/EmailProvider.cs" target="_blank" rel="noopener noreferrer">EmailProvider</a> which uses an <code>SmtpClient</code> to send the Email to the AWS SES endpoint.</p><p>To handle cases where the long-running process can fail at any point, the email template keeps a record of each user that emails were sent to by updating the <code>emailed_user_ids</code> PostgreSQL Array after each email is sent. So if the <code>SendNotification</code> message is replayed it will start back where it left off and only sends emails to the remaining users.</p><div class="language-csharp"><pre><code><span class="token keyword">private</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">SendEmailsToRemainingUsers</span><span class="token punctuation">(</span><span class="token class-name">Notification</span> notification<span class="token punctuation">,</span> <span class="token class-name">EmailTemplate</span> template<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> remainingUserIds <span class="token operator">=</span> notification<span class="token punctuation">.</span>UserIds<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> <span class="token operator">!</span>notification<span class="token punctuation">.</span>EmailedUserIds<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>remainingUserIds<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> users <span class="token operator">=</span> <span class="token keyword">await</span> Db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">SelectAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserEmailInfo<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>Db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">From</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CustomUserAuth<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> remainingUserIds<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> userMap <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">ToDictionary</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> userId <span class="token keyword">in</span> remainingUserIds<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> userMap<span class="token punctuation">[</span>userId<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Email<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Email<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">ToEmailMessage</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Email<span class="token punctuation">,</span> user<span class="token punctuation">.</span>DisplayName <span class="token operator">??</span> user<span class="token punctuation">.</span>UserName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">await</span> <span class="token function">RecordEmailSentToUser</span><span class="token punctuation">(</span>notification<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token function">SendNotificationEmail</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">notification<span class="token punctuation">.</span>UserIds<span class="token punctuation">.</span>Length</span><span class="token punctuation">}</span></span><span class="token string"> subscribers&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SendNotificationEmail</span><span class="token punctuation">(</span><span class="token class-name">EmailTemplate</span> template<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> toName<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> notificationsEmail <span class="token operator">=</span> AppSettings<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;NotificationsFromEmail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> email <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">ToEmailMessage</span><span class="token punctuation">(</span>notificationsEmail<span class="token punctuation">,</span> toName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Email<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">RecordEmailSentToUser</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">long</span></span> notificationId<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> userId<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">await</span> Db<span class="token punctuation">.</span><span class="token function">ExecuteSqlAsync</span><span class="token punctuation">(</span><span class="token string">@&quot;UPDATE notification SET emailed_user_ids = emailed_user_ids || @userId
        WHERE id = @id&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> userId<span class="token punctuation">,</span> id <span class="token operator">=</span> notificationId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="replaying-messages" tabindex="-1">Replaying Messages <a class="header-anchor" href="#replaying-messages" aria-hidden="true">#</a></h3><p>The <code>RetryPendingNotifications</code> Service replays incomplete notifications by publishing new <code>SendNotification</code> messages which are executed by the <code>BackgroundMqService</code> as normal. This also lets you replay failed notifications by setting <code>Failed</code> to <code>null</code> and recalling the Service. As the state of each task is persisted after each step, it can fail at any point and the replayed task will be able to restart where it left off.</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">RetryPendingNotifications</span> request<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> pendingNotificationIds <span class="token operator">=</span> Db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">long</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>Db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">From</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Notification<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Completed <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> x<span class="token punctuation">.</span>Failed <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>pendingNotificationIds<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Resending </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">pendingNotificationIds<span class="token punctuation">.</span>Length</span><span class="token punctuation">}</span></span><span class="token string"> pending notifications: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">pendingNotificationIds</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> notificationId <span class="token keyword">in</span> pendingNotificationIds<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">PublishMessage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SendNotification</span> <span class="token punctuation">{</span> Id <span class="token operator">=</span> notificationId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RetryPendingNotificationsResponse</span> <span class="token punctuation">{</span>
        ResentIds <span class="token operator">=</span> pendingNotificationIds
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="mq-status" tabindex="-1">MQ Status <a class="header-anchor" href="#mq-status" aria-hidden="true">#</a></h3><p>The other benefit from persisting the status of each tasks is being able to inspect the <code>Notification</code> and <code>EmailTemplate</code> table to be able to monitor the progress of each Task.</p><p>We can also call the <a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Interfaces/Messaging/IMessageService.cs" target="_blank" rel="noopener noreferrer">IMessageService</a> APIs to inspect the state of the Background MQ Service. We can use the Service below to make the APIs accessible remotely:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/mq/stop&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>  <span class="token comment">// Stop the Background Service and all MQ Workers from processing more messages</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MqStop</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/mq/start&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token comment">// Start the Background Service and process any queued messages</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MqStart</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/mq/stats&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MqStats</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/mq/status&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MqStatus</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BackgroundAdminServices</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IMessageService</span> MqService <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RequiredRole</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Admin&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">MqStart</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        MqService<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;OK&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RequiredRole</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Admin&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">MqStop</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        MqService<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;OK&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">MqStats</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MqService<span class="token punctuation">.</span><span class="token function">GetStats</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AddHeader</span><span class="token attribute-arguments"><span class="token punctuation">(</span>ContentType <span class="token operator">=</span> MimeTypes<span class="token punctuation">.</span>PlainText<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">MqStatus</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MqService<span class="token punctuation">.</span><span class="token function">GetStatsDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This lets you can call <a href="https://techstacks.io/mq/stats.json" target="_blank" rel="noopener noreferrer">/mq/stats</a> to view a summary of <strong>all messages processed</strong> since the last time the App was restarted and <a href="https://techstacks.io/mq/status" target="_blank" rel="noopener noreferrer">/mq/status</a> to view <strong>all Queues</strong> the Background Service is currently listening to and the <strong>statistics of each individual MQ worker</strong>.</p><p>Here&#39;s a snapshot of what this looks like for TechStacks with 4 threads listening to <code>SendNotification</code> messages and 1 thread listening to <code>SendSystemEmail</code>:</p><div class="language-"><pre><code># MQ SERVER STATS:

STATUS: Started

LISTENING ON: 
  mq:SendNotification.inq
  mq:SendNotification.inq
  mq:SendNotification.inq
  mq:SendNotification.inq
  mq:SendSystemEmail.inq

------------------------------

# COLLECTIONS:

------------------------------
INFO SendNotification:

STATS:
  Thread Count:         4
  Total Messages Added: 27
  Total Messages Taken: 0
  Total .outq Messages: 27
  Total .dlq Messages:  0
QUEUES:
  mq:SendNotification.inq:        0 message(s)
  mq:SendNotification.priorityq:  0 message(s)
  mq:SendNotification.dlq:        0 message(s)
  mq:SendNotification.outq:       27 message(s)
------------------------------
INFO SendSystemEmail:

STATS:
  Thread Count:         1
  Total Messages Added: 1
  Total Messages Taken: 0
  Total .outq Messages: 1
  Total .dlq Messages:  0
QUEUES:
  mq:SendSystemEmail.inq:         0 message(s)
  mq:SendSystemEmail.priorityq:   0 message(s)
  mq:SendSystemEmail.dlq:         0 message(s)
  mq:SendSystemEmail.outq:        1 message(s)
------------------------------

# WORKERS:

------------------------------
WORKER 1 on mq:SendNotification.inq 
STATS for SendNotification:

  TotalNormalMessagesReceived:    7
  TotalPriorityMessagesReceived:  0
  TotalProcessed:                 7
  TotalRetries:                   0
  TotalFailed:                    0
  LastMessageProcessed:           4/9/18 7:44:49 PM
------------------------------
WORKER 2 on mq:SendNotification.inq 
STATS for SendNotification:

  TotalNormalMessagesReceived:    7
  TotalPriorityMessagesReceived:  0
  TotalProcessed:                 7
  TotalRetries:                   0
  TotalFailed:                    0
  LastMessageProcessed:           4/9/18 7:49:17 PM
------------------------------
WORKER 3 on mq:SendNotification.inq 
STATS for SendNotification:

  TotalNormalMessagesReceived:    7
  TotalPriorityMessagesReceived:  0
  TotalProcessed:                 7
  TotalRetries:                   0
  TotalFailed:                    0
  LastMessageProcessed:           4/9/18 8:28:59 PM
------------------------------
WORKER 4 on mq:SendNotification.inq 
STATS for SendNotification:

  TotalNormalMessagesReceived:    6
  TotalPriorityMessagesReceived:  0
  TotalProcessed:                 6
  TotalRetries:                   0
  TotalFailed:                    0
  LastMessageProcessed:           4/9/18 7:41:18 PM
------------------------------
WORKER 5 on mq:SendSystemEmail.inq 
STATS for SendSystemEmail:

  TotalNormalMessagesReceived:    1
  TotalPriorityMessagesReceived:  0
  TotalProcessed:                 1
  TotalRetries:                   0
  TotalFailed:                    0
  LastMessageProcessed:           4/9/18 7:44:47 PM
------------------------------
</code></pre></div><h2 id="new-vue-components" tabindex="-1">New Vue Components <a class="header-anchor" href="#new-vue-components" aria-hidden="true">#</a></h2><p>Thanks to the comprehensive suite of Vuetify UI components very few generic UI Components needed to be created. But we developed a few you might find useful for use in your own Apps:</p><h3 id="vuetify-markdown-editor" tabindex="-1">Vuetify Markdown Editor <a class="header-anchor" href="#vuetify-markdown-editor" aria-hidden="true">#</a></h3><p>To make contributing ServiceStack Community content as pleasant as possible we&#39;ve developed a custom Markdown Editor that enhances a Vuetify Text Input component with editing features optimal for authoring Markdown of developer content.</p><p><a href="https://github.com/ServiceStack/servicestack-editor" target="_blank" rel="noopener noreferrer">@servicestack/editor</a> is a developer-friendly Markdown Editor for Vuetify Apps which is optimized for <a href="https://guides.github.com/features/mastering-markdown/" target="_blank" rel="noopener noreferrer">GitHub Flavored Markdown</a> where it supports popular IDE short-cuts for authoring code like tab un/indenting, single-line code and comments blocks, etc.</p><p><a href="https://github.com/ServiceStack/servicestack-editor" target="_blank" rel="noopener noreferrer"><img src="https://i.imgur.com/YPlfplv.png" alt=""></a></p><p>For wrist-friendly productivity the Editor supports many of the popular Keyboard shortcuts found in popular IDEs:</p><p><img src="https://i.imgur.com/PXqkSuN.png" alt=""></p><p>It&#39;s ideal for use in Apps that need to accept rich Content and can be installed with:</p><pre><code>$ npm install @servicestack/editor
</code></pre><p>Where it&#39;s used like a regular Vue or Vuetify component:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Editor</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Markdown<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> Editor <span class="token keyword">from</span> <span class="token string">&quot;@servicestack/editor&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span> Editor <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>See the Project Page for <a href="https://github.com/ServiceStack/servicestack-editor/blob/master/README.md#example-usage" target="_blank" rel="noopener noreferrer">documented Example Usage</a> of its features and how to make use of it within an existing component.</p><h3 id="beautiful-free-hero-backgrounds" tabindex="-1">Beautiful, free Hero Backgrounds <a class="header-anchor" href="#beautiful-free-hero-backgrounds" aria-hidden="true">#</a></h3><p><a href="https://github.com/ServiceStack/images" target="_blank" rel="noopener noreferrer">@servicestack/images</a> is a growing hand-picked curated collection of beautiful free images from <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">unsplash.com</a> that&#39;s an easy drop-in to any Website, with backgrounds being served from GitHub&#39;s CDN.</p><p><a href="https://github.com/ServiceStack/images/blob/master/heroes.js" target="_blank" rel="noopener noreferrer">heroes.js</a> is a dependency-free script that returns different URLs to <strong>2560x1000</strong> <a href="https://github.com/ServiceStack/images/tree/master/hero" target="_blank" rel="noopener noreferrer">/hero</a> images ideal for usage in hero backgrounds.</p><p>It includes a number of different API&#39;s to control which hero to get and for how long to return the same hero for:</p><div class="language-"><pre><code>heroes.random()          // a random hero each time
heroes.daily()           // the same hero for the day
heroes.hourly()          // the same hero for the hour
heroes.static(&#39;foo&#39;)     // the same hero for this string constant
heroes.static(&#39;foo&#39;,10)  // the same hero + 10 for this string constant
heroes.get(1)            // the first hero
heroes.get(1000000)      // the hero at mod length 1000000

heroes.images            // the array of hero image names
heroes.baseUrl           //= https://servicestack.github.io/images/ 
</code></pre></div><blockquote><p>Live Example: <a href="https://servicestack.github.io/images/heroes" target="_blank" rel="noopener noreferrer">/heroes</a></p></blockquote><p>It&#39;s used in all TechStacks pages containing background hero images where it&#39;s embedded inside a <a href="https://vuetifyjs.com/en/components/parallax" target="_blank" rel="noopener noreferrer">Vuetify Parallax Component</a> where it provides a subtle parallax effect. This example shows the same hero image for each Technology based on its <code>slug</code>:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-parallax</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>heroUrl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> heroes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@servicestack/images&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">heroUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      <span class="token keyword">return</span> heroes<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>slug<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>The <a href="https://github.com/ServiceStack/images/blob/master/README.md#usage" target="_blank" rel="noopener noreferrer">Usage</a> section on the project page contains additional examples showing how to use it within a static web page, a npm-based Web App using ES6/TypeScript as well as inside a React or Vue Component.</p><h3 id="image-upload-vue-component" tabindex="-1">Image Upload Vue Component <a class="header-anchor" href="#image-upload-vue-component" aria-hidden="true">#</a></h3><p>The <a href="https://github.com/NetCoreApps/TechStacks/blob/master/src/TechStacks/src/components/FileInput.vue" target="_blank" rel="noopener noreferrer">FileInput.vue</a> is a simple single File Upload Component with an image preview.</p><p>The basic usage example below shows an example of using it to upload files with the <code>JsonServiceClient</code> where instead of sending a Request DTO, use <code>toFormData</code> to create a &quot;multipart/form-data&quot; <code>FormData</code> request that can be sent using the <code>postBody</code> API, e.g:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file-input</span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logoUrl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>image/*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onFileChange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">selectLabel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Add Logo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file-input</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

<span class="token keyword">import</span> <span class="token punctuation">{</span> JsonServiceClient<span class="token punctuation">,</span> toFormData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@servicestack/client&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span> FileInput <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">onFileChange</span><span class="token punctuation">(</span><span class="token parameter">imgFile</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fields <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&#39;foo&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token function">toFormData</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span>fields<span class="token punctuation">,</span> imgFile <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">postBody</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CreateTechnology</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Inside your ServiceStack Service the uploaded file will be accessible from <code>IRequest.Files</code> collection with any additional arguments used to populate the Request DTO.</p><p>You could use <code>VirtualFiles.WriteFile(path, Request.Files[0].InputStream)</code> to write the file to the configured <a href="/virtual-file-system.html">Virtual File System provider</a>, but as we want to keep the App Server stateless we&#39;re instead uploading it to Imgur and just saving the URL on Imgur:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Post</span><span class="token punctuation">(</span><span class="token class-name">CreateTechnology</span> request<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Request<span class="token punctuation">.</span>Files<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        tech<span class="token punctuation">.</span>LogoUrl <span class="token operator">=</span> Request<span class="token punctuation">.</span>Files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">UploadToImgur</span><span class="token punctuation">(</span>AppSettings<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;oauth.imgur.ClientId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">nameof</span><span class="token punctuation">(</span>tech<span class="token punctuation">.</span>LogoUrl<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">minWidth</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">minHeight</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">maxWidth</span><span class="token punctuation">:</span><span class="token number">2000</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">maxHeight</span><span class="token punctuation">:</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you&#39;d also like to upload to Imgur you can copy the <code>UploadToImgur</code> extension in <a href="https://github.com/NetCoreApps/TechStacks/blob/master/src/TechStacks.ServiceInterface/ImgurExtensions.cs" target="_blank" rel="noopener noreferrer">ImgurExtensions.cs</a> into your project which includes image size validation as well as extracting any Imgur error responses into a readable C# Exception so it displays the cause of any downstream Imgur Upload Error in your UI.</p><h2 id="stripe-gateway" tabindex="-1">Stripe Gateway <a class="header-anchor" href="#stripe-gateway" aria-hidden="true">#</a></h2><p>We&#39;ve been notified by Stripe that they intend on removing the old <strong>2015-10-16</strong> API Version that <a href="https://github.com/ServiceStack/Stripe" target="_blank" rel="noopener noreferrer">ServiceStack.Stripe</a> used so we&#39;ve updated to use latest <strong>2018-02-28</strong> Stripe API Version available. Please consult <a href="https://stripe.com/docs/upgrades" target="_blank" rel="noopener noreferrer">Stripe&#39;s API Migration Guide</a> for the full list of changes, but the main breaking change is that <code>Card</code> has been renamed to <code>Source</code>.</p><p>Into addition to supporting the latest API Version, full support was also added for <a href="https://stripe.com/docs/api#products" target="_blank" rel="noopener noreferrer">Stripe Products</a>.</p><p>The list of new API&#39;s available include:</p><ul><li><code>GetStripeProduct</code></li><li><code>CreateStripeProduct</code></li><li><code>UpdateStripeProduct</code></li><li><code>DeleteStripeProduct</code></li><li><code>GetStripeProducts</code></li><li><code>UpdateStripeCoupon</code></li></ul><h2 id="servicestack-text" tabindex="-1">ServiceStack.Text <a class="header-anchor" href="#servicestack-text" aria-hidden="true">#</a></h2><h3 id="accept-arbitrary-javascript-or-json-objects" tabindex="-1">Accept arbitrary JavaScript or JSON Objects <a class="header-anchor" href="#accept-arbitrary-javascript-or-json-objects" aria-hidden="true">#</a></h3><p>Whilst we recommend creating well-defined, Typed Service Contracts for your Services, there are rare situations where you&#39;d want to be able to accept an arbitrary JSON payload, an example of this is with integration hooks with a 3rd party provider that calls back into your Service with a custom JSON payload, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/callback&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Callback</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span>CallbackResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> Payload <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ServiceStack <code>object</code> properties are now deserialized using <code>#Script</code> <a href="/js-utils.html">JS Utils</a> which can parse any JavaScript or JSON data structure. So if a POST callback was sent to the above service containing:</p><div class="language-"><pre><code>POST /callback

{&quot;payload&quot;: {&quot;id&quot;:1,&quot;name&quot;:&quot;foo&quot;, &quot;List&quot;: [{&quot;id&quot;:2,&quot;name&quot;:&quot;bar&quot;}], &quot;Dictionary&quot;: {&quot;key&quot;:{&quot;id&quot;:3,&quot;name&quot;:&quot;bax&quot;}} }}
</code></pre></div><p>It will parsed into the appropriate .NET Types and generic collections which can be accessed with:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">Callback</span> request<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> payload <span class="token operator">=</span> request<span class="token punctuation">.</span>Object <span class="token keyword">as</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> id <span class="token operator">=</span> payload<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                             <span class="token comment">//= 1</span>
    <span class="token class-name"><span class="token keyword">var</span></span> name <span class="token operator">=</span> payload<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                         <span class="token comment">//= foo</span>
    <span class="token class-name"><span class="token keyword">var</span></span> list <span class="token operator">=</span> payload<span class="token punctuation">[</span><span class="token string">&quot;List&quot;</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> firstListItem <span class="token operator">=</span> list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> firstListName <span class="token operator">=</span> firstListItem<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token comment">//= bar</span>
    <span class="token class-name"><span class="token keyword">var</span></span> dictionary <span class="token operator">=</span> payload<span class="token punctuation">[</span><span class="token string">&quot;Dictionary&quot;</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> dictionaryValue <span class="token operator">=</span> dictionary<span class="token punctuation">[</span><span class="token string">&quot;Key&quot;</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> dictionaryValueName <span class="token operator">=</span> dictionaryValue<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//= baz</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As it&#39;s using <a href="/js-utils.html">JS Utils</a> it can also accept JavaScript object literal syntax, e.g: <code>{ payload: { id: 1 } }</code>.</p><p>Whilst this feature enables some flexibility by effectively poking a hole in your Service Contract as a placeholder for any arbitrary JS data structure, we still recommend only using <code>object</code> properties sparingly when it&#39;s needed as it only works with JSON/JSV Services, can&#39;t be documented in Metadata Services and isn&#39;t supported in most <a href="/add-servicestack-reference.html">Add ServiceStack Reference</a> languages.</p><h3 id="populate-objects-from-read-only-dictionary" tabindex="-1">Populate Objects from Read Only Dictionary <a class="header-anchor" href="#populate-objects-from-read-only-dictionary" aria-hidden="true">#</a></h3><p>The <code>ToObjectDictionary</code> and <code>FromObjectDictionary</code> extension methods lets you convert instances into a loosely-typed Object Dictionary where it can be dynamically accessed and manipulated before being used to create and populate an instance of any type. The new <code>MergeIntoObjectDictionary</code> extension method lets you merge multiple object sources into a dictionary whilst <code>FromObjectDictionary</code> was relaxed to be able to use an <code>IReadOnlyDictionary</code>:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> customer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Customer</span> <span class="token punctuation">{</span> FirstName <span class="token operator">=</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> LastName <span class="token operator">=</span> <span class="token string">&quot;Doe&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> map <span class="token operator">=</span> customer<span class="token punctuation">.</span><span class="token function">MergeIntoObjectDictionary</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{</span> Initial <span class="token operator">=</span> <span class="token string">&quot;Z&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

map<span class="token punctuation">[</span><span class="token string">&quot;DisplayName&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> map<span class="token punctuation">[</span><span class="token string">&quot;FirstName&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> map<span class="token punctuation">[</span><span class="token string">&quot;Initial&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> map<span class="token punctuation">[</span><span class="token string">&quot;LastName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token keyword">sealed</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ReadOnlyDictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> employee <span class="token operator">=</span> <span class="token keyword">sealed</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">FromObjectDictionary</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Employee<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
employee<span class="token punctuation">.</span>DisplayName <span class="token comment">//= John Z Doe</span>
</code></pre></div><h3 id="support-for-enummember" tabindex="-1">Support for <code>[EnumMember]</code> <a class="header-anchor" href="#support-for-enummember" aria-hidden="true">#</a></h3><p>You can use <code>[EnumMember]</code> to change what Enum value gets serialized, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DataContract</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Day</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EnumMember</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Value <span class="token operator">=</span> <span class="token string">&quot;MON&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    Monday<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EnumMember</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Value <span class="token operator">=</span> <span class="token string">&quot;TUE&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    Tuesday<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EnumMember</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Value <span class="token operator">=</span> <span class="token string">&quot;WED&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    Wednesday<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EnumMember</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Value <span class="token operator">=</span> <span class="token string">&quot;THU&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    Thursday<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EnumMember</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Value <span class="token operator">=</span> <span class="token string">&quot;FRI&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    Friday<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EnumMember</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Value <span class="token operator">=</span> <span class="token string">&quot;SAT&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    Saturday<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EnumMember</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Value <span class="token operator">=</span> <span class="token string">&quot;SUN&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    Sunday<span class="token punctuation">,</span>            
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">EnumMemberDto</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Day</span> Day <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name"><span class="token keyword">var</span></span> dto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EnumMemberDto</span> <span class="token punctuation">{</span>Day <span class="token operator">=</span> Day<span class="token punctuation">.</span>Sunday<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> json <span class="token operator">=</span> dto<span class="token punctuation">.</span><span class="token function">ToJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//= {&quot;Day&quot;:&quot;SUN&quot;}</span>

<span class="token class-name"><span class="token keyword">var</span></span> fromDto <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">FromJson</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>EnumMemberDto<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fromDto<span class="token punctuation">.</span>Day               <span class="token comment">//= Day.Sunday</span>
</code></pre></div><h2 id="ormlite" tabindex="-1">OrmLite <a class="header-anchor" href="#ormlite" aria-hidden="true">#</a></h2><h3 id="support-for-sql-server-2012-sequences" tabindex="-1">Support for SQL Server 2012 Sequences <a class="header-anchor" href="#support-for-sql-server-2012-sequences" aria-hidden="true">#</a></h3><p>The new <code>[Sequence]</code> attribute can be used as an alternative to <code>[AutoIncrement]</code> for inserting rows with an auto incrementing integer value populated by SQL Server, but instead of needing an <code>IDENTITY</code> column it can populate a normal <code>INT</code> column from a user-defined Sequence, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SequenceTest</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Sequence</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Seq_SequenceTest_Id&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">,</span> <span class="token class-name">ReturnOnInsert</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> UserName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Email <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Sequence</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Seq_Counter&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Counter <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SequenceTest</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;me&quot;</span><span class="token punctuation">,</span> Email <span class="token operator">=</span> <span class="token string">&quot;me@mydomain.com&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

user<span class="token punctuation">.</span>Id <span class="token comment">//= Populated by next value in &quot;Seq_SequenceTest_Id&quot; SQL Server Sequence</span>
</code></pre></div><p>The new <code>[ReturnOnInsert]</code> attribute tells OrmLite which columns to return the values of, in this case it returns the new Sequence value the row was inserted with. Sequences offer more flexibility than <code>IDENTITY</code> columns where you can use multiple sequences in a table or have the same sequence shared across multiple tables.</p><p>When creating tables, OrmLite will also create any missing Sequences automatically so you can continue to have reproducible tests and consistent Startups states that&#39;s unreliant on external state. But it doesn&#39;t drop sequences when OrmLite drops the table as they could have other external dependents.</p><p>Special thanks to <a href="https://github.com/madaleno" target="_blank" rel="noopener noreferrer">Luis Madaleno</a> for this feature.</p><h4 id="sql-server-dialects" tabindex="-1">SQL Server Dialects <a class="header-anchor" href="#sql-server-dialects" aria-hidden="true">#</a></h4><p>To be able to use the new sequence support you&#39;ll need to use an SQL Server dialect greater than SQL Server 2012+, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> dbFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OrmLiteConnectionFactory</span><span class="token punctuation">(</span>connString<span class="token punctuation">,</span> SqlServer2012Dialect<span class="token punctuation">.</span>Provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>New SQL Server dialects have been added to take advantage of features in newer SQL Server versions, the total list include:</p><ul><li><code>SqlServerDialect.Provider</code></li><li><code>SqlServer2008Dialect.Provider</code></li><li><code>SqlServer2012Dialect.Provider</code></li><li><code>SqlServer2014Dialect.Provider</code></li><li><code>SqlServer2016Dialect.Provider</code></li><li><code>SqlServer2017Dialect.Provider</code></li></ul><p>Currently <code>SqlServerDialect.Provider</code> assumes the baseline SQL Server version but we plan on upgrading it to assume <strong>SQL Server 2012</strong> in future so existing users who use it with SQL Server 2012+ can gain valuable optimizations.</p><h4 id="sql-server-2008-or-earlier" tabindex="-1">SQL Server 2008 or earlier <a class="header-anchor" href="#sql-server-2008-or-earlier" aria-hidden="true">#</a></h4><p>If you&#39;re using OrmLite with an <strong>SQL Server 2008 or earlier</strong> please change your connection to use <code>SqlServer2008Dialect.Provider</code>.</p><h3 id="auto-populated-guid-ids" tabindex="-1">Auto populated Guid Ids <a class="header-anchor" href="#auto-populated-guid-ids" aria-hidden="true">#</a></h3><p>Support for Auto populating <code>Guid</code> Primary Keys was also added in this release with the new <code>[AutoId]</code> attribute, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Table</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoId</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Guid</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In SQL Server it will populate <code>Id</code> primary key with <code>newid()</code>, in <code>PostgreSQL</code> it uses <code>uuid_generate_v4()</code> which requires installing the the <strong>uuid-ossp</strong> extension by running the SQL below on each PostgreSQL RDBMS it&#39;s used on:</p><pre><code>CREATE EXTENSION IF NOT EXISTS &quot;uuid-ossp&quot;
</code></pre><p>For all other RDBMS&#39;s OrmLite will populate the <code>Id</code> with <code>Guid.NewGuid()</code>. In all RDBMS&#39;s it will populate the <code>Id</code> property on <code>db.Insert()</code> or <code>db.Save()</code> with the new value, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> row <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Table</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">;</span>
row<span class="token punctuation">.</span>Id <span class="token comment">//= Auto populated with new Guid</span>
</code></pre></div><h3 id="select-multiple-join-alias-tables" tabindex="-1">Select Multiple Join Alias Tables <a class="header-anchor" href="#select-multiple-join-alias-tables" aria-hidden="true">#</a></h3><p>You can use <a href="https://github.com/ServiceStack/ServiceStack.OrmLite#selecting-multiple-columns-across-joined-tables" target="_blank" rel="noopener noreferrer">SelectMulti</a> with multiple joined table aliases by specifying the table alias to use for each Type selected, e.g:</p><div class="language-csharp"><pre><code>q <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">From</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Sale<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">LeftJoin</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Contact<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>SellerId <span class="token operator">==</span> c<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> db<span class="token punctuation">.</span><span class="token function">JoinAlias</span><span class="token punctuation">(</span><span class="token string">&quot;seller&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">LeftJoin</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Contact<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>BuyerId <span class="token operator">==</span> c<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> db<span class="token punctuation">.</span><span class="token function">JoinAlias</span><span class="token punctuation">(</span><span class="token string">&quot;buyer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> results <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">SelectMulti</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Sale<span class="token punctuation">,</span> Contact<span class="token punctuation">,</span> Contact<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;Sale.*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;buyer.*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;seller.*&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> result <span class="token keyword">in</span> results<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token class-name">Sale</span> sale <span class="token operator">=</span> result<span class="token punctuation">.</span>Item1<span class="token punctuation">;</span>
  <span class="token class-name">Contact</span> buyer <span class="token operator">=</span> result<span class="token punctuation">.</span>Item2<span class="token punctuation">;</span>
  <span class="token class-name">Contact</span> seller <span class="token operator">=</span> result<span class="token punctuation">.</span>Item3<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="support-for-unique-and-uniqueconstraint" tabindex="-1">Support for <code>[Unique]</code> and <code>[UniqueConstraint]</code> <a class="header-anchor" href="#support-for-unique-and-uniqueconstraint" aria-hidden="true">#</a></h3><p>In addition to creating an Index with unique constraints using <code>[Index(Unique=true)]</code> you can now use <code>[Unique]</code> to enforce a single column should only contain unique values or annotate the class with <code>[UniqueConstraint]</code> to specify a composite unique constraint, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">UniqueConstraint</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>PartialUnique1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>PartialUnique2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>PartialUnique3<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UniqueTest</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoIncrement</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Unique</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> UniqueField <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> PartialUnique1 <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> PartialUnique2 <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> PartialUnique3 <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="order-by-dynamic-expressions" tabindex="-1">Order by dynamic expressions <a class="header-anchor" href="#order-by-dynamic-expressions" aria-hidden="true">#</a></h3><p>The <code>[CustomSelect]</code> attribute can be used to populate a property with a dynamic SQL Expression instead of an existing column, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FeatureRequest</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Up <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Down <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CustomSelect</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;1 + Up - Down&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Points <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can now order by the SQL Expression by referencing the property as you would a normal column. By extension this feature now also works in AutoQuery where you can <a href="/autoquery-rdbms.html#custom-fields">select it in a partial result set</a> and order the results by using its property name, e.g:</p><p>/features?fields=id,points&amp;orderBy=points</p><h3 id="new-beforeexecfilter-and-afterexecfilter-filters" tabindex="-1">New <code>BeforeExecFilter</code> and <code>AfterExecFilter</code> filters <a class="header-anchor" href="#new-beforeexecfilter-and-afterexecfilter-filters" aria-hidden="true">#</a></h3><p>The way to see what queries OrmLite generates was to enable a <strong>debug enabled</strong> logger, e.g:</p><div class="language-csharp"><pre><code>LogManager<span class="token punctuation">.</span>LogFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConsoleLogFactory</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">debugEnabled</span><span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>But this can easily get lost in the noisy stream of other debug messages.</p><p>The new <code>BeforeExecFilter</code> and <code>AfterExecFilter</code> filters make inspection of executed commands easier by executing a custom lambda expression before and after each query is executed. So if one of your a queries are failing you can put a breakpoint in <code>BeforeExecFilter</code> to inspect the populated <code>IDbCommand</code> object before it&#39;s executed or use the <code>.GetDebugString()</code> extension method for an easy way to print the Generated SQL and DB Params to the Console:</p><div class="language-csharp"><pre><code>OrmLiteConfig<span class="token punctuation">.</span>BeforeExecFilter <span class="token operator">=</span> dbCmd <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>dbCmd<span class="token punctuation">.</span><span class="token function">GetDebugString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//OrmLiteConfig.AfterExecFilter = dbCmd =&gt; Console.WriteLine(dbCmd.GetDebugString());</span>
</code></pre></div><h3 id="typed-sql-cast-sql-modifier" tabindex="-1">Typed <code>Sql.Cast()</code> SQL Modifier <a class="header-anchor" href="#typed-sql-cast-sql-modifier" aria-hidden="true">#</a></h3><p>The new <code>Sql.Cast()</code> provides a cross-database abstraction for casting columns or expressions in SQL queries, e.g:</p><div class="language-csharp"><pre><code>db<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlTest</span> <span class="token punctuation">{</span> Value <span class="token operator">=</span> <span class="token number">123.456</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> results <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Select</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token keyword">string</span> text<span class="token punctuation">)</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">From</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SqlTest<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token punctuation">{</span>
        x<span class="token punctuation">.</span>Id<span class="token punctuation">,</span>
        text <span class="token operator">=</span> Sql<span class="token punctuation">.</span><span class="token function">Cast</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> Sql<span class="token punctuation">.</span>VARCHAR<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; : &quot;</span> <span class="token operator">+</span> Sql<span class="token punctuation">.</span><span class="token function">Cast</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>Value<span class="token punctuation">,</span> Sql<span class="token punctuation">.</span>VARCHAR<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; : &quot;</span> 
             <span class="token operator">+</span> Sql<span class="token punctuation">.</span><span class="token function">Cast</span><span class="token punctuation">(</span><span class="token string">&quot;1 + 2&quot;</span><span class="token punctuation">,</span> Sql<span class="token punctuation">.</span>VARCHAR<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; string&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text <span class="token comment">//= 1 : 123.456 : 3 string</span>
</code></pre></div><h3 id="typed-column-t-and-table-t-apis" tabindex="-1">Typed <code>Column&lt;T&gt;</code> and <code>Table&lt;T&gt;</code> APIs <a class="header-anchor" href="#typed-column-t-and-table-t-apis" aria-hidden="true">#</a></h3><p>You can use the new <code>Column&lt;T&gt;</code> and <code>Table&lt;T&gt;()</code> methods to resolve the quoted names of a Column or Table within SQL Fragments (taking into account any configured aliases or naming strategies).</p><p>Usage Example of the new APIs inside a <code>CustomJoin()</code> expression used to join on a custom SELECT expression:</p><div class="language-csharp"><pre><code>q<span class="token punctuation">.</span><span class="token function">CustomJoin</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;LEFT JOIN (SELECT </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">q<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Job<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Id<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string"> ...&quot;</span></span><span class="token punctuation">)</span>
q<span class="token punctuation">.</span><span class="token function">CustomJoin</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;LEFT JOIN (SELECT </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">q<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Job<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>Job<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string"> ...&quot;</span></span><span class="token punctuation">)</span>

q<span class="token punctuation">.</span><span class="token function">CustomJoin</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;LEFT JOIN (SELECT </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">q<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Job<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> <span class="token named-parameter punctuation">tablePrefix</span><span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string"> ...&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment">//Equivalent to:</span>
q<span class="token punctuation">.</span><span class="token function">CustomJoin</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;LEFT JOIN (SELECT </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">q<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Table</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Job<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">q<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Job<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Id<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string"> ...&quot;</span></span><span class="token punctuation">)</span>
</code></pre></div><h3 id="dapper-upgraded" tabindex="-1">Dapper Upgraded <a class="header-anchor" href="#dapper-upgraded" aria-hidden="true">#</a></h3><p>The embedded version of Dapper in <code>ServiceStack.OrmLite.Dapper</code> has been upgraded to the latest version.</p><h3 id="new-live-create-table-schemas-example" tabindex="-1">New Live Create Table Schemas Example <a class="header-anchor" href="#new-live-create-table-schemas-example" aria-hidden="true">#</a></h3><p>To quickly view and experiment with OrmLite&#39;s different Schema features we&#39;ve added a new <a href="https://gistlyn.com/?gist=840bc7f09292ad5753d07cef6063893e&amp;collection=991db51e44674ad01d3d318b24cf0934" target="_blank" rel="noopener noreferrer">Live Example on Gistlyn</a> packed with a number of popular declarative annotations OrmLite supports to enlist different RDBMS features:</p><p><a href="https://gistlyn.com/?gist=840bc7f09292ad5753d07cef6063893e&amp;collection=991db51e44674ad01d3d318b24cf0934" target="_blank" rel="noopener noreferrer"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/release-notes/gistlyn-ormlite-schema.png" alt=""></a></p><h2 id="net-core-extensibility-in-webapps" tabindex="-1">.NET Core Extensibility in WebApps <a class="header-anchor" href="#net-core-extensibility-in-webapps" aria-hidden="true">#</a></h2><p><a href="https://sharpscript.net/docs/sharp-apps" target="_blank" rel="noopener noreferrer">Web Apps</a> is our solution for rapidly developing .NET Core Web Apps in real-time, without compilation. It&#39;s especially useful when you have a number of similar Web Apps that need to share an approved suite of curated functionality which you can make available as a plugin or set of filters and drop the compiled <code>.dll</code> into a <code>/plugins</code> folder. It simplifies updates as all Web Apps are running the same binaries and the late-binding nature of <a href="https://sharpscript.net" target="_blank" rel="noopener noreferrer">#Script</a> ensures there&#39;s no binary coupling or dependency upgrade issues. <a href="https://sharpscript.net/docs/deploying-sharp-apps#using-travis-ci-to-deploy-using-docker-to-aws-ecs" target="_blank" rel="noopener noreferrer">Deployments are also simplified</a> since Apps only need to be copied to the remote server and not built.</p><p>We&#39;ve further improved the extensibility of Plugins which can now implement .NET Core&#39;s <code>IStartup</code> to be able to register any required dependencies without any coupling to any Custom AppHost.</p><p>To simplify configuration you can use the new <code>plugins/*</code> wildcard in <a href="https://github.com/ServiceStack/dotnet-app/blob/master/src/apps/plugins2/app.settings" target="_blank" rel="noopener noreferrer">app.settings</a> at the end of an ordered plugin list to register all remaining Plugins it finds in the apps <code>/plugins</code> folder:</p><pre><code>features OpenApiFeature, PostmanFeature, CorsFeature, ValidationFeature, plugins/*
CustomPlugin { ShowProcessLinks: true }
</code></pre><p>Each plugin registered can continue to be furthered configured by specifying its name and a JavaScript object literal as seen above.</p><p>The <a href="https://github.com/ServiceStack/dotnet-app/tree/master/src/apps/plugins2" target="_blank" rel="noopener noreferrer">/plugins2</a> App shows an example of this with the <a href="https://github.com/ServiceStack/dotnet-app/blob/master/src/example-plugins/ServerInfo/StartupPlugin.cs" target="_blank" rel="noopener noreferrer">StartupPlugin</a> registering a <code>StartupDep</code> dependency which is used by its <code>StartupServices</code> at runtime:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StartupDep</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>StartupDep<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StartupPlugin</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IPlugin</span><span class="token punctuation">,</span> <span class="token class-name">IStartup</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">IServiceProvider</span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        services<span class="token punctuation">.</span><span class="token function">AddSingleton</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">StartupDep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token class-name">IAppHost</span> appHost<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        appHost<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetPlugin</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MetadataFeature<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">AddPluginLink</span><span class="token punctuation">(</span><span class="token string">&quot;/startup-dep&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Startup Service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>       
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/startup-dep&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GetStartupDep</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IReturn<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StartupServices</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">StartupDep</span> StartupDep <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AddHeader</span><span class="token attribute-arguments"><span class="token punctuation">(</span>ContentType <span class="token operator">=</span> MimeTypes<span class="token punctuation">.</span>PlainText<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">GetStartupDep</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> StartupDep<span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="jwt" tabindex="-1">JWT <a class="header-anchor" href="#jwt" aria-hidden="true">#</a></h3><h3 id="support-for-multiple-audiences" tabindex="-1">Support for multiple Audiences <a class="header-anchor" href="#support-for-multiple-audiences" aria-hidden="true">#</a></h3><p>The <a href="/jwt-authprovider.html">JWT AuthProvider</a> now supports issuing and validating JWT&#39;s with multiple audiences. So you could for example configure the JWT Auth Provider to issue tokens allowing users to access <strong>search</strong> and <strong>analytics</strong> system functions by configuring its <code>Audiences</code> property:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtAuthProvider</span> <span class="token punctuation">{</span>
    Audiences <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;search&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;analytics&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This will include both audiences in new JWT&#39;s as a JSON Array (if only 1 audience was configured it will continue to be embedded as a string).</p><p>When validating a JWT with multiple audiences it only needs to match a single Audience configured with the <code>JwtAuthProvider</code>, e.g given the above configuration users that authenticate with a JWT containing:</p><pre><code>JWT[aud] = null           //= Valid: No Audience specified
JWT[aud] = admin          //= NOT Valid: Wrong Audience specified
JWT[aud] = [search,admin] //= Valid: Partial Audience match
</code></pre><h3 id="new-jwt-apis" tabindex="-1">New JWT APIs <a class="header-anchor" href="#new-jwt-apis" aria-hidden="true">#</a></h3><p>The new <code>IsValidJwt()</code> and <code>GetValidJwtPayload()</code> APIs lets you validate and inspect the contents of a JWT stand-alone, i.e. outside the context of a Request. Given an invalid <code>expiredJwt</code> and a <code>validJwt</code> you can test the validity and inspect the contents of each with:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> jwtProvider <span class="token operator">=</span> AuthenticateService<span class="token punctuation">.</span><span class="token function">GetJwtAuthProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

jwtProvider<span class="token punctuation">.</span><span class="token function">IsValidJwt</span><span class="token punctuation">(</span>expiredJwt<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">//= false</span>
jwtProvider<span class="token punctuation">.</span><span class="token function">GetValidJwtPayload</span><span class="token punctuation">(</span>expiredJwt<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//= null</span>


jwtProvider<span class="token punctuation">.</span><span class="token function">IsValidJwt</span><span class="token punctuation">(</span>validJwt<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//= true</span>
<span class="token class-name">JsonObject</span> payload <span class="token operator">=</span> jwtProvider<span class="token punctuation">.</span><span class="token function">GetValidJwtPayload</span><span class="token punctuation">(</span>validJwt<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> userId <span class="token operator">=</span> payload<span class="token punctuation">[</span><span class="token string">&quot;sub&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>For cases where you don&#39;t have access to HTTP Client Cookies you can use the new opt-in <code>IncludeJwtInConvertSessionToTokenResponse</code> option on <code>JwtAuthProvider</code> to include JWTs in <code>ConvertSession</code> Service Responses which are otherwise only available in the <code>ss-tok</code> Cookie.</p><h2 id="metadata" tabindex="-1">Metadata <a class="header-anchor" href="#metadata" aria-hidden="true">#</a></h2><h3 id="native-type-wildcards" tabindex="-1">Native Type Wildcards <a class="header-anchor" href="#native-type-wildcards" aria-hidden="true">#</a></h3><p>To better support some of our Customers maintaining large ServiceStack Systems with 1000+ Services, the <code>IncludeTypes</code> option in all <a href="/add-servicestack-reference.html">Add ServiceStack Reference languages</a> includes more flexible wildcard options for being able to specify which Services to generate DTOs for with the <code>.*</code> and <code>/*</code> wildcard suffixes:</p><h4 id="include-request-dto-and-its-dependent-types" tabindex="-1">Include Request DTO and its dependent types <a class="header-anchor" href="#include-request-dto-and-its-dependent-types" aria-hidden="true">#</a></h4><p>Use the <code>.*</code> suffix on Request DTOs to only generate Types needed by that Service, e.g:</p><div class="language-"><pre><code>/* Options:
IncludeTypes: GetTechnology.*
</code></pre></div><p>This will only generated DTOs for the <code>GetTechnology</code> Request DTO, its <code>GetTechnologyResponse</code> Response DTO and all dependent Types they both reference.</p><h4 id="include-all-types-within-a-c-namespace" tabindex="-1">Include All Types within a C# namespace <a class="header-anchor" href="#include-all-types-within-a-c-namespace" aria-hidden="true">#</a></h4><p>If your DTOs are organized into multiple namespaces they can be all included using the <code>/*</code> suffix, e.g:</p><div class="language-"><pre><code>/* Options:
IncludeTypes: MyApp.ServiceModel.Admin/*, MyApp.ServiceModel.Management/*
</code></pre></div><p>This will generate all DTOs within the <code>MyApp.ServiceModel.Admin</code> and <code>MyApp.ServiceModel.Management</code> C# namespaces.</p><h4 id="use-a-different-baseurl" tabindex="-1">Use a different BaseUrl <a class="header-anchor" href="#use-a-different-baseurl" aria-hidden="true">#</a></h4><p>You can specify a different BaseUrl for Add ServiceStack Reference DTOs then what&#39;s resolved by the AppHost with:</p><div class="language-csharp"><pre><code><span class="token generic-method"><span class="token function">GetPlugin</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NativeTypesFeature<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MetadataTypesConfig<span class="token punctuation">.</span>BaseUrl <span class="token operator">=</span> <span class="token string">&quot;https://new.example.org&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="call-internal-and-external-services-from-urls" tabindex="-1">Call Internal and External Services from URLs <a class="header-anchor" href="#call-internal-and-external-services-from-urls" aria-hidden="true">#</a></h3><p>The new <code>Metadata.CreateRequestFromUrl()</code> API lets you create Request DTOs from absolute or relative URLs. This is useful if you need a generic routine to be able to execute a number of different Services from a collection or URL&#39;s, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> processUrls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span> <span class="token string">&quot;https://example.org/invoices/generate?userId=1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/assets/1/generate&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> url <span class="token keyword">in</span> processUrls<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> request <span class="token operator">=</span> HostContext<span class="token punctuation">.</span>Metadata<span class="token punctuation">.</span><span class="token function">CreateRequestFromUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> responseType <span class="token operator">=</span> HostContext<span class="token punctuation">.</span>Metadata<span class="token punctuation">.</span><span class="token function">GetResponseTypeByRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> HostContext<span class="token punctuation">.</span>AppHost<span class="token punctuation">.</span><span class="token function">GetServiceGateway</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">BasicRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>responseType<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>

    db<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Task</span> <span class="token punctuation">{</span> Url <span class="token operator">=</span> url<span class="token punctuation">,</span> Response <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">ToJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Completed <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The Service Gateway provides an optimal way for executing Services where it will transparently execute local requests in process or external requests remotely using either the configured <a href="/service-gateway.html#substitutable-service-gateways">Service Gateway</a> or <a href="/service-discovery.html">Service Discovery Solution</a>.</p><h2 id="servicestack" tabindex="-1">ServiceStack <a class="header-anchor" href="#servicestack" aria-hidden="true">#</a></h2><h3 id="logging" tabindex="-1">Logging <a class="header-anchor" href="#logging" aria-hidden="true">#</a></h3><p><strong>.NET Standard 2.0</strong> builds are now published in <code>ServiceStack.Logging.Log4Net</code> and <code>ServiceStack.Logging.NLog</code> NuGet packages which can now be used in .NET Core Apps.</p><p>As there&#39;s a sizable percentage of Customers that are running <a href="/templates-corefx.html">ASP.NET Core Apps on the .NET Framework</a>, we&#39;ve also published .NET Standard 2.0-only <code>.Core</code> packages so they can be referenced in <a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET</a> Core Apps running on the .NET Framework:</p><ul><li><a href="https://www.nuget.org/packages/ServiceStack.Logging.Log4Net.Core" target="_blank" rel="noopener noreferrer">ServiceStack.Logging.Log4Net.Core</a></li><li><a href="https://www.nuget.org/packages/ServiceStack.Logging.NLog.Core" target="_blank" rel="noopener noreferrer">ServiceStack.Logging.NLog.Core</a></li></ul><h3 id="serverevents-client" tabindex="-1">ServerEvents Client <a class="header-anchor" href="#serverevents-client" aria-hidden="true">#</a></h3><p>The new APIs available on <code>ServerEventsClient</code> let you inspect and modify custom registrations at runtime:</p><ul><li><code>HasListener(eventName,handler)</code> - Is the handler already registered for this event?</li><li><code>HasListeners(eventName)</code> - Are there any handlers registered for this event?</li><li><code>RemoveListener(eventName,handler)</code> - Remove the handler for this event so they&#39;re no longer receiving events</li><li><code>RemoveListeners(eventName)</code> - Remove all handlers registered for this event</li><li><code>RemoveAllListeners()</code> - Remove all registered handlers on all events</li><li><code>RemoveAllRegistrations()</code> - Remove all custom registrations inc. all Handlers, Named Receivers and Receiver Types</li><li><code>ResolveStreamUrl</code> - Modify the URL used to connect to the <code>/event-stream</code> (e.g. to add additional query params)</li></ul><h3 id="sessions" tabindex="-1">Sessions <a class="header-anchor" href="#sessions" aria-hidden="true">#</a></h3><p>New customizations hooks are available when inheriting <code>AuthUserSession</code> allowing for more custom logic to be included in Custom UserSession&#39;s instead of in Custom AuthProviders:</p><ul><li><code>OnLoad(IRequest)</code> - Called after new sessions are hydrated, can be used to populate session with more info at runtime</li><li><code>Validate(authService,session,tokens,authInfo)</code> - Lets you invalidate User Sessions by returning a custom <code>HttpResult</code></li></ul><h3 id="minor-features" tabindex="-1">Minor Features <a class="header-anchor" href="#minor-features" aria-hidden="true">#</a></h3><ul><li>Use <code>UseBufferedStream</code> in .NET Core Responses to return buffered a Response with a <code>ContentLength</code> instead of a chunked response</li><li>You can restrict Services to only be executed via MQ with the <code>[Restrict(RequestAttributes.MessageQueue)]</code> Request Filter Attribute</li><li>Added <code>userId</code>, <code>userName</code> and <code>userEmail</code> Template info filters and <code>toDateTime()</code> and <code>toTimeSpan()</code> Default filters</li><li>Use <code>Name</code> to override the Request DTO Name, e.g. <code>[AutoQueryViewer(Name = &quot;Today&#39;s Logs&quot;, Title = &quot;Logs from Today&quot;)]</code> in <a href="https://github.com/ServiceStack/Admin" target="_blank" rel="noopener noreferrer">AutoQuery Viewer</a></li><li>Added a more optimal <code>ToOptimizedResultAsync()</code> API which should be preferred over the existing <code>ToOptimizedResult()</code> that&#39;s now deprecated</li><li>Any license key in <code>servicestack:license</code> setting in <code>IAppSettings</code> is auto-registered, useful for .NET Core Apps using <code>appsettings.json</code></li><li>Use <code>ClientConfig.ConfigureTls12()</code> to upgrade .NET <code>HttpWebRequest</code> and ServiceClients to use <strong>TLS 1.2</strong>, enabled when using <code>GithubAuthProvider</code></li><li><code>&quot;.well-known/**/*&quot;</code> was added to <code>Config.AllowFilePaths</code> to allow LetsEncrypt verification requests through by default</li></ul><h3 id="open-api" tabindex="-1">Open API <a class="header-anchor" href="#open-api" aria-hidden="true">#</a></h3><p><a href="https://github.com/georgehemmings" target="_blank" rel="noopener noreferrer">@georgehemmings</a> contributed the <code>InlineSchemaTypesInNamespaces</code> feature in <a href="/openapi.html">OpenApiFeature</a> which lets you specify which types should have inline their schema definitions inlined.</p><h2 id="community" tabindex="-1">Community <a class="header-anchor" href="#community" aria-hidden="true">#</a></h2><ul><li><a href="https://twitter.com/mattjcowan" target="_blank" rel="noopener noreferrer">@mattjcowan</a> project used in his <a href="https://www.meetup.com/Fox-Valley-NET-Web-Development-Meetup/events/247972058/" target="_blank" rel="noopener noreferrer">Getting Started with ServiceStack</a> is available at <a href="https://github.com/mattjcowan/foxvalleymeetup-servicestack" target="_blank" rel="noopener noreferrer">foxvalleymeetup-servicestack</a></li><li><a href="https://twitter.com/82unpluggd" target="_blank" rel="noopener noreferrer">Jacob Foshee</a> upgraded his <a href="https://github.com/jfoshee/ServiceStack.Authentication.Aad" target="_blank" rel="noopener noreferrer">ServiceStack.Authentication.Aad</a> package to v5</li><li><a href="https://github.com/daleholborow" target="_blank" rel="noopener noreferrer">@daleholborow</a> published a post on <a href="http://inayearorso.io/2018/04/18/servicestack-miniprofiler-dotnetcore-angular2/" target="_blank" rel="noopener noreferrer">Enabling Mini Profiler with SQL Profiling inside a .NET Core Angular App</a></li></ul><h2 id="patch-release-versions" tabindex="-1">Patch Release Versions <a class="header-anchor" href="#patch-release-versions" aria-hidden="true">#</a></h2><p>As a <a href="/releases/v5.0.0.html#enhancement-releases">reminder from last release</a> we&#39;re dedicating time immediately after each release to resolve any issues. If any priority issues are reported and resolved we&#39;ll release them in new patch releases, e.g. <strong>5.1.1</strong>, <strong>5.1.2</strong>, etc. These will be non-breaking releases that will be safe to upgrade.</p><p>We hope you enjoy this release, feel free to ask any questions or leave any feedback in <a href="https://techstacks.io/servicestack" target="_blank" rel="noopener noreferrer">techstacks.io/servicestack</a>, the <a href="https://forums.servicestack.net" target="_blank" rel="noopener noreferrer">Customer Forums</a> or StackOverflow</p><h1 id="v5-0-2-release-notes" tabindex="-1"><a href="/releases/v5.0.0.html">v5.0.2 Release Notes</a> <a class="header-anchor" href="#v5-0-2-release-notes" aria-hidden="true">#</a></h1>__VP_STATIC_END__`,214),r=[c,l,i];function u(k,d,h,g,m,f){return o(),e("div",null,r)}var v=t(p,[["render",u]]);export{w as __pageData,v as default};
