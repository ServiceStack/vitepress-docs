import{_ as s,c as e,o as t,a as o,b as n,e as a}from"./app.14440598.js";const A='{"title":"Mix features into ASP.NET Core Projects from Gists","description":"","frontmatter":{"slug":"mix-tool","title":"Mix features into ASP.NET Core Projects from Gists"},"headers":[{"level":3,"title":"mix-enabled dotnet tools","slug":"mix-enabled-dotnet-tools"},{"level":3,"title":"mix Usage","slug":"mix-usage"},{"level":3,"title":"Mix in Features into ASP.NET Core Apps","slug":"mix-in-features-into-asp-net-core-apps"},{"level":3,"title":"Mix in DB Support","slug":"mix-in-db-support"},{"level":3,"title":"Composable Features","slug":"composable-features"},{"level":3,"title":"Undo mix","slug":"undo-mix"},{"level":3,"title":"Encapsulated Features","slug":"encapsulated-features"},{"level":3,"title":"Mix in Auth Repository","slug":"mix-in-auth-repository"},{"level":3,"title":"Mix in MQ Server","slug":"mix-in-mq-server"},{"level":2,"title":"Mix in NUglify","slug":"mix-in-nuglify"},{"level":3,"title":"Mix in Prebuilt Recipes and Working Examples","slug":"mix-in-prebuilt-recipes-and-working-examples"},{"level":3,"title":"example-validation","slug":"example-validation"},{"level":3,"title":"feature-mq","slug":"feature-mq"},{"level":3,"title":"feature-authrepo","slug":"feature-authrepo"}],"relativePath":"mix-tool.md","lastUpdated":1634495308422}',p={},c=o(`__VP_STATIC_START__<p>To complete the picture of making it easy as possible to compose <a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET</a> Core Apps &amp; easily install features we&#39;ve added <code>mix</code> support to the <a href="/dotnet-tool.html">dotnet tools</a>:</p><div class="language-bash"><pre><code>$ dotnet tool <span class="token function">install</span> --global x
</code></pre></div><p>The same functionality is also built into the Windows <a href="/netcore-windows-desktop.html">app</a> dotnet tool, both can be updated to the latest version with:</p><p>.NET 5.0 (Windows/macOS/Linux):</p><div class="language-bash"><pre><code>$ dotnet tool update -g x
</code></pre></div><p>.NET 5.0 (Windows x64):</p><div class="language-bash"><pre><code>$ dotnet tool update -g app
</code></pre></div><h3 id="mix-enabled-dotnet-tools" tabindex="-1">mix-enabled dotnet tools <a class="header-anchor" href="#mix-enabled-dotnet-tools" aria-hidden="true">#</a></h3><p><code>mix</code> works exactly the same in all dotnet tools, which just needs the <strong>tool name prefixed</strong> before the <code>mix</code> command:</p><div class="language-bash"><pre><code>$ x mix <span class="token punctuation">..</span>.
$ app mix <span class="token punctuation">..</span>.
</code></pre></div><h3 id="mix-usage" tabindex="-1">mix Usage <a class="header-anchor" href="#mix-usage" aria-hidden="true">#</a></h3><p><code>x mix</code> is designed around applying <a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET</a> Core features captured in GitHub gists to your local .NET Core projects.</p><p>Type <code>x mix ?</code> for a quick Usage Summary:</p><div class="language-"><pre><code>View all published gists:
   x mix

Simple Usage:
   x mix &lt;name&gt; &lt;name&gt; ...

Mix using numbered list index instead:
   x mix 1 3 5 ...

Delete previously mixed gists:
   x mix -delete &lt;name&gt; &lt;name&gt; ...

Use custom project name instead of current folder name (replaces MyApp):
   x mix -name ProjectName &lt;name&gt; &lt;name&gt; ...

Replace additional tokens before mixing:
   x mix -replace term=with &lt;name&gt; &lt;name&gt; ...

Multi replace with escaped string example:
   x mix -replace term=with -replace &quot;This Phrase&quot;=&quot;With This&quot; &lt;name&gt; &lt;name&gt; ...

Only display available gists with a specific tag:
  x mix [tag]
  x mix [tag1,tag2]
</code></pre></div><p>Although most of the time you&#39;re only going to run 2 commands, viewing available features with:</p><div class="language-bash"><pre><code>$ x mix
</code></pre></div><p>Where it displays different features that can be added to your App, where they&#39;re added to and the author of the Gist:</p><div class="language-"><pre><code> 1. init                 Empty C# .NET 5.0 ServiceStack App      to: .      by @ServiceStack  [project,C#]
 2. init-lts             Empty C# .NET Core 3.1 LTS ServiceStack App  to: .      by @ServiceStack  [project,VB]
 3. init-vb              Empty VB .NET 5.0 LTS ServiceStack App  to: .      by @ServiceStack  [project,F#]
 4. init-fsharp          Empty F# .NET 5.0 LTS ServiceStack App  to: .      by @ServiceStack  [project,C#]
 5. init-corefx          Empty ASP.NET 2.1 LTS on .NET Framework to: .      by @ServiceStack  [project,C#]
 6. init-sharp-app       Empty ServiceStack #Script App               to: .      by @ServiceStack  [project,S#]
 7. bootstrap-sharp      Bootstrap + #Script Pages Starter Template   to: $HOST  by @ServiceStack  [ui,S#]
 8. redis                Use ServiceStack.Redis                       to: $HOST  by @ServiceStack  [db]
 9. sqlserver            Use OrmLite with SQL Server                  to: $HOST  by @ServiceStack  [db]
10. sqlite               Use OrmLite with SQLite                      to: $HOST  by @ServiceStack  [db]
11. postgres             Use OrmLite with PostgreSQL                  to: $HOST  by @ServiceStack  [db]
12. mysql                Use OrmLite with MySql                       to: $HOST  by @ServiceStack  [db]
13. oracle               Use OrmLite with Oracle                      to: $HOST  by @ServiceStack  [db]
14. firebird             Use OrmLite with Firebird                    to: $HOST  by @ServiceStack  [db]
15. dynamodb             Use AWS DynamoDB and PocoDynamo              to: $HOST  by @ServiceStack  [db]
16. mongodb              Use MongoDB                                  to: $HOST  by @ServiceStack  [db]
17. ravendb              Use RavenDB                                  to: $HOST  by @ServiceStack  [db]
18. marten               Use Marten NoSQL with PostgreSQL             to: $HOST  by @ServiceStack  [db]
19. auth                 Configure AuthFeature                        to: $HOST  by @ServiceStack  [auth]
20. auth-db              Use OrmLite Auth Repository (requires auth)  to: $HOST  by @ServiceStack  [auth]
21. auth-redis           Use Redis Auth Repository (requires auth)    to: $HOST  by @ServiceStack  [auth]
22. auth-memory          Use Memory Auth Repository (requires auth)   to: $HOST  by @ServiceStack  [auth]
23. auth-dynamodb        Use DynamoDB Auth Repository (requires auth) to: $HOST  by @ServiceStack  [auth]
24. auth-mongodb         Use MongoDB Auth Repository (requires auth)  to: $HOST  by @ServiceStack  [auth]
25. auth-ravendb         Use RavenDB Auth Repository (requires auth)  to: $HOST  by @ServiceStack  [auth]
26. auth-marten          Use Marten Auth Repository (requires auth)   to: $HOST  by @ServiceStack  [auth]
27. backgroundmq         Use Memory Background MQ                     to: $HOST  by @ServiceStack  [mq]
28. rabbitmq             Use RabbitMQ                                 to: $HOST  by @ServiceStack  [mq]
29. sqs                  Use AWS SQS MQ                               to: $HOST  by @ServiceStack  [mq]
30. servicebus           Use Azure Service Bus MQ                     to: $HOST  by @ServiceStack  [mq]
31. redismq              Use Redis MQ                                 to: $HOST  by @ServiceStack  [mq]
32. feature-mq           Simple MQ Feature to test sending Messages   to: $HOST  by @ServiceStack  [mq]
33. feature-authrepo     List &amp; Search Users registered in Auth Repo  to: $HOST  by @ServiceStack  [auth]
34. hangfire-postgres    Postgres hangfire cron scheduler &amp; dashboard to: $HOST  by @GuerrillaCoder [hangfire]
35. autocrudgen          Configure AutoGen AutoCrud Services          to: $HOST  by @ServiceStack  [autoquery]
36. autodto              Generate DB DTOs in C#, TypeScript, Dart...  to: .      by @ServiceStack  [autoquery]
37. sharpdata            Instant JSON,CSV,XML,JSV data APIs           to: .      by @ServiceStack  [db]
38. nuglify              Use Nuglify&#39;s Advanced JS/CSS/HTML Minifiers to: $HOST  by @ServiceStack  [assets]
39. northwind.sqlite     northwind.sqlite                             to: .      by @ServiceStack  [sqlite]
40. northwind.sharpdata  northwind.sharpdata                          to: .      by @ServiceStack  [sharpdata]
41. vue-lite-lib         Update vue-lite projects libraries           to: $HOST  by @ServiceStack  [lib,vue]
42. react-lite-lib       Update react-lite projects libraries         to: $HOST  by @ServiceStack  [lib,react]
43. grpc                 Configure gRPC (requires .NET 5.0)      to: $HOST  by @ServiceStack  [grpc]
44. grpc-android         Android gRPC SSL Channel Builder             to: .      by @ServiceStack  [java,grpc]
45. bcl.proto            protobuf-net\\bcl.proto                       to: .      by @ServiceStack  [grpc]
46. example-validation   Contacts Validation Example                  to: $HOST  by @ServiceStack  [example]
47. validation-contacts  Contacts Validation Example                  to: $HOST  by @ServiceStack  [example]
48. feature-mq           Simple MQ Feature to test sending Messages   to: $HOST  by @ServiceStack  [feature,mq]
49. feature-authrepo     List and Search Users registered in AuthRepo to: $HOST  by @ServiceStack  [feature]
50. docker               Dockerfile example for .NET Core Sharp Apps  to: .      by @ServiceStack  [config]
51. svg-action           Material Design Action Icons                 to: svg/   by @ServiceStack  [svg]
52. svg-alert            Material Design Alert Icons                  to: svg/   by @ServiceStack  [svg]
53. svg-av               Material Design Audio Visual Icons           to: svg/   by @ServiceStack  [svg]
54. svg-communication    Material Design Communication Icons          to: svg/   by @ServiceStack  [svg]
55. svg-content          Material Design Content Icons                to: svg/   by @ServiceStack  [svg]
56. svg-device           Material Design Device Icons                 to: svg/   by @ServiceStack  [svg]
57. svg-editor           Material Design Editor Icons                 to: svg/   by @ServiceStack  [svg]
58. svg-file             Material Design File Icons                   to: svg/   by @ServiceStack  [svg]
59. svg-hardware         Material Design Hardware Icons               to: svg/   by @ServiceStack  [svg]
60. svg-image            Material Design Image Icons                  to: svg/   by @ServiceStack  [svg]
61. svg-maps             Material Design Maps Icons                   to: svg/   by @ServiceStack  [svg]
62. svg-navigation       Material Design Navigation Icons             to: svg/   by @ServiceStack  [svg]
63. svg-places           Material Design Places Icons                 to: svg/   by @ServiceStack  [svg]
64. svg-social           Material Design Social Icons                 to: svg/   by @ServiceStack  [svg]
65. svg-toggle           Material Design Toggle Icons                 to: svg/   by @ServiceStack  [svg]

   Usage:  x mix &lt;name&gt; &lt;name&gt; ...

  Search:  x mix [tag] Available tags: auth, config, db, feature, lib, mq, project, react, sharp, svg, ui, vue

Advanced:  x mix ?
</code></pre></div><p>Then choosing which features you want to add to your project with <code>x mix &lt;name&gt;</code>, e.g:</p><div class="language-bash"><pre><code>$ x mix redis
</code></pre></div><p>The entire list of available features is maintained in the self-documenting human and machine readable <a href="https://gist.github.com/gistlyn/9b32b03f207a191099137429051ebde8" target="_blank" rel="noopener noreferrer">mix.md</a> feature index.</p><blockquote><p>To publish your feature here and make it available to all <code>mix</code> users, please <a href="https://gist.github.com/gistlyn/9b32b03f207a191099137429051ebde8#comments" target="_blank" rel="noopener noreferrer">link to it in the comments</a>.</p></blockquote><h3 id="mix-in-features-into-asp-net-core-apps" tabindex="-1">Mix in Features into <a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET</a> Core Apps <a class="header-anchor" href="#mix-in-features-into-asp-net-core-apps" aria-hidden="true">#</a></h3><p>It should be noted that <code>ModularStartup</code> and <code>mix</code> dotnet tool aren&#39;t limited to ServiceStack Apps, they&#39;re a generic solution that can easily add features to any .NET Core App. E.g. some of ServiceStack features relies on external dependencies which utilizes the same dependency registration used in all <a href="http://ASP.NET" target="_blank" rel="noopener noreferrer">ASP.NET</a> Core Apps, e.g running:</p><div class="language-bash"><pre><code>$ x mix mongodb
</code></pre></div><p>Applies the <code>mongodb</code> feature to your HOST project as instructed by the <code>to: $HOST</code> modifier above that it finds by using the first folder containing either <code>appsettings.json</code>, <code>Program.cs</code> or <code>Startup.cs</code> and writing the following <a href="https://gist.github.com/gistlyn/f777396583262127a66e2369ae475d3f" target="_blank" rel="noopener noreferrer">mongodb Gist file</a>:</p><div class="language-csharp"><pre><code><span class="token keyword">namespace</span> <span class="token namespace">MyApp</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigureMongoDb</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IConfigureServices</span></span>
    <span class="token punctuation">{</span>
        <span class="token return-type class-name">IConfiguration</span> Configuration <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token function">ConfigureMongoDb</span><span class="token punctuation">(</span><span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Configuration <span class="token operator">=</span> configuration<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> mongoClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MongoClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">IMongoDatabase</span> mongoDatabase <span class="token operator">=</span> mongoClient<span class="token punctuation">.</span><span class="token function">GetDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;MyApp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            container<span class="token punctuation">.</span><span class="token function">AddSingleton</span><span class="token punctuation">(</span>mongoDatabase<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
</code></pre></div><p>With all <code>MyApp</code> tokens replaced with the <strong>Project Name</strong> using the same replacement rules as new projects, i.e:</p><ul><li><code>MyApp</code> will be replaced with <code>ProjectName</code></li><li><code>my-app</code> will be replaced with <code>project-name</code></li><li><code>My App</code> will be replaced with <code>Project Name</code></li></ul><p>By default it assumes the folder name is the project name, that&#39;s overridable using the <code>-name</code> flag:</p><div class="language-bash"><pre><code>$ x mix -name ProjectName mongodb
</code></pre></div><p>This feature also installs the <strong>MongoDB.Driver</strong> NuGet package as instructed by the <code>_init</code> command in the <a href="https://gist.github.com/gistlyn/f777396583262127a66e2369ae475d3f" target="_blank" rel="noopener noreferrer">mongodb feature</a>.</p><p>So after just a single <code>mix</code> command and App restart, it&#39;s now configured and running with MongoDB!</p><h4 id="registering-mongodb-auth-repository" tabindex="-1">Registering MongoDB Auth Repository <a class="header-anchor" href="#registering-mongodb-auth-repository" aria-hidden="true">#</a></h4><p>As a design goal <code>mix</code> features are designed to be layerable where you can existing features that builds upon existing registrations, for example you can later configure your App to <strong>enable auth</strong> and configure it to use a <code>MongoDbAuthRepository</code> with:</p><div class="language-bash"><pre><code>$ x mix auth auth-mongodb
</code></pre></div><h3 id="mix-in-db-support" tabindex="-1">Mix in DB Support <a class="header-anchor" href="#mix-in-db-support" aria-hidden="true">#</a></h3><p>All DB servers are just as easily configurable, which we can quickly find using a <code>[db]</code> tag search:</p><div class="language-bash"><pre><code>$ x mix <span class="token punctuation">[</span>db<span class="token punctuation">]</span>
</code></pre></div><div class="info custom-block"><p class="custom-block-title">Tip</p><p>search term needs to be quoted in unix shells, e.g: &#39;[db]&#39;</p></div><p>Which will list all available <code>[db]</code> providers:</p><div class="language-"><pre><code>Results matching tag [db]:

   1. redis      Use ServiceStack.Redis            to: $HOST  by @ServiceStack  [db]
   2. sqlserver  Use OrmLite with SQL Server       to: $HOST  by @ServiceStack  [db]
   3. sqlite     Use OrmLite with SQLite           to: $HOST  by @ServiceStack  [db]
   4. postgres   Use OrmLite with PostgreSQL       to: $HOST  by @ServiceStack  [db]
   5. mysql      Use OrmLite with MySql            to: $HOST  by @ServiceStack  [db]
   6. oracle     Use OrmLite with Oracle           to: $HOST  by @ServiceStack  [db]
   7. firebird   Use OrmLite with Firebird         to: $HOST  by @ServiceStack  [db]
   8. dynamodb   Use AWS DynamoDB and PocoDynamo   to: $HOST  by @ServiceStack  [db]
   9. mongodb    Use MongoDB                       to: $HOST  by @ServiceStack  [db]
  10. ravendb    Use RavenDB                       to: $HOST  by @ServiceStack  [db]
  11. marten     Use Marten NoSQL with PostgreSQL  to: $HOST  by @ServiceStack  [db]

   Usage:  x mix &lt;name&gt; &lt;name&gt; ...

  Search:  x mix [tag] Available tags: auth, config, db, feature, lib, mq, project, react, sharp, svg, ui, vue

Advanced:  x mix ?
</code></pre></div><p>So we can install Redis with:</p><div class="language-bash"><pre><code>$ x mix redis
</code></pre></div><p>Where it will apply the <a href="https://gist.github.com/gistlyn/512309b3cb7d734bb0f7323907499b08" target="_blank" rel="noopener noreferrer">Redis Gist</a> below:</p><div class="language-csharp"><pre><code><span class="token keyword">namespace</span> <span class="token namespace">MyApp</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigureRedis</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IConfigureServices</span><span class="token punctuation">,</span> <span class="token class-name">IConfigureAppHost</span></span>
    <span class="token punctuation">{</span>
        <span class="token return-type class-name">IConfiguration</span> Configuration <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token function">ConfigureRedis</span><span class="token punctuation">(</span><span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Configuration <span class="token operator">=</span> configuration<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IRedisClientsManager<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RedisManagerPool</span><span class="token punctuation">(</span>Configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;Redis&quot;</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">&quot;localhost:6379&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IAppHost</span> appHost<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            appHost<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetPlugin</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SharpPagesFeature<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">?.</span>ScriptMethods<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">RedisScripts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The configuration is declarative where it only runs <code>Configure(IAppHost appHost)</code> in ServiceStack Apps and only adds the <code>RedisScripts</code> if it&#39;s configured with <a href="https://sharpscript.net/docs/sharp-pages" target="_blank" rel="noopener noreferrer">#Script Pages</a>, otherwise any additional configuration is inert and isn&#39;t run.</p><p>Typically DB&#39;s will require you to specify your App DB&#39;s connection string to your external DB (with a default fallback) - where typically the most effort required to enable a feature is adding a Connection String in your <code>appsettings.json</code>.</p><h3 id="composable-features" tabindex="-1">Composable Features <a class="header-anchor" href="#composable-features" aria-hidden="true">#</a></h3><p>A nice characteristic about &quot;no-touch&quot; layerable features are that they&#39;re composable, where <code>mix</code> will let you hand-pick all features you want in a single command. For example you can enable Authentication, register an RDBMS Auth Repository using SQL Server with:</p><div class="language-bash"><pre><code>$ x mix auth auth-db sqlserver
</code></pre></div><p>Which will apply the <a href="https://gist.github.com/gistlyn/1ec54e10d44f87e0f20daaf7e2248fea" target="_blank" rel="noopener noreferrer">Configure.Auth.cs</a>, <a href="https://gist.github.com/gistlyn/16fddde0763b3eee516d670ab9fab194" target="_blank" rel="noopener noreferrer">Configure.AuthRepository.cs</a> and <a href="https://gist.github.com/gistlyn/7075e53e1fe69d3da12996677b5f3a5a" target="_blank" rel="noopener noreferrer">Configure.Db.cs</a> gists.</p><p>If you later wanted to switch to PostgreSQL, you can <code>mix</code> it in with:</p><div class="language-bash"><pre><code>$ x mix postgres
</code></pre></div><p>Where it will override <a href="https://gist.github.com/gistlyn/faf62da8b8ef30849506631025a5d06c" target="_blank" rel="noopener noreferrer">Configure.Db.cs</a> to use the postgres version, leaving any custom logic in <code>Configure.Auth.cs</code> or <code>Configure.AuthRepository.cs</code> untouched.</p><p>Or if you later want to change the Auth Repository to use Redis instead, you can run:</p><div class="language-bash"><pre><code>$ x mix auth-redis
</code></pre></div><p>Where it will override the existing <code>Configure.AuthRepository.cs</code> added by <strong>auth-db</strong>.</p><h3 id="undo-mix" tabindex="-1">Undo mix <a class="header-anchor" href="#undo-mix" aria-hidden="true">#</a></h3><p>In addition to being easy to add, <code>mix</code> makes it easy to undo where you can specify the <code>-delete</code> flag to remove all the Gist files added by all features, e.g:</p><div class="language-bash"><pre><code>$ x mix -delete auth auth-db sqlserver
</code></pre></div><p>Which will let you review all the files in each Gist that will deleted, then hit <code>Enter</code> to confirm:</p><div class="language-"><pre><code>Delete 1 file from &#39;auth&#39; https://gist.github.com/gistlyn/1ec54e10d44f87e0f20daaf7e2248fea:

C:\\Projects\\app\\Configure.Auth.cs

Delete 1 file from &#39;auth-db&#39; https://gist.github.com/gistlyn/16fddde0763b3eee516d670ab9fab194:

C:\\Projects\\app\\Configure.AuthRepository.cs

Delete 1 file from &#39;sqlserver&#39; https://gist.github.com/gistlyn/7075e53e1fe69d3da12996677b5f3a5a:

C:\\Projects\\app\\Configure.Db.cs

Proceed? (n/Y):
</code></pre></div><h3 id="encapsulated-features" tabindex="-1">Encapsulated Features <a class="header-anchor" href="#encapsulated-features" aria-hidden="true">#</a></h3><p>A nice benefit of decoupling features into modular classes is that you&#39;re able to a richer and more customizable out-of-the-box experience.</p><p>Instead of overloading users with daunting amounts of configuration required in common medium-sized Apps, most templates will start with an empty slate and leave it for users to read about each feature then decide how to hand-pick different configuration to slot it into their own App&#39;s configuration.</p><p>On the flip-side if you provide too much configuration Developers wont be confident to know what configuration belongs to which feature and which feature are interconnected or can be safely removed without breaking their App.</p><p>With modular features we can encapsulate configuration in a single <code>.cs</code> file that&#39;s primed with the popular well-known configuration for the feature. E.g. The Auth Repositories include an example of maintaining a custom <code>UserAuth</code> model, registering the <a href="/sessions.html#session-events">Auth Event</a> to populate their additional fields on Authentication and sample code necessary for ensuring a specific Admin User is created on <code>Startup</code>:</p><div class="language-csharp"><pre><code><span class="token keyword">namespace</span> <span class="token namespace">MyApp</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Custom User Table with extended Metadata properties</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppUser</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">UserAuth</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ProfileUrl <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> LastLoginIp <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> LastLoginDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppUserAuthEvents</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AuthEvents</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnAuthenticated</span><span class="token punctuation">(</span><span class="token class-name">IRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">IAuthSession</span> session<span class="token punctuation">,</span> <span class="token class-name">IServiceBase</span> authService<span class="token punctuation">,</span> 
            <span class="token class-name">IAuthTokens</span> tokens<span class="token punctuation">,</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> authInfo<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> authRepo <span class="token operator">=</span> HostContext<span class="token punctuation">.</span>AppHost<span class="token punctuation">.</span><span class="token function">GetAuthRepository</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span>authRepo <span class="token keyword">as</span> <span class="token class-name">IDisposable</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> userAuth <span class="token operator">=</span> <span class="token punctuation">(</span>AppUser<span class="token punctuation">)</span>authRepo<span class="token punctuation">.</span><span class="token function">GetUserAuth</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span>UserAuthId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                userAuth<span class="token punctuation">.</span>ProfileUrl <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">GetProfileUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                userAuth<span class="token punctuation">.</span>LastLoginIp <span class="token operator">=</span> req<span class="token punctuation">.</span>UserHostAddress<span class="token punctuation">;</span>
                userAuth<span class="token punctuation">.</span>LastLoginDate <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">;</span>
                authRepo<span class="token punctuation">.</span><span class="token function">SaveUserAuth</span><span class="token punctuation">(</span>userAuth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigureAuthRepository</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IConfigureAppHost</span><span class="token punctuation">,</span> <span class="token class-name">IConfigureServices</span><span class="token punctuation">,</span> <span class="token class-name">IPreInitPlugin</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IAuthRepository<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OrmLiteAuthRepository<span class="token punctuation">&lt;</span>AppUser<span class="token punctuation">,</span> UserAuthDetails<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDbConnectionFactory<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    UseDistinctRoleTables <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IAppHost</span> appHost<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> authRepo <span class="token operator">=</span> appHost<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IAuthRepository<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            authRepo<span class="token punctuation">.</span><span class="token function">InitSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">CreateUser</span><span class="token punctuation">(</span>authRepo<span class="token punctuation">,</span> <span class="token string">&quot;admin@email.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Admin User&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;p@55wOrd&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">roles</span><span class="token punctuation">:</span><span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span> RoleNames<span class="token punctuation">.</span>Admin <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">BeforePluginsLoaded</span><span class="token punctuation">(</span><span class="token class-name">IAppHost</span> appHost<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            appHost<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AssertPlugin</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AuthFeature<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>AuthEvents<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AppUserAuthEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Add initial Users to the configured Auth Repository</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CreateUser</span><span class="token punctuation">(</span><span class="token class-name">IAuthRepository</span> authRepo<span class="token punctuation">,</span> 
            <span class="token class-name"><span class="token keyword">string</span></span> email<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> password<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> roles<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>authRepo<span class="token punctuation">.</span><span class="token function">GetUserAuthByUserName</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> newAdmin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AppUser</span> <span class="token punctuation">{</span> Email <span class="token operator">=</span> email<span class="token punctuation">,</span> DisplayName <span class="token operator">=</span> name <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> authRepo<span class="token punctuation">.</span><span class="token function">CreateUserAuth</span><span class="token punctuation">(</span>newAdmin<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
                authRepo<span class="token punctuation">.</span><span class="token function">AssignRoles</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> roles<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>All captured within a working configuration. You can start appreciating the instant utility of <code>mix</code> once you imagine what it was like before with how much time an effort it would&#39;ve taken to scan through docs, learn about each feature independently to be able to piece together equivalent functionality.</p><h3 id="mix-in-auth-repository" tabindex="-1">Mix in Auth Repository <a class="header-anchor" href="#mix-in-auth-repository" aria-hidden="true">#</a></h3><p>As it can take a while to piece together how to configure your preferred Auth Repository, use a Custom User Model and utilize <a href="/sessions.html#session-events">Auth Events</a> to populate it, we now recommend using <code>mix</code> to configure your preferred Auth Repository, which you can query with:</p><div class="language-bash"><pre><code>$ x mix <span class="token punctuation">[</span>auth<span class="token punctuation">]</span>
</code></pre></div><p>To display the current list of available Auth Repositories:</p><div class="language-"><pre><code>Results matching tag [auth]:

   1. auth              Configure AuthFeature                        to: $HOST  by @ServiceStack [auth]
   2. auth-db           Use OrmLite Auth Repository (requires auth)  to: $HOST  by @ServiceStack [auth]
   3. auth-redis        Use Redis Auth Repository (requires auth)    to: $HOST  by @ServiceStack [auth]
   4. auth-memory       Use Memory Auth Repository (requires auth)   to: $HOST  by @ServiceStack [auth]
   5. auth-dynamodb     Use DynamoDB Auth Repository (requires auth) to: $HOST  by @ServiceStack [auth]
   6. auth-mongodb      Use MongoDB Auth Repository (requires auth)  to: $HOST  by @ServiceStack [auth]
   7. auth-ravendb      Use RavenDB Auth Repository (requires auth)  to: $HOST  by @ServiceStack [auth]
   8. auth-marten       Use Marten Auth Repository (requires auth)   to: $HOST  by @ServiceStack [auth]
   9. feature-authrepo  List and Search Users in an Auth Repo        to: $HOST  by @ServiceStack [feature,auth]
</code></pre></div><h3 id="mix-in-mq-server" tabindex="-1">Mix in MQ Server <a class="header-anchor" href="#mix-in-mq-server" aria-hidden="true">#</a></h3><p>Likewise we now recommend using <code>mix</code> to configure your preferred MQ Service, other than being quicker to add, it proposes adopting a naming convention in app settings and file names that other <code>mix</code> features can also make use of:</p><div class="language-bash"><pre><code>$ x mix <span class="token punctuation">[</span>mq<span class="token punctuation">]</span>
</code></pre></div><p>Currently available list of MQ Services:</p><div class="language-"><pre><code>Results matching tag [mq]:

   1. backgroundmq  Use Memory Background MQ                    to: $HOST  by @ServiceStack  [mq]
   2. rabbitmq      Use RabbitMQ                                to: $HOST  by @ServiceStack  [mq]
   3. sqs           Use AWS SQS MQ                              to: $HOST  by @ServiceStack  [mq]
   4. servicebus    Use Azure Service Bus MQ                    to: $HOST  by @ServiceStack  [mq]
   5. redismq       Use Redis MQ                                to: $HOST  by @ServiceStack  [mq]
   6. feature-mq    Simple MQ Feature to test sending Messages  to: $HOST  by @ServiceStack  [feature,mq,sharp]
</code></pre></div><h2 id="mix-in-nuglify" tabindex="-1">Mix in NUglify <a class="header-anchor" href="#mix-in-nuglify" aria-hidden="true">#</a></h2><p>You can configure your ServiceStack App to use Nuglify&#39;s Advanced HTML, CSS, JS Minifiers using <a href="/mix-tool.html">mix</a> with:</p><div class="language-bash"><pre><code>$ x mix nuglify 
</code></pre></div><p>Which will write <a href="https://gist.github.com/gistlyn/4bdb79d21f199c22b8a86f032c186e2d" target="_blank" rel="noopener noreferrer">Configure.Nuglify.cs</a> to your <strong>HOST</strong> project.</p><h3 id="mix-in-prebuilt-recipes-and-working-examples" tabindex="-1">Mix in Prebuilt Recipes and Working Examples <a class="header-anchor" href="#mix-in-prebuilt-recipes-and-working-examples" aria-hidden="true">#</a></h3><p><code>ModularStartup</code> and <code>mix</code> can scale up to complete working examples which can provide instant utility and integration of a feature into your existing App. By contrast most working examples are typically made available off to the side in stale projects which need to be downloaded and run in isolation. If it still works you&#39;d then have to compare the project files with your project and carefully copy over the differences you&#39;d think your App needs to replicate its functionality. This can be very time consuming to the point where a lot of users will skip trying to download &amp; run the example and instead try to manually configure it in their App.</p><p>All <code>mix</code> features add their files to your App&#39;s <a href="/physical-project-structure.html">Physical Project Structure</a> where configuration is added to your <code>Host</code> Project, Service Contracts are added to your <code>ServiceModel/</code> folder and Service Implementations added to your <code>ServiceInterface/</code> folder and any Web assets added to your App&#39;s <code>wwwroot/</code>.</p><p>They can also be added to both multi and single project solutions in which case they&#39;ll be added to <code>ServiceInterface</code> and <code>ServiceModel</code> folders in your App&#39;s project folder using the same namespace as used in multi-project solutions, making it easy to upgrade to a multi-project solution later.</p><h3 id="example-validation" tabindex="-1">example-validation <a class="header-anchor" href="#example-validation" aria-hidden="true">#</a></h3><p>The <code>example-validation</code> <strong>mix</strong> is a complete working validation example that&#39;s typical of a real-world validation example complete with Authentication integration allowing each authenticated user to manage their own private Contacts list.</p><p><a href="https://youtu.be/udrLtICylj8" target="_blank" rel="noopener noreferrer"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/mix/example-validation-900.gif" alt=""></a></p><blockquote><p>YouTube: <a href="https://youtu.be/udrLtICylj8" target="_blank" rel="noopener noreferrer">youtu.be/udrLtICylj8</a></p></blockquote><p>To follow video&#39;s example, start with a new <strong>Acme</strong> project from <code>sharp</code> .NET Core Template:</p><div class="language-bash"><pre><code>$ x new script Acme
</code></pre></div><p>Add the <code>example-validation</code> mix:</p><div class="language-bash"><pre><code>$ <span class="token builtin class-name">cd</span> Acme
$ x mix example-validation
</code></pre></div><p>Which will prompt you with a link to the gist and the files that will be added to your project:</p><div class="language-"><pre><code>Write files from &#39;example-validation&#39; https://gist.github.com/gistlyn/33873ed2857b2c5a9623629c6210d665 to:

  C:\\projects\\Acme\\Acme\\Configure.Contacts.cs
  C:\\projects\\Acme\\Acme.ServiceInterface\\ContactServices.cs
  C:\\projects\\Acme\\Acme.ServiceModel\\Contacts.cs
  C:\\projects\\Acme\\Acme\\wwwroot\\contacts\\_id\\edit.html
  C:\\projects\\Acme\\Acme\\wwwroot\\contacts\\_requires-auth-partial.html
  C:\\projects\\Acme\\Acme\\wwwroot\\contacts\\index.html

Proceed? (n/Y):
</code></pre></div><p>Now after restarting your App you&#39;ll be able to add contacts by clicking on the new <strong>Contacts</strong> link in your App&#39;s main menu:</p><div class="language-bash"><pre><code>$ <span class="token builtin class-name">cd</span> Acme
$ dotnet run
</code></pre></div><p>After you&#39;re done reviewing the example you can either refactor it to handle your App&#39;s requirements or completely remove it from your App with:</p><div class="language-bash"><pre><code>$ x mix -delete example-validation
</code></pre></div><h3 id="feature-mq" tabindex="-1">feature-mq <a class="header-anchor" href="#feature-mq" aria-hidden="true">#</a></h3><p>The <code>feature-mq</code> adds MQ support to your App, complete with UI and includes 2 different ways of calling MQ Services in ServiceStack, just like <code>example-validation</code> above, <code>feature-mq</code> is another complete working example with both UI and Service implementation in the following files:</p><ul><li><a href="https://gist.github.com/gistlyn/355338cd60a32ee9c9fc4761269f7782#file-configure-mq-cs" target="_blank" rel="noopener noreferrer">Configure.Mq.cs?</a></li><li><a href="https://gist.github.com/gistlyn/355338cd60a32ee9c9fc4761269f7782#file-feature-mq-cs" target="_blank" rel="noopener noreferrer">Feature.Mq.cs</a></li><li><a href="https://gist.github.com/gistlyn/355338cd60a32ee9c9fc4761269f7782#file-serviceinterface-mqservices-cs" target="_blank" rel="noopener noreferrer">ServiceInterface\\MqServices.cs </a></li><li><a href="https://gist.github.com/gistlyn/355338cd60a32ee9c9fc4761269f7782#file-servicemodel-mq-cs" target="_blank" rel="noopener noreferrer">ServiceModel\\Mq.cs</a></li><li><a href="https://gist.github.com/gistlyn/355338cd60a32ee9c9fc4761269f7782#file-wwwroot-messaging-html" target="_blank" rel="noopener noreferrer">wwwroot\\messaging.html</a></li></ul><p>As <code>Configure.Mq.cs?</code> is optional it will only add it if doesn&#39;t already exist, so it will either use your existing MQ configuration or configure your App to use the In Memory <code>BackgroundMqService</code> implementation.</p><p>Add <code>feature-mq</code> to your project with:</p><div class="language-bash"><pre><code>$ x mix feature-mq
</code></pre></div><p><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/nav/feature-mq.png" alt=""></p><p>This will add the <code>TestMq</code> Service and make it available to your MQ endpoint. <code>TestMq</code> is a regular service that updates values in the App&#39;s registered <code>ICacheClient</code> and returns the Cache&#39;s current values as well as the internal Stats of the MQ:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MqServices</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IMessageService</span> MqService <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">PublishMq</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">PublishMessage</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ConvertTo</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TestMq<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">TestMq</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">)</span>
            Cache<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;mq.name&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>Add <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            Cache<span class="token punctuation">.</span><span class="token function">Increment</span><span class="token punctuation">(</span><span class="token string">&quot;mq.counter&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">uint</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>Add<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>Add <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            Cache<span class="token punctuation">.</span><span class="token function">Decrement</span><span class="token punctuation">(</span><span class="token string">&quot;mq.counter&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">uint</span><span class="token punctuation">)</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>Add <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TestMqResponse</span> <span class="token punctuation">{</span>
            Name <span class="token operator">=</span> Cache<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;mq.name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Counter <span class="token operator">=</span> Cache<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">long</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;mq.counter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            StatsDescription <span class="token operator">=</span> MqService<span class="token punctuation">.</span><span class="token function">GetStatsDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The 2 ways to call a MQ Service is directly using the <code>publish</code> or <code>sendOneWay</code> APIs (available in all ServiceStack Service Clients) where it send the request to the Service&#39;s <code>/oneway</code> endpoint which will automatically publish it to the registered MQ.</p><p>Alternatively you can publish the Request DTO yourself from a different Service Implementation as done in <code>PublishMq</code>, as-is typical for Services that queues sending emails without blocking Service Execution.</p><p>The feature&#39;s UI allows you to publish <code>TestMq</code> messages using either approach:</p><div class="language-js"><pre><code>client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonServiceClient</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> oneway <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;input[name=mq-publish]:checked&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">&quot;OneWay&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>oneway<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    client<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TestMq</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> $txtName<span class="token punctuation">.</span>value<span class="token punctuation">,</span> add<span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PublishMq</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> $txtName<span class="token punctuation">.</span>value<span class="token punctuation">,</span> add<span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Both approaches end with the same result with the <code>TestMq</code> Request DTO published and executed by the registered MQ Service as shown in the UI which is periodically updated with the current state in the Cache and the internal stats of the MQ Service showing how many messages it processed.</p><h3 id="feature-authrepo" tabindex="-1">feature-authrepo <a class="header-anchor" href="#feature-authrepo" aria-hidden="true">#</a></h3><p>Another UI feature <code>mix</code> available is a UI to browse and search for registered users in an Auth Repository.</p><p>This wasn&#39;t generically possible before as <code>IAuthRepository</code> didn&#39;t previously provide any API&#39;s to be able to query all Users, which is now available in the new <code>IQueryUserAuth</code> API:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IQueryUserAuth</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>IUserAuth<span class="token punctuation">&gt;</span></span> <span class="token function">GetUserAuths</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> orderBy <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> skip <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> take <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>IUserAuth<span class="token punctuation">&gt;</span></span> <span class="token function">SearchUserAuths</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> query<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> orderBy <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> skip <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> take <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This is now implemented in all ServiceStack Auth Repositories although there are limitations depending on the queryability of the underlying data provider.</p><p>Searching in these Auth Repositories are efficient and searches in <strong>UserName</strong>, <strong>Email</strong>, <strong>DisplayName</strong> and <strong>Company</strong> fields:</p><ul><li><code>OrmLiteAuthRepository</code></li><li><code>InMemoryAuthRepository</code></li><li><code>MongoDbAuthRepository</code></li></ul><p>For RavenDB it reuses the existing Username/Email indexes so only searches <strong>UserName</strong>, <strong>Email</strong> fields and only performs a StartsWith/EndsWith search as allowed by RavenDB:</p><ul><li><code>RavenDbUserAuthRepository</code></li></ul><p>Searches and Order By&#39;s are very inefficient in Redis as it needs to deserialize all users to perform the querying/sorting on the client. Just paging through users with skip/take is efficient as it only needs to deserialize the partial resultset.</p><ul><li><code>RedisAuthRepository</code></li></ul><p>All queries performs a table scan in DynamoDB but searches all fields:</p><ul><li><code>DynamoDbAuthRepository</code></li></ul><h4 id="api-usage" tabindex="-1">API Usage <a class="header-anchor" href="#api-usage" aria-hidden="true">#</a></h4><p>These API&#39;s are accessible from an <code>IAuthRepository</code> dependency, if you&#39;re using a custom Auth Repository it will need to implement <code>IQueryUserAuth</code> otherwise calling these APIs (and feature) will throw a <code>NotSupportedException</code>:</p><div class="language-csharp"><pre><code>AuthRepository<span class="token punctuation">.</span>GetUserAuths<span class="token return-type class-name"><span class="token punctuation">(</span>orderBy<span class="token punctuation">:</span>fieldName<span class="token punctuation">,</span> skip<span class="token punctuation">:</span>skip<span class="token punctuation">,</span> take<span class="token punctuation">:</span>take<span class="token punctuation">)</span></span>
AuthRepository<span class="token punctuation">.</span><span class="token function">SearchUserAuths</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">query</span><span class="token punctuation">:</span>q<span class="token punctuation">,</span> <span class="token named-parameter punctuation">orderBy</span><span class="token punctuation">:</span>fieldName<span class="token punctuation">,</span> <span class="token named-parameter punctuation">skip</span><span class="token punctuation">:</span>skip<span class="token punctuation">,</span> <span class="token named-parameter punctuation">take</span><span class="token punctuation">:</span>take<span class="token punctuation">)</span>
</code></pre></div><p>The <code>orderBy</code> is the field name you want to order the results by, e.g. <code>UserName</code> and can suffixed with the <code>DESC</code> modifier to order results in descending order, e.g. <code>UserName DESC</code>.</p><p>In <code>#Script</code> these API&#39;s are available in <code>camelCase</code> off <code>authRepo</code> using a JS Object literal as seen in <code>users.html</code> page usage of this feature:</p>__VP_STATIC_END__`,134),i=n("div",null,[n("div",{class:"language-hbs"},[n("pre",{"v-pre":""},[n("code",null,[n("span",{class:"token delimiter punctuation"},"{{"),a(),n("span",{class:"token variable"},"authRepo"),n("span",{class:"token punctuation"},"."),n("span",{class:"token variable"},"searchUserAuths"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),a(),n("span",{class:"token variable"},"query"),n("span",{class:"token punctuation"},":"),n("span",{class:"token variable"},"qs"),n("span",{class:"token punctuation"},"."),n("span",{class:"token variable"},"q"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token variable"},"take"),n("span",{class:"token punctuation"},":"),a(),n("span",{class:"token variable"},"pageSize"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token variable"},"skip"),n("span",{class:"token punctuation"},":"),a(),n("span",{class:"token variable"},"pageSize"),n("span",{class:"token punctuation"},"*"),n("span",{class:"token variable"},"page"),a(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"|"),a(),n("span",{class:"token variable"},"to"),a(),n("span",{class:"token punctuation"},"="),n("span",{class:"token punctuation"},">"),a(),n("span",{class:"token variable"},"users"),a(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},"}"),a(`
`)])])])],-1),r=n("h4",{id:"users-ui",tabindex:"-1"},[a("Users UI "),n("a",{class:"header-anchor",href:"#users-ui","aria-hidden":"true"},"#")],-1),l=n("p",null,[a("Clicking the "),n("strong",null,"Users"),a(" menu item will show you a list of searchable and pageable registered Users in a summary view:")],-1),u=n("p",null,[n("img",{src:"https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/mix/feature-authrepo.png",alt:""})],-1),d=n("p",null,[a("Clicking on a user will show you a complete list of fields stored for that user, including any custom fields, if you're using a Custom "),n("code",null,"UserAuth"),a(" table:")],-1),k=n("p",null,[n("img",{src:"https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/mix/feature-authrepo-admin.png",alt:""})],-1),h=[c,i,r,l,u,d,k];function g(m,y,f,b,v,S){return t(),e("div",null,h)}var x=s(p,[["render",g]]);export{A as __pageData,x as default};
