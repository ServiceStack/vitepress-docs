import{_ as s,c as a,o as t,a as n,b as e}from"./app.14440598.js";const g=`{"title":"AutoQuery CRUD","description":"","frontmatter":{"slug":"autoquery-crud","title":"AutoQuery CRUD"},"headers":[{"level":3,"title":"Rapidly develop data-driven systems","slug":"rapidly-develop-data-driven-systems"},{"level":3,"title":"Creating AutoQuery CRUD Services","slug":"creating-autoquery-crud-services"},{"level":3,"title":"AutoQuery CRUD Attributes","slug":"autoquery-crud-attributes"},{"level":3,"title":"Advanced CRUD Example","slug":"advanced-crud-example"},{"level":3,"title":"AutoPopulate","slug":"autopopulate"},{"level":3,"title":"Multi RDBMS Services","slug":"multi-rdbms-services"},{"level":3,"title":"AutoFilter","slug":"autofilter"},{"level":3,"title":"AutoMap and AutoDefault Attributes","slug":"automap-and-autodefault-attributes"},{"level":3,"title":"AutoIgnore Attributes","slug":"autoignore-attributes"},{"level":3,"title":"Apply Generic CRUD Behaviors","slug":"apply-generic-crud-behaviors"},{"level":3,"title":"AutoQuery CRUD Events","slug":"autoquery-crud-events"},{"level":3,"title":"Custom Complex Mapping","slug":"custom-complex-mapping"},{"level":3,"title":"Auto Guid's","slug":"auto-guid-s"},{"level":3,"title":"Optimistic Concurrency","slug":"optimistic-concurrency"},{"level":3,"title":"MQ AutoQuery CRUD Requests","slug":"mq-autoquery-crud-requests"},{"level":2,"title":"AutoQuery CRUD Features","slug":"autoquery-crud-features"}],"relativePath":"autoquery-crud.md","lastUpdated":1634495307610}`,p={},o=n('',8),c=e("iframe",{width:"896",height:"525",src:"https://www.youtube.com/embed/XpHAaCTV7jE",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,-1),u=n(`__VP_STATIC_START__<h3 id="creating-autoquery-crud-services" tabindex="-1">Creating AutoQuery CRUD Services <a class="header-anchor" href="#creating-autoquery-crud-services" aria-hidden="true">#</a></h3><p>Just like <a href="/autoquery-rdbms.html">AutoQuery</a>, you just need to provide the typed Request DTOs definition for your DB Table APIs and AutoQuery automatically provides the implementation for the Service.</p><p>To enlist Auto CRUD behavior your Request DTOs need to implement one of the following interfaces which dictates the behavior of the Service:</p><ul><li><code>ICreateDb&lt;Table&gt;</code> - Create new Table Entry</li><li><code>IUpdateDb&lt;Table&gt;</code> - Update existing Table Entry</li><li><code>IPatchDb&lt;Table&gt;</code> - Partially update existing Table Entry</li><li><code>IDeleteDb&lt;Table&gt;</code> - Delete existing Table Entry</li></ul><p>All Request DTOs also require either an <code>IReturn&lt;T&gt;</code> or <code>IReturnVoid</code> marker interface to specify the return type of the Service.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Can use built-in <code>IReturn&lt;EmptyResponse&gt;</code> for an &quot;empty&quot; response where as <code>IReturnVoid</code> returns &quot;no&quot; response.</p></div><p>Let&#39;s go through a simple example, starting with a simple POCO OrmLite data model we want to add to our RDBMS:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Rockstar</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoIncrement</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FirstName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> LastName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> DateOfBirth <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> DateDied <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">LivingStatus</span> LivingStatus <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We can create a Service that <strong>inserts</strong> a new <code>Rockstar</code> by defining all the properties we want to allow API consumers to provide when creating a new Rockstar:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateRockstar</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICreateDb<span class="token punctuation">&lt;</span>Rockstar<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>CreateRockstarResponse<span class="token punctuation">&gt;</span></span></span> 
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FirstName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> LastName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> DateOfBirth <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateRockstarResponse</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// Id is auto populated with RDBMS generated Id</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ResponseStatus</span> ResponseStatus <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When ServiceStack starts it generates the implementation for this Service, which can now insert Rockstars using your populated Request DTO:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonServiceClient</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CreateRockstar</span> <span class="token punctuation">{</span>
    FirstName <span class="token operator">=</span> <span class="token string">&quot;Kurt&quot;</span><span class="token punctuation">,</span>
    LastName <span class="token operator">=</span> <span class="token string">&quot;Cobain&quot;</span><span class="token punctuation">,</span>
    Age <span class="token operator">=</span> <span class="token number">27</span><span class="token punctuation">,</span>
    DateOfBirth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DateTime</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1967</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Similarly you can define <strong>Update</strong> and <strong>Delete</strong> Services the same way, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpdateRockstar</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Rockstar</span><span class="token punctuation">,</span>
    <span class="token class-name">IUpdateDb<span class="token punctuation">&lt;</span>Rockstar<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>UpdateRockstarResponse<span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpdateRockstarResponse</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// Id is auto populated with RDBMS generated Id</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Rockstar</span> Result <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// selects &amp; returns latest DB Rockstar</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ResponseStatus</span> ResponseStatus <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>By convention if your Response DTO contains any of these properties it will be automatically populated:</p><ul><li><code>T Id</code> - The Primary Key</li><li><code>T Result</code> - The POCO you want to return (can be a subset of DB model)</li><li><code>int Count</code> - Return the number of rows affected (typically 1, but Deletes can be &gt;1)</li></ul><p>Delete Services need only a Primary Key, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeleteRockstar</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDeleteDb<span class="token punctuation">&lt;</span>Rockstar<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturnVoid</span></span> 
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>and to Query the Rockstar table you have the <a href="/autoquery-rdbms.html">full featureset of AutoQuery</a> for a complete set of CRUD Services without needing to provide any implementations.</p><h3 id="autoquery-crud-attributes" tabindex="-1">AutoQuery CRUD Attributes <a class="header-anchor" href="#autoquery-crud-attributes" aria-hidden="true">#</a></h3><p>AutoQuery CRUD extends existing <a href="/autoquery-rdbms.html">querying functionality in AutoQuery</a> with additional features covering common functionality in CRUD operations:</p><ul><li><code>[AutoApply]</code> - Apply built-in composite generic behavior</li><li><code>[AutoPopulate]</code> - Populate data models with generic user &amp; system info</li><li><code>[AutoFilter]</code> - Apply pre-configured filters to query operations</li><li><code>[AutoMap]</code> - Map System Input properties to Data Model fields</li><li><code>[AutoDefault]</code> - Specify to fallback default values when not provided</li><li><code>[AutoIgnore]</code> - Ignore mapping Request DTO property to Data Model</li></ul><p>Each of these are covered in more detail in the docs and examples below.</p><h3 id="advanced-crud-example" tabindex="-1">Advanced CRUD Example <a class="header-anchor" href="#advanced-crud-example" aria-hidden="true">#</a></h3><p>Lets now explore a more advanced example that implements Audit information as well as layered support for multi-tenancy to see how you can easily compose features.</p><p>So lets say you have an interface that all tables you want to contain Audit information implements:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IAudit</span> 
<span class="token punctuation">{</span>
    <span class="token return-type class-name">DateTime</span> CreatedDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> CreatedBy <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> CreatedInfo <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token return-type class-name">DateTime</span> ModifiedDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> ModifiedBy <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> ModifiedInfo <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> SoftDeletedDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> SoftDeletedBy <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> SoftDeletedInfo <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>It&#39;s not required, but it&#39;s also useful to have a concrete base table which could be annotated like:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AuditBase</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IAudit</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> CreatedDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> CreatedBy <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> CreatedInfo <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> ModifiedDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ModifiedBy <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ModifiedInfo <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Index</span></span><span class="token punctuation">]</span> <span class="token comment">//Check if Deleted</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> SoftDeletedDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> SoftDeletedBy <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> SoftDeletedInfo <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We can then create a base Request DTO that all Audit Create Services will implement:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateIsAuthenticated</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>IAudit<span class="token punctuation">.</span>CreatedDate<span class="token punctuation">)</span><span class="token punctuation">,</span>  Eval <span class="token operator">=</span> <span class="token string">&quot;utcNow&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>IAudit<span class="token punctuation">.</span>CreatedBy<span class="token punctuation">)</span><span class="token punctuation">,</span>    Eval <span class="token operator">=</span> <span class="token string">&quot;userAuthName&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token comment">//or userAuthId</span>
<span class="token punctuation">[</span><span class="token function">AutoPopulate</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>IAudit<span class="token punctuation">.</span>CreatedInfo<span class="token punctuation">)</span><span class="token punctuation">,</span>  Eval <span class="token operator">=</span> <span class="token string">&quot;\`\${userSession.DisplayName} (\${userSession.City})\`&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>IAudit<span class="token punctuation">.</span>ModifiedDate<span class="token punctuation">)</span><span class="token punctuation">,</span> Eval <span class="token operator">=</span> <span class="token string">&quot;utcNow&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>IAudit<span class="token punctuation">.</span>ModifiedBy<span class="token punctuation">)</span><span class="token punctuation">,</span>   Eval <span class="token operator">=</span> <span class="token string">&quot;userAuthName&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token comment">//or userAuthId</span>
<span class="token punctuation">[</span><span class="token function">AutoPopulate</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>IAudit<span class="token punctuation">.</span>ModifiedInfo<span class="token punctuation">)</span><span class="token punctuation">,</span> Eval <span class="token operator">=</span> <span class="token string">&quot;\`\${userSession.DisplayName} (\${userSession.City})\`&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">CreateAuditBase<span class="token punctuation">&lt;</span>Table<span class="token punctuation">,</span>TResponse<span class="token punctuation">&gt;</span></span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICreateDb<span class="token punctuation">&lt;</span>Table<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>TResponse<span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>These all call <a href="https://sharpscript.net/docs/methods" target="_blank" rel="noopener noreferrer">#Script Methods</a> which you can <a href="https://sharpscript.net/docs/sharp-pages#extend" target="_blank" rel="noopener noreferrer">add/extend yourself</a>.</p><p>The <code>*Info</code> examples is a superfluous example showing that you can basically evaluate any <code>#Script</code> expression. Typically you&#39;d only save User Id or Username</p><h3 id="autopopulate" tabindex="-1">AutoPopulate <a class="header-anchor" href="#autopopulate" aria-hidden="true">#</a></h3><p>The <code>[AutoPopulate]</code> attribute tells AutoCrud that you want the DB Table to automatically populate these properties, which can be populated using any of its properties below:</p><ul><li><strong>Value</strong> - A constant value that can be used in C# Attributes, e.g <code>Value=&quot;Foo&quot;</code></li><li><strong>Expression</strong> - A Lightweight <a href="https://sharpscript.net/" target="_blank" rel="noopener noreferrer">#Script</a> Expression that results in a constant value that&#39;s only evaluated once and cached globally, e.g. <code>Expression = &quot;date(2001,1,1)&quot;</code>, useful for values that can&#39;t be defined in C# Attributes like <code>DateTime</code>, can be any <a href="https://sharpscript.net/docs/default-scripts" target="_blank" rel="noopener noreferrer">#Script Method</a>.</li><li><strong>Eval</strong> - A <a href="https://sharpscript.net/" target="_blank" rel="noopener noreferrer">#Script</a> Expression that&#39;s cached per request. E.g. <code>Eval=&quot;utcNow&quot;</code> calls the <code>utcNow</code> Script method which returns <code>DateTime.UtcNow</code> which is cached for that request so all other <code>utcNow</code> expressions will return the same exact value.</li><li><strong>NoCache</strong> - Don&#39;t cache the expression, evaluate it each time.</li></ul><p>AutoCrud makes extensive usage of <code>#Script</code> expressions for much of its declarative functionality which always executes their cached ASTs so expressions are only parsed once and still fast to evaluate even when results are not cached.</p><p>Lets now layer on additional generic functionality by inheriting and extending the base class with additional functionality, e.g. if we want our table to support <a href="/multitenancy.html">Multitenancy</a> we could extend it with:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>IAuditTenant<span class="token punctuation">.</span>TenantId<span class="token punctuation">)</span><span class="token punctuation">,</span> Eval <span class="token operator">=</span> <span class="token string">&quot;Request.Items.TenantId&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">CreateAuditTenantBase<span class="token punctuation">&lt;</span>Table<span class="token punctuation">,</span>TResponse<span class="token punctuation">&gt;</span></span> 
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">CreateAuditBase<span class="token punctuation">&lt;</span>Table<span class="token punctuation">,</span>TResponse<span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>Where <code>TenantId</code> is added in a Global Request Filter (e.g. after inspecting the authenticated UserSession to determine the tenant they belong to), e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> TenantId <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>TenantId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetTenant</span><span class="token punctuation">(</span><span class="token class-name">IRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">IResponse</span> res<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> dto<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> userSession <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">SessionAs</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AuthUserSession<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>userSession<span class="token punctuation">.</span>IsAuthenticated<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        req<span class="token punctuation">.</span><span class="token function">SetItem</span><span class="token punctuation">(</span>TenantId<span class="token punctuation">,</span> userSession<span class="token punctuation">.</span>City <span class="token keyword">switch</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;London&quot;</span> <span class="token operator">=&gt;</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Perth&quot;</span>  <span class="token operator">=&gt;</span> <span class="token number">11</span><span class="token punctuation">,</span>
            <span class="token comment">//...</span>
            _        <span class="token operator">=&gt;</span> <span class="token number">100</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
    
GlobalRequestFilters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>SetTenant<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// HTTP Requests</span>
GlobalMessageRequestFilters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>SetTenant<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// MQ Requests</span>
</code></pre></div><p>Now we easily implement custom &quot;Audited&quot; and &quot;Multi Tenant&quot; CRUD Services by inheriting these base Services.</p><p>Here&#39;s an example of our custom Table that implements our <code>AuditBase</code> class with a <code>TenantId</code> to capture the Tenant the record should be saved to:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RockstarAuditTenant</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AuditBase</span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Index</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> TenantId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoIncrement</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FirstName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> LastName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> DateOfBirth <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> DateDied <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">LivingStatus</span> LivingStatus <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Our service can now implement our base Audit &amp; Multitenant enabled service:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateRockstarAuditTenant</span> 
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">CreateAuditTenantBase<span class="token punctuation">&lt;</span>RockstarAuditTenant<span class="token punctuation">,</span> CreateRockstarResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FirstName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> LastName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> DateOfBirth <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>And all the decorated properties will be automatically populated when creating the Rockstar with <code>CreateRockstarAuditTenant</code>, e.g:</p><div class="language-csharp"><pre><code>client<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CreateRockstarAuditTenant</span> <span class="token punctuation">{</span>
    FirstName <span class="token operator">=</span> <span class="token string">&quot;Kurt&quot;</span><span class="token punctuation">,</span>
    LastName <span class="token operator">=</span> <span class="token string">&quot;Cobain&quot;</span><span class="token punctuation">,</span>
    Age <span class="token operator">=</span> <span class="token number">27</span><span class="token punctuation">,</span>
    DateOfBirth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DateTime</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1967</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We can create the same base classes for Updates:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateIsAuthenticated</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>IAudit<span class="token punctuation">.</span>ModifiedDate<span class="token punctuation">)</span><span class="token punctuation">,</span> Eval <span class="token operator">=</span> <span class="token string">&quot;utcNow&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>IAudit<span class="token punctuation">.</span>ModifiedBy<span class="token punctuation">)</span><span class="token punctuation">,</span>   Eval <span class="token operator">=</span> <span class="token string">&quot;userAuthName&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token comment">//or userAuthId</span>
<span class="token punctuation">[</span><span class="token function">AutoPopulate</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>IAudit<span class="token punctuation">.</span>ModifiedInfo<span class="token punctuation">)</span><span class="token punctuation">,</span> Eval <span class="token operator">=</span> <span class="token string">&quot;\`\${userSession.DisplayName} (\${userSession.City})\`&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">UpdateAuditBase<span class="token punctuation">&lt;</span>Table<span class="token punctuation">,</span>TResponse<span class="token punctuation">&gt;</span></span> 
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IUpdateDb<span class="token punctuation">&lt;</span>Table<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>TResponse<span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoFilter</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>IAuditTenant<span class="token punctuation">.</span>TenantId<span class="token punctuation">)</span><span class="token punctuation">,</span> Eval<span class="token operator">=</span><span class="token string">&quot;Request.Items.TenantId&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">UpdateAuditTenantBase<span class="token punctuation">&lt;</span>Table<span class="token punctuation">,</span>TResponse<span class="token punctuation">&gt;</span></span> 
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">UpdateAuditBase<span class="token punctuation">&lt;</span>Table<span class="token punctuation">,</span>TResponse<span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpdateRockstarAuditTenant</span> 
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">UpdateAuditTenantBase<span class="token punctuation">&lt;</span>RockstarAuditTenant<span class="token punctuation">,</span> RockstarWithIdResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FirstName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">LivingStatus<span class="token punctuation">?</span></span> LivingStatus <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>the <code>[AutoPopulate]</code> properties only appear on the Data Model, not the external Request DTO since we don&#39;t want external API consumers to populate them.</p></div><p>For Apps that prefer to never delete rows and instead mark records as deleted so an audit trail is retained, we can implement &quot;Soft Deletes&quot; using an UPDATE to populate the <code>SoftDelete*</code> fields behind-the-scenes:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateIsAuthenticated</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>IAudit<span class="token punctuation">.</span>SoftDeletedDate<span class="token punctuation">)</span><span class="token punctuation">,</span> Eval <span class="token operator">=</span> <span class="token string">&quot;utcNow&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>IAudit<span class="token punctuation">.</span>SoftDeletedBy<span class="token punctuation">)</span><span class="token punctuation">,</span>   Eval <span class="token operator">=</span> <span class="token string">&quot;userAuthName&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token comment">//or userAuthId</span>
<span class="token punctuation">[</span><span class="token function">AutoPopulate</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>IAudit<span class="token punctuation">.</span>SoftDeletedInfo<span class="token punctuation">)</span><span class="token punctuation">,</span> Eval <span class="token operator">=</span> <span class="token string">&quot;\`\${userSession.DisplayName} (\${userSession.City})\`&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">SoftDeleteAuditBase<span class="token punctuation">&lt;</span>Table<span class="token punctuation">,</span>TResponse<span class="token punctuation">&gt;</span></span> 
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IUpdateDb<span class="token punctuation">&lt;</span>Table<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>TResponse<span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoFilter</span><span class="token attribute-arguments"><span class="token punctuation">(</span>QueryTerm<span class="token punctuation">.</span>Ensure<span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>IAuditTenant<span class="token punctuation">.</span>TenantId<span class="token punctuation">)</span><span class="token punctuation">,</span>  Eval <span class="token operator">=</span> <span class="token string">&quot;Request.Items.TenantId&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">SoftDeleteAuditTenantBase<span class="token punctuation">&lt;</span>Table<span class="token punctuation">,</span>TResponse<span class="token punctuation">&gt;</span></span> 
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SoftDeleteAuditBase<span class="token punctuation">&lt;</span>Table<span class="token punctuation">,</span>TResponse<span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SoftDeleteAuditTenant</span> 
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SoftDeleteAuditTenantBase<span class="token punctuation">&lt;</span>RockstarAuditTenant<span class="token punctuation">,</span> RockstarWithIdResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To implement a &quot;Real&quot; permanently destructive DELETE you would instead implement <code>IDeleteDb&lt;T&gt;</code>:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateIsAuthenticated</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoFilter</span><span class="token attribute-arguments"><span class="token punctuation">(</span>QueryTerm<span class="token punctuation">.</span>Ensure<span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>IAuditTenant<span class="token punctuation">.</span>TenantId<span class="token punctuation">)</span><span class="token punctuation">,</span>  Eval <span class="token operator">=</span> <span class="token string">&quot;Request.Items.TenantId&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RealDeleteAuditTenant</span> 
    <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDeleteDb<span class="token punctuation">&lt;</span>RockstarAuditTenant<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>RockstarWithIdResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="multi-rdbms-services" tabindex="-1">Multi RDBMS Services <a class="header-anchor" href="#multi-rdbms-services" aria-hidden="true">#</a></h3><p>As they&#39;re just regular ServiceStack Services everything you\u2019re used to that works with normal services also works with new Auto Crud Services, to recap you can annotate the <strong>DB Model</strong> with the <code>[NamedConnection]</code> attribute to specify which <a href="/multitenancy.html#changedb-apphost-registration">registered named connection</a> AutoQuery should use:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">NamedConnection</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Reporting&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NamedRockstar</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Rockstar</span></span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token comment">//DB Model</span>
</code></pre></div><p>Where all AutoQuery Services for that data model will query the <strong>Reporting</strong> database instead:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateNamedRockstar</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">RockstarBase</span><span class="token punctuation">,</span> 
    <span class="token class-name">ICreateDb<span class="token punctuation">&lt;</span>NamedRockstar<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>RockstarWithIdAndResultResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpdateNamedRockstar</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">RockstarBase</span><span class="token punctuation">,</span> 
    <span class="token class-name">IUpdateDb<span class="token punctuation">&lt;</span>NamedRockstar<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>RockstarWithIdAndResultResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="custom-autoquery-crud-services" tabindex="-1">Custom AutoQuery CRUD Services <a class="header-anchor" href="#custom-autoquery-crud-services" aria-hidden="true">#</a></h4><p>Alternatively the <code>[ConnectionInfo]</code> can be <a href="/multitenancy.html#connectioninfo-attribute">used on Service implementations</a>, but as AutoQuery doesn&#39;t have them you&#39;d need to provide custom implementations that can delegate to their respective Auto Crud API, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ConnectionInfo</span><span class="token attribute-arguments"><span class="token punctuation">(</span>NamedConnection <span class="token operator">=</span> MyDatabases<span class="token punctuation">.</span>Reporting<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyReportingServices</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IAutoQueryDb</span> AutoQuery <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">CreateConnectionInfoRockstar</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
        AutoQuery<span class="token punctuation">.</span><span class="token function">CreateAsync</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> Request<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">UpdateConnectionInfoRockstar</span> request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
        AutoQuery<span class="token punctuation">.</span><span class="token function">UpdateAsync</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> Request<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="autofilter" tabindex="-1">AutoFilter <a class="header-anchor" href="#autofilter" aria-hidden="true">#</a></h3><p>If you&#39;re creating Soft Delete &amp; Multi tenant services you&#39;ll want to ensure that every query only returns records in their tenant and doesn&#39;t return deleted items, which we can implement using an <code>[AutoFilter]</code>, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ValidateIsAuthenticated</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoFilter</span><span class="token attribute-arguments"><span class="token punctuation">(</span>QueryTerm<span class="token punctuation">.</span>Ensure<span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>IAudit<span class="token punctuation">.</span>SoftDeletedDate<span class="token punctuation">)</span><span class="token punctuation">,</span> Template <span class="token operator">=</span> SqlTemplate<span class="token punctuation">.</span>IsNull<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoFilter</span><span class="token attribute-arguments"><span class="token punctuation">(</span>QueryTerm<span class="token punctuation">.</span>Ensure<span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>IAuditTenant<span class="token punctuation">.</span>TenantId<span class="token punctuation">)</span><span class="token punctuation">,</span>  Eval <span class="token operator">=</span> <span class="token string">&quot;Request.Items.TenantId&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">QueryDbTenant<span class="token punctuation">&lt;</span>From<span class="token punctuation">,</span> Into<span class="token punctuation">&gt;</span></span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">QueryDb<span class="token punctuation">&lt;</span>From<span class="token punctuation">,</span> Into<span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>The <code>[AutoFilter]</code> lets you add pre-configured filters to the query, <code>QueryTerm.Ensure</code> utilizes OrmLite&#39;s new <code>Ensure()</code> APIs which forces always applying this filter, even if the query contains other <code>OR</code> conditions.</p><p>This base class will then let you create concrete queries that doesn&#39;t return soft deleted rows and only returns rows from the same tenant as the authenticated user, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryRockstarAudit</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">QueryDbTenant<span class="token punctuation">&lt;</span>RockstarAuditTenant<span class="token punctuation">,</span> Rockstar<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To coincide with AutoCRUD there&#39;s also support for <a href="https://github.com/ServiceStack/ServiceStack/blob/master/tests/ServiceStack.WebHost.Endpoints.Tests/AutoQueryCrudTests.Validate.cs" target="_blank" rel="noopener noreferrer">declarative validation</a> which thanks to <a href="https://sharpscript.net/" target="_blank" rel="noopener noreferrer">#Script</a> lets you define your Fluent Validation Rules by annotating your Request DTO properties. As it&#39;s essentially a different way to define Fluent Validation Rules, it still <a href="/validation.html#validation-feature">needs Validation enabled</a> to run:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ValidationFeature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="automap-and-autodefault-attributes" tabindex="-1">AutoMap and AutoDefault Attributes <a class="header-anchor" href="#automap-and-autodefault-attributes" aria-hidden="true">#</a></h3><p>The <code>[AutoDefault]</code> attribute allows you to specify default values that the Data Model should be populated with using the same <code>#Script</code> expression support available in <code>[AutoPopulate]</code> to populate constant values, cached constant expressions or results of full evaluated expressions.</p><p>The <code>[AutoMap]</code> attributes enables the flexibility of being able to maintain different external property names from their internal data models, but still be able to declaratively map them.</p><p>Here&#39;s an example <code>ICreateDb&lt;T&gt;</code> AutoCrud Service that makes use of both these attributes to achieve its desired behavior:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateRockstarAutoMapDefault</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICreateDb<span class="token punctuation">&lt;</span>Rockstar<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>RockstarWithIdResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoMap</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>Rockstar<span class="token punctuation">.</span>FirstName<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> MapFirstName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoMap</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>Rockstar<span class="token punctuation">.</span>LastName<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> MapLastName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoMap</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>Rockstar<span class="token punctuation">.</span>Age<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoDefault</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Value <span class="token operator">=</span> <span class="token number">21</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> MapAge <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoMap</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>Rockstar<span class="token punctuation">.</span>DateOfBirth<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoDefault</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Expression <span class="token operator">=</span> <span class="token string">&quot;date(2001,1,1)&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> MapDateOfBirth <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoMap</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>Rockstar<span class="token punctuation">.</span>DateDied<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoDefault</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Eval <span class="token operator">=</span> <span class="token string">&quot;utcNow&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> MapDateDied <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoMap</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>Rockstar<span class="token punctuation">.</span>LivingStatus<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoDefault</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Value <span class="token operator">=</span> LivingStatus<span class="token punctuation">.</span>Dead<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">LivingStatus<span class="token punctuation">?</span></span> MapLivingStatus <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="autoignore-attributes" tabindex="-1">AutoIgnore Attributes <a class="header-anchor" href="#autoignore-attributes" aria-hidden="true">#</a></h3><p>To send additional properties with your AutoQuery CRUD Request DTO which doesn&#39;t match the data model you can ignore the validation check by annotating properties with the <code>[AutoIgnore]</code> Attribute, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomRockstarService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICreateDb<span class="token punctuation">&lt;</span>Rockstar<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>RockstarWithIdResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoIgnore</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">CustomInfo</span> CustomInfo <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span><span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Or you can ignore validation for all properties with the same name by registering it to <code>AutoQuery.IncludeCrudProperties</code>, e.g:</p><div class="language-csharp"><pre><code>AutoQuery<span class="token punctuation">.</span>IncludeCrudProperties<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>CustomInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="apply-generic-crud-behaviors" tabindex="-1">Apply Generic CRUD Behaviors <a class="header-anchor" href="#apply-generic-crud-behaviors" aria-hidden="true">#</a></h3><p>The AutoQuery Attributes are used to construct a metadata model of each operation used to enlist the desired functionality that each Service should have. This metadata model can also be programmatically constructed allowing you to codify conventions by grouping annotated attributes under a single <code>[AutoApply]</code> attribute resulting in the same behavior had the AutoQuery Request been annotated with the attributes directly, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Behavior<span class="token punctuation">.</span>AuditQuery<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryBookings</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span> <span class="token comment">// Equivalent to:</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoFilter</span><span class="token attribute-arguments"><span class="token punctuation">(</span>QueryTerm<span class="token punctuation">.</span>Ensure<span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>DeletedDate<span class="token punctuation">)</span><span class="token punctuation">,</span> Template <span class="token operator">=</span> SqlTemplate<span class="token punctuation">.</span>IsNull<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QueryBookings</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>


<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Behavior<span class="token punctuation">.</span>AuditCreate<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateBooking</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span> <span class="token comment">// Equivalent to:</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>CreatedDate<span class="token punctuation">)</span><span class="token punctuation">,</span>  Eval <span class="token operator">=</span> <span class="token string">&quot;utcNow&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>CreatedBy<span class="token punctuation">)</span><span class="token punctuation">,</span>    Eval <span class="token operator">=</span> <span class="token string">&quot;userAuthName&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>ModifiedDate<span class="token punctuation">)</span><span class="token punctuation">,</span> Eval <span class="token operator">=</span> <span class="token string">&quot;utcNow&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>ModifiedBy<span class="token punctuation">)</span><span class="token punctuation">,</span>   Eval <span class="token operator">=</span> <span class="token string">&quot;userAuthName&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateBooking</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><p>The <code>[AutoApply]</code> attribute is itself an inert marker for capturing what generic behavior you want applied to AutoQuery Services. All built-in behavior is declared on the <code>Behavior</code> static class:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Behavior</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Auto Filter SoftDeleted Results</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> AuditQuery <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Auto Populate CreatedDate, CreatedBy, ModifiedDate &amp; ModifiedBy fields</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> AuditCreate <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditCreate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Auto Populate ModifiedDate &amp; ModifiedBy fields</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> AuditModify <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditModify<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Auto Populate DeletedDate &amp; DeletedBy fields</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> AuditDelete <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditDelete<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Auto Populate DeletedDate &amp; DeletedBy fields and changes IDeleteDb operation to Update</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> AuditSoftDelete <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditSoftDelete<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This functionality is implemented by extending the metadata for AutoQuery CRUD Services with additional attributes in <code>AutoQueryFeature.AutoCrudMetadataFilters</code> delegate filters where they result in the same behavior as if the Request DTOs were annotated with attributes directly. E.g. Here&#39;s the built-in filter for implementing the above behaviors:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AuditAutoCrudMetadataFilter</span><span class="token punctuation">(</span><span class="token class-name">AutoCrudMetadata</span> meta<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> applyAttr <span class="token keyword">in</span> meta<span class="token punctuation">.</span>AutoApplyAttrs<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>applyAttr<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">case</span> Behavior<span class="token punctuation">.</span>AuditQuery<span class="token punctuation">:</span>
                meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoFilterAttribute</span><span class="token punctuation">(</span>
                    QueryTerm<span class="token punctuation">.</span>Ensure<span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>DeletedDate<span class="token punctuation">)</span><span class="token punctuation">,</span> SqlTemplate<span class="token punctuation">.</span>IsNull<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> Behavior<span class="token punctuation">.</span>AuditCreate<span class="token punctuation">:</span>
            <span class="token keyword">case</span> Behavior<span class="token punctuation">.</span>AuditModify<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>applyAttr<span class="token punctuation">.</span>Name <span class="token operator">==</span> Behavior<span class="token punctuation">.</span>AuditCreate<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoPopulateAttribute</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>CreatedDate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        Eval <span class="token operator">=</span> <span class="token string">&quot;utcNow&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoPopulateAttribute</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>CreatedBy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        Eval <span class="token operator">=</span> <span class="token string">&quot;userAuthName&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoPopulateAttribute</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>ModifiedDate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    Eval <span class="token operator">=</span> <span class="token string">&quot;utcNow&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoPopulateAttribute</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>ModifiedBy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    Eval <span class="token operator">=</span> <span class="token string">&quot;userAuthName&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> Behavior<span class="token punctuation">.</span>AuditDelete<span class="token punctuation">:</span>
            <span class="token keyword">case</span> Behavior<span class="token punctuation">.</span>AuditSoftDelete<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>applyAttr<span class="token punctuation">.</span>Name <span class="token operator">==</span> Behavior<span class="token punctuation">.</span>AuditSoftDelete<span class="token punctuation">)</span>
                    meta<span class="token punctuation">.</span>SoftDelete <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

                meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoPopulateAttribute</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>DeletedDate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    Eval <span class="token operator">=</span> <span class="token string">&quot;utcNow&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoPopulateAttribute</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">.</span>DeletedBy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    Eval <span class="token operator">=</span> <span class="token string">&quot;userAuthName&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can use this same functionality to describe your own custom generic functionality, e.g. Lets say you wanted to instead populate your base class with Audit Info containing different named properties with <strong>local</strong> <code>DateTime</code> and UserAuth <code>Id</code>. You can define your own Behavior name for this functionality:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoApply</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;MyUpdate&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpdateBooking</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><p>and implement it with a custom <code>AutoCrudMetadataFilters</code> that populates the Audit <code>[AutoPopulate]</code> attributes on all Request DTOs marked with your Behavior name, e.g:</p><div class="language-csharp"><pre><code><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MyAuditFilter</span><span class="token punctuation">(</span><span class="token class-name">AutoCrudMetadata</span> meta<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>meta<span class="token punctuation">.</span><span class="token function">HasAutoApply</span><span class="token punctuation">(</span><span class="token string">&quot;MyUpdate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoPopulateAttribute</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MyBase<span class="token punctuation">.</span>MyModifiedDate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Eval <span class="token operator">=</span> <span class="token string">&quot;now&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoPopulateAttribute</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MyBase<span class="token punctuation">.</span>MyModifiedBy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Eval <span class="token operator">=</span> <span class="token string">&quot;userAuthId&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoQueryFeature</span> <span class="token punctuation">{</span>
    AutoCrudMetadataFilters <span class="token operator">=</span> <span class="token punctuation">{</span> MyAuditFilter <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="autoquery-crud-events" tabindex="-1">AutoQuery CRUD Events <a class="header-anchor" href="#autoquery-crud-events" aria-hidden="true">#</a></h3><p>AutoQuery includes <code>OnBefore*</code> and <code>OnAfter*</code> (sync &amp; async) events for <code>Create</code>, <code>Update</code>, <code>Patch</code> &amp; <code>Delete</code> that can be used to execute custom logic before or after each AutoQuery CRUD operation. E.g. if your system implements their own Audit history via RDBMS triggers, you can use the <code>OnBefore</code> <strong>Delete</strong> event to update the record with deleted info before the AutoQuery CRUD operation deletes it:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoQueryFeature</span> <span class="token punctuation">{</span>
    OnBeforeDeleteAsync <span class="token operator">=</span> <span class="token keyword">async</span> ctx <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>Dto <span class="token keyword">is</span> <span class="token class-name">DeleteBooking</span> deleteBooking<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> session <span class="token operator">=</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token function">GetSessionAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>Db<span class="token punctuation">.</span><span class="token function">UpdateOnlyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Booking</span> <span class="token punctuation">{</span>
                DeletedBy <span class="token operator">=</span> session<span class="token punctuation">.</span>UserAuthName<span class="token punctuation">,</span>
                DeletedDate <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">where</span><span class="token punctuation">:</span> x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Id <span class="token operator">==</span> deleteBooking<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>                
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>AutoQuery generates <strong>async</strong> Services by default which will invoke the <code>*Async</code> events, but if you implement a <a href="/autoquery-crud.html#custom-autoquery-crud-services">sync Custom AutoQuery CRUD Service</a> it executes the <strong>sync</strong> events instead so you&#39;d need to implement the <code>OnBeforeDelete</code> custom hook instead.</p></div><h3 id="custom-complex-mapping" tabindex="-1">Custom Complex Mapping <a class="header-anchor" href="#custom-complex-mapping" aria-hidden="true">#</a></h3><p>Another opportunity to apply more complex custom mapping logic before resorting to creating an actual Service implementation is to make use of ServiceStack&#39;s built-in <a href="/auto-mapping.html#intercept-automapping-conversions">Auto Mapping Populator API</a> to intercept an AutoMapping conversion between 2 types and apply custom logic after <code>ConvertTo&lt;T&gt;</code> or <code>PopulateWith&lt;T&gt;</code> APIs, e.g:</p><div class="language-csharp"><pre><code>AutoMapping<span class="token punctuation">.</span><span class="token function">RegisterPopulator</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> target<span class="token punctuation">,</span> <span class="token class-name">CreateRockstar</span> source<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">IsAlive</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        target<span class="token punctuation">[</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>LivingStatus<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> LivingStatus<span class="token punctuation">.</span>Dead<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="auto-guid-s" tabindex="-1">Auto Guid&#39;s <a class="header-anchor" href="#auto-guid-s" aria-hidden="true">#</a></h3><p>In addition to supporting <code>[AutoIncrement]</code> to insert records with Auto Incrementing Ids, you can use <code>[AutoId]</code> to insert entities with <a href="https://github.com/ServiceStack/ServiceStack.OrmLite#auto-populated-guid-ids" target="_blank" rel="noopener noreferrer">RDBMS generated UUIDs</a> where they&#39;re supported otherwise OrmLite populates them with <code>Guid.NewGuid()</code>.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>usage of inheritance isn&#39;t required &amp; has the same behavior as using explicit properties</p></div><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">RockstarBase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FirstName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> LastName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> DateOfBirth <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Rockstar</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">RockstarBase</span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoId</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Guid</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateRockstarWithAutoGuid</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">RockstarBase</span><span class="token punctuation">,</span> <span class="token class-name">ICreateDb<span class="token punctuation">&lt;</span>Rockstar<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>RockstarWithIdResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Or if you prefer for Id&#39;s to always be populated with <code>Guid.NewGuid()</code>, remove <code>[AutoId]</code> and populate it with <code>[AutoPopulate]</code> instead:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoPopulate</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>Rockstar<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">,</span>  Eval <span class="token operator">=</span> <span class="token string">&quot;nguid&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateRockstarWithAutoGuid</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">RockstarBase</span><span class="token punctuation">,</span> <span class="token class-name">ICreateDb<span class="token punctuation">&lt;</span>Rockstar<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>RockstarWithIdResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="optimistic-concurrency" tabindex="-1">Optimistic Concurrency <a class="header-anchor" href="#optimistic-concurrency" aria-hidden="true">#</a></h3><p>We can declaratively add support for <a href="https://github.com/ServiceStack/ServiceStack.OrmLite#optimistic-concurrency" target="_blank" rel="noopener noreferrer">OrmLite&#39;s Optimistic Concurrency</a> by including <code>ulong RowVersion</code> property on Auto Crud Request/Response DTOs and Data Models, e.g:</p><div class="language-csharp"><pre><code><span class="token comment">// Data Model</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RockstarVersion</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">RockstarBase</span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoIncrement</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">ulong</span></span> RowVersion <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateRockstarVersion</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">RockstarBase</span><span class="token punctuation">,</span> <span class="token class-name">ICreateDb<span class="token punctuation">&lt;</span>RockstarVersion<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
    <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>RockstarWithIdAndRowVersionResponse<span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpdateRockstarVersion</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">RockstarBase</span><span class="token punctuation">,</span> <span class="token class-name">IPatchDb<span class="token punctuation">&lt;</span>RockstarVersion<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
    <span class="token class-name">IReturn<span class="token punctuation">&lt;</span>RockstarWithIdAndRowVersionResponse<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">ulong</span></span> RowVersion <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Response DTO</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RockstarWithIdAndRowVersionResponse</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">ulong</span></span> RowVersion <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ResponseStatus</span> ResponseStatus <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>AutoQuery will populate the <code>RowVersion</code> in Response DTOs which will need to be provided whenever making changes to that entity where it will fail to update the entity if no <code>RowVersion</code> was provided or has since been modified:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> createResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CreateRockstarVersion</span> <span class="token punctuation">{</span>
    FirstName <span class="token operator">=</span> <span class="token string">&quot;Original&quot;</span><span class="token punctuation">,</span>
    LastName <span class="token operator">=</span> <span class="token string">&quot;Version&quot;</span><span class="token punctuation">,</span>
    Age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>
    DateOfBirth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DateTime</span><span class="token punctuation">(</span><span class="token number">2001</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    LivingStatus <span class="token operator">=</span> LivingStatus<span class="token punctuation">.</span>Dead<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// throws OptimisticConcurrencyException: No RowVersion provided</span>
client<span class="token punctuation">.</span><span class="token function">Patch</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">UpdateRockstarVersion</span> <span class="token punctuation">{</span>
    Id <span class="token operator">=</span> createResponse<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> 
    LastName <span class="token operator">=</span> <span class="token string">&quot;UpdatedVersion&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// succeeds if &quot;Original Version&quot; wasn&#39;t modified otherwise throws OptimisticConcurrencyException </span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Patch</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">UpdateRockstarVersion</span> <span class="token punctuation">{</span>
    Id <span class="token operator">=</span> createResponse<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> 
    LastName <span class="token operator">=</span> <span class="token string">&quot;UpdatedVersion&quot;</span><span class="token punctuation">,</span>
    RowVersion <span class="token operator">=</span> createResponse<span class="token punctuation">.</span>RowVersion<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="mq-autoquery-crud-requests" tabindex="-1">MQ AutoQuery CRUD Requests <a class="header-anchor" href="#mq-autoquery-crud-requests" aria-hidden="true">#</a></h3><p>As AutoQuery CRUD Services are just ServiceStack Services they can partake in its ecosystem of features like being able to <a href="/messaging.html">invoke Services via MQ</a>, although there&#39;s some extra consideration needed to account for the differences between HTTP and MQ Requests. First whatever filters you&#39;ve added to populate the <code>IRequest.Items</code> like tenant Id you&#39;ll also need to register in <code>GlobalMessageRequestFilters</code> so they&#39;re executed for MQ Requests as well:</p><div class="language-csharp"><pre><code>GlobalRequestFilters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>SetTenant<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// HTTP Requests</span>
GlobalMessageRequestFilters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>SetTenant<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// MQ Requests</span>
</code></pre></div><p>Secondly Auth Information is typically sent in the HTTP Request Headers, but they need to be included in the Request DTO to send Authenticated MQ Requests, which can either implement <code>IHasSessionId</code> for normal <a href="/authentication-and-authorization.html#session-authentication-overview">Session Auth Providers</a>, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateRockstarAuditTenant</span> 
  <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">CreateAuditTenantBase<span class="token punctuation">&lt;</span>RockstarAuditTenant<span class="token punctuation">,</span> RockstarWithIdAndResultResponse<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IHasSessionId</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> SessionId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">//Authenticate MQ Requests</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Alternatively they can implement <code>IHasBearerToken</code> for <a href="/authentication-and-authorization.html#authentication-per-request-auth-providers">stateless Bearer Token</a> Auth providers like JWT or API Keys.</p><p>If you&#39;re publishing an MQ Request inside a HTTP Service you can use the <code>PopulateRequestDtoIfAuthenticated</code> extension method which populates the Request DTO from the Authenticated HTTP Request, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutoCrudMqServices</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Service</span></span>
<span class="token punctuation">{</span>        
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">CreateRockstarAuditTenantMq</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> mqRequest <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ConvertTo</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CreateRockstarAuditTenant<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Request<span class="token punctuation">.</span><span class="token function">PopulateRequestDtoIfAuthenticated</span><span class="token punctuation">(</span>mqRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">PublishMessage</span><span class="token punctuation">(</span>mqRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In this case if using <a href="/background-mq.html">Background MQ</a>, it will execute the <code>CreateRockstarAuditTenant</code> request in a background thread, populating the MQ Request Context with the session identified by the <code>IRequest.GetSessionId()</code>.</p><h4 id="publishing-requests-to-oneway-endpoint" tabindex="-1">Publishing Requests to OneWay Endpoint <a class="header-anchor" href="#publishing-requests-to-oneway-endpoint" aria-hidden="true">#</a></h4><p>You can also send MQ requests directly by <a href="/messaging.html#oneway-http-requests-are-published-to-mq-then-executed">publishing to the OneWay HTTP endpoint</a>, which if your AppHost is registered with an MQ Server, it will publish the message to the MQ and auto populate Request DTOs that implements <code>IHasSessionId</code> or <code>IHasBearerToken</code>, either if implicitly sent from an Authenticated client:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> authResponse <span class="token operator">=</span> authClient<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Authenticate</span> <span class="token punctuation">{</span>
    provider <span class="token operator">=</span> <span class="token string">&quot;credentials&quot;</span><span class="token punctuation">,</span>
    UserName <span class="token operator">=</span> <span class="token string">&quot;admin@email.com&quot;</span><span class="token punctuation">,</span>
    Password <span class="token operator">=</span> <span class="token string">&quot;p@55wOrd&quot;</span><span class="token punctuation">,</span>
    RememberMe <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

authClient<span class="token punctuation">.</span><span class="token function">SendOneWay</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CreateRockstarAuditTenant</span> <span class="token punctuation">{</span>
    FirstName <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>CreateRockstarAuditTenant<span class="token punctuation">)</span><span class="token punctuation">,</span>
    LastName <span class="token operator">=</span> <span class="token string">&quot;SessionId&quot;</span><span class="token punctuation">,</span>
    Age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>
    DateOfBirth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DateTime</span><span class="token punctuation">(</span><span class="token number">2002</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or from an anonymous client with the explicit <code>BearerToken</code> or <code>SessionId</code> properties populated, e.g:</p><div class="language-csharp"><pre><code>client<span class="token punctuation">.</span><span class="token function">SendOneWay</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CreateRockstarAuditMqToken</span> <span class="token punctuation">{</span>
    BearerToken <span class="token operator">=</span> JwtUserToken<span class="token punctuation">,</span>
    FirstName <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>CreateRockstarAuditMqToken<span class="token punctuation">)</span><span class="token punctuation">,</span>
    LastName <span class="token operator">=</span> <span class="token string">&quot;JWT&quot;</span><span class="token punctuation">,</span>
    Age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>
    DateOfBirth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DateTime</span><span class="token punctuation">(</span><span class="token number">2002</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To save populating the <code>BearerToken</code> in each request, you can set it once on the Service Client which will automatically populate it on Request DTOs:</p><div class="language-csharp"><pre><code>client<span class="token punctuation">.</span>BearerToken <span class="token operator">=</span> jwtUserToken<span class="token punctuation">;</span>
</code></pre></div><h2 id="autoquery-crud-features" tabindex="-1">AutoQuery CRUD Features <a class="header-anchor" href="#autoquery-crud-features" aria-hidden="true">#</a></h2><p>Building upon AutoQuery is a number of other features that increase the capabilities of AutoQuery Services &amp; provide instant utility, including:</p><ul><li><a href="/declarative-validation.html">Declarative Validation</a></li><li><a href="/autoquery-audit-log.html">Executable Audit Log</a></li><li><a href="/autoquery-autogen.html">Instantly Servicify with AutoGen</a></li></ul>__VP_STATIC_END__`,129),l=[o,c,u];function i(k,r,d,y,m,w){return t(),a("div",null,l)}var b=s(p,[["render",i]]);export{g as __pageData,b as default};
