import{_ as t,c as e,o as n,b as a,e as s,a as o}from"./app.14440598.js";const y='{"title":"AWS Project Templates","description":"","frontmatter":{"title":"AWS Project Templates","slug":"templates-aws"},"headers":[{"level":2,"title":"aws-lambda","slug":"aws-lambda"},{"level":3,"title":"Prerequisites","slug":"prerequisites"},{"level":3,"title":"Built with GitHub Actions","slug":"built-with-github-actions"},{"level":3,"title":"Use Case for ServiceStack App on AWS Lambda","slug":"use-case-for-servicestack-app-on-aws-lambda"},{"level":3,"title":"Deployment process","slug":"deployment-process"},{"level":3,"title":"Public access via custom subdomain","slug":"public-access-via-custom-subdomain"},{"level":3,"title":"AWS Lambda Cold starts","slug":"aws-lambda-cold-starts"}],"relativePath":"templates-aws.md","lastUpdated":1634495308450}',p={},i=a("p",null,".NET 5.0 Amazon AWS Lambda Container Project Template",-1),c=a("h2",{id:"aws-lambda",tabindex:"-1"},[s("aws-lambda "),a("a",{class:"header-anchor",href:"#aws-lambda","aria-hidden":"true"},"#")],-1),r=a("iframe",{width:"896",height:"525",src:"https://www.youtube.com/embed/8mpGNTsSlvE",frameborder:"0",allow:"autoplay; encrypted-media",allowfullscreen:""},null,-1),l=o(`<blockquote><p>YouTube: <a href="https://youtu.be/8mpGNTsSlvE" target="_blank" rel="noopener noreferrer">https://youtu.be/8mpGNTsSlvE</a></p></blockquote><p>This project lets you create a .NET 5 empty ServiceStack web project ready for deployment as a AWS Lambda Function wired with API GateWay and packaged via a Docker image.</p><p>Create new project with <a href="https://docs.servicestack.net/dotnet-new" target="_blank" rel="noopener noreferrer">x dotnet tool</a>:</p><div class="language-bash"><pre><code>$ dotnet tool <span class="token function">install</span> -g x
$ x new aws-lambda ProjectName
</code></pre></div><h3 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-hidden="true">#</a></h3><ul><li><a href="https://dotnet.microsoft.com/download/dotnet-core/3.1" target="_blank" rel="noopener noreferrer">.NET Core SDK 3.1 (runtime 5.0+) or higher</a></li><li><a href="https://docs.aws.amazon.com/lambda/latest/dg/csharp-package-cli.html" target="_blank" rel="noopener noreferrer">AWS .NET Core CLI</a></li><li><a href="https://aws.amazon.com/free/" target="_blank" rel="noopener noreferrer">AWS account</a></li></ul><h3 id="built-with-github-actions" tabindex="-1">Built with GitHub Actions <a class="header-anchor" href="#built-with-github-actions" aria-hidden="true">#</a></h3><p>The above pre-requisites are setup ready to use with this template via GitHub Actions.</p><p>GitHub Actions need to authenticate with AWS required to deploy your application. To enable this you&#39;ll need to setup an IAM account specifically to enable this. This IAM account will need the permissions required to create and manage all the related AWS resources.</p><p>Below is an example of a IAM policy for a &#39;deploy&#39; user that will be able to use the <code>serverless.template</code> CloudFormation file with AWS .NET Core CLI.</p><div class="language-json"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;Version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2012-10-17&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;Statement&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;Sid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VisualEditor0&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;Effect&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Allow&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;Action&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;lambda:CreateFunction&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;lambda:TagResource&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;lambda:AddPermission&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;lambda:ListFunctions&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;lambda:InvokeFunction&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;lambda:InvokeAsync&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;lambda:GetFunctionConfiguration&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;lambda:GetFunction&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;lambda:UpdateAlias&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;lambda:UpdateFunctionCode&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;lambda:DeleteAlias&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;lambda:DeleteFunction&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;lambda:PublishVersion&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;lambda:CreateAlias&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;iam:DeleteRole&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;iam:CreateRole&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;iam:AttachRolePolicy&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;iam:GetRole&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;iam:PassRole&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;iam:DetachRolePolicy&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;cloudformation:*&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;apigateway:*&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ecr:UploadLayerPart&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ecr:CompleteLayerUpload&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ecr:DescribeRepositories&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ecr:BatchCheckLayerAvailability&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ecr:CreateRepository&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ecr:GetDownloadUrlForLayer&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ecr:GetAuthorizationToken&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ecr:PutImage&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ecr:SetRepositoryPolicy&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ecr:BatchGetImage&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ecr:InitiateLayerUpload&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ecr:GetRepositoryPolicy&quot;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;Resource&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="use-case-for-servicestack-app-on-aws-lambda" tabindex="-1">Use Case for ServiceStack App on AWS Lambda <a class="header-anchor" href="#use-case-for-servicestack-app-on-aws-lambda" aria-hidden="true">#</a></h3><p>AWS Lambda Containers allows the use of standard docker tooling with AWS serverless offering which for low traffic volume applications or APIs can be an extremely cost effective way of hosting an application.</p><p>AWS provides a Lambda <a href="https://aws.amazon.com/lambda/pricing/" target="_blank" rel="noopener noreferrer">free-tier of 1M requests and 400,000GB-seconds of compute time per month</a>. This can be enough traffic for many full ServiceStack APIs or applications.</p><h3 id="deployment-process" tabindex="-1">Deployment process <a class="header-anchor" href="#deployment-process" aria-hidden="true">#</a></h3><p>The provided GitHub Action YAML configures a workflow to build, test, package and deploy your ServiceStack Application with AWS Lambda and API GateWay.</p><p>Additional configuration is needed to get your application accessible from a friendly name subdomain. This can be done with API GateWay Mapping and Route 53.</p><h3 id="public-access-via-custom-subdomain" tabindex="-1">Public access via custom subdomain <a class="header-anchor" href="#public-access-via-custom-subdomain" aria-hidden="true">#</a></h3><p>If you want to use this ServiceStack app external from AWS, you&#39;ll need create a &quot;Custom Domain&quot; within API GateWay and setup an <code>A</code> record in Route53 to a hosted zone.</p><ul><li>Navigate to <a href="https://console.aws.amazon.com/apigateway/main/publish/domain-names" target="_blank" rel="noopener noreferrer">API GateWay AWS Console</a>.</li><li>Select &quot;Create&quot; and specify the domain name and provide associated TLS certificate. If you don&#39;t yet have one, one can be created via AWS Certificate Manager or provided directly to this UI.</li><li>Once created, configure an API Mapping.</li><li>Specify the API Gateway and Stage.</li><li>View configuration and look for <code>API Gateway domain name</code>, copy this value ready for use in Route 53 configuration.</li><li>Select the hosted zone related to your subdomain in Route 53</li><li>Create an <code>A</code> record pointing to your <code>API Gateway domain name</code> copied from previous step</li></ul><p>Your application should now be viewable from your custom domain!</p><h3 id="aws-lambda-cold-starts" tabindex="-1">AWS Lambda Cold starts <a class="header-anchor" href="#aws-lambda-cold-starts" aria-hidden="true">#</a></h3><p>Just like any AWS Lambda application or function, the latency impacts of &#39;cold starts&#39; are something that can impact user experience significantly depending on your expected traffic load. When your function hasn&#39;t received any traffic for while, AWS Lambda will stop your container. Once a new request comes in, AWS Lambda needs to start up your application and wait for it to be ready to take your request. This creates the cold start latency problem. This also happens when there are already too many concurrent requests, to handle the increased load AWS Lambda will create new instances of your container to handle those requests.</p><p>If your load is low and expected, you can use tools like uptimerobot or others to periodically hit your application endpoint to keep at least one container alive to reduce this cold start latency.</p><p>Alternatively <a href="https://aws.amazon.com/blogs/aws/new-provisioned-concurrency-for-lambda-functions/" target="_blank" rel="noopener noreferrer">AWS Provisioned Capacity</a> can be used (at additional cost) to mitigate these limitations.</p>`,25),u=[i,c,r,l];function d(h,m,k,b,q,f){return n(),e("div",null,u)}var w=t(p,[["render",d]]);export{y as __pageData,w as default};
